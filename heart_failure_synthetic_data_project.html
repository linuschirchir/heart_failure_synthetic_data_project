<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Linus Chirchir">
<meta name="dcterms.date" content="2025-09-07">

<title>Heart Failure Clinical Records Synthetic Data Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="heart_failure_synthetic_data_project_files/libs/clipboard/clipboard.min.js"></script>
<script src="heart_failure_synthetic_data_project_files/libs/quarto-html/quarto.js"></script>
<script src="heart_failure_synthetic_data_project_files/libs/quarto-html/popper.min.js"></script>
<script src="heart_failure_synthetic_data_project_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="heart_failure_synthetic_data_project_files/libs/quarto-html/anchor.min.js"></script>
<link href="heart_failure_synthetic_data_project_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="heart_failure_synthetic_data_project_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="heart_failure_synthetic_data_project_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="heart_failure_synthetic_data_project_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="heart_failure_synthetic_data_project_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="styles/styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#heart-failure-clinical-records-dataset-and-initial-exploration" id="toc-heart-failure-clinical-records-dataset-and-initial-exploration" class="nav-link" data-scroll-target="#heart-failure-clinical-records-dataset-and-initial-exploration"><span class="header-section-number">2</span> Heart Failure Clinical Records Dataset and Initial Exploration</a></li>
  <li><a href="#generating-synthetic-data" id="toc-generating-synthetic-data" class="nav-link" data-scroll-target="#generating-synthetic-data"><span class="header-section-number">3</span> Generating Synthetic Data</a>
  <ul>
  <li><a href="#parametric-imputation-using-mice" id="toc-parametric-imputation-using-mice" class="nav-link" data-scroll-target="#parametric-imputation-using-mice"><span class="header-section-number">3.1</span> Parametric Imputation Using MICE</a></li>
  <li><a href="#non-parametric-imputation-using-cart" id="toc-non-parametric-imputation-using-cart" class="nav-link" data-scroll-target="#non-parametric-imputation-using-cart"><span class="header-section-number">3.2</span> Non-Parametric Imputation Using CART</a></li>
  <li><a href="#generating-synthetic-data-using-synthpop" id="toc-generating-synthetic-data-using-synthpop" class="nav-link" data-scroll-target="#generating-synthetic-data-using-synthpop"><span class="header-section-number">3.3</span> Generating Synthetic Data Using Synthpop</a></li>
  <li><a href="#generating-synthetic-data-using-metadada" id="toc-generating-synthetic-data-using-metadada" class="nav-link" data-scroll-target="#generating-synthetic-data-using-metadada"><span class="header-section-number">3.4</span> Generating Synthetic Data Using Metadada</a></li>
  </ul></li>
  <li><a href="#synthetic-data-identification" id="toc-synthetic-data-identification" class="nav-link" data-scroll-target="#synthetic-data-identification"><span class="header-section-number">4</span> Synthetic Data Identification</a></li>
  <li><a href="#synthetic-dataset-structure" id="toc-synthetic-dataset-structure" class="nav-link" data-scroll-target="#synthetic-dataset-structure"><span class="header-section-number">5</span> Synthetic Dataset Structure</a>
  <ul>
  <li><a href="#dataset-size-and-structure-comparison" id="toc-dataset-size-and-structure-comparison" class="nav-link" data-scroll-target="#dataset-size-and-structure-comparison"><span class="header-section-number">5.1</span> Dataset Size and Structure Comparison</a></li>
  <li><a href="#categorical-variables-all-levels-maintained-and-comparison-of-distribution" id="toc-categorical-variables-all-levels-maintained-and-comparison-of-distribution" class="nav-link" data-scroll-target="#categorical-variables-all-levels-maintained-and-comparison-of-distribution"><span class="header-section-number">5.2</span> Categorical Variables: All Levels Maintained and Comparison of Distribution</a></li>
  <li><a href="#numeric-variables-range-and-distribution-comparison" id="toc-numeric-variables-range-and-distribution-comparison" class="nav-link" data-scroll-target="#numeric-variables-range-and-distribution-comparison"><span class="header-section-number">5.3</span> Numeric Variables: Range and Distribution Comparison</a></li>
  <li><a href="#missingness-comparison" id="toc-missingness-comparison" class="nav-link" data-scroll-target="#missingness-comparison"><span class="header-section-number">5.4</span> Missingness Comparison</a>
  <ul class="collapse">
  <li><a href="#introduction-plots" id="toc-introduction-plots" class="nav-link" data-scroll-target="#introduction-plots"><span class="header-section-number">5.4.1</span> Introduction Plots</a></li>
  <li><a href="#missingness-proportions-and-comparison-outcome" id="toc-missingness-proportions-and-comparison-outcome" class="nav-link" data-scroll-target="#missingness-proportions-and-comparison-outcome"><span class="header-section-number">5.4.2</span> Missingness Proportions and Comparison Outcome</a></li>
  <li><a href="#missingness-maps" id="toc-missingness-maps" class="nav-link" data-scroll-target="#missingness-maps"><span class="header-section-number">5.4.3</span> Missingness Maps</a></li>
  </ul></li>
  <li><a href="#correlation-matrices-comparison" id="toc-correlation-matrices-comparison" class="nav-link" data-scroll-target="#correlation-matrices-comparison"><span class="header-section-number">5.5</span> Correlation Matrices Comparison</a>
  <ul class="collapse">
  <li><a href="#correlation-matrices-comparison-using-psych" id="toc-correlation-matrices-comparison-using-psych" class="nav-link" data-scroll-target="#correlation-matrices-comparison-using-psych"><span class="header-section-number">5.5.1</span> Correlation Matrices Comparison using psych</a></li>
  <li><a href="#correlation-matrices-comparison-using-corrplot" id="toc-correlation-matrices-comparison-using-corrplot" class="nav-link" data-scroll-target="#correlation-matrices-comparison-using-corrplot"><span class="header-section-number">5.5.2</span> Correlation Matrices Comparison using Corrplot</a></li>
  <li><a href="#correlation-matrices-comparison-using-ggally" id="toc-correlation-matrices-comparison-using-ggally" class="nav-link" data-scroll-target="#correlation-matrices-comparison-using-ggally"><span class="header-section-number">5.5.3</span> Correlation Matrices Comparison using GGally</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#fidelity-assessment" id="toc-fidelity-assessment" class="nav-link" data-scroll-target="#fidelity-assessment"><span class="header-section-number">6</span> Fidelity Assessment</a>
  <ul>
  <li><a href="#descriptive-statistics" id="toc-descriptive-statistics" class="nav-link" data-scroll-target="#descriptive-statistics"><span class="header-section-number">6.1</span> Descriptive Statistics</a>
  <ul class="collapse">
  <li><a href="#real-dataset" id="toc-real-dataset" class="nav-link" data-scroll-target="#real-dataset"><span class="header-section-number">6.1.1</span> Real Dataset</a></li>
  <li><a href="#parametric-imputation-mice" id="toc-parametric-imputation-mice" class="nav-link" data-scroll-target="#parametric-imputation-mice"><span class="header-section-number">6.1.2</span> Parametric Imputation (MICE)</a></li>
  <li><a href="#non-parametric-imputation-cart" id="toc-non-parametric-imputation-cart" class="nav-link" data-scroll-target="#non-parametric-imputation-cart"><span class="header-section-number">6.1.3</span> Non-Parametric Imputation (CART)</a></li>
  <li><a href="#synthpop-based-synthetic-data" id="toc-synthpop-based-synthetic-data" class="nav-link" data-scroll-target="#synthpop-based-synthetic-data"><span class="header-section-number">6.1.4</span> Synthpop-Based Synthetic Data</a></li>
  <li><a href="#metadata-based-synthetic-data" id="toc-metadata-based-synthetic-data" class="nav-link" data-scroll-target="#metadata-based-synthetic-data"><span class="header-section-number">6.1.5</span> Metadata-Based Synthetic Data</a></li>
  <li><a href="#parametric-imputation-mice-1" id="toc-parametric-imputation-mice-1" class="nav-link" data-scroll-target="#parametric-imputation-mice-1"><span class="header-section-number">6.1.6</span> Parametric Imputation (MICE)</a></li>
  <li><a href="#non-parametric-imputation-cart-1" id="toc-non-parametric-imputation-cart-1" class="nav-link" data-scroll-target="#non-parametric-imputation-cart-1"><span class="header-section-number">6.1.7</span> Non-Parametric Imputation (CART)</a></li>
  <li><a href="#synthpop-based-synthetic-data-1" id="toc-synthpop-based-synthetic-data-1" class="nav-link" data-scroll-target="#synthpop-based-synthetic-data-1"><span class="header-section-number">6.1.8</span> Synthpop-Based Synthetic Data</a></li>
  <li><a href="#metadata-based-synthetic-data-1" id="toc-metadata-based-synthetic-data-1" class="nav-link" data-scroll-target="#metadata-based-synthetic-data-1"><span class="header-section-number">6.1.9</span> Metadata-Based Synthetic Data</a></li>
  </ul></li>
  <li><a href="#histogram-similarity-score" id="toc-histogram-similarity-score" class="nav-link" data-scroll-target="#histogram-similarity-score"><span class="header-section-number">6.2</span> Histogram Similarity Score</a></li>
  <li><a href="#mutual-information-score" id="toc-mutual-information-score" class="nav-link" data-scroll-target="#mutual-information-score"><span class="header-section-number">6.3</span> Mutual Information Score</a></li>
  <li><a href="#correlation-score" id="toc-correlation-score" class="nav-link" data-scroll-target="#correlation-score"><span class="header-section-number">6.4</span> Correlation Score</a></li>
  </ul></li>
  <li><a href="#utility-assessment" id="toc-utility-assessment" class="nav-link" data-scroll-target="#utility-assessment"><span class="header-section-number">7</span> Utility Assessment</a>
  <ul>
  <li><a href="#feature-importance-consistency-assessment" id="toc-feature-importance-consistency-assessment" class="nav-link" data-scroll-target="#feature-importance-consistency-assessment"><span class="header-section-number">7.1</span> Feature Importance Consistency Assessment</a></li>
  <li><a href="#prediction-score" id="toc-prediction-score" class="nav-link" data-scroll-target="#prediction-score"><span class="header-section-number">7.2</span> Prediction Score</a></li>
  <li><a href="#quality-score-qscore" id="toc-quality-score-qscore" class="nav-link" data-scroll-target="#quality-score-qscore"><span class="header-section-number">7.3</span> Quality Score (QScore)</a></li>
  </ul></li>
  <li><a href="#privacy-disclosure-risk" id="toc-privacy-disclosure-risk" class="nav-link" data-scroll-target="#privacy-disclosure-risk"><span class="header-section-number">8</span> Privacy / Disclosure Risk</a>
  <ul>
  <li><a href="#check-for-replication-of-real-value-combinations" id="toc-check-for-replication-of-real-value-combinations" class="nav-link" data-scroll-target="#check-for-replication-of-real-value-combinations"><span class="header-section-number">8.1</span> Check for Replication of Real Value Combinations</a></li>
  <li><a href="#check-for-unique-value-combinations" id="toc-check-for-unique-value-combinations" class="nav-link" data-scroll-target="#check-for-unique-value-combinations"><span class="header-section-number">8.2</span> Check for Unique Value Combinations</a></li>
  <li><a href="#exact-match-score" id="toc-exact-match-score" class="nav-link" data-scroll-target="#exact-match-score"><span class="header-section-number">8.3</span> Exact Match Score</a></li>
  <li><a href="#neighbors-privacy-score" id="toc-neighbors-privacy-score" class="nav-link" data-scroll-target="#neighbors-privacy-score"><span class="header-section-number">8.4</span> Neighbors’ Privacy Score</a></li>
  <li><a href="#membership-inference-score" id="toc-membership-inference-score" class="nav-link" data-scroll-target="#membership-inference-score"><span class="header-section-number">8.5</span> Membership Inference Score</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions"><span class="header-section-number">9</span> Conclusions</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="heart_failure_synthetic_data_project.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Heart Failure Clinical Records Synthetic Data Project</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Linus Chirchir </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">7 September 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Project and Performance Utilities ---</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)                 <span class="co"># Manage project-relative file paths</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)           <span class="co"># Enable parallel processing for faster computations</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)            <span class="co"># Core data science toolkit (dplyr, tidyr, readr, purrr, etc.)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)               <span class="co"># Import Excel (.xlsx, .xls) files into R</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Data Exploration and Summaries ---</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)                <span class="co"># Produce descriptive statistics and psychometric analyses</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)                <span class="co"># Format dynamic tables and reports in Markdown/Quarto</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Visualisation ---</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)              <span class="co"># Build customizable, high-quality data visualizations</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)            <span class="co"># Combine multiple ggplot2 plots into unified layouts</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)             <span class="co"># Visualize correlation matrices with heatmaps and plots</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)               <span class="co"># Extend ggplot2 with correlation plots, pairwise plots, ggpairs()</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VIM)                  <span class="co"># Visualize/impute missing values with advanced methods (e.g., matrix plots)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Data Imputation and Synthesis ---</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)                 <span class="co"># Perform multiple imputation by chained equations for missing data</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(synthpop)             <span class="co"># Generate, evaluate, and compare synthetic datasets</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Statistical and Information-Theoretic Measures ---</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(transport)            <span class="co"># Compute optimal transport distances (e.g., Wasserstein) for distribution comparison</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(infotheo)             <span class="co"># Calculate information-theoretic metrics (entropy, mutual information)</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Modeling and Machine Learning ---</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)                <span class="co"># Streamline machine learning workflows (training, tuning, evaluation)</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)              <span class="co"># Implement gradient boosting for classification/regression</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SHAPforxgboost)       <span class="co"># Explain XGBoost predictions using SHAP values</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FNN)                  <span class="co"># Perform fast k-nearest neighbor searches and distance calculations</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up parallel processing</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>num_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Use one less than the total number of cores</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(num_cores)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div style="page-break-after: always;"></div>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>This project evaluates the quality of synthetic datasets derived from the Heart Failure Clinical Records data (299 patients, 13 variables). Our goal is to determine how well different generation strategies reproduce the statistical properties and analytic value of the original data while protecting privacy. We generate synthetic data using four approaches: (1) parametric imputation (MICE), (2) non-parametric imputation (CART via MICE), (3) distribution-driven synthesis (synthpop), and (4) metadata-guided rules. We then compare each synthetic dataset with the real data across three dimensions:</p>
<ul>
<li>Fidelity – univariate and multivariate similarity (distributions, ranges, correlations), histogram similarity, and mutual information.</li>
<li>Utility – model transportability using XGBoost (TRTR vs.&nbsp;TSTR), feature-importance agreement, and SHAP-based behaviour.</li>
<li>Privacy / Disclosure risk – exact record matches, neighbour-proximity checks, and membership-inference sensitivity.</li>
</ul>
<p>Results are presented through aligned tables and plots (structure checks, categorical level retention, density overlays, correlation matrices, SHAP summaries) with concise scores for each method. The report concludes with a comparative summary to guide method selection given different fidelity–utility–privacy trade-offs.</p>
</section>
<section id="heart-failure-clinical-records-dataset-and-initial-exploration" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="heart-failure-clinical-records-dataset-and-initial-exploration"><span class="header-section-number">2</span> Heart Failure Clinical Records Dataset and Initial Exploration</h2>
<p>The <strong>Heart Failure Clinical Records dataset</strong>, sourced from the <a href="https://archive.ics.uci.edu/dataset/519/heart+failure+clinical+records">UCI Machine Learning Repository</a>, contains records of <strong>299 patients</strong> with heart failure collected during their follow-up period. Each record includes <strong>13 clinical features</strong> covering demographics, clinical conditions, and laboratory measures:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 51%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Unit / Levels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>age</strong></td>
<td>Age of the patient</td>
<td>Years</td>
</tr>
<tr class="even">
<td><strong>anaemia</strong></td>
<td>Reduction in red blood cells</td>
<td>No / Yes</td>
</tr>
<tr class="odd">
<td><strong>creatinine_phosphokinase</strong></td>
<td>Enzyme level in the blood</td>
<td>mcg/L</td>
</tr>
<tr class="even">
<td><strong>diabetes</strong></td>
<td>Diabetes status</td>
<td>No / Yes</td>
</tr>
<tr class="odd">
<td><strong>ejection_fraction</strong></td>
<td>% of blood leaving the heart with each contraction</td>
<td>Percentage (%)</td>
</tr>
<tr class="even">
<td><strong>platelets</strong></td>
<td>Platelet count</td>
<td>Kiloplatelets/mL</td>
</tr>
<tr class="odd">
<td><strong>serum_creatinine</strong></td>
<td>Serum creatinine level</td>
<td>mg/dL</td>
</tr>
<tr class="even">
<td><strong>serum_sodium</strong></td>
<td>Serum sodium level</td>
<td>mEq/L</td>
</tr>
<tr class="odd">
<td><strong>sex</strong></td>
<td>Gender of the patient</td>
<td>Female / Male</td>
</tr>
<tr class="even">
<td><strong>smoking</strong></td>
<td>Smoking status</td>
<td>No / Yes</td>
</tr>
<tr class="odd">
<td><strong>hypertension</strong></td>
<td>Hypertension status</td>
<td>No / Yes</td>
</tr>
<tr class="even">
<td><strong>deceased</strong></td>
<td>Survival status during follow-up</td>
<td>No / Yes</td>
</tr>
<tr class="odd">
<td><strong>follow_up</strong></td>
<td>Duration of the follow-up period</td>
<td>Days</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>A preview of the first 10 rows of the dataset is shown below.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the heart failure dataset from the local directory</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>heart_failure <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"heart_failure.csv"</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's preview the heart failure dataset</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(heart_failure, <span class="dv">10</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Preview of the first 10 rows of the Heart Failure dataset"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">rep</span>(<span class="st">"l"</span>, <span class="fu">ncol</span>(heart_failure))  <span class="co"># left align all columns</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Preview of the first 10 rows of the Heart Failure dataset</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 16%">
<col style="width: 5%">
<col style="width: 11%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">age</th>
<th style="text-align: left;">anaemia</th>
<th style="text-align: left;">creatinine_phosphokinase</th>
<th style="text-align: left;">diabetes</th>
<th style="text-align: left;">ejection_fraction</th>
<th style="text-align: left;">platelets</th>
<th style="text-align: left;">serum_creatinine</th>
<th style="text-align: left;">serum_sodium</th>
<th style="text-align: left;">sex</th>
<th style="text-align: left;">smoking</th>
<th style="text-align: left;">hypertension</th>
<th style="text-align: left;">deceased</th>
<th style="text-align: left;">follow_up</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">75</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">582</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">265000</td>
<td style="text-align: left;">1.9</td>
<td style="text-align: left;">130</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">55</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">7861</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">263358</td>
<td style="text-align: left;">1.1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">65</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">162000</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">129</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">111</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">1.9</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">65</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">160</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">327000</td>
<td style="text-align: left;">2.7</td>
<td style="text-align: left;">116</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">90</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">47</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">40</td>
<td style="text-align: left;">204000</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">132</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">246</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">1.2</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">60</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">315</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">60</td>
<td style="text-align: left;">454000</td>
<td style="text-align: left;">1.1</td>
<td style="text-align: left;">131</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">263358</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">80</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">123</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">388000</td>
<td style="text-align: left;">9.4</td>
<td style="text-align: left;">133</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">10</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Here’s the preview of the structure of the heart failure dataset.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(heart_failure),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type   =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(heart_failure, \(x) <span class="fu">paste</span>(<span class="fu">class</span>(x), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Values =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(heart_failure, \(x) <span class="fu">paste</span>(<span class="fu">head</span>(<span class="fu">unique</span>(x), <span class="dv">10</span>), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  df,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Structure of the Heart Failure Dataset: Variables, Types, and Values"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"l"</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Structure of the Heart Failure Dataset: Variables, Types, and Values</caption>
<colgroup>
<col style="width: 22%">
<col style="width: 8%">
<col style="width: 69%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">75, 55, 65, NA, 90, 60, 80, 62, 45, 50</td>
</tr>
<tr class="even">
<td style="text-align: left;">anaemia</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">582, 7861, NA, 111, 160, 47, 246, 315, 123, 81</td>
</tr>
<tr class="even">
<td style="text-align: left;">diabetes</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">20, NA, 40, 15, 60, 65, 35, 38, 25, 30</td>
</tr>
<tr class="even">
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">265000, 263358.03, 162000, NA, 327000, 204000, 454000, 388000, 368000, 253000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">1.9, 1.1, NA, 2.7, 1.2, 9.4, 4, 0.9, 1, 1.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">130, NA, 129, 116, 132, 131, 133, 140, 137, 138</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Male, Female</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoking</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hypertension</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">follow_up</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">4, 6, 7, 8, 10, 11, 12, 13, 14, 15</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Let’s perform some basic data cleaning and preprocessing steps. Convert the following columns to factors: sex, anaemia, diabetes, smoking, hypertension and deceased. Here’s the new structure of the dataset after the basic cleaning.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the specified columns to factors</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart_failure<span class="sc">$</span>sex)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>anaemia <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart_failure<span class="sc">$</span>anaemia)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>diabetes <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart_failure<span class="sc">$</span>diabetes)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>smoking <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart_failure<span class="sc">$</span>smoking)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>hypertension <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart_failure<span class="sc">$</span>hypertension)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>deceased <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart_failure<span class="sc">$</span>deceased)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are the summary statistics of the heart failure dataset.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate descriptive statistics and display as a single table</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(heart_failure) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Summary Statistics of the Heart Failure Dataset"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,  <span class="co"># round to 2 decimal places</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"lrrrrrrrrrr"</span>  <span class="co"># left for variable, right for numbers</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Summary Statistics of the Heart Failure Dataset</caption>
<colgroup>
<col style="width: 19%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">vars</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">trimmed</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">range</th>
<th style="text-align: right;">skew</th>
<th style="text-align: left;">kurtosis</th>
<th style="text-align: right;">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">60.80</td>
<td style="text-align: right;">12.08</td>
<td style="text-align: right;">60.0</td>
<td style="text-align: right;">60.15</td>
<td style="text-align: right;">14.83</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: right;">95.0</td>
<td style="text-align: right;">55.0</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: left;">-0.28</td>
<td style="text-align: right;">0.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">anaemia*</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.41</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: left;">-1.93</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">578.81</td>
<td style="text-align: right;">981.99</td>
<td style="text-align: right;">249.0</td>
<td style="text-align: right;">358.95</td>
<td style="text-align: right;">268.35</td>
<td style="text-align: right;">23.0</td>
<td style="text-align: right;">7861.0</td>
<td style="text-align: right;">7838.0</td>
<td style="text-align: right;">4.45</td>
<td style="text-align: left;">24.52</td>
<td style="text-align: right;">58.17</td>
</tr>
<tr class="even">
<td style="text-align: left;">diabetes*</td>
<td style="text-align: left;">4</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.40</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: left;">-1.90</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">5</td>
<td style="text-align: right;">287</td>
<td style="text-align: right;">38.00</td>
<td style="text-align: right;">11.92</td>
<td style="text-align: right;">38.0</td>
<td style="text-align: right;">37.31</td>
<td style="text-align: right;">11.86</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">80.0</td>
<td style="text-align: right;">66.0</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">0.02</td>
<td style="text-align: right;">0.70</td>
</tr>
<tr class="even">
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">6</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">265163.83</td>
<td style="text-align: right;">97508.63</td>
<td style="text-align: right;">263358.0</td>
<td style="text-align: right;">259212.20</td>
<td style="text-align: right;">65765.22</td>
<td style="text-align: right;">25100.0</td>
<td style="text-align: right;">850000.0</td>
<td style="text-align: right;">824900.0</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: left;">6.24</td>
<td style="text-align: right;">5775.91</td>
</tr>
<tr class="odd">
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">7</td>
<td style="text-align: right;">281</td>
<td style="text-align: right;">1.39</td>
<td style="text-align: right;">1.05</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">1.18</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">9.4</td>
<td style="text-align: right;">8.9</td>
<td style="text-align: right;">4.44</td>
<td style="text-align: left;">25.03</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: left;">8</td>
<td style="text-align: right;">279</td>
<td style="text-align: right;">136.59</td>
<td style="text-align: right;">4.49</td>
<td style="text-align: right;">137.0</td>
<td style="text-align: right;">136.80</td>
<td style="text-align: right;">4.45</td>
<td style="text-align: right;">113.0</td>
<td style="text-align: right;">148.0</td>
<td style="text-align: right;">35.0</td>
<td style="text-align: right;">-1.05</td>
<td style="text-align: left;">3.88</td>
<td style="text-align: right;">0.27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex*</td>
<td style="text-align: left;">9</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">1.68</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">-0.62</td>
<td style="text-align: left;">-1.62</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoking*</td>
<td style="text-align: left;">10</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.28</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: left;">-1.42</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hypertension*</td>
<td style="text-align: left;">11</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.35</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: left;">-1.62</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased*</td>
<td style="text-align: left;">12</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.28</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: left;">-1.42</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">follow_up</td>
<td style="text-align: left;">13</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">130.26</td>
<td style="text-align: right;">77.61</td>
<td style="text-align: right;">115.0</td>
<td style="text-align: right;">129.28</td>
<td style="text-align: right;">105.26</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">285.0</td>
<td style="text-align: right;">281.0</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: left;">-1.22</td>
<td style="text-align: right;">4.49</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="generating-synthetic-data" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="generating-synthetic-data"><span class="header-section-number">3</span> Generating Synthetic Data</h2>
<p>The process of generating synthetic data is essential for tasks such as privacy preservation, testing machine learning models, and conducting simulations. In this section, we employ various techniques to generate synthetic data based on the real heart failure dataset. Each method serves a different purpose and offers distinct advantages, depending on the use case and the type of missing data or privacy concerns.</p>
<p>We explore four key approaches for generating synthetic data:</p>
<section id="parametric-imputation-using-mice" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="parametric-imputation-using-mice"><span class="header-section-number">3.1</span> Parametric Imputation Using MICE</h3>
<p>This method uses the Multivariate Imputation by Chained Equations (MICE) framework, with parametric imputation based on a normal distribution. MICE allows for handling missing data through multiple imputations and is widely used in data science and healthcare for its flexibility and statistical rigor. Here’s the preview of the first 10 rows of the synthetic data generated.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute the 5th and 95th percentiles for numeric columns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>compute_percentiles <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">lower_percentile =</span> <span class="fl">0.05</span>, <span class="at">upper_percentile =</span> <span class="fl">0.95</span>) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  percentiles <span class="ot">&lt;-</span> <span class="fu">lapply</span>(data, <span class="cf">function</span>(column) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(column)) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      lower <span class="ot">&lt;-</span> <span class="fu">quantile</span>(column, <span class="at">probs =</span> lower_percentile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      upper <span class="ot">&lt;-</span> <span class="fu">quantile</span>(column, <span class="at">probs =</span> upper_percentile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">c</span>(lower, upper))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(percentiles) <span class="ot">&lt;-</span> <span class="fu">names</span>(data)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(percentiles)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to scale numeric values based on the 5th and 95th percentiles</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>scale_to_percentiles <span class="ot">&lt;-</span> <span class="cf">function</span>(data, percentiles) {</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  scaled_data <span class="ot">&lt;-</span> data</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">colnames</span>(data)) {</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(data[[col]])) {</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Apply scaling only if percentiles are available for this column</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(percentiles[[col]][<span class="dv">1</span>]) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(percentiles[[col]][<span class="dv">2</span>])) {</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        min_val <span class="ot">&lt;-</span> percentiles[[col]][<span class="dv">1</span>]</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        max_val <span class="ot">&lt;-</span> percentiles[[col]][<span class="dv">2</span>]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clip values to lie within the 5th and 95th percentile range</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        scaled_data[[col]] <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(data[[col]], min_val), max_val)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(scaled_data)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate missingness in a dataset based on the real data's pattern</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>generate_missingness_based_on_real <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data) {</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure the synthetic dataset has the same structure as the real</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">colnames</span>(real_data) <span class="sc">==</span> <span class="fu">colnames</span>(synthetic_data))) {</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Column names in real and synthetic data must match"</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Copy the real missingness pattern to the synthetic dataset</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  synthetic_data_with_missingness <span class="ot">&lt;-</span> synthetic_data</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">colnames</span>(real_data)) {</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply missingness where it was present in the real data</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    missing_indices <span class="ot">&lt;-</span> <span class="fu">is.na</span>(real_data[[col]])</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    synthetic_data_with_missingness[[col]][missing_indices] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(synthetic_data_with_missingness)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the 5th and 95th percentiles for the real data</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>percentiles <span class="ot">&lt;-</span> <span class="fu">compute_percentiles</span>(heart_failure)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data using MICE</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>where <span class="ot">&lt;-</span> <span class="fu">make.where</span>(heart_failure, <span class="st">"all"</span>)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>method <span class="ot">&lt;-</span> <span class="fu">make.method</span>(heart_failure, <span class="at">where =</span> where)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>method[method <span class="sc">==</span> <span class="st">"pmm"</span>] <span class="ot">&lt;-</span> <span class="st">"norm"</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform multiple imputation (10 datasets)</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>syn_param <span class="ot">&lt;-</span> <span class="fu">mice</span>(heart_failure, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">maxit =</span> <span class="dv">1</span>, <span class="at">method =</span> method, <span class="at">where =</span> where, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the first synthetic dataset</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>syn_data_1 <span class="ot">&lt;-</span> <span class="fu">complete</span>(syn_param, <span class="dv">1</span>)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale synthetic data to the 5th and 95th percentile ranges</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>syn_data_1 <span class="ot">&lt;-</span> <span class="fu">scale_to_percentiles</span>(syn_data_1, percentiles)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the real missingness pattern to the synthetic dataset</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>syn_data_1 <span class="ot">&lt;-</span> <span class="fu">generate_missingness_based_on_real</span>(heart_failure, syn_data_1)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Round off all numeric columns to 0 decimal places</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>syn_data_1 <span class="ot">&lt;-</span> syn_data_1 <span class="sc">%&gt;%</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">0</span>))</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a prefix 'synth_' to all synthetic dataset variable names</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_data_1) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"synth"</span>, <span class="fu">colnames</span>(syn_data_1), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the structure of the dataset (fix double variable issue)</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>df_syn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(syn_data_1),</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type   =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(syn_data_1, \(x) <span class="fu">paste</span>(<span class="fu">class</span>(x), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">Values =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(syn_data_1, \(x) <span class="fu">paste</span>(<span class="fu">head</span>(<span class="fu">unique</span>(x), <span class="dv">10</span>), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicated variables if any</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>df_syn <span class="ot">&lt;-</span> df_syn[<span class="sc">!</span><span class="fu">duplicated</span>(df_syn<span class="sc">$</span>Variable), ]</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>  df_syn,</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Structure of the Heart Failure Dataset: Variables, Types, and Values"</span>,</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"l"</span>),</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Structure of the Heart Failure Dataset: Variables, Types, and Values</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 7%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">56, 42, 57, NA, 69, 53, 72, 59, 82, 73</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">184, 1540, NA, 559, 941, 1926, 570, 1380, 59, 1531</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">40, NA, 52, 48, 49, 27, 33, 51, 30, 39</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">284572, 235177, 175379, NA, 352540, 132200, 349886, 421200, 246142, 265262</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">2, 1, NA, 3</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">138, NA, 131, 130, 137, 135, 142, 134, 141, 144</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Male, Female</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">90, 13, 88, 40, 31, 129, 91, 51, 29, 118</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="non-parametric-imputation-using-cart" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="non-parametric-imputation-using-cart"><span class="header-section-number">3.2</span> Non-Parametric Imputation Using CART</h3>
<p>The Classification and Regression Trees (CART) method, a non-parametric approach, is useful for imputation when the relationships between variables are complex or non-linear. By leveraging decision trees, CART is capable of capturing intricate patterns in the data without making strong assumptions about the underlying distributions. Here’s the preview of the first 10 rows of the synthetic data generated.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the 5th and 95th percentiles for the real data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>percentiles <span class="ot">&lt;-</span> <span class="fu">compute_percentiles</span>(heart_failure)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data using CART imputation with MICE</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>where <span class="ot">&lt;-</span> <span class="fu">make.where</span>(heart_failure, <span class="st">"all"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>method <span class="ot">&lt;-</span> <span class="fu">make.method</span>(heart_failure, <span class="at">where =</span> where)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>method[method <span class="sc">==</span> <span class="st">"pmm"</span>] <span class="ot">&lt;-</span> <span class="st">"cart"</span>  <span class="co"># Set the method to "cart" for non-parametric imputation</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform multiple imputation (10 datasets)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>syn_cart <span class="ot">&lt;-</span> <span class="fu">mice</span>(heart_failure, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">maxit =</span> <span class="dv">1</span>, <span class="at">method =</span> method, <span class="at">where =</span> where, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the first synthetic dataset</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>syn_cart_1 <span class="ot">&lt;-</span> <span class="fu">complete</span>(syn_cart, <span class="dv">1</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale synthetic data to the 5th and 95th percentile ranges</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>syn_cart_1 <span class="ot">&lt;-</span> <span class="fu">scale_to_percentiles</span>(syn_cart_1, percentiles)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the real missingness pattern to the synthetic dataset</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>syn_cart_1 <span class="ot">&lt;-</span> <span class="fu">generate_missingness_based_on_real</span>(heart_failure, syn_cart_1)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Round off all numeric columns to 0 decimal places</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>syn_cart_1 <span class="ot">&lt;-</span> syn_cart_1 <span class="sc">%&gt;%</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">0</span>))</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a prefix 'synth_' to all synthetic dataset variable names</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_cart_1) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"synth"</span>, <span class="fu">colnames</span>(syn_cart_1), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the structure of the dataset (fix double variable issue)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>df_cart <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(syn_cart_1),</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type   =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(syn_cart_1, \(x) <span class="fu">paste</span>(<span class="fu">class</span>(x), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">Values =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(syn_cart_1, \(x) <span class="fu">paste</span>(<span class="fu">head</span>(<span class="fu">unique</span>(x), <span class="dv">10</span>), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicated variables if any</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>df_cart <span class="ot">&lt;-</span> df_cart[<span class="sc">!</span><span class="fu">duplicated</span>(df_cart<span class="sc">$</span>Variable), ]</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  df_cart,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Structure of the Heart Failure Dataset: Variables, Types, and Values (CART Imputation)"</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"l"</span>),</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Structure of the Heart Failure Dataset: Variables, Types, and Values (CART Imputation)</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 7%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">60, 50, 65, NA, 82, 53, 75, 69, 70, 45</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">582, 161, NA, 203, 112, 371, 246, 60, 59, 2221</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">30, NA, 38, 25, 50, 60, 35, 20, 45, 40</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">132200, 263358, NA, 421200, 351000, 219000, 327000, 213000, 395000, 282000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">3, 1, NA, 2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">133, NA, 130, 140, 138, 139, 137, 136, 134, 135</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Female, Male</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">59, 30, 154, 24, 66, 13, 28, 65, 129, 72</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="generating-synthetic-data-using-synthpop" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="generating-synthetic-data-using-synthpop"><span class="header-section-number">3.3</span> Generating Synthetic Data Using Synthpop</h3>
<p>The Synthpop package is designed for creating synthetic data based on the distribution of the real dataset. It is particularly useful for privacy-preserving data sharing, where the aim is to create a synthetic dataset that mimics the real data without exposing sensitive information. Here’s the preview of the first 10 rows of the synthetic data generated.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the 5th and 95th percentiles for the real data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>percentiles <span class="ot">&lt;-</span> <span class="fu">compute_percentiles</span>(heart_failure)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate low-fidelity synthetic data using random sampling</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>syn_data_low_fidelity <span class="ot">&lt;-</span> <span class="fu">syn</span>(heart_failure, <span class="at">method =</span> <span class="st">"sample"</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Synthesis
-----------
 age anaemia creatinine_phosphokinase diabetes ejection_fraction platelets serum_creatinine serum_sodium sex smoking
 hypertension deceased follow_up</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the synthetic dataset to a data frame</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>syn_data_low_fidelity_synthpop <span class="ot">&lt;-</span> syn_data_low_fidelity<span class="sc">$</span>syn</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the synthetic data to the 5th and 95th percentile ranges</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>syn_data_low_fidelity_synthpop <span class="ot">&lt;-</span> <span class="fu">scale_to_percentiles</span>(syn_data_low_fidelity_synthpop, percentiles)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the real missingness pattern to the synthetic dataset</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>syn_data_low_fidelity_synthpop <span class="ot">&lt;-</span> <span class="fu">generate_missingness_based_on_real</span>(heart_failure, syn_data_low_fidelity_synthpop)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Round off all numeric columns to 0 decimal places</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>syn_data_low_fidelity_synthpop <span class="ot">&lt;-</span> syn_data_low_fidelity_synthpop <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">0</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a prefix 'synth_' to all synthetic dataset variable names</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_data_low_fidelity_synthpop) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"synth"</span>, <span class="fu">colnames</span>(syn_data_low_fidelity_synthpop), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the structure of the dataset (fix double variable issue)</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>df_synthpop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(syn_data_low_fidelity_synthpop),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type   =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(syn_data_low_fidelity_synthpop, \(x) <span class="fu">paste</span>(<span class="fu">class</span>(x), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Values =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(syn_data_low_fidelity_synthpop, \(x) <span class="fu">paste</span>(<span class="fu">head</span>(<span class="fu">unique</span>(x), <span class="dv">10</span>), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicated variables if any</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>df_synthpop <span class="ot">&lt;-</span> df_synthpop[<span class="sc">!</span><span class="fu">duplicated</span>(df_synthpop<span class="sc">$</span>Variable), ]</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  df_synthpop,</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Structure of the Heart Failure Dataset: Variables, Types, and Values (Synthpop)"</span>,</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"l"</span>),</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Structure of the Heart Failure Dataset: Variables, Types, and Values (Synthpop)</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 7%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">63, 50, 45, NA, 73, 57, 70, 52, 65, 80</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">427, 335, NA, 249, 64, 1610, 2221, 224, 910, 260</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">25, NA, 20, 40, 60, 30, 35, 38, 45, 50</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">NA, 229000, 385000, 277000, 268000, 271000, 274000, 189000, 236000, 329000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">1, NA, 2, 3</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">142, NA, 139, 136, 137, 134, 140, 130, 144, 135</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Male, Female</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">250, 13, 91, 121, 20, 113, 186, 85, 74, 50</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="generating-synthetic-data-using-metadada" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="generating-synthetic-data-using-metadada"><span class="header-section-number">3.4</span> Generating Synthetic Data Using Metadada</h3>
<p>This method uses a data dictionary (metadata) to drive the generation of synthetic data. The metadata defines the structure and types of variables, which ensures that the generated synthetic data conforms to expected formats, such as ranges for continuous variables and categories for binary or categorical variables. Here’s the preview of the first 10 rows of the synthetic data generated.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the 5th and 95th percentiles for the real data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>percentiles <span class="ot">&lt;-</span> <span class="fu">compute_percentiles</span>(heart_failure)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data using metadata</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the metadata from the Excel file</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>heart_failure_metadata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"heart_failure_metadata.xlsx"</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty data frame based on the metadata structure</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>n_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(heart_failure)  <span class="co"># Number of synthetic records to generate</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> heart_failure_metadata<span class="sc">$</span><span class="st">`</span><span class="at">Variable Name</span><span class="st">`</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>data_types <span class="ot">&lt;-</span> heart_failure_metadata<span class="sc">$</span>Type</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>syn_data_metadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(variable_names), <span class="at">nrow =</span> n_rows))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_data_metadata) <span class="ot">&lt;-</span> variable_names</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate data based on metadata</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>generate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, real_data, type, n) {</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Continuous"</span> <span class="sc">||</span> type <span class="sc">==</span> <span class="st">"Integer"</span>) {</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(real_data[[variable]])) {</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Compute 5th and 95th percentiles for numeric variables</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>      p5 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(real_data[[variable]], <span class="at">probs =</span> <span class="fl">0.05</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>      p95 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(real_data[[variable]], <span class="at">probs =</span> <span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Continuous"</span>) {</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">runif</span>(n, <span class="at">min =</span> p5, <span class="at">max =</span> p95))</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Integer"</span>) {</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">sample</span>(<span class="fu">floor</span>(p5)<span class="sc">:</span><span class="fu">ceiling</span>(p95), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.factor</span>(real_data[[variable]])) {</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sample</span>(<span class="fu">levels</span>(real_data[[variable]]), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"anaemia"</span>, <span class="st">"diabetes"</span>, <span class="st">"hypertension"</span>, <span class="st">"smoking"</span>, <span class="st">"sex"</span>)) {</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sample</span>(<span class="fu">unique</span>(real_data[[variable]]), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n))</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data based on the metadata</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(variable_names)) {</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  syn_data_metadata[[i]] <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(variable_names[i], heart_failure, data_types[i], n_rows)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the synthetic data to the 5th and 95th percentile ranges</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>syn_data_metadata <span class="ot">&lt;-</span> <span class="fu">scale_to_percentiles</span>(syn_data_metadata, percentiles)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the real missingness pattern to the synthetic dataset</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>syn_data_metadata <span class="ot">&lt;-</span> <span class="fu">generate_missingness_based_on_real</span>(heart_failure, syn_data_metadata)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Round off all numeric columns to 0 decimal places</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>syn_data_metadata <span class="ot">&lt;-</span> syn_data_metadata <span class="sc">%&gt;%</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">0</span>))</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a prefix 'synth_' to all synthetic dataset variable names</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_data_metadata) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"synth"</span>, <span class="fu">colnames</span>(syn_data_metadata), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the structure of the dataset (fix double variable issue)</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>df_metadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(syn_data_metadata),</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type   =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(syn_data_metadata, \(x) <span class="fu">paste</span>(<span class="fu">class</span>(x), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">Values =</span> <span class="fu">unname</span>(<span class="fu">sapply</span>(syn_data_metadata, \(x) <span class="fu">paste</span>(<span class="fu">head</span>(<span class="fu">unique</span>(x), <span class="dv">10</span>), <span class="at">collapse =</span> <span class="st">", "</span>))),</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span>,</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicated variables if any</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>df_metadata <span class="ot">&lt;-</span> df_metadata[<span class="sc">!</span><span class="fu">duplicated</span>(df_metadata<span class="sc">$</span>Variable), ]</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  df_metadata,</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Structure of the Heart Failure Dataset: Variables, Types, and Values (Metadata)"</span>,</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"l"</span>),</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Structure of the Heart Failure Dataset: Variables, Types, and Values (Metadata)</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 8%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">45, 51, 82, NA, 80, 66, 59, 71, 47, 57</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">180, 1663, NA, 191, 571, 1228, 395, 1553, 812, 335</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">31, NA, 58, 60, 29, 26, 37, 33, 24, 28</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">210137, 203132, 257570, NA, 395609, 331643, 171789, 279683, 413390, 185403</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">3, 1, NA, 2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">136, NA, 138, 131, 130, 135, 134, 137, 143, 142</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Female, Male</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Yes, No</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">No, Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">152, 231, 199, 46, 188, 117, 57, 248, 90, 237</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="synthetic-data-identification" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="synthetic-data-identification"><span class="header-section-number">4</span> Synthetic Data Identification</h2>
<p>In this section, we generate tables to identify which columns in the synthetic datasets are synthetic (prefixed with “synth_”) and which remain unchanged from the real dataset. This helps ensure clarity on which variables have been altered during the synthetic data generation process.</p>
<p>For each dataset, we produce a table displaying the column names and whether the column is synthetic. A column is marked “Yes” if it was generated synthetically and “No” if it was retained from the real data.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create column info with dataset name</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>create_column_info <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, dataset_name) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_name =</span> <span class="fu">colnames</span>(dataset),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dataset =</span> dataset_name,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_synthetic =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^synth_"</span>, <span class="fu">colnames</span>(dataset)), <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect column info for all datasets</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>all_column_info <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_column_info</span>(syn_data_1, <span class="st">"Parametric MICE"</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_column_info</span>(syn_cart_1, <span class="st">"CART Imputation"</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_column_info</span>(syn_data_low_fidelity_synthpop, <span class="st">"Synthpop (Low Fidelity)"</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_column_info</span>(syn_data_metadata, <span class="st">"Metadata-Based"</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape into wide format so variables appear once</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>wide_column_info <span class="ot">&lt;-</span> all_column_info <span class="sc">%&gt;%</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> dataset,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> is_synthetic</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the combined wide table</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  wide_column_info,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Synthetic Indicators for Each Variable Across Datasets"</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Synthetic Indicators for Each Variable Across Datasets</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 23%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">column_name</th>
<th style="text-align: left;">Parametric MICE</th>
<th style="text-align: left;">CART Imputation</th>
<th style="text-align: left;">Synthpop (Low Fidelity)</th>
<th style="text-align: left;">Metadata-Based</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="synthetic-dataset-structure" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="synthetic-dataset-structure"><span class="header-section-number">5</span> Synthetic Dataset Structure</h2>
<section id="dataset-size-and-structure-comparison" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="dataset-size-and-structure-comparison"><span class="header-section-number">5.1</span> Dataset Size and Structure Comparison</h3>
<p>This step evaluates whether the synthetic datasets match the real dataset in terms of the number of rows, columns, and feature types. Consistency in these dimensions is essential for the synthetic data to be a reliable stand-in for the real.</p>
<ul>
<li><p><strong>Number of Rows</strong>: Indicates if the synthetic data captures the same number of records as the real. Any mismatch can impact comparability.</p></li>
<li><p><strong>Number of Columns</strong>: Ensures all variables are retained. Missing or extra columns suggest structural issues.</p></li>
<li><p><strong>Feature Types</strong>: Confirms that categorical, numerical, and other variable types remain unchanged, preserving analytical consistency.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract structure info</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>get_structure_info <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data, dataset_name) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Dataset =</span> dataset_name,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rows_Real =</span> <span class="fu">nrow</span>(real_data),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cols_Real =</span> <span class="fu">ncol</span>(real_data),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rows_Synthetic =</span> <span class="fu">nrow</span>(synthetic_data),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cols_Synthetic =</span> <span class="fu">ncol</span>(synthetic_data),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Structure_Match =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nrow</span>(real_data) <span class="sc">==</span> <span class="fu">nrow</span>(synthetic_data) <span class="sc">&amp;</span> <span class="fu">ncol</span>(real_data) <span class="sc">==</span> <span class="fu">ncol</span>(synthetic_data),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"✅ Yes"</span>, <span class="st">"❌ No"</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect results</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>structure_comparison <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_structure_info</span>(heart_failure, syn_data_1, <span class="st">"Parametric MICE"</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_structure_info</span>(heart_failure, syn_cart_1, <span class="st">"CART Imputation"</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_structure_info</span>(heart_failure, syn_data_low_fidelity_synthpop, <span class="st">"Synthpop (Low Fidelity)"</span>),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_structure_info</span>(heart_failure, syn_data_metadata, <span class="st">"Metadata-Based"</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as a neat table</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  structure_comparison,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Comparison of Real vs Synthetic Dataset Sizes and Structures"</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparison of Real vs Synthetic Dataset Sizes and Structures</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Rows_Real</th>
<th style="text-align: right;">Cols_Real</th>
<th style="text-align: right;">Rows_Synthetic</th>
<th style="text-align: right;">Cols_Synthetic</th>
<th style="text-align: left;">Structure_Match</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="categorical-variables-all-levels-maintained-and-comparison-of-distribution" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="categorical-variables-all-levels-maintained-and-comparison-of-distribution"><span class="header-section-number">5.2</span> Categorical Variables: All Levels Maintained and Comparison of Distribution</h3>
<p>This section evaluates how well the synthetic datasets replicate the categorical variables in the real dataset, focusing on the preservation of all levels and their distributions.</p>
<ul>
<li><p><strong>Level Matching</strong>: For each categorical variable, the synthetic dataset should retain all levels (categories) present in the real dataset. Missing levels suggest that the synthetic data may be incomplete, while additional levels could indicate errors in data generation.</p></li>
<li><p><strong>Distribution Comparison</strong>: The frequency of each categorical level in the synthetic data should closely mirror that of the real dataset. Significant deviations in category frequencies suggest that the synthetic data does not fully capture the true distribution of the categorical features.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to collect categorical level info</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>get_cat_levels <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data, dataset_name) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  cat_vars <span class="ot">&lt;-</span> <span class="fu">colnames</span>(real_data)[<span class="fu">sapply</span>(real_data, is.factor)]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(cat_vars, <span class="cf">function</span>(var) {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    levels_real <span class="ot">&lt;-</span> <span class="fu">unique</span>(real_data[[var]])</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    levels_synth <span class="ot">&lt;-</span> <span class="fu">unique</span>(synthetic_data[[<span class="fu">paste</span>(<span class="st">"synth"</span>, var, <span class="at">sep =</span> <span class="st">"_"</span>)]])</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">Variable =</span> var,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">Dataset =</span> dataset_name,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">Real_Levels =</span> <span class="fu">paste</span>(levels_real, <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">Synthetic_Levels =</span> <span class="fu">paste</span>(levels_synth, <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">Match =</span> <span class="fu">ifelse</span>(<span class="fu">all</span>(levels_real <span class="sc">%in%</span> levels_synth), <span class="st">"✅ Yes"</span>, <span class="st">"❌ No"</span>),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect results</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>cat_comparison <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_cat_levels</span>(heart_failure, syn_data_1, <span class="st">"Parametric MICE"</span>),</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_cat_levels</span>(heart_failure, syn_cart_1, <span class="st">"CART Imputation"</span>),</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_cat_levels</span>(heart_failure, syn_data_low_fidelity_synthpop, <span class="st">"Synthpop (Low Fidelity)"</span>),</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_cat_levels</span>(heart_failure, syn_data_metadata, <span class="st">"Metadata-Based"</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Display table</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cat_comparison,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Comparison of Categorical Variable Levels in Real vs Synthetic Datasets"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparison of Categorical Variable Levels in Real vs Synthetic Datasets</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 32%">
<col style="width: 17%">
<col style="width: 22%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Dataset</th>
<th style="text-align: left;">Real_Levels</th>
<th style="text-align: left;">Synthetic_Levels</th>
<th style="text-align: left;">Match</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">anaemia</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">diabetes</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">Male, Female</td>
<td style="text-align: left;">Male, Female</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoking</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hypertension</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">anaemia</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">diabetes</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">Male, Female</td>
<td style="text-align: left;">Female, Male</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoking</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hypertension</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">anaemia</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">diabetes</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">Male, Female</td>
<td style="text-align: left;">Male, Female</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoking</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hypertension</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">anaemia</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">diabetes</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">Male, Female</td>
<td style="text-align: left;">Female, Male</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoking</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hypertension</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">Yes, No</td>
<td style="text-align: left;">No, Yes</td>
<td style="text-align: left;">✅ Yes</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="numeric-variables-range-and-distribution-comparison" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="numeric-variables-range-and-distribution-comparison"><span class="header-section-number">5.3</span> Numeric Variables: Range and Distribution Comparison</h3>
<p>This analysis evaluates how well the numeric variables in the synthetic datasets replicate the real data in terms of range and distribution.</p>
<ul>
<li><p><strong>Range</strong>: For each numeric variable, the synthetic data should maintain values within the range of the real dataset. Any deviations, especially outliers, could indicate inaccuracies in the synthetic generation process.</p></li>
<li><p><strong>Distribution Comparison</strong>: Density plots are used to compare the shape of the distributions between the real and synthetic datasets. Ideally, the synthetic data should closely mirror the real distribution, indicating that the underlying data generation model has captured the true variability of the numeric features.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute per-variable stats for a (real, synthetic) pair</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>numeric_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(real, synth, dataset_name) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  num_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(real)[<span class="fu">sapply</span>(real, is.numeric)]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># real percentiles</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  pctl <span class="ot">&lt;-</span> <span class="fu">map</span>(num_vars, <span class="sc">~</span><span class="fu">quantile</span>(real[[.x]], <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(num_vars)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> num_vars,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Real_Min =</span> <span class="fu">map_dbl</span>(num_vars, <span class="sc">~</span><span class="fu">min</span>(real[[.x]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Real_P5  =</span> <span class="fu">map_dbl</span>(num_vars, <span class="sc">~</span>pctl[[.x]][<span class="dv">1</span>]),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Real_P95 =</span> <span class="fu">map_dbl</span>(num_vars, <span class="sc">~</span>pctl[[.x]][<span class="dv">2</span>]),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Real_Max =</span> <span class="fu">map_dbl</span>(num_vars, <span class="sc">~</span><span class="fu">max</span>(real[[.x]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Synth_Min =</span> <span class="fu">map_dbl</span>(num_vars, <span class="sc">~</span><span class="fu">min</span>(synth[[<span class="fu">paste0</span>(<span class="st">"synth_"</span>, .x)]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Synth_Max =</span> <span class="fu">map_dbl</span>(num_vars, <span class="sc">~</span><span class="fu">max</span>(synth[[<span class="fu">paste0</span>(<span class="st">"synth_"</span>, .x)]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">Within_P5_P95 =</span> <span class="fu">ifelse</span>(Synth_Min <span class="sc">&gt;=</span> Real_P5 <span class="sc">&amp;</span> Synth_Max <span class="sc">&lt;=</span> Real_P95, <span class="st">"✅ Yes"</span>, <span class="st">"❌ No"</span>),</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">Dataset =</span> dataset_name,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Build one continuous table for all synthetic datasets</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>num_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">numeric_summary</span>(heart_failure, syn_data_1, <span class="st">"Parametric MICE"</span>),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">numeric_summary</span>(heart_failure, syn_cart_1, <span class="st">"CART Imputation"</span>),</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">numeric_summary</span>(heart_failure, syn_data_low_fidelity_synthpop, <span class="st">"Synthpop (Low Fidelity)"</span>),</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">numeric_summary</span>(heart_failure, syn_data_metadata, <span class="st">"Metadata-Based"</span>)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  num_table,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Numeric variables: real ranges &amp; percentiles vs. synthetic ranges (with P5–P95 containment check)"</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Numeric variables: real ranges &amp; percentiles vs.&nbsp;synthetic ranges (with P5–P95 containment check)</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Within_P5_P95</th>
<th style="text-align: left;">Dataset</th>
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Real_Min</th>
<th style="text-align: right;">Real_P5</th>
<th style="text-align: right;">Real_P95</th>
<th style="text-align: right;">Real_Max</th>
<th style="text-align: right;">Synth_Min</th>
<th style="text-align: right;">Synth_Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">age</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: right;">42.15</td>
<td style="text-align: right;">82.0</td>
<td style="text-align: right;">95.0</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">23.0</td>
<td style="text-align: right;">59.20</td>
<td style="text-align: right;">2220.8</td>
<td style="text-align: right;">7861.0</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">2221</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">60.0</td>
<td style="text-align: right;">80.0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">25100.0</td>
<td style="text-align: right;">132200.00</td>
<td style="text-align: right;">421200.0</td>
<td style="text-align: right;">850000.0</td>
<td style="text-align: right;">132200</td>
<td style="text-align: right;">421200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">9.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">113.0</td>
<td style="text-align: right;">130.00</td>
<td style="text-align: right;">144.0</td>
<td style="text-align: right;">148.0</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">12.90</td>
<td style="text-align: right;">250.0</td>
<td style="text-align: right;">285.0</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">250</td>
</tr>
<tr class="even">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">age</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: right;">42.15</td>
<td style="text-align: right;">82.0</td>
<td style="text-align: right;">95.0</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">23.0</td>
<td style="text-align: right;">59.20</td>
<td style="text-align: right;">2220.8</td>
<td style="text-align: right;">7861.0</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">2221</td>
</tr>
<tr class="even">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">60.0</td>
<td style="text-align: right;">80.0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">25100.0</td>
<td style="text-align: right;">132200.00</td>
<td style="text-align: right;">421200.0</td>
<td style="text-align: right;">850000.0</td>
<td style="text-align: right;">132200</td>
<td style="text-align: right;">421200</td>
</tr>
<tr class="even">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">9.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">113.0</td>
<td style="text-align: right;">130.00</td>
<td style="text-align: right;">144.0</td>
<td style="text-align: right;">148.0</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="even">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">12.90</td>
<td style="text-align: right;">250.0</td>
<td style="text-align: right;">285.0</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">250</td>
</tr>
<tr class="odd">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">age</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: right;">42.15</td>
<td style="text-align: right;">82.0</td>
<td style="text-align: right;">95.0</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">23.0</td>
<td style="text-align: right;">59.20</td>
<td style="text-align: right;">2220.8</td>
<td style="text-align: right;">7861.0</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">2221</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">60.0</td>
<td style="text-align: right;">80.0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">25100.0</td>
<td style="text-align: right;">132200.00</td>
<td style="text-align: right;">421200.0</td>
<td style="text-align: right;">850000.0</td>
<td style="text-align: right;">132200</td>
<td style="text-align: right;">421200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">9.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">113.0</td>
<td style="text-align: right;">130.00</td>
<td style="text-align: right;">144.0</td>
<td style="text-align: right;">148.0</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">12.90</td>
<td style="text-align: right;">250.0</td>
<td style="text-align: right;">285.0</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">250</td>
</tr>
<tr class="even">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">age</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: right;">42.15</td>
<td style="text-align: right;">82.0</td>
<td style="text-align: right;">95.0</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">23.0</td>
<td style="text-align: right;">59.20</td>
<td style="text-align: right;">2220.8</td>
<td style="text-align: right;">7861.0</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">2216</td>
</tr>
<tr class="even">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">60.0</td>
<td style="text-align: right;">80.0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">25100.0</td>
<td style="text-align: right;">132200.00</td>
<td style="text-align: right;">421200.0</td>
<td style="text-align: right;">850000.0</td>
<td style="text-align: right;">134054</td>
<td style="text-align: right;">421118</td>
</tr>
<tr class="even">
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">9.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">113.0</td>
<td style="text-align: right;">130.00</td>
<td style="text-align: right;">144.0</td>
<td style="text-align: right;">148.0</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="even">
<td style="text-align: left;">✅ Yes</td>
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">12.90</td>
<td style="text-align: right;">250.0</td>
<td style="text-align: right;">285.0</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">249</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="missingness-comparison" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="missingness-comparison"><span class="header-section-number">5.4</span> Missingness Comparison</h3>
<p>In this section, we compare the proportions of missing values between the real dataset and each synthetic dataset. This comparison helps determine whether the synthetic datasets accurately represent the patterns of missingness in the real data.</p>
<ul>
<li><p><strong>Missingness Proportions</strong>: For each dataset, we calculate the proportion of missing values for every column and compare the results across the real and synthetic datasets.</p></li>
<li><p><strong>Comparison Outcome</strong>: Ideally, the synthetic datasets should exhibit similar missingness proportions to the real data. Any deviations may indicate differences in how missing values were handled during the synthetic data generation process.</p></li>
</ul>
<section id="introduction-plots" class="level4" data-number="5.4.1">
<h4 data-number="5.4.1" class="anchored" data-anchor-id="introduction-plots"><span class="header-section-number">5.4.1</span> Introduction Plots</h4>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom palette for the 5 metrics</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>metric_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Discrete Columns"</span>     <span class="ot">=</span> <span class="st">"#B0D99B"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Continuous Columns"</span>   <span class="ot">=</span> <span class="st">"#528AA8"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"All Missing Columns"</span>  <span class="ot">=</span> <span class="st">"#FFB6DB"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Complete Rows"</span>        <span class="ot">=</span> <span class="st">"#264653"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Missing Observations"</span> <span class="ot">=</span> <span class="st">"#2A9D8F"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Strip 'synth_' for fair visuals</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>strip_synth_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(df) { </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^synth_"</span>, <span class="st">""</span>, <span class="fu">names</span>(df)) </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  df </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Datasets to compare</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Real Data"</span>               <span class="ot">=</span> heart_failure,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Parametric MICE"</span>         <span class="ot">=</span> <span class="fu">strip_synth_prefix</span>(syn_data_1),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CART Imputation"</span>         <span class="ot">=</span> <span class="fu">strip_synth_prefix</span>(syn_cart_1),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Synthpop (Low Fidelity)"</span> <span class="ot">=</span> <span class="fu">strip_synth_prefix</span>(syn_data_low_fidelity_synthpop),</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Metadata-Based"</span>          <span class="ot">=</span> <span class="fu">strip_synth_prefix</span>(syn_data_metadata)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Function: horizontal bar chart for the 5 metrics</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>make_intro_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df, title) {</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  n_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  n_cols <span class="ot">&lt;-</span> <span class="fu">ncol</span>(df)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  pct_discrete   <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">vapply</span>(df, is.factor,  <span class="fu">logical</span>(<span class="dv">1</span>))) <span class="sc">/</span> n_cols</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  pct_continuous <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">vapply</span>(df, is.numeric, <span class="fu">logical</span>(<span class="dv">1</span>))) <span class="sc">/</span> n_cols</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  pct_allmisscol <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(df)) <span class="sc">==</span> n_rows) <span class="sc">/</span> n_cols</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  pct_completer  <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">complete.cases</span>(df)) <span class="sc">/</span> n_rows</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  pct_missobs    <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(df)) <span class="sc">/</span> (n_rows <span class="sc">*</span> n_cols)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Metric =</span> <span class="fu">factor</span>(</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"Discrete Columns"</span>, <span class="st">"Continuous Columns"</span>, <span class="st">"All Missing Columns"</span>,</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Complete Rows"</span>, <span class="st">"Missing Observations"</span>),</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Discrete Columns"</span>, <span class="st">"Continuous Columns"</span>, <span class="st">"All Missing Columns"</span>,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Complete Rows"</span>, <span class="st">"Missing Observations"</span>)) <span class="co"># reverse for nicer order</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">Percentage =</span> <span class="fu">c</span>(pct_discrete, pct_continuous, pct_allmisscol, pct_completer, pct_missobs)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(<span class="at">x =</span> Percentage, <span class="at">y =</span> Metric, <span class="at">fill =</span> Metric)) <span class="sc">+</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(Percentage, <span class="dv">1</span>), <span class="st">"%"</span>)),</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>              <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>),</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)) <span class="co"># headroom for labels</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> metric_palette) <span class="sc">+</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">x =</span> <span class="st">"Percentage"</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title   =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Build plots and combine in one grid</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(datasets, <span class="sc">~</span> <span class="fu">make_intro_plot</span>(.x, .y)),</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Dataset Overview: Discrete/Continuous Columns, All-Missing Columns, Complete Rows, Missing Observations"</span>,</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Percentages shown per dataset; axes standardized to 0–100%"</span>,</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/intro-plots-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="missingness-proportions-and-comparison-outcome" class="level4" data-number="5.4.2">
<h4 data-number="5.4.2" class="anchored" data-anchor-id="missingness-proportions-and-comparison-outcome"><span class="header-section-number">5.4.2</span> Missingness Proportions and Comparison Outcome</h4>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove 'synth_' prefix so names match the real dataset</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>strip_synth_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^synth_"</span>, <span class="st">""</span>, <span class="fu">names</span>(df))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare against the real dataset's variable set</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>core_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(heart_failure)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute missingness proportions (2 d.p.) for one dataset</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>get_missingness <span class="ot">&lt;-</span> <span class="cf">function</span>(df, label) {</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  df2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">strip_synth_prefix</span>()</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep only variables present in the real data (prevents mismatches)</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  df2 <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(core_vars))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable   =</span> <span class="fu">names</span>(df2),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Proportion =</span> <span class="fu">round</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(df2)) <span class="sc">/</span> <span class="fu">nrow</span>(df2), <span class="dv">2</span>),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Dataset    =</span> label</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Build tidy table</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>missing_tbl <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_missingness</span>(heart_failure, <span class="st">"Real Data"</span>),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_missingness</span>(syn_data_1, <span class="st">"Parametric MICE"</span>),</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_missingness</span>(syn_cart_1, <span class="st">"CART Imputation"</span>),</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_missingness</span>(syn_data_low_fidelity_synthpop, <span class="st">"Synthpop (Low Fidelity)"</span>),</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_missingness</span>(syn_data_metadata, <span class="st">"Metadata-Based"</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider for side-by-side comparison</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>missing_tbl_wide <span class="ot">&lt;-</span> missing_tbl <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Dataset, <span class="at">values_from =</span> Proportion) <span class="sc">%&gt;%</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Variable)</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: add quick match flags (✅ if identical to Real Data)</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co"># missing_tbl_wide &lt;- missing_tbl_wide %&gt;%</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     `Parametric MICE Match` = ifelse(`Parametric MICE` == `Real Data`, "✅", "❌"),</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     `CART Imputation Match` = ifelse(`CART Imputation` == `Real Data`, "✅", "❌"),</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co">#     `Synthpop (Low Fidelity) Match` = ifelse(`Synthpop (Low Fidelity)` == `Real Data`, "✅", "❌"),</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co">#     `Metadata-Based Match` = ifelse(`Metadata-Based` == `Real Data`, "✅", "❌")</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>  missing_tbl_wide,</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Missingness Proportions by Variable (rounded to 2 d.p.)"</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Missingness Proportions by Variable (rounded to 2 d.p.)</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 9%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 22%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Real Data</th>
<th style="text-align: right;">Parametric MICE</th>
<th style="text-align: right;">CART Imputation</th>
<th style="text-align: right;">Synthpop (Low Fidelity)</th>
<th style="text-align: right;">Metadata-Based</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">anaemia</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">diabetes</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">hypertension</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">smoking</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="missingness-maps" class="level4" data-number="5.4.3">
<h4 data-number="5.4.3" class="anchored" data-anchor-id="missingness-maps"><span class="header-section-number">5.4.3</span> Missingness Maps</h4>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate missingness map for the real dataset</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>real_missing_map <span class="ot">&lt;-</span> <span class="fu">aggr</span>(heart_failure, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">numbers =</span> <span class="cn">TRUE</span>, <span class="at">sortVars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">names</span>(heart_failure), <span class="at">cex.axis =</span> .<span class="dv">7</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">gap =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"Missing Data"</span>, <span class="st">"Pattern - real Dataset"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Missingness%20Maps-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Variables sorted by number of missings: 
                 Variable      Count
             serum_sodium 0.06688963
         serum_creatinine 0.06020067
                      age 0.05016722
 creatinine_phosphokinase 0.04682274
                platelets 0.04682274
        ejection_fraction 0.04013378
                  anaemia 0.00000000
                 diabetes 0.00000000
                      sex 0.00000000
                  smoking 0.00000000
             hypertension 0.00000000
                 deceased 0.00000000
                follow_up 0.00000000</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate missingness map for Parametric MICE synthetic dataset</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>parametric_mice_missing_map <span class="ot">&lt;-</span> <span class="fu">aggr</span>(syn_data_1, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">numbers =</span> <span class="cn">TRUE</span>, <span class="at">sortVars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labels =</span> <span class="fu">names</span>(syn_data_1), <span class="at">cex.axis =</span> .<span class="dv">7</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">gap =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"Missing Data"</span>, <span class="st">"Pattern - Parametric MICE Dataset"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Missingness%20Maps-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Variables sorted by number of missings: 
                       Variable      Count
             synth_serum_sodium 0.06688963
         synth_serum_creatinine 0.06020067
                      synth_age 0.05016722
 synth_creatinine_phosphokinase 0.04682274
                synth_platelets 0.04682274
        synth_ejection_fraction 0.04013378
                  synth_anaemia 0.00000000
                 synth_diabetes 0.00000000
                      synth_sex 0.00000000
                  synth_smoking 0.00000000
             synth_hypertension 0.00000000
                 synth_deceased 0.00000000
                synth_follow_up 0.00000000</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate missingness map for CART synthetic dataset</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cart_missing_map <span class="ot">&lt;-</span> <span class="fu">aggr</span>(syn_cart_1, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">numbers =</span> <span class="cn">TRUE</span>, <span class="at">sortVars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">names</span>(syn_cart_1), <span class="at">cex.axis =</span> .<span class="dv">7</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">gap =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"Missing Data"</span>, <span class="st">"Pattern - CART Dataset"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Missingness%20Maps-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Variables sorted by number of missings: 
                       Variable      Count
             synth_serum_sodium 0.06688963
         synth_serum_creatinine 0.06020067
                      synth_age 0.05016722
 synth_creatinine_phosphokinase 0.04682274
                synth_platelets 0.04682274
        synth_ejection_fraction 0.04013378
                  synth_anaemia 0.00000000
                 synth_diabetes 0.00000000
                      synth_sex 0.00000000
                  synth_smoking 0.00000000
             synth_hypertension 0.00000000
                 synth_deceased 0.00000000
                synth_follow_up 0.00000000</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate missingness map for Synthpop synthetic dataset</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>synthpop_missing_map <span class="ot">&lt;-</span> <span class="fu">aggr</span>(syn_data_low_fidelity_synthpop, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">numbers =</span> <span class="cn">TRUE</span>, <span class="at">sortVars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">names</span>(syn_data_low_fidelity_synthpop), <span class="at">cex.axis =</span> .<span class="dv">7</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">gap =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"Missing Data"</span>, <span class="st">"Pattern - Synthpop Dataset"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Missingness%20Maps-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Variables sorted by number of missings: 
                       Variable      Count
         synth_serum_creatinine 0.11705686
             synth_serum_sodium 0.11371237
                synth_platelets 0.10367893
 synth_creatinine_phosphokinase 0.10033445
                      synth_age 0.09364548
        synth_ejection_fraction 0.04682274
                  synth_anaemia 0.00000000
                 synth_diabetes 0.00000000
                      synth_sex 0.00000000
                  synth_smoking 0.00000000
             synth_hypertension 0.00000000
                 synth_deceased 0.00000000
                synth_follow_up 0.00000000</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate missingness map for Metadata-based synthetic dataset</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>metadata_missing_map <span class="ot">&lt;-</span> <span class="fu">aggr</span>(syn_data_metadata, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">numbers =</span> <span class="cn">TRUE</span>, <span class="at">sortVars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">names</span>(syn_data_metadata), <span class="at">cex.axis =</span> .<span class="dv">7</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">gap =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="fu">c</span>(<span class="st">"Missing Data"</span>, <span class="st">"Pattern - Metadata-Based Dataset"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Missingness%20Maps-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Variables sorted by number of missings: 
                       Variable      Count
             synth_serum_sodium 0.06688963
         synth_serum_creatinine 0.06020067
                      synth_age 0.05016722
 synth_creatinine_phosphokinase 0.04682274
                synth_platelets 0.04682274
        synth_ejection_fraction 0.04013378
                  synth_anaemia 0.00000000
                 synth_diabetes 0.00000000
                      synth_sex 0.00000000
                  synth_smoking 0.00000000
             synth_hypertension 0.00000000
                 synth_deceased 0.00000000
                synth_follow_up 0.00000000</code></pre>
</div>
</div>
</section>
</section>
<section id="correlation-matrices-comparison" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="correlation-matrices-comparison"><span class="header-section-number">5.5</span> Correlation Matrices Comparison</h3>
<p>In this section, we assess how well the correlations between numeric variables are preserved in the synthetic datasets compared to the real dataset. By comparing the correlation matrices, we evaluate whether the relationships between variables in the real data are reflected in the synthetic versions. This assessment is essential because maintaining the real data’s correlation structure ensures that any statistical or machine learning models trained on synthetic data will behave similarly to those trained on real data.</p>
<ul>
<li><p><strong>Correlation Matrix</strong>: A correlation matrix quantifies the strength and direction of relationships between pairs of numeric variables. Each cell in the matrix represents the correlation coefficient between two variables, which can range from -1 (perfect negative correlation) to +1 (perfect positive correlation). It is crucial that synthetic data retains these relationships to ensure that any analyses based on these dependencies remain valid.</p></li>
<li><p><strong>Comparison Process</strong>: The correlation matrices for both the real and synthetic datasets are computed and Visualised. Ideally, the structure and strength of correlations in the synthetic datasets should closely match those in the real dataset. Differences in correlation strength or direction indicate that the synthetic data may not fully capture the underlying relationships, which can affect the validity of any conclusions drawn from analyses using the synthetic data.</p></li>
</ul>
<p>Maintaining similar correlation structures is particularly important for use cases where relationships between variables play a crucial role, such as in predictive modeling, feature selection, and understanding variable dependencies. The following sections outline different methods used to compare correlation matrices between the real and synthetic datasets.</p>
<section id="correlation-matrices-comparison-using-psych" class="level4" data-number="5.5.1">
<h4 data-number="5.5.1" class="anchored" data-anchor-id="correlation-matrices-comparison-using-psych"><span class="header-section-number">5.5.1</span> Correlation Matrices Comparison using psych</h4>
<p>The <code>psych</code> package provides tools for analyzing and visualizing correlation matrices. The <code>corr.test()</code> function is particularly useful for computing correlation coefficients while handling missing data and providing additional statistics, such as confidence intervals.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Strip 'synth_' so names line up with real</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>strip_synth_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^synth_"</span>, <span class="st">""</span>, <span class="fu">names</span>(df))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a tidy table of pairwise correlations for real vs one synthetic dataset</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>corr_compare_one <span class="ot">&lt;-</span> <span class="cf">function</span>(real, synth, label) {</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> real <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> synth <span class="sc">|&gt;</span> <span class="fu">strip_synth_prefix</span>() <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(real_num), <span class="fu">names</span>(synth_num))</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">Dataset =</span> label, <span class="at">Var1 =</span> <span class="fu">character</span>(), <span class="at">Var2 =</span> <span class="fu">character</span>(),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Real =</span> <span class="fu">numeric</span>(), <span class="at">Synthetic =</span> <span class="fu">numeric</span>(), <span class="at">Diff =</span> <span class="fu">numeric</span>(), <span class="at">AbsDiff =</span> <span class="fu">numeric</span>()))</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute Pearson correlations with pairwise complete observations</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  rc <span class="ot">&lt;-</span> <span class="fu">cor</span>(real_num[common],  <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  sc <span class="ot">&lt;-</span> <span class="fu">cor</span>(synth_num[common], <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only upper triangle (unique pairs)</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  ut <span class="ot">&lt;-</span> <span class="fu">upper.tri</span>(rc, <span class="at">diag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  pairs <span class="ot">&lt;-</span> <span class="fu">which</span>(ut, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Var1 =</span> <span class="fu">colnames</span>(rc)[pairs[, <span class="dv">1</span>]],</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">Var2 =</span> <span class="fu">colnames</span>(rc)[pairs[, <span class="dv">2</span>]],</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">Real =</span> rc[pairs],</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">Synthetic =</span> sc[pairs]</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">Dataset =</span> label,</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">Diff =</span> Synthetic <span class="sc">-</span> Real,</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">AbsDiff =</span> <span class="fu">abs</span>(Diff)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Dataset, Var1, Var2, Real, Synthetic, Diff, AbsDiff)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Build one combined table for all synthetic datasets</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>corr_cmp_tbl <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corr_compare_one</span>(heart_failure, syn_data_1, <span class="st">"Parametric MICE"</span>),</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corr_compare_one</span>(heart_failure, syn_cart_1, <span class="st">"CART Imputation"</span>),</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corr_compare_one</span>(heart_failure, syn_data_low_fidelity_synthpop, <span class="st">"Synthpop (Low Fidelity)"</span>),</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corr_compare_one</span>(heart_failure, syn_data_metadata, <span class="st">"Metadata-Based"</span>)</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Dataset, <span class="fu">desc</span>(AbsDiff)) <span class="sc">|&gt;</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Real =</span> <span class="fu">round</span>(Real, <span class="dv">2</span>),</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">Synthetic =</span> <span class="fu">round</span>(Synthetic, <span class="dv">2</span>),</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">Diff =</span> <span class="fu">round</span>(Diff, <span class="dv">2</span>),</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">AbsDiff =</span> <span class="fu">round</span>(AbsDiff, <span class="dv">2</span>)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>  corr_cmp_tbl,</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Pairwise Correlations: Real vs. Synthetic (sorted by largest absolute difference per dataset)"</span>,</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lllrrrr"</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Pairwise Correlations: Real vs.&nbsp;Synthetic (sorted by largest absolute difference per dataset)</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 5%">
<col style="width: 9%">
<col style="width: 5%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: left;">Var1</th>
<th style="text-align: left;">Var2</th>
<th style="text-align: right;">Real</th>
<th style="text-align: right;">Synthetic</th>
<th style="text-align: right;">Diff</th>
<th style="text-align: right;">AbsDiff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.24</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">-0.21</td>
<td style="text-align: right;">-0.23</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">-0.14</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.24</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.36</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">-0.16</td>
<td style="text-align: right;">-0.23</td>
<td style="text-align: right;">0.23</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">-0.21</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">-0.09</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">-0.21</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.23</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.24</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">0.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">0.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">-0.09</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.24</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">-0.21</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">-0.20</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.19</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">-0.14</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: left;">age</td>
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="correlation-matrices-comparison-using-corrplot" class="level4" data-number="5.5.2">
<h4 data-number="5.5.2" class="anchored" data-anchor-id="correlation-matrices-comparison-using-corrplot"><span class="header-section-number">5.5.2</span> Correlation Matrices Comparison using Corrplot</h4>
<p>The <code>corrplot</code> package is widely used for visualizing correlation matrices. It provides a variety of options for customization, making it easy to identify patterns and relationships between variables. This method is particularly effective for visual comparisons because it highlights differences in correlation strength and direction.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove 'synth_' so names match the real dataset</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>strip_synth_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(df) { <span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^synth_"</span>, <span class="st">""</span>, <span class="fu">names</span>(df)); df }</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Side-by-side correlation matrices (full width)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>compare_correlation_matrices <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data, dataset_name) {</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Numeric-only</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> real_data[<span class="fu">sapply</span>(real_data, is.numeric)]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> <span class="fu">strip_synth_prefix</span>(synthetic_data)[<span class="fu">sapply</span>(<span class="fu">strip_synth_prefix</span>(synthetic_data), is.numeric)]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use common numeric variables in same order</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(real_num), <span class="fu">names</span>(synth_num))</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(dataset_name, <span class="st">": fewer than 2 common numeric columns — skipping."</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  real_corr  <span class="ot">&lt;-</span> <span class="fu">cor</span>(real_num[common],  <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  synth_corr <span class="ot">&lt;-</span> <span class="fu">cor</span>(synth_num[common], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make two panels across the page</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> <span class="cn">TRUE</span>); <span class="fu">on.exit</span>(<span class="fu">par</span>(op), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>))</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrplot</span>(real_corr,  <span class="at">tl.cex =</span> <span class="fl">0.8</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(<span class="fu">paste</span>(dataset_name, <span class="st">"- Real Data"</span>), <span class="at">line =</span> <span class="dv">1</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrplot</span>(synth_corr, <span class="at">tl.cex =</span> <span class="fl">0.8</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(<span class="fu">paste</span>(dataset_name, <span class="st">"- Synthetic Data"</span>), <span class="at">line =</span> <span class="dv">1</span>)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Run for each synthetic dataset</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_correlation_matrices</span>(heart_failure, syn_data_1, <span class="st">"Parametric MICE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Correlation%20Matrices%20Comparison%20using%20Corrplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_correlation_matrices</span>(heart_failure, syn_cart_1, <span class="st">"CART Imputation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Correlation%20Matrices%20Comparison%20using%20Corrplot-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_correlation_matrices</span>(heart_failure, syn_data_low_fidelity_synthpop, <span class="st">"Synthpop (Low Fidelity)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Correlation%20Matrices%20Comparison%20using%20Corrplot-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_correlation_matrices</span>(heart_failure, syn_data_metadata, <span class="st">"Metadata-Based"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Correlation%20Matrices%20Comparison%20using%20Corrplot-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-matrices-comparison-using-ggally" class="level4" data-number="5.5.3">
<h4 data-number="5.5.3" class="anchored" data-anchor-id="correlation-matrices-comparison-using-ggally"><span class="header-section-number">5.5.3</span> Correlation Matrices Comparison using GGally</h4>
<p>The <code>GGally</code> package extends <code>ggplot2</code> to create pairwise visualizations, including correlation matrix plots. Using <code>ggpairs()</code>, you can generate a matrix of scatterplots, histograms, and correlation coefficients, which provides a detailed view of the relationships between numeric variables in the real and synthetic datasets.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>compare_correlation_matrices_ggally <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data, dataset_name) {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only numeric columns from both datasets</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  real_numeric <span class="ot">&lt;-</span> real_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove prefix 'synth_' from synthetic data column names</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(synthetic_data) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^synth_"</span>, <span class="st">""</span>, <span class="fu">names</span>(synthetic_data))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  synthetic_numeric <span class="ot">&lt;-</span> synthetic_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure that both datasets have the same columns</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  common_columns <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(real_numeric), <span class="fu">names</span>(synthetic_numeric))</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common_columns) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">No common numeric columns found for comparison in"</span>, dataset_name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>()</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  real_numeric <span class="ot">&lt;-</span> real_numeric[, common_columns, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  synthetic_numeric <span class="ot">&lt;-</span> synthetic_numeric[, common_columns, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a column to differentiate between real and synthetic data</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  real_numeric<span class="sc">$</span>Dataset <span class="ot">&lt;-</span> <span class="st">"Real"</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  synthetic_numeric<span class="sc">$</span>Dataset <span class="ot">&lt;-</span> <span class="st">"Synth"</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine the datasets</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  combined_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(real_numeric, synthetic_numeric)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create correlation matrix plot using GGally if there are valid columns to plot</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">ncol</span>(combined_data) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>      combined_data, </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">color =</span> Dataset, <span class="at">alpha =</span> <span class="fl">0.5</span>), </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(dataset_name, <span class="st">"- Correlation Matrix Comparison"</span>),</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(combined_data) <span class="sc">-</span> <span class="dv">1</span>),  <span class="co"># Exclude the 'Dataset' column from the plot</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"cor"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alignPercent =</span> <span class="fl">0.5</span>)),  <span class="co"># Smaller correlation labels</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"smooth"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">0.5</span>)),  <span class="co"># Smoother plots for readability</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>))  <span class="co"># Density plot with improved transparency</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Use a cleaner theme</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">face =</span> <span class="st">"bold"</span>),  <span class="co"># Smaller strip labels</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>),  <span class="co"># Rotate x-axis labels for better readability</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"top"</span>,  <span class="co"># Move legend to a better location</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>()  <span class="co"># Remove unnecessary legend title</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(p)</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Not enough numeric columns to generate a correlation matrix plot for"</span>, dataset_name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to each synthetic dataset</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_correlation_matrices_ggally</span>(heart_failure, syn_data_1, <span class="st">"Parametric MICE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Correlation%20Matrices%20Comparison%20using%20GGally-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_correlation_matrices_ggally</span>(heart_failure, syn_cart_1, <span class="st">"CART Imputation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Correlation%20Matrices%20Comparison%20using%20GGally-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_correlation_matrices_ggally</span>(heart_failure, syn_data_low_fidelity_synthpop, <span class="st">"Synthpop Low Fidelity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Correlation%20Matrices%20Comparison%20using%20GGally-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_correlation_matrices_ggally</span>(heart_failure, syn_data_metadata, <span class="st">"Metadata-Based Synthetic Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Correlation%20Matrices%20Comparison%20using%20GGally-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="fidelity-assessment" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="fidelity-assessment"><span class="header-section-number">6</span> Fidelity Assessment</h2>
<section id="descriptive-statistics" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="descriptive-statistics"><span class="header-section-number">6.1</span> Descriptive Statistics</h3>
<p>This section provides a comparative analysis of the descriptive statistics between the real dataset and the synthetic datasets generated using different methods.</p>
<section id="real-dataset" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="real-dataset"><span class="header-section-number">6.1.1</span> Real Dataset</h4>
<p>The descriptive statistics for the real heart failure dataset include metrics such as mean, median, standard deviation, and range. This serves as the baseline for comparison with the synthetic datasets.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate descriptive stats</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>desc_tbl <span class="ot">&lt;-</span> <span class="fu">describe</span>(heart_failure) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, min, median, max) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as a neat table</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  desc_tbl,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive Statistics for the Heart Failure Dataset"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrrrrrr"</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Descriptive Statistics for the Heart Failure Dataset</caption>
<colgroup>
<col style="width: 33%">
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">60.80</td>
<td style="text-align: right;">12.08</td>
<td style="text-align: right;">40.0</td>
<td style="text-align: right;">60.0</td>
<td style="text-align: right;">95.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">anaemia*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">creatinine_phosphokinase</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">578.81</td>
<td style="text-align: right;">981.99</td>
<td style="text-align: right;">23.0</td>
<td style="text-align: right;">249.0</td>
<td style="text-align: right;">7861.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">diabetes*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ejection_fraction</td>
<td style="text-align: right;">287</td>
<td style="text-align: right;">38.00</td>
<td style="text-align: right;">11.92</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">38.0</td>
<td style="text-align: right;">80.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">platelets</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">265163.83</td>
<td style="text-align: right;">97508.63</td>
<td style="text-align: right;">25100.0</td>
<td style="text-align: right;">263358.0</td>
<td style="text-align: right;">850000.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">serum_creatinine</td>
<td style="text-align: right;">281</td>
<td style="text-align: right;">1.39</td>
<td style="text-align: right;">1.05</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">9.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">serum_sodium</td>
<td style="text-align: right;">279</td>
<td style="text-align: right;">136.59</td>
<td style="text-align: right;">4.49</td>
<td style="text-align: right;">113.0</td>
<td style="text-align: right;">137.0</td>
<td style="text-align: right;">148.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoking*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hypertension*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.35</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">deceased*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">follow_up</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">130.26</td>
<td style="text-align: right;">77.61</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">115.0</td>
<td style="text-align: right;">285.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="parametric-imputation-mice" class="level4" data-number="6.1.2">
<h4 data-number="6.1.2" class="anchored" data-anchor-id="parametric-imputation-mice"><span class="header-section-number">6.1.2</span> Parametric Imputation (MICE)</h4>
<p>The synthetic data generated using the MICE framework is analyzed to compare its summary statistics with the real dataset. This will help evaluate how well the parametric method captures the key characteristics of the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive stats for Parametric MICE synthetic dataset</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>desc_mice <span class="ot">&lt;-</span> <span class="fu">describe</span>(syn_data_1) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, min, median, max) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display table</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  desc_mice,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive Statistics for Parametric MICE Synthetic Dataset"</span>,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrrrrrr"</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Descriptive Statistics for Parametric MICE Synthetic Dataset</caption>
<colgroup>
<col style="width: 41%">
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">61.01</td>
<td style="text-align: right;">11.40</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.45</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">735.72</td>
<td style="text-align: right;">687.98</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">540</td>
<td style="text-align: right;">2221</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: right;">287</td>
<td style="text-align: right;">38.44</td>
<td style="text-align: right;">10.70</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">257523.78</td>
<td style="text-align: right;">86505.14</td>
<td style="text-align: right;">132200</td>
<td style="text-align: right;">254087</td>
<td style="text-align: right;">421200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: right;">281</td>
<td style="text-align: right;">1.70</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: right;">279</td>
<td style="text-align: right;">135.78</td>
<td style="text-align: right;">3.96</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">135</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.64</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.31</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">132.74</td>
<td style="text-align: right;">71.11</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">132</td>
<td style="text-align: right;">250</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="non-parametric-imputation-cart" class="level4" data-number="6.1.3">
<h4 data-number="6.1.3" class="anchored" data-anchor-id="non-parametric-imputation-cart"><span class="header-section-number">6.1.3</span> Non-Parametric Imputation (CART)</h4>
<p>The CART method is a non-parametric technique that handles non-linear relationships. The descriptive statistics of the CART-imputed synthetic data provide insight into how this method captures the dataset’s distribution.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive stats for CART synthetic dataset</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>desc_cart <span class="ot">&lt;-</span> <span class="fu">describe</span>(syn_cart_1) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, min, median, max) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display table</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  desc_cart,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive Statistics for CART Synthetic Dataset"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrrrrrr"</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Descriptive Statistics for CART Synthetic Dataset</caption>
<colgroup>
<col style="width: 41%">
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">60.81</td>
<td style="text-align: right;">11.88</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">469.20</td>
<td style="text-align: right;">547.58</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">231</td>
<td style="text-align: right;">2221</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.46</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: right;">287</td>
<td style="text-align: right;">38.56</td>
<td style="text-align: right;">11.85</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">265126.32</td>
<td style="text-align: right;">76944.75</td>
<td style="text-align: right;">132200</td>
<td style="text-align: right;">263358</td>
<td style="text-align: right;">421200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: right;">281</td>
<td style="text-align: right;">1.28</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: right;">279</td>
<td style="text-align: right;">136.79</td>
<td style="text-align: right;">3.67</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.67</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.37</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">132.53</td>
<td style="text-align: right;">75.17</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">117</td>
<td style="text-align: right;">250</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="synthpop-based-synthetic-data" class="level4" data-number="6.1.4">
<h4 data-number="6.1.4" class="anchored" data-anchor-id="synthpop-based-synthetic-data"><span class="header-section-number">6.1.4</span> Synthpop-Based Synthetic Data</h4>
<p>The Synthpop package generates synthetic data aimed at preserving data privacy. Descriptive statistics for this dataset help assess how well the key attributes of the real data are preserved.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive stats for Synthpop synthetic dataset</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>desc_synthpop <span class="ot">&lt;-</span> <span class="fu">describe</span>(syn_data_low_fidelity_synthpop) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, min, median, max) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as a clean table</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  desc_synthpop,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive Statistics for Synthpop Synthetic Dataset"</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrrrrrr"</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Descriptive Statistics for Synthpop Synthetic Dataset</caption>
<colgroup>
<col style="width: 41%">
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: right;">271</td>
<td style="text-align: right;">61.15</td>
<td style="text-align: right;">11.13</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.47</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: right;">269</td>
<td style="text-align: right;">435.35</td>
<td style="text-align: right;">498.44</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">232</td>
<td style="text-align: right;">2221</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.37</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">36.73</td>
<td style="text-align: right;">10.93</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: right;">268</td>
<td style="text-align: right;">269756.34</td>
<td style="text-align: right;">77738.41</td>
<td style="text-align: right;">132200</td>
<td style="text-align: right;">263358</td>
<td style="text-align: right;">421200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: right;">265</td>
<td style="text-align: right;">136.92</td>
<td style="text-align: right;">3.69</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.28</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.37</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.31</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">121.22</td>
<td style="text-align: right;">74.28</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">250</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="metadata-based-synthetic-data" class="level4" data-number="6.1.5">
<h4 data-number="6.1.5" class="anchored" data-anchor-id="metadata-based-synthetic-data"><span class="header-section-number">6.1.5</span> Metadata-Based Synthetic Data</h4>
<p>The synthetic data generated using metadata ensures that variable structures conform to the data dictionary. The summary statistics here show how well the dataset reflects the real’s attributes based on predefined metadata.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive stats for Metadata-Based synthetic dataset</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>desc_metadata <span class="ot">&lt;-</span> <span class="fu">describe</span>(syn_data_metadata) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, sd, min, median, max) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as a clean table</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  desc_metadata,</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Descriptive Statistics for Metadata-Based Synthetic Dataset"</span>,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrrrrrr"</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Descriptive Statistics for Metadata-Based Synthetic Dataset</caption>
<colgroup>
<col style="width: 40%">
<col style="width: 5%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">synth_age</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">62.57</td>
<td style="text-align: right;">11.98</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">62.5</td>
<td style="text-align: right;">82</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_anaemia*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.52</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_creatinine_phosphokinase</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">1129.11</td>
<td style="text-align: right;">594.90</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">1185.0</td>
<td style="text-align: right;">2216</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_diabetes*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.48</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_ejection_fraction</td>
<td style="text-align: right;">287</td>
<td style="text-align: right;">39.81</td>
<td style="text-align: right;">12.08</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">38.0</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_platelets</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">275686.74</td>
<td style="text-align: right;">79876.34</td>
<td style="text-align: right;">134054</td>
<td style="text-align: right;">280442.0</td>
<td style="text-align: right;">421118</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_serum_creatinine</td>
<td style="text-align: right;">281</td>
<td style="text-align: right;">1.79</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_serum_sodium</td>
<td style="text-align: right;">279</td>
<td style="text-align: right;">136.69</td>
<td style="text-align: right;">4.20</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">137.0</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_sex*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_smoking*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.51</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_hypertension*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.51</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth_deceased*</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">1.47</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth_follow_up</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">136.77</td>
<td style="text-align: right;">70.26</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">139.0</td>
<td style="text-align: right;">249</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>By comparing the descriptive statistics, you can evaluate how closely the synthetic datasets resemble the real dataset across key summary metrics. This is a critical step in assessing the quality and usability of synthetic data. Histogram Similarity Score ### Variable Exploration</p>
</section>
<section id="parametric-imputation-mice-1" class="level4" data-number="6.1.6">
<h4 data-number="6.1.6" class="anchored" data-anchor-id="parametric-imputation-mice-1"><span class="header-section-number">6.1.6</span> Parametric Imputation (MICE)</h4>
<p>The parametric imputation using the MICE framework generates synthetic data by imputing missing values based on multivariate normal distributions.</p>
<section id="bar-plots-for-categorical-variables" class="level5" data-number="6.1.6.1">
<h5 data-number="6.1.6.1" class="anchored" data-anchor-id="bar-plots-for-categorical-variables"><span class="header-section-number">6.1.6.1</span> Bar Plots for Categorical Variables</h5>
<p>To evaluate the preservation of categorical variable distributions in the synthetic data, we generate bar plots comparing the proportions of categorical variables between the real and synthetic datasets.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine real and parametric MICE synthetic datasets</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"real"</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>syn_data_1<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"synthetic"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the column names for synthetic data by removing the 'synth_' prefix</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_data_1) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"synth_"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(syn_data_1))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both datasets (real and synthetic)</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>combined_data_param <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(heart_failure, syn_data_1)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar plots for categorical variables</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>bar_plots <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heart_failure)[<span class="fu">map_lgl</span>(heart_failure, is.factor)] <span class="sc">%&gt;%</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">ggplot</span>(combined_data_param, <span class="fu">aes_string</span>(.x, <span class="at">fill =</span> <span class="st">'dataset'</span>, <span class="at">group =</span> <span class="st">'dataset'</span>)) <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..prop..), <span class="at">position =</span> <span class="fu">position_dodge2</span>(), <span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"real"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"synthetic"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> .x, <span class="at">y =</span> <span class="st">"Proportion"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>() <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of Categorical Variables Between real and Synthetic Datasets"</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined plot with one main title</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bar_plots)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Bar%20Plots%20for%20Categorical%20Variables-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="density-plots-for-numeric-variables" class="level5" data-number="6.1.6.2">
<h5 data-number="6.1.6.2" class="anchored" data-anchor-id="density-plots-for-numeric-variables"><span class="header-section-number">6.1.6.2</span> Density Plots for Numeric Variables</h5>
<p>The density plots illustrate the distribution of numeric variables between the real dataset and the parametric MICE synthetic data. The goal is to ensure that the synthetic data closely follows the real data’s numeric distribution.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plots for numeric variables (parametric imputed data)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>density_plots_param <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heart_failure)[<span class="fu">map_lgl</span>(heart_failure, is.numeric)] <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">ggplot</span>(combined_data_param, <span class="fu">aes_string</span>(.x, <span class="at">fill =</span> <span class="st">'dataset'</span>, <span class="at">group =</span> <span class="st">'dataset'</span>)) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"real"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"synthetic"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> .x, <span class="at">y =</span> <span class="st">"Density"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(<span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Arrange plots in 2 columns</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of Numeric Variables Between real and Parametric Synthetic Data"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined density plots with one main title</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(density_plots_param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Density%20plots%20for%20numeric%20variables%20(parametric%20imputed%20data)-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="non-parametric-imputation-cart-1" class="level4" data-number="6.1.7">
<h4 data-number="6.1.7" class="anchored" data-anchor-id="non-parametric-imputation-cart-1"><span class="header-section-number">6.1.7</span> Non-Parametric Imputation (CART)</h4>
<p>CART is a non-parametric approach for generating synthetic data that captures complex relationships between variables without making distributional assumptions.</p>
<section id="bar-plots-for-categorical-variables-1" class="level5" data-number="6.1.7.1">
<h5 data-number="6.1.7.1" class="anchored" data-anchor-id="bar-plots-for-categorical-variables-1"><span class="header-section-number">6.1.7.1</span> Bar Plots for Categorical Variables</h5>
<p>The bar plots compare the distribution of categorical variables in the real and synthetic datasets generated using the CART method.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine real and non-parametric CART synthetic datasets</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>syn_cart_1<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"synthetic"</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the column names for synthetic data by removing the 'synth_' prefix</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_cart_1) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"synth_"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(syn_cart_1))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both datasets (real and synthetic)</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>combined_data_cart <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(heart_failure, syn_cart_1)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar plots for categorical variables (CART-imputed data)</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>bar_plots_cart <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heart_failure)[<span class="fu">map_lgl</span>(heart_failure, is.factor)] <span class="sc">%&gt;%</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">ggplot</span>(combined_data_cart, <span class="fu">aes_string</span>(.x, <span class="at">fill =</span> <span class="st">'dataset'</span>, <span class="at">group =</span> <span class="st">'dataset'</span>)) <span class="sc">+</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..prop..), <span class="at">position =</span> <span class="fu">position_dodge2</span>(), <span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"real"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"synthetic"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> .x, <span class="at">y =</span> <span class="st">"Proportion"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>() <span class="sc">+</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of Categorical Variables Between real and Synthetic Data"</span>,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined plot with one main title</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bar_plots_cart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Bar%20plots%20for%20categorical%20variables%20(CART-imputed%20data)-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="density-plots-for-numeric-variables-1" class="level5" data-number="6.1.7.2">
<h5 data-number="6.1.7.2" class="anchored" data-anchor-id="density-plots-for-numeric-variables-1"><span class="header-section-number">6.1.7.2</span> Density Plots for Numeric Variables</h5>
<p>The density plots display how well the numeric variables in the CART-imputed synthetic data align with the real dataset.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plots for numeric variables (CART-imputed data)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>density_plots_cart <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heart_failure)[<span class="fu">map_lgl</span>(heart_failure, is.numeric)] <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">ggplot</span>(combined_data_cart, <span class="fu">aes_string</span>(.x, <span class="at">fill =</span> <span class="st">'dataset'</span>, <span class="at">group =</span> <span class="st">'dataset'</span>)) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"real"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"synthetic"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> .x, <span class="at">y =</span> <span class="st">"Density"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(<span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Arrange plots in 2 columns</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of Numeric Variables Between real and Synthetic Data"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined density plots with one main title</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(density_plots_cart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Density%20plots%20for%20numeric%20variables%20(CART-imputed%20data)-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="synthpop-based-synthetic-data-1" class="level4" data-number="6.1.8">
<h4 data-number="6.1.8" class="anchored" data-anchor-id="synthpop-based-synthetic-data-1"><span class="header-section-number">6.1.8</span> Synthpop-Based Synthetic Data</h4>
<p>Synthpop is used to generate synthetic datasets that closely follow the distributions of the real data for privacy-preserving data sharing.</p>
<section id="bar-plots-for-categorical-variables-2" class="level5" data-number="6.1.8.1">
<h5 data-number="6.1.8.1" class="anchored" data-anchor-id="bar-plots-for-categorical-variables-2"><span class="header-section-number">6.1.8.1</span> Bar Plots for Categorical Variables</h5>
<p>These bar plots assess how well Synthpop-based synthetic data maintains the categorical distributions of the real dataset.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine real and Synthpop-based synthetic datasets</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"real"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>syn_data_low_fidelity_synthpop<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"synthetic"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the column names for synthetic data by removing the 'synth_' prefix</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_data_low_fidelity_synthpop) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"synth_"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(syn_data_low_fidelity_synthpop))</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both datasets (real and synthetic)</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>combined_data_synthpop <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(heart_failure, syn_data_low_fidelity_synthpop)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar plots for categorical variables (Synthpop-based synthetic data)</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>bar_plots_synthpop <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heart_failure)[<span class="fu">map_lgl</span>(heart_failure, is.factor)] <span class="sc">%&gt;%</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">ggplot</span>(combined_data_synthpop, <span class="fu">aes_string</span>(.x, <span class="at">fill =</span> <span class="st">'dataset'</span>, <span class="at">group =</span> <span class="st">'dataset'</span>)) <span class="sc">+</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..prop..), <span class="at">position =</span> <span class="fu">position_dodge2</span>(), <span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"real"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"synthetic"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> .x, <span class="at">y =</span> <span class="st">"Proportion"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>() <span class="sc">+</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of Categorical Variables Between real and Synthetic Data"</span>,</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined plot with one main title</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bar_plots_synthpop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Bar%20plots%20for%20categorical%20variables%20(Synthpop-based%20synthetic%20data)-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="density-plots-for-numeric-variables-2" class="level5" data-number="6.1.8.2">
<h5 data-number="6.1.8.2" class="anchored" data-anchor-id="density-plots-for-numeric-variables-2"><span class="header-section-number">6.1.8.2</span> Density Plots for Numeric Variables</h5>
<p>The density plots illustrate how closely Synthpop-based synthetic data matches the real dataset for numeric variables.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine real and Synthpop-based synthetic datasets</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"real"</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>syn_data_low_fidelity_synthpop<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"synthetic"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>combined_data_synthpop <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(heart_failure, syn_data_low_fidelity_synthpop)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plots for numeric variables (Synthpop-based synthetic data)</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>density_plots_synthpop <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heart_failure)[<span class="fu">map_lgl</span>(heart_failure, is.numeric)] <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">ggplot</span>(combined_data_synthpop, <span class="fu">aes_string</span>(.x, <span class="at">fill =</span> <span class="st">'dataset'</span>, <span class="at">group =</span> <span class="st">'dataset'</span>)) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"real"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"synthetic"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> .x, <span class="at">y =</span> <span class="st">"Density"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(<span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Arrange plots in 2 columns</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of Numeric Variables Between real and Synthetic Data"</span>,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined density plots with one main title</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(density_plots_synthpop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Density%20plots%20for%20numeric%20variables%20(Synthpop-based%20synthetic%20data)-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="metadata-based-synthetic-data-1" class="level4" data-number="6.1.9">
<h4 data-number="6.1.9" class="anchored" data-anchor-id="metadata-based-synthetic-data-1"><span class="header-section-number">6.1.9</span> Metadata-Based Synthetic Data</h4>
<p>Metadata-based synthetic data generation uses a predefined data dictionary to ensure that the synthetic data follows the correct structure and distribution.</p>
<section id="bar-plots-for-categorical-variables-3" class="level5" data-number="6.1.9.1">
<h5 data-number="6.1.9.1" class="anchored" data-anchor-id="bar-plots-for-categorical-variables-3"><span class="header-section-number">6.1.9.1</span> Bar Plots for Categorical Variables</h5>
<p>We compare the categorical variables of the real and metadata-based synthetic datasets to assess distributional alignment.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine real and Metadata-based synthetic datasets</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"real"</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>syn_data_metadata<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"synthetic"</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the column names for synthetic data by removing the 'synth_' prefix</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(syn_data_metadata) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"synth_"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(syn_data_metadata))</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both datasets (real and synthetic)</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>combined_data_metadata <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(heart_failure, syn_data_metadata)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar plots for categorical variables (Metadata-based synthetic data)</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>bar_plots_metadata <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heart_failure)[<span class="fu">map_lgl</span>(heart_failure, is.factor)] <span class="sc">%&gt;%</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">ggplot</span>(combined_data_metadata, <span class="fu">aes_string</span>(.x, <span class="at">fill =</span> <span class="st">'dataset'</span>, <span class="at">group =</span> <span class="st">'dataset'</span>)) <span class="sc">+</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..prop..), <span class="at">position =</span> <span class="fu">position_dodge2</span>(), <span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"real"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"synthetic"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> .x, <span class="at">y =</span> <span class="st">"Proportion"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>() <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of Categorical Variables Between real and Synthetic Datasets"</span>,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined plot with one main title</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bar_plots_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Bar%20plots%20for%20categorical%20variables%20(Metadata-based%20synthetic%20data)-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="density-plots-for-numeric-variables-3" class="level5" data-number="6.1.9.2">
<h5 data-number="6.1.9.2" class="anchored" data-anchor-id="density-plots-for-numeric-variables-3"><span class="header-section-number">6.1.9.2</span> Density Plots for Numeric Variables</h5>
<p>The density plots for numeric variables compare the distribution of numeric values between the real and metadata-based synthetic datasets.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine real and Metadata-based synthetic datasets</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>heart_failure<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"real"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>syn_data_metadata<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"synthetic"</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>combined_data_metadata <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(heart_failure, syn_data_metadata)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plots for numeric variables (Metadata-based synthetic data)</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>density_plots_metadata <span class="ot">&lt;-</span> <span class="fu">colnames</span>(heart_failure)[<span class="fu">map_lgl</span>(heart_failure, is.numeric)] <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">ggplot</span>(combined_data_metadata, <span class="fu">aes_string</span>(.x, <span class="at">fill =</span> <span class="st">'dataset'</span>, <span class="at">group =</span> <span class="st">'dataset'</span>)) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"real"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"synthetic"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> .x, <span class="at">y =</span> <span class="st">"Density"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(<span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Arrange plots in 2 columns</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Comparison of Numeric Variables Between real and Synthetic Data"</span>,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)))</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined density plots with one main title</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(density_plots_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Density%20Plots%20for%20Numeric%20Variables-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="histogram-similarity-score" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="histogram-similarity-score"><span class="header-section-number">6.2</span> Histogram Similarity Score</h3>
<p>The Histogram Similarity Score measures how closely the marginal distributions of the synthetic data match the real data. Marginal distributions are critical for assessing whether key data characteristics such as spread, central tendency (mean/median), and shape (skewness/kurtosis) are preserved.</p>
<p>Ideal Ranges for Histogram Similarity:</p>
<ul>
<li><strong>Perfect Match:</strong> 1 (100%) indicates a perfect match between the distributions.</li>
<li><strong>Good Match:</strong> 0.85–1 (85% to 100%) shows strong similarity.</li>
<li><strong>Moderate Match:</strong> 0.65–0.85 suggests some differences that may need addressing.</li>
<li><strong>Poor Match:</strong> Below 0.65 indicates significant deviation from the real data.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom palette for datasets</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>dataset_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Parametric MICE"</span>       <span class="ot">=</span> <span class="st">"#B0D99B"</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CART Imputation"</span>       <span class="ot">=</span> <span class="st">"#528AA8"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Synthpop (Low Fidelity)"</span> <span class="ot">=</span> <span class="st">"#FFB6DB"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Metadata-Based"</span>        <span class="ot">=</span> <span class="st">"#264653"</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function once</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>calculate_histogram_similarity <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data) {</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  real_numeric <span class="ot">&lt;-</span> real_data[<span class="fu">sapply</span>(real_data, is.numeric)]</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  synthetic_numeric <span class="ot">&lt;-</span> synthetic_data[<span class="fu">sapply</span>(synthetic_data, is.numeric)]</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  similarity_scores <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">names</span>(real_numeric), <span class="cf">function</span>(var) {</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    real_hist <span class="ot">&lt;-</span> <span class="fu">hist</span>(real_numeric[[var]], <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    synthetic_hist <span class="ot">&lt;-</span> <span class="fu">hist</span>(synthetic_numeric[[var]], <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wasserstein distance between histogram midpoints</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    wasserstein_distance <span class="ot">&lt;-</span> transport<span class="sc">::</span><span class="fu">wasserstein1d</span>(real_hist<span class="sc">$</span>mids, synthetic_hist<span class="sc">$</span>mids)</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> wasserstein_distance)  <span class="co"># similarity score</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(similarity_scores)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect results in a tibble (convert to percentages)</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>hist_sim_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Parametric MICE"</span>, <span class="st">"CART Imputation"</span>, <span class="st">"Synthpop (Low Fidelity)"</span>, <span class="st">"Metadata-Based"</span>),</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Histogram_Similarity =</span> <span class="fu">c</span>(</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_histogram_similarity</span>(heart_failure, syn_data_1),</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_histogram_similarity</span>(heart_failure, syn_cart_1),</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_histogram_similarity</span>(heart_failure, syn_data_low_fidelity_synthpop),</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_histogram_similarity</span>(heart_failure, syn_data_metadata)</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Histogram_Similarity =</span> <span class="fu">round</span>(Histogram_Similarity <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))  <span class="co"># percentage</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as table</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>  hist_sim_tbl,</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Histogram Similarity Scores (%): higher = more similar to real data"</span>,</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lr"</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Histogram Similarity Scores (%): higher = more similar to real data</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Histogram_Similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">9.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: right;">9.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">9.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">9.5</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Horizontal bar chart with custom colours</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hist_sim_tbl, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> Histogram_Similarity, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Histogram_Similarity, <span class="st">"%"</span>)), </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.3</span>) <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> dataset_palette) <span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Histogram Similarity by Synthetic Method"</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Based on Wasserstein distance of variable histograms"</span>,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Similarity (%)"</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/histogram-similarity-score-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mutual-information-score" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="mutual-information-score"><span class="header-section-number">6.3</span> Mutual Information Score</h3>
<p>The Mutual Information (MI) Score measures the shared information between pairs of features in the real and synthetic datasets, assessing how well relationships between variables are preserved.</p>
<p>Ideal Ranges for Mutual Information:</p>
<ul>
<li><strong>Perfect Alignment:</strong> MI scores for synthetic data should ideally match the real within 10-20% for critical feature pairs.</li>
<li><strong>Lower MI:</strong> Consistently lower MI scores suggest that noise has been added, weakening relationships.</li>
<li><strong>Overfitting Risk:</strong> Higher MI scores than the real may indicate overfitting, increasing re-identification risk.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom palette for datasets</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>dataset_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Parametric MICE"</span>         <span class="ot">=</span> <span class="st">"#B0D99B"</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CART Imputation"</span>         <span class="ot">=</span> <span class="st">"#528AA8"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Synthpop (Low Fidelity)"</span> <span class="ot">=</span> <span class="st">"#FFB6DB"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Metadata-Based"</span>          <span class="ot">=</span> <span class="st">"#264653"</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ------- Helpers -------</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Strip 'synth_' so variable names align with the real dataset</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>strip_synth_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^synth_"</span>, <span class="st">""</span>, <span class="fu">names</span>(df))</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute pairwise MI matrix for a data.frame of discretized columns</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>compute_mi_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(df_disc) {</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(df_disc)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="fu">matrix</span>(<span class="fu">numeric</span>(<span class="dv">0</span>), <span class="at">nrow =</span> p, <span class="at">ncol =</span> p,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">colnames</span>(df_disc), <span class="fu">colnames</span>(df_disc))))</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> p, <span class="at">ncol =</span> p,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">colnames</span>(df_disc), <span class="fu">colnames</span>(df_disc)))</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(p)) {</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> i<span class="sc">:</span>p) {</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># safe MI (skip NA rows; zero if not enough variation)</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>      ok <span class="ot">&lt;-</span> <span class="fu">is.finite</span>(df_disc[[i]]) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(df_disc[[j]])</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>      xi <span class="ot">&lt;-</span> df_disc[[i]][ok]; xj <span class="ot">&lt;-</span> df_disc[[j]][ok]</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>      mi <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(xi)) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">||</span> <span class="fu">length</span>(<span class="fu">unique</span>(xj)) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="dv">0</span> <span class="cf">else</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">suppressWarnings</span>(infotheo<span class="sc">::</span><span class="fu">mutinformation</span>(xi, xj))</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>      M[i, j] <span class="ot">&lt;-</span> mi</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>      M[j, i] <span class="ot">&lt;-</span> mi</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>  M</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare two MI matrices (upper triangle only) -&gt; 0–1 similarity score (higher = closer)</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>mi_similarity_score <span class="ot">&lt;-</span> <span class="cf">function</span>(M_real, M_synth) {</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(M_real) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">length</span>(M_synth) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">colnames</span>(M_real), <span class="fu">colnames</span>(M_synth))</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> M_real[common, common, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> M_synth[common, common, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>  ut <span class="ot">&lt;-</span> <span class="fu">upper.tri</span>(R, <span class="at">diag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>  mean_abs_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(R[ut] <span class="sc">-</span> S[ut]))</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> mean_abs_diff)</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Discretize numeric columns (equal-frequency bins); keep only shared numeric vars</span></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>Mutual_Information <span class="ot">&lt;-</span> <span class="cf">function</span>(real_df, synth_df, <span class="at">nbins =</span> <span class="dv">10</span>) {</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(real_df,  <span class="fu">where</span>(is.numeric))</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> <span class="fu">strip_synth_prefix</span>(synth_df) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(real_num), <span class="fu">names</span>(synth_num))</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> real_num[common]</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> synth_num[common]</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Discretize numerics (returns integer codes)</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>  real_disc  <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(real_num,  \(x) infotheo<span class="sc">::</span><span class="fu">discretize</span>(x, <span class="at">disc =</span> <span class="st">"equalfreq"</span>, <span class="at">nbins =</span> nbins)))</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>  synth_disc <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(synth_num, \(x) infotheo<span class="sc">::</span><span class="fu">discretize</span>(x, <span class="at">disc =</span> <span class="st">"equalfreq"</span>, <span class="at">nbins =</span> nbins)))</span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># MI matrices and similarity score</span></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>  M_real  <span class="ot">&lt;-</span> <span class="fu">compute_mi_matrix</span>(real_disc)</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>  M_synth <span class="ot">&lt;-</span> <span class="fu">compute_mi_matrix</span>(synth_disc)</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mi_similarity_score</span>(M_real, M_synth)</span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a><span class="co"># ------- Compute scores and present nicely (percentages) -------</span></span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>mi_results <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Parametric MICE"</span>, <span class="st">"CART Imputation"</span>, <span class="st">"Synthpop (Low Fidelity)"</span>, <span class="st">"Metadata-Based"</span>),</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mutual_Information =</span> <span class="fu">c</span>(</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Mutual_Information</span>(heart_failure, syn_data_1),</span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Mutual_Information</span>(heart_failure, syn_cart_1),</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Mutual_Information</span>(heart_failure, syn_data_low_fidelity_synthpop),</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Mutual_Information</span>(heart_failure, syn_data_metadata)</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mutual_Information =</span> <span class="fu">round</span>(Mutual_Information <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))  <span class="co"># convert to %</span></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a><span class="co"># User-friendly table</span></span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>  mi_results,</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Mutual Information Similarity (%): higher = synthetic preserves dependency structure more closely"</span>,</span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lr"</span></span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Mutual Information Similarity (%): higher = synthetic preserves dependency structure more closely</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Mutual_Information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">93.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: right;">94.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">91.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">93.2</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Horizontal bar chart with custom colours</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mi_results, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> Mutual_Information, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Mutual_Information, <span class="st">"%"</span>)), </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.3</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> dataset_palette) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mutual Information Similarity by Synthetic Method"</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Based on pairwise MI matrices of discretized numeric variables (equal-frequency bins)"</span>,</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Similarity (%)"</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/mutual-information-score-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-score" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="correlation-score"><span class="header-section-number">6.4</span> Correlation Score</h3>
<p>The Correlation Score measures how well the relationships (correlations) between variables are preserved in the synthetic dataset compared to the real.</p>
<p>Ideal Ranges for Correlation Score:</p>
<ul>
<li><strong>Perfect Alignment:</strong> Correlations in the synthetic data should match the real closely, with deviations of 5-10% being acceptable.</li>
<li><strong>Weaker Correlations:</strong> If synthetic correlations are weaker, it may indicate loss of fidelity due to noise.</li>
<li><strong>Stronger Correlations:</strong> Stronger correlations suggest overfitting, which may increase privacy risks.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom palette for datasets</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dataset_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Parametric MICE"</span>         <span class="ot">=</span> <span class="st">"#B0D99B"</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CART Imputation"</span>         <span class="ot">=</span> <span class="st">"#528AA8"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Synthpop (Low Fidelity)"</span> <span class="ot">=</span> <span class="st">"#FFB6DB"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Metadata-Based"</span>          <span class="ot">=</span> <span class="st">"#264653"</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Strip 'synth_' so names align</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>strip_synth_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^synth_"</span>, <span class="st">""</span>, <span class="fu">names</span>(df))</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Function to calculate Correlation Similarity Score</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>calculate_correlation_score <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data) {</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep numeric columns only</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> real_data[<span class="fu">sapply</span>(real_data, is.numeric)]</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> <span class="fu">strip_synth_prefix</span>(synthetic_data)[<span class="fu">sapply</span>(<span class="fu">strip_synth_prefix</span>(synthetic_data), is.numeric)]</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use only common variables</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(real_num), <span class="fu">names</span>(synth_num))</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  real_corr  <span class="ot">&lt;-</span> <span class="fu">cor</span>(real_num[common],  <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>  synth_corr <span class="ot">&lt;-</span> <span class="fu">cor</span>(synth_num[common], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Frobenius norm difference → similarity score in [0,1]</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>  corr_diff <span class="ot">&lt;-</span> <span class="fu">norm</span>(real_corr <span class="sc">-</span> synth_corr, <span class="at">type =</span> <span class="st">"F"</span>)</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> corr_diff)</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Compute scores for all synthetic datasets</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>corr_scores <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Parametric MICE"</span>, <span class="st">"CART Imputation"</span>, <span class="st">"Synthpop (Low Fidelity)"</span>, <span class="st">"Metadata-Based"</span>),</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">Correlation_Score =</span> <span class="fu">c</span>(</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_correlation_score</span>(heart_failure, syn_data_1),</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_correlation_score</span>(heart_failure, syn_cart_1),</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_correlation_score</span>(heart_failure, syn_data_low_fidelity_synthpop),</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_correlation_score</span>(heart_failure, syn_data_metadata)</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Correlation_Score =</span> <span class="fu">round</span>(Correlation_Score <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))   <span class="co"># convert to %</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a><span class="co"># --- User-friendly table</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>  corr_scores,</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Correlation Similarity Scores (%): higher = synthetic preserves correlation structure more closely"</span>,</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lr"</span></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Correlation Similarity Scores (%): higher = synthetic preserves correlation structure more closely</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Correlation_Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">58.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: right;">67.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">53.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">55.5</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Horizontal bar chart with custom colours</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(corr_scores, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> Correlation_Score, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Correlation_Score, <span class="st">"%"</span>)), </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.3</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> dataset_palette) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Correlation Similarity by Synthetic Method"</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Based on Frobenius norm difference between real and synthetic correlation matrices"</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Similarity (%)"</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/correlation-score-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="utility-assessment" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="utility-assessment"><span class="header-section-number">7</span> Utility Assessment</h2>
<section id="feature-importance-consistency-assessment" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="feature-importance-consistency-assessment"><span class="header-section-number">7.1</span> Feature Importance Consistency Assessment</h3>
<p>The Feature Importance Consistency Assessment evaluates how well the synthetic datasets retain the predictive significance of features compared to the real dataset. This assessment is essential for ensuring that the synthetic data accurately reflects the underlying relationships that contribute to the model’s predictive performance.</p>
<p>Feature importance measures each variable’s contribution to model predictions. Consistency in feature importance rankings between the real and synthetic datasets serves as a crucial indicator of data quality. Significant discrepancies may indicate deficiencies in the synthetic data generation process, potentially affecting the performance of models trained on synthetic data.</p>
<p>Ideal Ranges for Feature Importance Consistency Assessment:</p>
<ul>
<li><strong>Perfect Match</strong>: Feature importance scores in the synthetic dataset should closely align with those in the real dataset, particularly for highly predictive features.</li>
<li><strong>Acceptable Deviation</strong>: A deviation of 10-15% is generally acceptable for most features. For variables identified as highly influential, stricter thresholds may be needed to maintain predictive accuracy.</li>
</ul>
<p>Types of Deviations</p>
<ul>
<li><strong>Underrepresentation</strong>: If an important feature has lower importance in the synthetic dataset, it may suggest that critical predictive relationships are not well-preserved.</li>
<li><strong>Overrepresentation</strong>: If a feature’s importance is higher in the synthetic data, this could indicate noise or overfitting, potentially distorting the model’s perception of feature relationships.</li>
</ul>
<p>The following visualisation techniques will be used to compare feature importance:</p>
<ul>
<li><strong>Bar Plots for Feature Importance Comparison</strong>: Bar plots will compare feature importance scores between the real and synthetic datasets. This visual comparison can reveal significant deviations.</li>
<li><strong>SHAP Summary Plots</strong>: SHAP (SHapley Additive exPlanations) summary plots provide a comprehensive view of the distribution of SHAP values for each feature, allowing for a direct comparison between the real and synthetic datasets.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data for XGBoost</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(heart_failure)), <span class="at">size =</span> <span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">nrow</span>(heart_failure))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>train_real <span class="ot">&lt;-</span> heart_failure[train_indices, ]</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>test_real <span class="ot">&lt;-</span> heart_failure[<span class="sc">-</span>train_indices, ]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>train_real_matrix <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(deceased <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> anaemia <span class="sc">+</span> creatinine_phosphokinase <span class="sc">+</span> diabetes <span class="sc">+</span> ejection_fraction <span class="sc">+</span> platelets <span class="sc">+</span> serum_creatinine <span class="sc">+</span> serum_sodium <span class="sc">+</span> smoking <span class="sc">+</span> hypertension <span class="sc">+</span> follow_up <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> train_real)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>train_real_label <span class="ot">&lt;-</span> train_real[<span class="fu">rownames</span>(train_real_matrix), <span class="st">"deceased"</span>]</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>train_real_label <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_real_label) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Convert factor to 0 and 1</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>train_synth <span class="ot">&lt;-</span> syn_data_1[train_indices, ]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>train_synth_matrix <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(deceased <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> anaemia <span class="sc">+</span> creatinine_phosphokinase <span class="sc">+</span> diabetes <span class="sc">+</span> ejection_fraction <span class="sc">+</span> platelets <span class="sc">+</span> serum_creatinine <span class="sc">+</span> serum_sodium <span class="sc">+</span> smoking <span class="sc">+</span> hypertension <span class="sc">+</span> follow_up <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> train_synth)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>train_synth_label <span class="ot">&lt;-</span> train_synth[<span class="fu">rownames</span>(train_synth_matrix), <span class="st">"deceased"</span>]</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>train_synth_label <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_synth_label) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Convert factor to 0 and 1</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DMatrix format, which is required for XGBoost</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>dtrain_real <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_real_matrix, <span class="at">label =</span> train_real_label)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>dtrain_synth <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_synth_matrix, <span class="at">label =</span> train_synth_label)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up parameters for XGBoost</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"auc"</span>,  <span class="co"># Use AUC as an evaluation metric</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">3</span>,</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune hyperparameters using cross-validation (with parallel processing)</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>cv_real <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dtrain_real,</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">nthread =</span> num_cores  <span class="co"># Number of threads for parallel processing</span></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>best_nrounds_real <span class="ot">&lt;-</span> cv_real<span class="sc">$</span>best_iteration</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>cv_synth <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dtrain_synth,</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">nthread =</span> num_cores  <span class="co"># Number of threads for parallel processing</span></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>best_nrounds_synth <span class="ot">&lt;-</span> cv_synth<span class="sc">$</span>best_iteration</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Train XGBoost on real data (TRTR)</span></span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>xgb_model_trtr <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">params =</span> params, <span class="at">data =</span> dtrain_real, <span class="at">nrounds =</span> best_nrounds_real, <span class="at">verbose =</span> <span class="dv">0</span>, <span class="at">nthread =</span> num_cores)</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Train XGBoost on synthetic data (TSTR)</span></span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>xgb_model_tstr <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">params =</span> params, <span class="at">data =</span> dtrain_synth, <span class="at">nrounds =</span> best_nrounds_synth, <span class="at">verbose =</span> <span class="dv">0</span>, <span class="at">nthread =</span> num_cores)</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Get feature importance for TRTR</span></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>importance_trtr <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">feature_names =</span> <span class="fu">colnames</span>(train_real_matrix), <span class="at">model =</span> xgb_model_trtr)</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Feature Importance for TRTR:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Feature Importance for TRTR:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(importance_trtr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    Feature        Gain      Cover  Frequency
                     &lt;char&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1:                follow_up 0.550035467 0.35582680 0.26470588
2:         serum_creatinine 0.179450673 0.25780255 0.22794118
3:        ejection_fraction 0.107840968 0.17061583 0.12500000
4: creatinine_phosphokinase 0.100830923 0.12847956 0.20588235
5:             serum_sodium 0.032740748 0.04233723 0.08823529
6:                      age 0.022510598 0.03446459 0.04411765
7:                platelets 0.006590623 0.01047345 0.04411765</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get feature importance for TSTR</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>importance_tstr <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">feature_names =</span> <span class="fu">colnames</span>(train_synth_matrix), <span class="at">model =</span> xgb_model_tstr)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Feature Importance for TSTR:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Feature Importance for TSTR:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(importance_tstr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    Feature       Gain      Cover Frequency
                     &lt;char&gt;      &lt;num&gt;      &lt;num&gt;     &lt;num&gt;
1:                follow_up 0.37991328 0.37325270      0.20
2:        ejection_fraction 0.22999025 0.21347069      0.32
3:             serum_sodium 0.20146359 0.17350782      0.16
4:                platelets 0.13419963 0.10862788      0.12
5:         serum_creatinine 0.04007483 0.12057396      0.16
6: creatinine_phosphokinase 0.01435841 0.01056696      0.04</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise feature importance for TRTR and TSTR</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>importance_trtr<span class="sc">$</span>Dataset <span class="ot">&lt;-</span> <span class="st">"Real Data"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>importance_tstr<span class="sc">$</span>Dataset <span class="ot">&lt;-</span> <span class="st">"Synthetic Data"</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>importance_combined <span class="ot">&lt;-</span> <span class="fu">rbind</span>(importance_trtr, importance_tstr)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot feature importance comparison</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(importance_combined, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Feature, Gain), <span class="at">y =</span> Gain, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Feature Importance Comparison (TRTR vs TSTR)"</span>,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Feature"</span>,</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Gain"</span>) <span class="sc">+</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Real Data"</span> <span class="ot">=</span> <span class="st">"#B0D99B"</span>, <span class="st">"Synthetic Data"</span> <span class="ot">=</span> <span class="st">"#528AA8"</span>)) <span class="sc">+</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Feature%20Importance%20Consistency%20Assessment-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation analysis between feature importance rankings</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>importance_trtr <span class="ot">&lt;-</span> importance_trtr <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="sc">-</span>Gain))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>importance_tstr <span class="ot">&lt;-</span> importance_tstr <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="sc">-</span>Gain))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>importance_ranking <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(importance_trtr, importance_tstr, <span class="at">by =</span> <span class="st">"Feature"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_trtr"</span>, <span class="st">"_tstr"</span>))</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(importance_ranking<span class="sc">$</span>rank_trtr, importance_ranking<span class="sc">$</span>rank_tstr, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Spearman correlation Between TRTR and TSTR Feature Importance Rankings:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Spearman correlation Between TRTR and TSTR Feature Importance Rankings:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3714286</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate SHAP values for better interpretability</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SHAP values for TRTR</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>shap_values_trtr <span class="ot">&lt;-</span> <span class="fu">shap.values</span>(xgb_model_trtr, dtrain_real)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>shap_long_trtr <span class="ot">&lt;-</span> <span class="fu">shap.prep</span>(<span class="at">shap_contrib =</span> shap_values_trtr<span class="sc">$</span>shap_score, <span class="at">X_train =</span> train_real_matrix)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">SHAP Summary for TRTR:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
SHAP Summary for TRTR:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>shap_values_trtr<span class="sc">$</span>mean_shap_score <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               follow_up         serum_creatinine        ejection_fraction 
              0.92293409               0.52780225               0.39932806 
creatinine_phosphokinase             serum_sodium                      age 
              0.18850937               0.10067811               0.06711965 
               platelets                sexFemale                  sexMale 
              0.02991459               0.00000000               0.00000000 
              anaemiaYes              diabetesYes               smokingYes 
              0.00000000               0.00000000               0.00000000 
         hypertensionYes 
              0.00000000 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SHAP values for TSTR</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>shap_values_tstr <span class="ot">&lt;-</span> <span class="fu">shap.values</span>(xgb_model_tstr, dtrain_synth)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>shap_long_tstr <span class="ot">&lt;-</span> <span class="fu">shap.prep</span>(<span class="at">shap_contrib =</span> shap_values_tstr<span class="sc">$</span>shap_score, <span class="at">X_train =</span> train_synth_matrix)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">SHAP Summary for TSTR:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
SHAP Summary for TSTR:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>shap_values_tstr<span class="sc">$</span>mean_shap_score <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               follow_up        ejection_fraction                platelets 
             0.210816300              0.069274587              0.067060756 
            serum_sodium         serum_creatinine creatinine_phosphokinase 
             0.058853411              0.035087248              0.006947092 
                     age                sexFemale                  sexMale 
             0.000000000              0.000000000              0.000000000 
              anaemiaYes              diabetesYes               smokingYes 
             0.000000000              0.000000000              0.000000000 
         hypertensionYes 
             0.000000000 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SHAP visualisation</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shap.plot.summary</span>(shap_long_trtr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Feature%20Importance%20Consistency%20Assessment-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shap.plot.summary</span>(shap_long_tstr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Feature%20Importance%20Consistency%20Assessment-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prediction-score" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="prediction-score"><span class="header-section-number">7.2</span> Prediction Score</h3>
<p>The Prediction Score assesses synthetic data utility by comparing models trained on real data (Train Real Test Real (TRTR)) versus synthetic data (Train Synthetic Test Real (TSTR)) using two metrics:</p>
<ul>
<li><strong>Accuracy</strong>: The proportion of correct predictions made by the model.</li>
<li><strong>pMSE (Prediction Mean Squared Error)</strong>: Measures the average of the squared differences between predicted and actual values.</li>
</ul>
<p>Ideal Ranges for Prediction Score:</p>
<ul>
<li><strong>Accuracy</strong>: TSTR accuracy should be within 5-10% of TRTR accuracy. Lower accuracy signals that synthetic data isn’t fully representative of the real dataset.</li>
<li><strong>pMSE</strong>: TSTR pMSE should be close to TRTR pMSE. A 5-10% deviation is acceptable; a higher pMSE suggests synthetic data may not be accurately reflecting the true relationships in the real data.</li>
</ul>
<p>This section assesses the utility of synthetic data generated through various methods, using XGBoost to calculate both Accuracy and pMSE for TRTR and TSTR.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- helpers ----</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>strip_synth_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(df) { <span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^synth_"</span>, <span class="st">""</span>, <span class="fu">names</span>(df)); df }</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>align_target_levels <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">levels_ref =</span> <span class="cn">NULL</span>, <span class="at">positive =</span> <span class="cn">NULL</span>) {</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.factor</span>(df<span class="sc">$</span>deceased)) {</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(df<span class="sc">$</span>deceased)) df<span class="sc">$</span>deceased <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(df<span class="sc">$</span>deceased)) <span class="cf">else</span> df<span class="sc">$</span>deceased <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>deceased)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(levels_ref)) df<span class="sc">$</span>deceased <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>deceased, <span class="at">levels =</span> levels_ref)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  lev <span class="ot">&lt;-</span> <span class="fu">levels</span>(df<span class="sc">$</span>deceased)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(lev) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">stop</span>(<span class="st">"Target 'deceased' must have two levels."</span>)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  pos <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(positive) <span class="sc">&amp;&amp;</span> positive <span class="sc">%in%</span> lev) positive <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"1"</span> <span class="sc">%in%</span> lev) <span class="st">"1"</span> <span class="cf">else</span> lev[<span class="dv">2</span>]</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>deceased <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">relevel</span>(df<span class="sc">$</span>deceased, <span class="at">ref =</span> pos)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">data =</span> df, <span class="at">levels =</span> <span class="fu">levels</span>(df<span class="sc">$</span>deceased), <span class="at">positive =</span> pos)</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>evaluate_model <span class="ot">&lt;-</span> <span class="cf">function</span>(train_data, test_data, label, tune_grid, train_control, <span class="at">seed =</span> <span class="dv">123</span>) {</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  test_aln  <span class="ot">&lt;-</span> <span class="fu">align_target_levels</span>(test_data)</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>  train_aln <span class="ot">&lt;-</span> <span class="fu">align_target_levels</span>(train_data, <span class="at">levels_ref =</span> test_aln<span class="sc">$</span>levels, <span class="at">positive =</span> test_aln<span class="sc">$</span>positive)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> train_aln<span class="sc">$</span>data</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  test_data  <span class="ot">&lt;-</span> test_aln<span class="sc">$</span>data</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>    deceased <span class="sc">~</span> follow_up <span class="sc">+</span> serum_creatinine <span class="sc">+</span> ejection_fraction <span class="sc">+</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>      creatinine_phosphokinase <span class="sc">+</span> serum_sodium <span class="sc">+</span> age <span class="sc">+</span> platelets,</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">data      =</span> train_data,</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">method    =</span> <span class="st">"xgbTree"</span>,</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> train_control,</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid  =</span> tune_grid,</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.action =</span> na.pass</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, test_data)</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>  acc  <span class="ot">&lt;-</span> <span class="fu">mean</span>(pred <span class="sc">==</span> test_data<span class="sc">$</span>deceased, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>  yhat <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(pred)</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>  y    <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data<span class="sc">$</span>deceased)</span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>  pMSE <span class="ot">&lt;-</span> <span class="fu">mean</span>((yhat <span class="sc">-</span> y)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">Dataset =</span> label, <span class="at">Accuracy =</span> acc, <span class="at">pMSE =</span> pMSE)</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- CV setup ----</span></span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>)</span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a>tune_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">50</span>,</span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">3</span>,</span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,</span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fl">0.8</span>,</span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.7</span></span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- prepare synthetic splits ----</span></span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a>syn_mice      <span class="ot">&lt;-</span> <span class="fu">strip_synth_prefix</span>(syn_data_1)</span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a>syn_cart      <span class="ot">&lt;-</span> <span class="fu">strip_synth_prefix</span>(syn_cart_1)</span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true" tabindex="-1"></a>syn_synthpop  <span class="ot">&lt;-</span> <span class="fu">strip_synth_prefix</span>(syn_data_low_fidelity_synthpop)</span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true" tabindex="-1"></a>syn_metadata  <span class="ot">&lt;-</span> <span class="fu">strip_synth_prefix</span>(syn_data_metadata)</span>
<span id="cb79-61"><a href="#cb79-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-62"><a href="#cb79-62" aria-hidden="true" tabindex="-1"></a>train_synth_mice     <span class="ot">&lt;-</span> syn_mice[train_indices, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb79-63"><a href="#cb79-63" aria-hidden="true" tabindex="-1"></a>train_synth_cart     <span class="ot">&lt;-</span> syn_cart[train_indices, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb79-64"><a href="#cb79-64" aria-hidden="true" tabindex="-1"></a>train_synth_synthpop <span class="ot">&lt;-</span> syn_synthpop[train_indices, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb79-65"><a href="#cb79-65" aria-hidden="true" tabindex="-1"></a>train_synth_metadata <span class="ot">&lt;-</span> syn_metadata[train_indices, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb79-66"><a href="#cb79-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-67"><a href="#cb79-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- results table ----</span></span>
<span id="cb79-68"><a href="#cb79-68" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb79-69"><a href="#cb79-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">evaluate_model</span>(train_real,               test_real, <span class="st">"TRTR (Real→Real)"</span>,     tune_grid, train_control),</span>
<span id="cb79-70"><a href="#cb79-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">evaluate_model</span>(train_synth_mice,         test_real, <span class="st">"TSTR (MICE→Real)"</span>,     tune_grid, train_control),</span>
<span id="cb79-71"><a href="#cb79-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">evaluate_model</span>(train_synth_cart,         test_real, <span class="st">"TSTR (CART→Real)"</span>,     tune_grid, train_control),</span>
<span id="cb79-72"><a href="#cb79-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">evaluate_model</span>(train_synth_synthpop,     test_real, <span class="st">"TSTR (Synthpop→Real)"</span>, tune_grid, train_control),</span>
<span id="cb79-73"><a href="#cb79-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">evaluate_model</span>(train_synth_metadata,     test_real, <span class="st">"TSTR (Metadata→Real)"</span>, tune_grid, train_control)</span>
<span id="cb79-74"><a href="#cb79-74" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb79-75"><a href="#cb79-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-76"><a href="#cb79-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">Accuracy =</span> scales<span class="sc">::</span><span class="fu">percent</span>(Accuracy, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb79-77"><a href="#cb79-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">pMSE     =</span> <span class="fu">round</span>(pMSE, <span class="dv">3</span>)</span>
<span id="cb79-78"><a href="#cb79-78" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb79-79"><a href="#cb79-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-80"><a href="#cb79-80" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb79-81"><a href="#cb79-81" aria-hidden="true" tabindex="-1"></a>  results,</span>
<span id="cb79-82"><a href="#cb79-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Prediction Score Summary (XGBoost, 5-fold CV): TRTR vs TSTR"</span>,</span>
<span id="cb79-83"><a href="#cb79-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrr"</span></span>
<span id="cb79-84"><a href="#cb79-84" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Prediction Score Summary (XGBoost, 5-fold CV): TRTR vs TSTR</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Accuracy</th>
<th style="text-align: right;">pMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">TRTR (Real→Real)</td>
<td style="text-align: right;">67.8%</td>
<td style="text-align: right;">0.322</td>
</tr>
<tr class="even">
<td style="text-align: left;">TSTR (MICE→Real)</td>
<td style="text-align: right;">70.0%</td>
<td style="text-align: right;">0.300</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TSTR (CART→Real)</td>
<td style="text-align: right;">70.0%</td>
<td style="text-align: right;">0.300</td>
</tr>
<tr class="even">
<td style="text-align: left;">TSTR (Synthpop→Real)</td>
<td style="text-align: right;">66.7%</td>
<td style="text-align: right;">0.333</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TSTR (Metadata→Real)</td>
<td style="text-align: right;">56.7%</td>
<td style="text-align: right;">0.433</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- horizontal Accuracy bar chart ----</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>palette5 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>, <span class="st">"#FFB6DB"</span>, <span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Accuracy_num =</span> readr<span class="sc">::</span><span class="fu">parse_number</span>(Accuracy) <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> Accuracy_num, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Accuracy), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">setNames</span>(palette5, <span class="fu">unique</span>(plot_df<span class="sc">$</span>Dataset))) <span class="sc">+</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model Accuracy: TRTR vs TSTR"</span>, <span class="at">x =</span> <span class="st">"Accuracy"</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Prediction%20Score-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="quality-score-qscore" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="quality-score-qscore"><span class="header-section-number">7.3</span> Quality Score (QScore)</h3>
<p>The QScore provides a comprehensive evaluation of synthetic data by aggregating multiple metrics, such as distribution similarity, feature importance, and correlation preservation, into a single score. This offers a clear, overall assessment of how well the synthetic data replicates the real dataset.</p>
<p>Ideal Ranges for QScore:</p>
<ul>
<li><strong>Excellent Quality (0.8 - 1.0)</strong>: Indicates the synthetic data closely mirrors the real and can be confidently used for most analyses.</li>
<li><strong>Good Quality (0.6 - 0.8)</strong>: Reflects good alignment, with some minor deviations. Suitable for most use cases, but some caution is advised.</li>
<li><strong>Moderate Quality (0.4 - 0.6)</strong>: The synthetic data may be useful for exploratory analysis but shows significant deviations in key metrics.</li>
<li><strong>Poor Quality (&lt; 0.4)</strong>: The synthetic data poorly aligns with the real and is likely unsuitable for most analytic or modeling tasks.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- QScore helper ----</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>calculate_qscore <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data, <span class="at">num_queries =</span> <span class="dv">10</span>) {</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  numeric_real_vars  <span class="ot">&lt;-</span> <span class="fu">names</span>(real_data)[<span class="fu">sapply</span>(real_data, is.numeric)]</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  numeric_synth_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(synthetic_data)[<span class="fu">sapply</span>(synthetic_data, is.numeric)]</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  common_vars <span class="ot">&lt;-</span> <span class="fu">intersect</span>(numeric_real_vars, numeric_synth_vars)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common_vars) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  qscores <span class="ot">&lt;-</span> <span class="fu">replicate</span>(num_queries, {</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    var_name <span class="ot">&lt;-</span> <span class="fu">sample</span>(common_vars, <span class="dv">1</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    fun_name <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sum"</span>), <span class="dv">1</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    fun      <span class="ot">&lt;-</span> <span class="fu">match.fun</span>(fun_name)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    real_val  <span class="ot">&lt;-</span> <span class="fu">fun</span>(real_data[[var_name]],  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    synth_val <span class="ot">&lt;-</span> <span class="fu">fun</span>(synthetic_data[[var_name]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(real_val) <span class="sc">&amp;&amp;</span> real_val <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(synth_val)) {</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(real_val <span class="sc">-</span> synth_val) <span class="sc">/</span> <span class="fu">abs</span>(real_val)  <span class="co"># proportion difference (0–1)</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(qscores, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Compute and present ----</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>qscore_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Parametric MICE"</span>, <span class="st">"CART Imputation"</span>,</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Synthpop (Low Fidelity)"</span>, <span class="st">"Metadata-Based"</span>),</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">QScore =</span> <span class="fu">c</span>(</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_qscore</span>(heart_failure, syn_data_1),</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_qscore</span>(heart_failure, syn_cart_1),</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_qscore</span>(heart_failure, syn_data_low_fidelity_synthpop),</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_qscore</span>(heart_failure, syn_data_metadata)</span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">QScore_num =</span> QScore,                                   <span class="co"># keep numeric 0–1</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">QScore_pct =</span> scales<span class="sc">::</span><span class="fu">percent</span>(QScore_num, <span class="at">accuracy =</span> <span class="fl">0.1</span>) <span class="co"># pretty %</span></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a><span class="co"># --- User-friendly table (as percentages) ---</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>  qscore_tbl <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Dataset, <span class="st">`</span><span class="at">QScore (%)</span><span class="st">`</span> <span class="ot">=</span> QScore_pct),</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Quality Score (QScore) — average % difference in aggregates (lower is better)"</span>,</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lr"</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Quality Score (QScore) — average % difference in aggregates (lower is better)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">QScore (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">8.8%</td>
</tr>
<tr class="even">
<td style="text-align: left;">CART Imputation</td>
<td style="text-align: right;">4.7%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">10.6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">3.0%</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Horizontal bar chart (percent axis) ---</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>, <span class="st">"#FFB6DB"</span>, <span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(qscore_tbl, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> QScore_num, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> QScore_pct), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">setNames</span>(pal[<span class="fu">seq_len</span>(<span class="fu">nrow</span>(qscore_tbl))], qscore_tbl<span class="sc">$</span>Dataset)) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"QScore Comparison (Lower is Better)"</span>,</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Average percentage difference between real and synthetic aggregates across random queries"</span>,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"QScore (%)"</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Quality%20Score-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:99.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="privacy-disclosure-risk" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="privacy-disclosure-risk"><span class="header-section-number">8</span> Privacy / Disclosure Risk</h2>
<section id="check-for-replication-of-real-value-combinations" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="check-for-replication-of-real-value-combinations"><span class="header-section-number">8.1</span> Check for Replication of Real Value Combinations</h3>
<p>This check identifies if any records in the synthetic data are exact duplicates of those in the real dataset. High replication increases privacy risks, so minimal or no duplication is ideal for preserving privacy.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Replicated rows count ----</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>check_replicated_rows <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data) {</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> <span class="fu">rbind</span>(real_data, synthetic_data)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">duplicated</span>(combined))</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Build results table ----</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>replication_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Parametric MICE"</span>, <span class="st">"Non-Parametric CART"</span>, </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Synthpop (Low Fidelity)"</span>, <span class="st">"Metadata-Based"</span>),</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Replicated_Rows =</span> <span class="fu">c</span>(</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_replicated_rows</span>(heart_failure, syn_data_1),</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_replicated_rows</span>(heart_failure, syn_cart_1),</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_replicated_rows</span>(heart_failure, syn_data_low_fidelity_synthpop),</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_replicated_rows</span>(heart_failure, syn_data_metadata)</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Rows =</span> <span class="fu">nrow</span>(heart_failure),</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Replication_Percent =</span> <span class="fu">round</span>((Replicated_Rows <span class="sc">/</span> Total_Rows) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Status =</span> <span class="fu">ifelse</span>(Replicated_Rows <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"⚠️ Replication Found"</span>, <span class="st">"✅ No Replication"</span>)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- User-friendly table ----</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>  replication_tbl,</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Replication Check: Exact Matching Rows Between Real and Synthetic Datasets"</span>,</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrrrl"</span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Replication Check: Exact Matching Rows Between Real and Synthetic Datasets</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 22%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Replicated_Rows</th>
<th style="text-align: right;">Total_Rows</th>
<th style="text-align: right;">Replication_Percent</th>
<th style="text-align: left;">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">✅ No Replication</td>
</tr>
<tr class="even">
<td style="text-align: left;">Non-Parametric CART</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">✅ No Replication</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">✅ No Replication</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">✅ No Replication</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Optional: bar chart if any replication &gt; 0 ----</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(replication_tbl<span class="sc">$</span>Replicated_Rows <span class="sc">&gt;</span> <span class="dv">0</span>)) {</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>, <span class="st">"#FFB6DB"</span>, <span class="st">"#264653"</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(replication_tbl, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> Replicated_Rows, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Replicated_Rows), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal[<span class="fu">seq_len</span>(<span class="fu">nrow</span>(replication_tbl))]) <span class="sc">+</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Replication of Real Rows in Synthetic Data"</span>,</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Counts of exact duplicated rows across real and synthetic datasets"</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Number of Replicated Rows"</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ No replicated rows were found across any synthetic dataset. No plot is generated.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✅ No replicated rows were found across any synthetic dataset. No plot is generated.</code></pre>
</div>
</div>
</section>
<section id="check-for-unique-value-combinations" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="check-for-unique-value-combinations"><span class="header-section-number">8.2</span> Check for Unique Value Combinations</h3>
<p>This analysis compares the number of unique row combinations between the real and synthetic datasets. A high number of unique combinations in the synthetic data suggests that it captures diverse patterns while minimising the replication of sensitive information, enhancing privacy protection.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Count unique rows ----</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>unique_combinations <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(<span class="fu">unique</span>(data))</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Build results table ----</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>unique_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Real Data"</span>, <span class="st">"Parametric MICE"</span>, </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Non-Parametric CART"</span>, <span class="st">"Synthpop (Low Fidelity)"</span>, </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Metadata-Based"</span>),</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Unique_Combinations =</span> <span class="fu">c</span>(</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique_combinations</span>(heart_failure),</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique_combinations</span>(syn_data_1),</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique_combinations</span>(syn_cart_1),</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique_combinations</span>(syn_data_low_fidelity_synthpop),</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique_combinations</span>(syn_data_metadata)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Rows =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(heart_failure), <span class="fu">rep</span>(<span class="fu">nrow</span>(heart_failure), <span class="dv">4</span>)),</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Percent_Unique =</span> <span class="fu">round</span>((Unique_Combinations <span class="sc">/</span> Total_Rows) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- User-friendly table ----</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>  unique_tbl,</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Unique Value Combinations in Real vs. Synthetic Datasets"</span>,</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrr"</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Unique Value Combinations in Real vs.&nbsp;Synthetic Datasets</caption>
<colgroup>
<col style="width: 34%">
<col style="width: 28%">
<col style="width: 15%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Unique_Combinations</th>
<th style="text-align: right;">Total_Rows</th>
<th style="text-align: left;">Percent_Unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Real Data</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">299</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">299</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Non-Parametric CART</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">299</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">299</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">299</td>
<td style="text-align: left;">100</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot only if any dataset has &gt; 0 unique rows ----</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(unique_tbl<span class="sc">$</span>Unique_Combinations <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>, <span class="st">"#FFB6DB"</span>, <span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(unique_tbl, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> Percent_Unique, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percent_Unique, <span class="st">"%"</span>)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal[<span class="fu">seq_len</span>(<span class="fu">nrow</span>(unique_tbl))]) <span class="sc">+</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Percentage of Unique Row Combinations"</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Higher % means fewer duplicates within the dataset"</span>,</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Percent of Rows that are Unique"</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ No unique combinations detected across datasets.  No plot is generated. </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="heart_failure_synthetic_data_project_files/figure-html/Check%20for%20Unique%20Value%20Combinations-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:99.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exact-match-score" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="exact-match-score"><span class="header-section-number">8.3</span> Exact Match Score</h3>
<p>The Exact Match Score measures how many individual records in the synthetic data are identical to records in the real dataset. Lower scores are ideal for privacy preservation, as high exact matches may pose privacy risks.</p>
<p>Ideal Ranges for Exact Match Score:</p>
<ul>
<li><strong>0 - 0.1</strong>: Strong privacy protection with minimal or no exact matches, ideal for most privacy-preserving synthetic data.</li>
<li><strong>0.1 - 0.3</strong>: Moderate exact matches, indicating some privacy risk but generally acceptable for many use cases.</li>
<li><strong>0.3 - 0.5</strong>: Higher exact matches, raising privacy concerns. Review is needed to ensure proper data generation.</li>
<li><strong>Above 0.5</strong>: Significant privacy risk, as the synthetic data too closely replicates the real.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Exact Match Score ----</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>calculate_exact_match_score <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data) {</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use only shared columns (to avoid mismatched names / prefixed cols)</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>common_cols <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(real_data), <span class="fu">names</span>(synthetic_data))</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(common_cols) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="at">exact_match_rows   =</span> <span class="cn">NA_integer_</span>,</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="at">total_synth_rows   =</span> <span class="cn">NA_integer_</span>,</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="at">exact_match_score  =</span> <span class="cn">NA_real_</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>real_aligned  <span class="ot">&lt;-</span> real_data[, common_cols, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>synth_aligned <span class="ot">&lt;-</span> synthetic_data[, common_cols, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: build a row "signature" string for fast equality checking</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>row_sig <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>df,</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(rowvals) <span class="fu">paste</span>(</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">is.na</span>(rowvals), <span class="st">"&lt;NA&gt;"</span>, <span class="fu">as.character</span>(rowvals)),</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a><span class="at">collapse =</span> <span class="st">"||"</span></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>real_keys  <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">row_sig</span>(real_aligned))</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>synth_keys <span class="ot">&lt;-</span> <span class="fu">row_sig</span>(synth_aligned)</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Count exact matches (synthetic rows that appear verbatim in real)</span></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>is_exact_match <span class="ot">&lt;-</span> synth_keys <span class="sc">%in%</span> real_keys</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>n_matches      <span class="ot">&lt;-</span> <span class="fu">sum</span>(is_exact_match, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>total_synth    <span class="ot">&lt;-</span> <span class="fu">length</span>(synth_keys)</span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of synthetic rows that are exact copies of real rows</span></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>exact_score <span class="ot">&lt;-</span> n_matches <span class="sc">/</span> total_synth</span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a><span class="at">exact_match_rows   =</span> n_matches,</span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a><span class="at">total_synth_rows   =</span> total_synth,</span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a><span class="at">exact_match_score  =</span> exact_score</span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Results table ----</span></span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>exact_mice     <span class="ot">&lt;-</span> <span class="fu">calculate_exact_match_score</span>(heart_failure, syn_data_1)</span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>exact_cart     <span class="ot">&lt;-</span> <span class="fu">calculate_exact_match_score</span>(heart_failure, syn_cart_1)</span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>exact_synthpop <span class="ot">&lt;-</span> <span class="fu">calculate_exact_match_score</span>(heart_failure, syn_data_low_fidelity_synthpop)</span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a>exact_meta     <span class="ot">&lt;-</span> <span class="fu">calculate_exact_match_score</span>(heart_failure, syn_data_metadata)</span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a>exact_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a><span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Parametric MICE"</span>,</span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a><span class="st">"Non-Parametric CART"</span>,</span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a><span class="st">"Synthpop (Low Fidelity)"</span>,</span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a><span class="st">"Metadata-Based"</span>),</span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a><span class="at">Exact_Match_Rows =</span> <span class="fu">c</span>(</span>
<span id="cb88-65"><a href="#cb88-65" aria-hidden="true" tabindex="-1"></a>exact_mice<span class="sc">$</span>exact_match_rows,</span>
<span id="cb88-66"><a href="#cb88-66" aria-hidden="true" tabindex="-1"></a>exact_cart<span class="sc">$</span>exact_match_rows,</span>
<span id="cb88-67"><a href="#cb88-67" aria-hidden="true" tabindex="-1"></a>exact_synthpop<span class="sc">$</span>exact_match_rows,</span>
<span id="cb88-68"><a href="#cb88-68" aria-hidden="true" tabindex="-1"></a>exact_meta<span class="sc">$</span>exact_match_rows</span>
<span id="cb88-69"><a href="#cb88-69" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb88-70"><a href="#cb88-70" aria-hidden="true" tabindex="-1"></a><span class="at">Total_Synthetic_Rows =</span> <span class="fu">c</span>(</span>
<span id="cb88-71"><a href="#cb88-71" aria-hidden="true" tabindex="-1"></a>exact_mice<span class="sc">$</span>total_synth_rows,</span>
<span id="cb88-72"><a href="#cb88-72" aria-hidden="true" tabindex="-1"></a>exact_cart<span class="sc">$</span>total_synth_rows,</span>
<span id="cb88-73"><a href="#cb88-73" aria-hidden="true" tabindex="-1"></a>exact_synthpop<span class="sc">$</span>total_synth_rows,</span>
<span id="cb88-74"><a href="#cb88-74" aria-hidden="true" tabindex="-1"></a>exact_meta<span class="sc">$</span>total_synth_rows</span>
<span id="cb88-75"><a href="#cb88-75" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb88-76"><a href="#cb88-76" aria-hidden="true" tabindex="-1"></a><span class="at">Exact_Match_Score =</span> <span class="fu">c</span>(</span>
<span id="cb88-77"><a href="#cb88-77" aria-hidden="true" tabindex="-1"></a>exact_mice<span class="sc">$</span>exact_match_score,</span>
<span id="cb88-78"><a href="#cb88-78" aria-hidden="true" tabindex="-1"></a>exact_cart<span class="sc">$</span>exact_match_score,</span>
<span id="cb88-79"><a href="#cb88-79" aria-hidden="true" tabindex="-1"></a>exact_synthpop<span class="sc">$</span>exact_match_score,</span>
<span id="cb88-80"><a href="#cb88-80" aria-hidden="true" tabindex="-1"></a>exact_meta<span class="sc">$</span>exact_match_score</span>
<span id="cb88-81"><a href="#cb88-81" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-82"><a href="#cb88-82" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb88-83"><a href="#cb88-83" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb88-84"><a href="#cb88-84" aria-hidden="true" tabindex="-1"></a><span class="at">Exact_Match_Percent =</span> <span class="fu">round</span>(Exact_Match_Score <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">3</span>),</span>
<span id="cb88-85"><a href="#cb88-85" aria-hidden="true" tabindex="-1"></a><span class="at">Status =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb88-86"><a href="#cb88-86" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(Exact_Match_Score)                     <span class="sc">~</span> <span class="st">"— Insufficient data"</span>,</span>
<span id="cb88-87"><a href="#cb88-87" aria-hidden="true" tabindex="-1"></a>Exact_Match_Score <span class="sc">==</span> <span class="dv">0</span>                       <span class="sc">~</span> <span class="st">"✅ 0% (Strong Privacy)"</span>,</span>
<span id="cb88-88"><a href="#cb88-88" aria-hidden="true" tabindex="-1"></a>Exact_Match_Score <span class="sc">&lt;=</span> <span class="fl">0.10</span>                    <span class="sc">~</span> <span class="st">"⚠️ ≤10% (Low Risk)"</span>,</span>
<span id="cb88-89"><a href="#cb88-89" aria-hidden="true" tabindex="-1"></a>Exact_Match_Score <span class="sc">&lt;=</span> <span class="fl">0.30</span>                    <span class="sc">~</span> <span class="st">"❗ 10–30% (Moderate Risk)"</span>,</span>
<span id="cb88-90"><a href="#cb88-90" aria-hidden="true" tabindex="-1"></a>Exact_Match_Score <span class="sc">&lt;=</span> <span class="fl">0.50</span>                    <span class="sc">~</span> <span class="st">"❌ 30–50% (High Risk)"</span>,</span>
<span id="cb88-91"><a href="#cb88-91" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span>                                         <span class="sc">~</span> <span class="st">"🚫 &gt;50% (Critical Risk)"</span></span>
<span id="cb88-92"><a href="#cb88-92" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-93"><a href="#cb88-93" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-94"><a href="#cb88-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-95"><a href="#cb88-95" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- User-friendly table ----</span></span>
<span id="cb88-96"><a href="#cb88-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-97"><a href="#cb88-97" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb88-98"><a href="#cb88-98" aria-hidden="true" tabindex="-1"></a>exact_tbl <span class="sc">%&gt;%</span></span>
<span id="cb88-99"><a href="#cb88-99" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb88-100"><a href="#cb88-100" aria-hidden="true" tabindex="-1"></a>Dataset,</span>
<span id="cb88-101"><a href="#cb88-101" aria-hidden="true" tabindex="-1"></a>Exact_Match_Rows,</span>
<span id="cb88-102"><a href="#cb88-102" aria-hidden="true" tabindex="-1"></a>Total_Synthetic_Rows,</span>
<span id="cb88-103"><a href="#cb88-103" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Exact Match %</span><span class="st">`</span> <span class="ot">=</span> Exact_Match_Percent,</span>
<span id="cb88-104"><a href="#cb88-104" aria-hidden="true" tabindex="-1"></a>Status</span>
<span id="cb88-105"><a href="#cb88-105" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb88-106"><a href="#cb88-106" aria-hidden="true" tabindex="-1"></a><span class="at">caption =</span> <span class="st">"Exact Match Score: Proportion of synthetic rows that are perfect duplicates of real rows (lower is better for privacy)"</span>,</span>
<span id="cb88-107"><a href="#cb88-107" aria-hidden="true" tabindex="-1"></a><span class="at">align   =</span> <span class="st">"lrrrl"</span></span>
<span id="cb88-108"><a href="#cb88-108" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Exact Match Score: Proportion of synthetic rows that are perfect duplicates of real rows (lower is better for privacy)</caption>
<colgroup>
<col style="width: 24%">
<col style="width: 17%">
<col style="width: 21%">
<col style="width: 14%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Exact_Match_Rows</th>
<th style="text-align: right;">Total_Synthetic_Rows</th>
<th style="text-align: right;">Exact Match %</th>
<th style="text-align: left;">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">✅ 0% (Strong Privacy)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Non-Parametric CART</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">✅ 0% (Strong Privacy)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">✅ 0% (Strong Privacy)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">299</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">✅ 0% (Strong Privacy)</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Conditional plot ----</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(exact_tbl<span class="sc">$</span>Exact_Match_Score <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>, <span class="st">"#FFB6DB"</span>, <span class="st">"#264653"</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>exact_tbl,</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> Dataset,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> Exact_Match_Percent,</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="at">fill =</span> Dataset</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_text</span>(</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Exact_Match_Percent, <span class="st">"%"</span>)),</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal[<span class="fu">seq_len</span>(<span class="fu">nrow</span>(exact_tbl))]) <span class="sc">+</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a><span class="at">limits =</span> <span class="fu">c</span>(</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>,</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(exact_tbl<span class="sc">$</span>Exact_Match_Percent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.15</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a><span class="at">title    =</span> <span class="st">"Exact Match Score by Synthetic Method"</span>,</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a><span class="at">subtitle =</span> <span class="st">"Lower values mean fewer fully replicated real rows appear in the synthetic data"</span>,</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a><span class="at">x        =</span> <span class="st">"Exact Match (%)"</span>,</span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a><span class="at">y        =</span> <span class="cn">NULL</span></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_minimal</span>()</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✅ All Exact Match Scores are 0%. No exact real-row replications found, so no plot is generated.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✅ All Exact Match Scores are 0%. No exact real-row replications found, so no plot is generated.</code></pre>
</div>
</div>
</section>
<section id="neighbors-privacy-score" class="level3" data-number="8.4">
<h3 data-number="8.4" class="anchored" data-anchor-id="neighbors-privacy-score"><span class="header-section-number">8.4</span> Neighbors’ Privacy Score</h3>
<p>The Neighbors’ Privacy Score identifies real records that are “too similar” to synthetic records by using a nearest-neighbors search. This metric helps evaluate privacy risk by detecting synthetic records that closely resemble real data, which could compromise privacy.</p>
<p>Ideal Ranges for Neighbors’ Privacy Score:</p>
<ul>
<li><strong>0 - 0.1</strong>: Indicates strong privacy protection, with very few synthetic records too similar to real ones.</li>
<li><strong>0.1 - 0.3</strong>: Moderate similarity, where privacy risk exists but remains within acceptable limits for many cases.</li>
<li><strong>Above 0.3</strong>: Higher similarity, raising privacy concerns and requiring review to ensure the synthetic data is not too closely mimicking real data.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Neighbors' Privacy Score ----</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>calculate_neighbors_privacy_score <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data, <span class="at">k =</span> <span class="dv">5</span>, <span class="at">threshold =</span> <span class="fl">0.01</span>) {</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Numeric-only columns</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> real_data[<span class="fu">sapply</span>(real_data, is.numeric)]</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> synthetic_data[<span class="fu">sapply</span>(synthetic_data, is.numeric)]</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">ncol</span>(real_num) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">ncol</span>(synth_num) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only common columns</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(real_num), <span class="fu">names</span>(synth_num))</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> real_num[common]</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> synth_num[common]</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Complete cases</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  real_cc  <span class="ot">&lt;-</span> real_num[<span class="fu">complete.cases</span>(real_num), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  synth_cc <span class="ot">&lt;-</span> synth_num[<span class="fu">complete.cases</span>(synth_num), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(real_cc) <span class="sc">&lt;</span> k <span class="sc">||</span> <span class="fu">nrow</span>(synth_cc) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardise</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>  real_scaled  <span class="ot">&lt;-</span> <span class="fu">scale</span>(real_cc)</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>  synth_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(synth_cc)</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># k-NN distances from synthetic → real</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>  neighbors <span class="ot">&lt;-</span> FNN<span class="sc">::</span><span class="fu">get.knnx</span>(real_scaled, synth_scaled, k)<span class="sc">$</span>nn.dist</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Privacy risk: synthetic records "too close" to real</span></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>  close_matches <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">rowMeans</span>(neighbors) <span class="sc">&lt;</span> threshold)</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>  score <span class="ot">&lt;-</span> close_matches <span class="sc">/</span> <span class="fu">nrow</span>(synth_scaled)</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(score)</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Build results table ----</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>neighbors_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Parametric MICE"</span>, <span class="st">"Non-Parametric CART"</span>,</span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Synthpop (Low Fidelity)"</span>, <span class="st">"Metadata-Based"</span>),</span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">Neighbors_Privacy_Score =</span> <span class="fu">c</span>(</span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_neighbors_privacy_score</span>(heart_failure, syn_data_1),</span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_neighbors_privacy_score</span>(heart_failure, syn_cart_1),</span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_neighbors_privacy_score</span>(heart_failure, syn_data_low_fidelity_synthpop),</span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_neighbors_privacy_score</span>(heart_failure, syn_data_metadata)</span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">Neighbors_Privacy_Score =</span> <span class="fu">round</span>(Neighbors_Privacy_Score, <span class="dv">4</span>),</span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Status =</span> <span class="fu">case_when</span>(</span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a>      Neighbors_Privacy_Score <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"✅ No risky neighbors"</span>,</span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a>      Neighbors_Privacy_Score <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"⚠️ Low risk"</span>,</span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"❌ High risk"</span></span>
<span id="cb91-52"><a href="#cb91-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- User-friendly table ----</span></span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb91-57"><a href="#cb91-57" aria-hidden="true" tabindex="-1"></a>  neighbors_tbl,</span>
<span id="cb91-58"><a href="#cb91-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Neighbors' Privacy Score: Proportion of synthetic records too close to real records (lower is better for privacy)"</span>,</span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"lrr"</span></span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Neighbors’ Privacy Score: Proportion of synthetic records too close to real records (lower is better for privacy)</caption>
<colgroup>
<col style="width: 34%">
<col style="width: 34%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Neighbors_Privacy_Score</th>
<th style="text-align: right;">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">✅ No risky neighbors</td>
</tr>
<tr class="even">
<td style="text-align: left;">Non-Parametric CART</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">✅ No risky neighbors</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">✅ No risky neighbors</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">✅ No risky neighbors</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot only if any score &gt; 0 ----</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(neighbors_tbl<span class="sc">$</span>Neighbors_Privacy_Score <span class="sc">&gt;</span> <span class="dv">0</span>)) {</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>, <span class="st">"#FFB6DB"</span>, <span class="st">"#264653"</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(neighbors_tbl, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> Neighbors_Privacy_Score, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Neighbors_Privacy_Score), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal[<span class="fu">seq_len</span>(<span class="fu">nrow</span>(neighbors_tbl))]) <span class="sc">+</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Neighbors' Privacy Score by Synthetic Method"</span>,</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Lower values mean synthetic records are less likely to be close replicas of real individuals"</span>,</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Privacy Score (Proportion of risky neighbors)"</span>, <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ All Neighbors' Privacy Scores are 0. No risky neighbors detected. No plot is generated.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✅ All Neighbors' Privacy Scores are 0. No risky neighbors detected. No plot is generated.</code></pre>
</div>
</div>
</section>
<section id="membership-inference-score" class="level3" data-number="8.5">
<h3 data-number="8.5" class="anchored" data-anchor-id="membership-inference-score"><span class="header-section-number">8.5</span> Membership Inference Score</h3>
<p>The Membership Inference Score evaluates the risk of membership inference attacks, which attempt to determine whether a specific record belongs to the real dataset. This metric helps assess the vulnerability of synthetic data to privacy breaches.</p>
<p>Ideal Ranges for Membership Inference Score:</p>
<ul>
<li><strong>0 - 0.1</strong>: Indicates low risk, where it is unlikely that membership inference attacks can accurately identify real records.</li>
<li><strong>0.1 - 0.3</strong>: Moderate risk, where some vulnerability to membership inference exists but may still be acceptable for certain use cases.</li>
<li><strong>Above 0.3</strong>: High risk, suggesting significant privacy concerns as the synthetic data could reveal membership information about the real records.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Membership Inference Score ----</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpreted as the proportion of synthetic records that are "too close" to the real data.</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower is better (safer).</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>calculate_membership_inference_score <span class="ot">&lt;-</span> <span class="cf">function</span>(real_data, synthetic_data, <span class="at">k =</span> <span class="dv">5</span>, <span class="at">threshold =</span> <span class="fl">0.01</span>) {</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Numeric-only columns</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> real_data[<span class="fu">sapply</span>(real_data, is.numeric)]</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> synthetic_data[<span class="fu">sapply</span>(synthetic_data, is.numeric)]</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardrails</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">ncol</span>(real_num) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">ncol</span>(synth_num) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only common numeric variables</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(real_num), <span class="fu">names</span>(synth_num))</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(common) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>  real_num  <span class="ot">&lt;-</span> real_num[common]</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>  synth_num <span class="ot">&lt;-</span> synth_num[common]</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use complete cases</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>  real_cc  <span class="ot">&lt;-</span> real_num[<span class="fu">complete.cases</span>(real_num), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>  synth_cc <span class="ot">&lt;-</span> synth_num[<span class="fu">complete.cases</span>(synth_num), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(real_cc) <span class="sc">&lt;</span> k <span class="sc">||</span> <span class="fu">nrow</span>(synth_cc) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardize</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>  real_scaled  <span class="ot">&lt;-</span> <span class="fu">scale</span>(real_cc)</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>  synth_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(synth_cc)</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># k-NN distances from synthetic → real</span></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>  nn <span class="ot">&lt;-</span> FNN<span class="sc">::</span><span class="fu">get.knnx</span>(real_scaled, synth_scaled, k)<span class="sc">$</span>nn.dist</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Score: proportion of synthetic records whose average distance to k nearest reals is below threshold</span></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>  risky <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">rowMeans</span>(nn) <span class="sc">&lt;</span> threshold)</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>  risky <span class="sc">/</span> <span class="fu">nrow</span>(synth_scaled)</span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Results table ----</span></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>mis_tbl <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">"Parametric MICE"</span>, <span class="st">"Non-Parametric CART"</span>,</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Synthpop (Low Fidelity)"</span>, <span class="st">"Metadata-Based"</span>),</span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">Membership_Inference_Score =</span> <span class="fu">c</span>(</span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_membership_inference_score</span>(heart_failure, syn_data_1),</span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_membership_inference_score</span>(heart_failure, syn_cart_1),</span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_membership_inference_score</span>(heart_failure, syn_data_low_fidelity_synthpop),</span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate_membership_inference_score</span>(heart_failure, syn_data_metadata)</span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">Membership_Inference_Score =</span> <span class="fu">round</span>(Membership_Inference_Score, <span class="dv">4</span>),</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Status =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(Membership_Inference_Score)              <span class="sc">~</span> <span class="st">"— Insufficient data"</span>,</span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>      Membership_Inference_Score <span class="sc">==</span> <span class="dv">0</span>                <span class="sc">~</span> <span class="st">"✅ No risky memberships"</span>,</span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>      Membership_Inference_Score <span class="sc">&lt;</span> <span class="fl">0.01</span>              <span class="sc">~</span> <span class="st">"⚠️ Low risk"</span>,</span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                                           <span class="sc">~</span> <span class="st">"❌ High risk"</span></span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- User-friendly table ----</span></span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a>  mis_tbl,</span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Membership Inference Score: Proportion of synthetic records that are very close to real records (lower is better for privacy)"</span>,</span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">align   =</span> <span class="st">"lrr"</span></span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Membership Inference Score: Proportion of synthetic records that are very close to real records (lower is better for privacy)</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 36%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: right;">Membership_Inference_Score</th>
<th style="text-align: right;">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parametric MICE</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">✅ No risky memberships</td>
</tr>
<tr class="even">
<td style="text-align: left;">Non-Parametric CART</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">✅ No risky memberships</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Synthpop (Low Fidelity)</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">✅ No risky memberships</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metadata-Based</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">✅ No risky memberships</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot only if any risky memberships (&gt; 0) ----</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(mis_tbl<span class="sc">$</span>Membership_Inference_Score <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#B0D99B"</span>, <span class="st">"#528AA8"</span>, <span class="st">"#FFB6DB"</span>, <span class="st">"#264653"</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(mis_tbl, <span class="fu">aes</span>(<span class="at">y =</span> Dataset, <span class="at">x =</span> Membership_Inference_Score, <span class="at">fill =</span> Dataset)) <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Membership_Inference_Score), <span class="st">"NA"</span>,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>                         scales<span class="sc">::</span><span class="fu">percent</span>(Membership_Inference_Score, <span class="at">accuracy =</span> <span class="fl">0.01</span>))),</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal[<span class="fu">seq_len</span>(<span class="fu">nrow</span>(mis_tbl))]) <span class="sc">+</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"Membership Inference Score by Synthetic Method"</span>,</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Lower values indicate better privacy protection"</span>,</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Score (Proportion of risky memberships)"</span>,</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ All Membership Inference Scores are 0. No risky memberships detected. No plot is generated. </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✅ All Membership Inference Scores are 0. No risky memberships detected. No plot is generated. </code></pre>
</div>
</div>
</section>
</section>
<section id="conclusions" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="conclusions"><span class="header-section-number">9</span> Conclusions</h2>
<p>This report evaluated the fidelity, utility, privacy, and overall quality of synthetic data generated using parametric MICE, non-parametric CART, Synthpop, and metadata-based methods. Key findings include:</p>
<ul>
<li><strong>Data Structure Preservation</strong>: All methods preserved the structure of the real dataset, though minor variations in variable distributions were observed.</li>
<li><strong>Categorical Variables</strong>: Most synthetic datasets retained categorical levels, but frequency distribution discrepancies were particularly notable in Synthpop data.</li>
<li><strong>Numeric Variables</strong>: The range and distribution of numeric variables were largely maintained across methods, with slight variations in density plots.</li>
<li><strong>Correlation &amp; Mutual Information</strong>: While most methods captured variable relationships, weaker correlations and lower mutual information scores suggested some loss of feature dependencies in certain synthetic datasets.</li>
<li><strong>Utility (Prediction Score)</strong>: Synthetic data performed similarly to real data in predictive modeling, though slight reductions in accuracy and increased pMSE indicated less precise representation of the real dataset’s predictive capabilities.</li>
<li><strong>Privacy (Exact Match &amp; Neighbors’ Privacy Scores)</strong>: All synthetic datasets demonstrated strong privacy protection, with zero values for both Exact Match and Neighbors’ Privacy Scores. This indicates that no synthetic records were identical to or highly similar to any real records, affirming robust privacy across all methods.</li>
</ul>
<p>In conclusion, synthetic data generated through these methods provides a balance between utility and privacy, though method selection should align with specific analytic or privacy needs.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop the parallel cluster</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoSEQ</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb98" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Heart Failure Clinical Records Synthetic Data Project</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Linus Chirchir</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 7 September 2025</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="an">date-format:</span><span class="co"> "D MMMM YYYY"</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="an">page-layout:</span><span class="co"> full</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Contents"</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles/styles.css</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show code"</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="co">  docx:</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 5</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Contents"</span></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a><span class="an">freeze:</span><span class="co"> auto</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a><span class="in"># Load necessary libraries</span></span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Project and Performance Utilities ---</span></span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(here)                 # Manage project-relative file paths</span></span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(doParallel)           # Enable parallel processing for faster computations</span></span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)            # Core data science toolkit (dplyr, tidyr, readr, purrr, etc.)</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a><span class="in">library(readxl)               # Import Excel (.xlsx, .xls) files into R</span></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Data Exploration and Summaries ---</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a><span class="in">library(psych)                # Produce descriptive statistics and psychometric analyses</span></span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)                # Format dynamic tables and reports in Markdown/Quarto</span></span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Visualisation ---</span></span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)              # Build customizable, high-quality data visualizations</span></span>
<span id="cb98-49"><a href="#cb98-49" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)            # Combine multiple ggplot2 plots into unified layouts</span></span>
<span id="cb98-50"><a href="#cb98-50" aria-hidden="true" tabindex="-1"></a><span class="in">library(corrplot)             # Visualize correlation matrices with heatmaps and plots</span></span>
<span id="cb98-51"><a href="#cb98-51" aria-hidden="true" tabindex="-1"></a><span class="in">library(GGally)               # Extend ggplot2 with correlation plots, pairwise plots, ggpairs()</span></span>
<span id="cb98-52"><a href="#cb98-52" aria-hidden="true" tabindex="-1"></a><span class="in">library(VIM)                  # Visualize/impute missing values with advanced methods (e.g., matrix plots)</span></span>
<span id="cb98-53"><a href="#cb98-53" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb98-54"><a href="#cb98-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-55"><a href="#cb98-55" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Data Imputation and Synthesis ---</span></span>
<span id="cb98-56"><a href="#cb98-56" aria-hidden="true" tabindex="-1"></a><span class="in">library(mice)                 # Perform multiple imputation by chained equations for missing data</span></span>
<span id="cb98-57"><a href="#cb98-57" aria-hidden="true" tabindex="-1"></a><span class="in">library(synthpop)             # Generate, evaluate, and compare synthetic datasets</span></span>
<span id="cb98-58"><a href="#cb98-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-59"><a href="#cb98-59" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Statistical and Information-Theoretic Measures ---</span></span>
<span id="cb98-60"><a href="#cb98-60" aria-hidden="true" tabindex="-1"></a><span class="in">library(transport)            # Compute optimal transport distances (e.g., Wasserstein) for distribution comparison</span></span>
<span id="cb98-61"><a href="#cb98-61" aria-hidden="true" tabindex="-1"></a><span class="in">library(infotheo)             # Calculate information-theoretic metrics (entropy, mutual information)</span></span>
<span id="cb98-62"><a href="#cb98-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-63"><a href="#cb98-63" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Modeling and Machine Learning ---</span></span>
<span id="cb98-64"><a href="#cb98-64" aria-hidden="true" tabindex="-1"></a><span class="in">library(caret)                # Streamline machine learning workflows (training, tuning, evaluation)</span></span>
<span id="cb98-65"><a href="#cb98-65" aria-hidden="true" tabindex="-1"></a><span class="in">library(xgboost)              # Implement gradient boosting for classification/regression</span></span>
<span id="cb98-66"><a href="#cb98-66" aria-hidden="true" tabindex="-1"></a><span class="in">library(SHAPforxgboost)       # Explain XGBoost predictions using SHAP values</span></span>
<span id="cb98-67"><a href="#cb98-67" aria-hidden="true" tabindex="-1"></a><span class="in">library(FNN)                  # Perform fast k-nearest neighbor searches and distance calculations</span></span>
<span id="cb98-68"><a href="#cb98-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-69"><a href="#cb98-69" aria-hidden="true" tabindex="-1"></a><span class="in"># Set up parallel processing</span></span>
<span id="cb98-70"><a href="#cb98-70" aria-hidden="true" tabindex="-1"></a><span class="in">num_cores &lt;- detectCores() - 1  # Use one less than the total number of cores</span></span>
<span id="cb98-71"><a href="#cb98-71" aria-hidden="true" tabindex="-1"></a><span class="in">cl &lt;- makeCluster(num_cores)</span></span>
<span id="cb98-72"><a href="#cb98-72" aria-hidden="true" tabindex="-1"></a><span class="in">registerDoParallel(cl)</span></span>
<span id="cb98-73"><a href="#cb98-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-74"><a href="#cb98-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-75"><a href="#cb98-75" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb98-76"><a href="#cb98-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-77"><a href="#cb98-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb98-78"><a href="#cb98-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-79"><a href="#cb98-79" aria-hidden="true" tabindex="-1"></a>This project evaluates the quality of synthetic datasets derived from the Heart Failure Clinical Records data (299 patients, 13 variables). Our goal is to determine how well different generation strategies reproduce the statistical properties and analytic value of the original data while protecting privacy.</span>
<span id="cb98-80"><a href="#cb98-80" aria-hidden="true" tabindex="-1"></a>We generate synthetic data using four approaches: (1) parametric imputation (MICE), (2) non-parametric imputation (CART via MICE), (3) distribution-driven synthesis (synthpop), and (4) metadata-guided rules. We then compare each synthetic dataset with the real data across three dimensions:</span>
<span id="cb98-81"><a href="#cb98-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-82"><a href="#cb98-82" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fidelity – univariate and multivariate similarity (distributions, ranges, correlations), histogram similarity, and mutual information.</span>
<span id="cb98-83"><a href="#cb98-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Utility – model transportability using XGBoost (TRTR vs. TSTR), feature-importance agreement, and SHAP-based behaviour.</span>
<span id="cb98-84"><a href="#cb98-84" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Privacy / Disclosure risk – exact record matches, neighbour-proximity checks, and membership-inference sensitivity.</span>
<span id="cb98-85"><a href="#cb98-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-86"><a href="#cb98-86" aria-hidden="true" tabindex="-1"></a>Results are presented through aligned tables and plots (structure checks, categorical level retention, density overlays, correlation matrices, SHAP summaries) with concise scores for each method. The report concludes with a comparative summary to guide method selection given different fidelity–utility–privacy trade-offs.</span>
<span id="cb98-87"><a href="#cb98-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-88"><a href="#cb98-88" aria-hidden="true" tabindex="-1"></a><span class="fu">## Heart Failure Clinical Records Dataset and Initial Exploration  </span></span>
<span id="cb98-89"><a href="#cb98-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-90"><a href="#cb98-90" aria-hidden="true" tabindex="-1"></a>The **Heart Failure Clinical Records dataset**, sourced from the [UCI Machine Learning Repository](https://archive.ics.uci.edu/dataset/519/heart+failure+clinical+records), contains records of **299 patients** with heart failure collected during their follow-up period. Each record includes **13 clinical features** covering demographics, clinical conditions, and laboratory measures:  </span>
<span id="cb98-91"><a href="#cb98-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-92"><a href="#cb98-92" aria-hidden="true" tabindex="-1"></a>| Variable                    | Description                                          | Unit / Levels        |</span>
<span id="cb98-93"><a href="#cb98-93" aria-hidden="true" tabindex="-1"></a>|-----------------------------|------------------------------------------------------|----------------------|</span>
<span id="cb98-94"><a href="#cb98-94" aria-hidden="true" tabindex="-1"></a>| **age**                     | Age of the patient                                   | Years                |</span>
<span id="cb98-95"><a href="#cb98-95" aria-hidden="true" tabindex="-1"></a>| **anaemia**                 | Reduction in red blood cells                         | No / Yes             |</span>
<span id="cb98-96"><a href="#cb98-96" aria-hidden="true" tabindex="-1"></a>| **creatinine_phosphokinase**| Enzyme level in the blood                            | mcg/L                |</span>
<span id="cb98-97"><a href="#cb98-97" aria-hidden="true" tabindex="-1"></a>| **diabetes**                | Diabetes status                                      | No / Yes             |</span>
<span id="cb98-98"><a href="#cb98-98" aria-hidden="true" tabindex="-1"></a>| **ejection_fraction**       | % of blood leaving the heart with each contraction   | Percentage (%)       |</span>
<span id="cb98-99"><a href="#cb98-99" aria-hidden="true" tabindex="-1"></a>| **platelets**               | Platelet count                                       | Kiloplatelets/mL     |</span>
<span id="cb98-100"><a href="#cb98-100" aria-hidden="true" tabindex="-1"></a>| **serum_creatinine**        | Serum creatinine level                               | mg/dL                |</span>
<span id="cb98-101"><a href="#cb98-101" aria-hidden="true" tabindex="-1"></a>| **serum_sodium**            | Serum sodium level                                   | mEq/L                |</span>
<span id="cb98-102"><a href="#cb98-102" aria-hidden="true" tabindex="-1"></a>| **sex**                     | Gender of the patient                                | Female / Male        |</span>
<span id="cb98-103"><a href="#cb98-103" aria-hidden="true" tabindex="-1"></a>| **smoking**                 | Smoking status                                       | No / Yes             |</span>
<span id="cb98-104"><a href="#cb98-104" aria-hidden="true" tabindex="-1"></a>| **hypertension**            | Hypertension status                                  | No / Yes             |</span>
<span id="cb98-105"><a href="#cb98-105" aria-hidden="true" tabindex="-1"></a>| **deceased**                | Survival status during follow-up                     | No / Yes             |</span>
<span id="cb98-106"><a href="#cb98-106" aria-hidden="true" tabindex="-1"></a>| **follow_up**               | Duration of the follow-up period                     | Days                 |</span>
<span id="cb98-107"><a href="#cb98-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-108"><a href="#cb98-108" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb98-109"><a href="#cb98-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-110"><a href="#cb98-110" aria-hidden="true" tabindex="-1"></a>A preview of the first 10 rows of the dataset is shown below.</span>
<span id="cb98-111"><a href="#cb98-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-112"><a href="#cb98-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load the heart failure dataset}</span></span>
<span id="cb98-113"><a href="#cb98-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-114"><a href="#cb98-114" aria-hidden="true" tabindex="-1"></a><span class="in"># Set seed for reproducibility</span></span>
<span id="cb98-115"><a href="#cb98-115" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb98-116"><a href="#cb98-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-117"><a href="#cb98-117" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the heart failure dataset from the local directory</span></span>
<span id="cb98-118"><a href="#cb98-118" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure &lt;- read.csv(here("data", "heart_failure.csv"))</span></span>
<span id="cb98-119"><a href="#cb98-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-120"><a href="#cb98-120" aria-hidden="true" tabindex="-1"></a><span class="in"># Let's preview the heart failure dataset</span></span>
<span id="cb98-121"><a href="#cb98-121" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-122"><a href="#cb98-122" aria-hidden="true" tabindex="-1"></a><span class="in">  head(heart_failure, 10),</span></span>
<span id="cb98-123"><a href="#cb98-123" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Preview of the first 10 rows of the Heart Failure dataset",</span></span>
<span id="cb98-124"><a href="#cb98-124" aria-hidden="true" tabindex="-1"></a><span class="in">  align = rep("l", ncol(heart_failure))  # left align all columns</span></span>
<span id="cb98-125"><a href="#cb98-125" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-126"><a href="#cb98-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-127"><a href="#cb98-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-128"><a href="#cb98-128" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb98-129"><a href="#cb98-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-130"><a href="#cb98-130" aria-hidden="true" tabindex="-1"></a>Here's the preview of the structure of the heart failure dataset.</span>
<span id="cb98-131"><a href="#cb98-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-132"><a href="#cb98-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r display the structure of the dataset}</span></span>
<span id="cb98-133"><a href="#cb98-133" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- data.frame(</span></span>
<span id="cb98-134"><a href="#cb98-134" aria-hidden="true" tabindex="-1"></a><span class="in">  Variable = names(heart_failure),</span></span>
<span id="cb98-135"><a href="#cb98-135" aria-hidden="true" tabindex="-1"></a><span class="in">  Type   = unname(sapply(heart_failure, \(x) paste(class(x), collapse = ", "))),</span></span>
<span id="cb98-136"><a href="#cb98-136" aria-hidden="true" tabindex="-1"></a><span class="in">  Values = unname(sapply(heart_failure, \(x) paste(head(unique(x), 10), collapse = ", "))),</span></span>
<span id="cb98-137"><a href="#cb98-137" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = NULL,</span></span>
<span id="cb98-138"><a href="#cb98-138" aria-hidden="true" tabindex="-1"></a><span class="in">  check.names = FALSE</span></span>
<span id="cb98-139"><a href="#cb98-139" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-140"><a href="#cb98-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-141"><a href="#cb98-141" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-142"><a href="#cb98-142" aria-hidden="true" tabindex="-1"></a><span class="in">  df,</span></span>
<span id="cb98-143"><a href="#cb98-143" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Structure of the Heart Failure Dataset: Variables, Types, and Values",</span></span>
<span id="cb98-144"><a href="#cb98-144" aria-hidden="true" tabindex="-1"></a><span class="in">  align = c("l","l","l"),</span></span>
<span id="cb98-145"><a href="#cb98-145" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = FALSE</span></span>
<span id="cb98-146"><a href="#cb98-146" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-147"><a href="#cb98-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-148"><a href="#cb98-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-149"><a href="#cb98-149" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb98-150"><a href="#cb98-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-151"><a href="#cb98-151" aria-hidden="true" tabindex="-1"></a>Let's perform some basic data cleaning and preprocessing steps. Convert the following columns to factors: sex, anaemia, diabetes, smoking, hypertension and deceased. Here's the new structure of the dataset after the basic cleaning.</span>
<span id="cb98-152"><a href="#cb98-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-153"><a href="#cb98-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r modify structure of the dataset}</span></span>
<span id="cb98-154"><a href="#cb98-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-155"><a href="#cb98-155" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert the specified columns to factors</span></span>
<span id="cb98-156"><a href="#cb98-156" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$sex &lt;- as.factor(heart_failure$sex)</span></span>
<span id="cb98-157"><a href="#cb98-157" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$anaemia &lt;- as.factor(heart_failure$anaemia)</span></span>
<span id="cb98-158"><a href="#cb98-158" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$diabetes &lt;- as.factor(heart_failure$diabetes)</span></span>
<span id="cb98-159"><a href="#cb98-159" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$smoking &lt;- as.factor(heart_failure$smoking)</span></span>
<span id="cb98-160"><a href="#cb98-160" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$hypertension &lt;- as.factor(heart_failure$hypertension)</span></span>
<span id="cb98-161"><a href="#cb98-161" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$deceased &lt;- as.factor(heart_failure$deceased)</span></span>
<span id="cb98-162"><a href="#cb98-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-163"><a href="#cb98-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-164"><a href="#cb98-164" aria-hidden="true" tabindex="-1"></a>Here are the summary statistics of the heart failure dataset.</span>
<span id="cb98-165"><a href="#cb98-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-166"><a href="#cb98-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary statistics of the heart failure dataset}</span></span>
<span id="cb98-167"><a href="#cb98-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-168"><a href="#cb98-168" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate descriptive statistics and display as a single table</span></span>
<span id="cb98-169"><a href="#cb98-169" aria-hidden="true" tabindex="-1"></a><span class="in">describe(heart_failure) |&gt;</span></span>
<span id="cb98-170"><a href="#cb98-170" aria-hidden="true" tabindex="-1"></a><span class="in">  kable(</span></span>
<span id="cb98-171"><a href="#cb98-171" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Summary Statistics of the Heart Failure Dataset",</span></span>
<span id="cb98-172"><a href="#cb98-172" aria-hidden="true" tabindex="-1"></a><span class="in">    digits = 2,  # round to 2 decimal places</span></span>
<span id="cb98-173"><a href="#cb98-173" aria-hidden="true" tabindex="-1"></a><span class="in">    align = "lrrrrrrrrrr"  # left for variable, right for numbers</span></span>
<span id="cb98-174"><a href="#cb98-174" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-175"><a href="#cb98-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-176"><a href="#cb98-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-177"><a href="#cb98-177" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generating Synthetic Data</span></span>
<span id="cb98-178"><a href="#cb98-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-179"><a href="#cb98-179" aria-hidden="true" tabindex="-1"></a>The process of generating synthetic data is essential for tasks such as privacy preservation, testing machine learning models, and conducting simulations. In this section, we employ various techniques to generate synthetic data based on the real heart failure dataset. Each method serves a different purpose and offers distinct advantages, depending on the use case and the type of missing data or privacy concerns.</span>
<span id="cb98-180"><a href="#cb98-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-181"><a href="#cb98-181" aria-hidden="true" tabindex="-1"></a>We explore four key approaches for generating synthetic data:</span>
<span id="cb98-182"><a href="#cb98-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-183"><a href="#cb98-183" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parametric Imputation Using MICE</span></span>
<span id="cb98-184"><a href="#cb98-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-185"><a href="#cb98-185" aria-hidden="true" tabindex="-1"></a>This method uses the Multivariate Imputation by Chained Equations (MICE) framework, with parametric imputation based on a normal distribution. MICE allows for handling missing data through multiple imputations and is widely used in data science and healthcare for its flexibility and statistical rigor. Here's the preview of the first 10 rows of the synthetic data generated.</span>
<span id="cb98-186"><a href="#cb98-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-187"><a href="#cb98-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Parametric Imputation using MICE}</span></span>
<span id="cb98-188"><a href="#cb98-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-189"><a href="#cb98-189" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to compute the 5th and 95th percentiles for numeric columns</span></span>
<span id="cb98-190"><a href="#cb98-190" aria-hidden="true" tabindex="-1"></a><span class="in">compute_percentiles &lt;- function(data, lower_percentile = 0.05, upper_percentile = 0.95) {</span></span>
<span id="cb98-191"><a href="#cb98-191" aria-hidden="true" tabindex="-1"></a><span class="in">  percentiles &lt;- lapply(data, function(column) {</span></span>
<span id="cb98-192"><a href="#cb98-192" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.numeric(column)) {</span></span>
<span id="cb98-193"><a href="#cb98-193" aria-hidden="true" tabindex="-1"></a><span class="in">      lower &lt;- quantile(column, probs = lower_percentile, na.rm = TRUE)</span></span>
<span id="cb98-194"><a href="#cb98-194" aria-hidden="true" tabindex="-1"></a><span class="in">      upper &lt;- quantile(column, probs = upper_percentile, na.rm = TRUE)</span></span>
<span id="cb98-195"><a href="#cb98-195" aria-hidden="true" tabindex="-1"></a><span class="in">      return(c(lower, upper))</span></span>
<span id="cb98-196"><a href="#cb98-196" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb98-197"><a href="#cb98-197" aria-hidden="true" tabindex="-1"></a><span class="in">    return(c(NA, NA))</span></span>
<span id="cb98-198"><a href="#cb98-198" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb98-199"><a href="#cb98-199" aria-hidden="true" tabindex="-1"></a><span class="in">  names(percentiles) &lt;- names(data)</span></span>
<span id="cb98-200"><a href="#cb98-200" aria-hidden="true" tabindex="-1"></a><span class="in">  return(percentiles)</span></span>
<span id="cb98-201"><a href="#cb98-201" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-202"><a href="#cb98-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-203"><a href="#cb98-203" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to scale numeric values based on the 5th and 95th percentiles</span></span>
<span id="cb98-204"><a href="#cb98-204" aria-hidden="true" tabindex="-1"></a><span class="in">scale_to_percentiles &lt;- function(data, percentiles) {</span></span>
<span id="cb98-205"><a href="#cb98-205" aria-hidden="true" tabindex="-1"></a><span class="in">  scaled_data &lt;- data</span></span>
<span id="cb98-206"><a href="#cb98-206" aria-hidden="true" tabindex="-1"></a><span class="in">  for (col in colnames(data)) {</span></span>
<span id="cb98-207"><a href="#cb98-207" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.numeric(data[[col]])) {</span></span>
<span id="cb98-208"><a href="#cb98-208" aria-hidden="true" tabindex="-1"></a><span class="in">      # Apply scaling only if percentiles are available for this column</span></span>
<span id="cb98-209"><a href="#cb98-209" aria-hidden="true" tabindex="-1"></a><span class="in">      if (!is.na(percentiles[[col]][1]) &amp;&amp; !is.na(percentiles[[col]][2])) {</span></span>
<span id="cb98-210"><a href="#cb98-210" aria-hidden="true" tabindex="-1"></a><span class="in">        min_val &lt;- percentiles[[col]][1]</span></span>
<span id="cb98-211"><a href="#cb98-211" aria-hidden="true" tabindex="-1"></a><span class="in">        max_val &lt;- percentiles[[col]][2]</span></span>
<span id="cb98-212"><a href="#cb98-212" aria-hidden="true" tabindex="-1"></a><span class="in">        # Clip values to lie within the 5th and 95th percentile range</span></span>
<span id="cb98-213"><a href="#cb98-213" aria-hidden="true" tabindex="-1"></a><span class="in">        scaled_data[[col]] &lt;- pmin(pmax(data[[col]], min_val), max_val)</span></span>
<span id="cb98-214"><a href="#cb98-214" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb98-215"><a href="#cb98-215" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb98-216"><a href="#cb98-216" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-217"><a href="#cb98-217" aria-hidden="true" tabindex="-1"></a><span class="in">  return(scaled_data)</span></span>
<span id="cb98-218"><a href="#cb98-218" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-219"><a href="#cb98-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-220"><a href="#cb98-220" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to generate missingness in a dataset based on the real data's pattern</span></span>
<span id="cb98-221"><a href="#cb98-221" aria-hidden="true" tabindex="-1"></a><span class="in">generate_missingness_based_on_real &lt;- function(real_data, synthetic_data) {</span></span>
<span id="cb98-222"><a href="#cb98-222" aria-hidden="true" tabindex="-1"></a><span class="in">  # Ensure the synthetic dataset has the same structure as the real</span></span>
<span id="cb98-223"><a href="#cb98-223" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!all(colnames(real_data) == colnames(synthetic_data))) {</span></span>
<span id="cb98-224"><a href="#cb98-224" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("Column names in real and synthetic data must match")</span></span>
<span id="cb98-225"><a href="#cb98-225" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-226"><a href="#cb98-226" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-227"><a href="#cb98-227" aria-hidden="true" tabindex="-1"></a><span class="in">  # Copy the real missingness pattern to the synthetic dataset</span></span>
<span id="cb98-228"><a href="#cb98-228" aria-hidden="true" tabindex="-1"></a><span class="in">  synthetic_data_with_missingness &lt;- synthetic_data</span></span>
<span id="cb98-229"><a href="#cb98-229" aria-hidden="true" tabindex="-1"></a><span class="in">  for (col in colnames(real_data)) {</span></span>
<span id="cb98-230"><a href="#cb98-230" aria-hidden="true" tabindex="-1"></a><span class="in">    # Apply missingness where it was present in the real data</span></span>
<span id="cb98-231"><a href="#cb98-231" aria-hidden="true" tabindex="-1"></a><span class="in">    missing_indices &lt;- is.na(real_data[[col]])</span></span>
<span id="cb98-232"><a href="#cb98-232" aria-hidden="true" tabindex="-1"></a><span class="in">    synthetic_data_with_missingness[[col]][missing_indices] &lt;- NA</span></span>
<span id="cb98-233"><a href="#cb98-233" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-234"><a href="#cb98-234" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-235"><a href="#cb98-235" aria-hidden="true" tabindex="-1"></a><span class="in">  return(synthetic_data_with_missingness)</span></span>
<span id="cb98-236"><a href="#cb98-236" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-237"><a href="#cb98-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-238"><a href="#cb98-238" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute the 5th and 95th percentiles for the real data</span></span>
<span id="cb98-239"><a href="#cb98-239" aria-hidden="true" tabindex="-1"></a><span class="in">percentiles &lt;- compute_percentiles(heart_failure)</span></span>
<span id="cb98-240"><a href="#cb98-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-241"><a href="#cb98-241" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate synthetic data using MICE</span></span>
<span id="cb98-242"><a href="#cb98-242" aria-hidden="true" tabindex="-1"></a><span class="in">where &lt;- make.where(heart_failure, "all")</span></span>
<span id="cb98-243"><a href="#cb98-243" aria-hidden="true" tabindex="-1"></a><span class="in">method &lt;- make.method(heart_failure, where = where)</span></span>
<span id="cb98-244"><a href="#cb98-244" aria-hidden="true" tabindex="-1"></a><span class="in">method[method == "pmm"] &lt;- "norm"</span></span>
<span id="cb98-245"><a href="#cb98-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-246"><a href="#cb98-246" aria-hidden="true" tabindex="-1"></a><span class="in"># Perform multiple imputation (10 datasets)</span></span>
<span id="cb98-247"><a href="#cb98-247" aria-hidden="true" tabindex="-1"></a><span class="in">syn_param &lt;- mice(heart_failure, m = 10, maxit = 1, method = method, where = where, printFlag = FALSE)</span></span>
<span id="cb98-248"><a href="#cb98-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-249"><a href="#cb98-249" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract the first synthetic dataset</span></span>
<span id="cb98-250"><a href="#cb98-250" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_1 &lt;- complete(syn_param, 1)</span></span>
<span id="cb98-251"><a href="#cb98-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-252"><a href="#cb98-252" aria-hidden="true" tabindex="-1"></a><span class="in"># Scale synthetic data to the 5th and 95th percentile ranges</span></span>
<span id="cb98-253"><a href="#cb98-253" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_1 &lt;- scale_to_percentiles(syn_data_1, percentiles)</span></span>
<span id="cb98-254"><a href="#cb98-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-255"><a href="#cb98-255" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply the real missingness pattern to the synthetic dataset</span></span>
<span id="cb98-256"><a href="#cb98-256" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_1 &lt;- generate_missingness_based_on_real(heart_failure, syn_data_1)</span></span>
<span id="cb98-257"><a href="#cb98-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-258"><a href="#cb98-258" aria-hidden="true" tabindex="-1"></a><span class="in"># Round off all numeric columns to 0 decimal places</span></span>
<span id="cb98-259"><a href="#cb98-259" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_1 &lt;- syn_data_1 %&gt;%</span></span>
<span id="cb98-260"><a href="#cb98-260" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.numeric), round, digits = 0))</span></span>
<span id="cb98-261"><a href="#cb98-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-262"><a href="#cb98-262" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a prefix 'synth_' to all synthetic dataset variable names</span></span>
<span id="cb98-263"><a href="#cb98-263" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_data_1) &lt;- paste("synth", colnames(syn_data_1), sep = "_")</span></span>
<span id="cb98-264"><a href="#cb98-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-265"><a href="#cb98-265" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the structure of the dataset (fix double variable issue)</span></span>
<span id="cb98-266"><a href="#cb98-266" aria-hidden="true" tabindex="-1"></a><span class="in">df_syn &lt;- data.frame(</span></span>
<span id="cb98-267"><a href="#cb98-267" aria-hidden="true" tabindex="-1"></a><span class="in">  Variable = names(syn_data_1),</span></span>
<span id="cb98-268"><a href="#cb98-268" aria-hidden="true" tabindex="-1"></a><span class="in">  Type   = unname(sapply(syn_data_1, \(x) paste(class(x), collapse = ", "))),</span></span>
<span id="cb98-269"><a href="#cb98-269" aria-hidden="true" tabindex="-1"></a><span class="in">  Values = unname(sapply(syn_data_1, \(x) paste(head(unique(x), 10), collapse = ", "))),</span></span>
<span id="cb98-270"><a href="#cb98-270" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = NULL,</span></span>
<span id="cb98-271"><a href="#cb98-271" aria-hidden="true" tabindex="-1"></a><span class="in">  check.names = FALSE</span></span>
<span id="cb98-272"><a href="#cb98-272" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-273"><a href="#cb98-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-274"><a href="#cb98-274" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove duplicated variables if any</span></span>
<span id="cb98-275"><a href="#cb98-275" aria-hidden="true" tabindex="-1"></a><span class="in">df_syn &lt;- df_syn[!duplicated(df_syn$Variable), ]</span></span>
<span id="cb98-276"><a href="#cb98-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-277"><a href="#cb98-277" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-278"><a href="#cb98-278" aria-hidden="true" tabindex="-1"></a><span class="in">  df_syn,</span></span>
<span id="cb98-279"><a href="#cb98-279" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Structure of the Heart Failure Dataset: Variables, Types, and Values",</span></span>
<span id="cb98-280"><a href="#cb98-280" aria-hidden="true" tabindex="-1"></a><span class="in">  align = c("l","l","l"),</span></span>
<span id="cb98-281"><a href="#cb98-281" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = FALSE</span></span>
<span id="cb98-282"><a href="#cb98-282" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-283"><a href="#cb98-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-284"><a href="#cb98-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-285"><a href="#cb98-285" aria-hidden="true" tabindex="-1"></a><span class="fu">### Non-Parametric Imputation Using CART</span></span>
<span id="cb98-286"><a href="#cb98-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-287"><a href="#cb98-287" aria-hidden="true" tabindex="-1"></a>The Classification and Regression Trees (CART) method, a non-parametric approach, is useful for imputation when the relationships between variables are complex or non-linear. By leveraging decision trees, CART is capable of capturing intricate patterns in the data without making strong assumptions about the underlying distributions. Here's the preview of the first 10 rows of the synthetic data generated.</span>
<span id="cb98-288"><a href="#cb98-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-289"><a href="#cb98-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Non-Parametric Imputation using CART}</span></span>
<span id="cb98-290"><a href="#cb98-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-291"><a href="#cb98-291" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute the 5th and 95th percentiles for the real data</span></span>
<span id="cb98-292"><a href="#cb98-292" aria-hidden="true" tabindex="-1"></a><span class="in">percentiles &lt;- compute_percentiles(heart_failure)</span></span>
<span id="cb98-293"><a href="#cb98-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-294"><a href="#cb98-294" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate synthetic data using CART imputation with MICE</span></span>
<span id="cb98-295"><a href="#cb98-295" aria-hidden="true" tabindex="-1"></a><span class="in">where &lt;- make.where(heart_failure, "all")</span></span>
<span id="cb98-296"><a href="#cb98-296" aria-hidden="true" tabindex="-1"></a><span class="in">method &lt;- make.method(heart_failure, where = where)</span></span>
<span id="cb98-297"><a href="#cb98-297" aria-hidden="true" tabindex="-1"></a><span class="in">method[method == "pmm"] &lt;- "cart"  # Set the method to "cart" for non-parametric imputation</span></span>
<span id="cb98-298"><a href="#cb98-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-299"><a href="#cb98-299" aria-hidden="true" tabindex="-1"></a><span class="in"># Perform multiple imputation (10 datasets)</span></span>
<span id="cb98-300"><a href="#cb98-300" aria-hidden="true" tabindex="-1"></a><span class="in">syn_cart &lt;- mice(heart_failure, m = 10, maxit = 1, method = method, where = where, printFlag = FALSE)</span></span>
<span id="cb98-301"><a href="#cb98-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-302"><a href="#cb98-302" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract the first synthetic dataset</span></span>
<span id="cb98-303"><a href="#cb98-303" aria-hidden="true" tabindex="-1"></a><span class="in">syn_cart_1 &lt;- complete(syn_cart, 1)</span></span>
<span id="cb98-304"><a href="#cb98-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-305"><a href="#cb98-305" aria-hidden="true" tabindex="-1"></a><span class="in"># Scale synthetic data to the 5th and 95th percentile ranges</span></span>
<span id="cb98-306"><a href="#cb98-306" aria-hidden="true" tabindex="-1"></a><span class="in">syn_cart_1 &lt;- scale_to_percentiles(syn_cart_1, percentiles)</span></span>
<span id="cb98-307"><a href="#cb98-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-308"><a href="#cb98-308" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply the real missingness pattern to the synthetic dataset</span></span>
<span id="cb98-309"><a href="#cb98-309" aria-hidden="true" tabindex="-1"></a><span class="in">syn_cart_1 &lt;- generate_missingness_based_on_real(heart_failure, syn_cart_1)</span></span>
<span id="cb98-310"><a href="#cb98-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-311"><a href="#cb98-311" aria-hidden="true" tabindex="-1"></a><span class="in"># Round off all numeric columns to 0 decimal places</span></span>
<span id="cb98-312"><a href="#cb98-312" aria-hidden="true" tabindex="-1"></a><span class="in">syn_cart_1 &lt;- syn_cart_1 %&gt;%</span></span>
<span id="cb98-313"><a href="#cb98-313" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.numeric), round, digits = 0))</span></span>
<span id="cb98-314"><a href="#cb98-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-315"><a href="#cb98-315" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a prefix 'synth_' to all synthetic dataset variable names</span></span>
<span id="cb98-316"><a href="#cb98-316" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_cart_1) &lt;- paste("synth", colnames(syn_cart_1), sep = "_")</span></span>
<span id="cb98-317"><a href="#cb98-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-318"><a href="#cb98-318" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the structure of the dataset (fix double variable issue)</span></span>
<span id="cb98-319"><a href="#cb98-319" aria-hidden="true" tabindex="-1"></a><span class="in">df_cart &lt;- data.frame(</span></span>
<span id="cb98-320"><a href="#cb98-320" aria-hidden="true" tabindex="-1"></a><span class="in">  Variable = names(syn_cart_1),</span></span>
<span id="cb98-321"><a href="#cb98-321" aria-hidden="true" tabindex="-1"></a><span class="in">  Type   = unname(sapply(syn_cart_1, \(x) paste(class(x), collapse = ", "))),</span></span>
<span id="cb98-322"><a href="#cb98-322" aria-hidden="true" tabindex="-1"></a><span class="in">  Values = unname(sapply(syn_cart_1, \(x) paste(head(unique(x), 10), collapse = ", "))),</span></span>
<span id="cb98-323"><a href="#cb98-323" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = NULL,</span></span>
<span id="cb98-324"><a href="#cb98-324" aria-hidden="true" tabindex="-1"></a><span class="in">  check.names = FALSE</span></span>
<span id="cb98-325"><a href="#cb98-325" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-326"><a href="#cb98-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-327"><a href="#cb98-327" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove duplicated variables if any</span></span>
<span id="cb98-328"><a href="#cb98-328" aria-hidden="true" tabindex="-1"></a><span class="in">df_cart &lt;- df_cart[!duplicated(df_cart$Variable), ]</span></span>
<span id="cb98-329"><a href="#cb98-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-330"><a href="#cb98-330" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-331"><a href="#cb98-331" aria-hidden="true" tabindex="-1"></a><span class="in">  df_cart,</span></span>
<span id="cb98-332"><a href="#cb98-332" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Structure of the Heart Failure Dataset: Variables, Types, and Values (CART Imputation)",</span></span>
<span id="cb98-333"><a href="#cb98-333" aria-hidden="true" tabindex="-1"></a><span class="in">  align = c("l","l","l"),</span></span>
<span id="cb98-334"><a href="#cb98-334" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = FALSE</span></span>
<span id="cb98-335"><a href="#cb98-335" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-336"><a href="#cb98-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-337"><a href="#cb98-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-338"><a href="#cb98-338" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generating Synthetic Data Using Synthpop</span></span>
<span id="cb98-339"><a href="#cb98-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-340"><a href="#cb98-340" aria-hidden="true" tabindex="-1"></a>The Synthpop package is designed for creating synthetic data based on the distribution of the real dataset. It is particularly useful for privacy-preserving data sharing, where the aim is to create a synthetic dataset that mimics the real data without exposing sensitive information. Here's the preview of the first 10 rows of the synthetic data generated.</span>
<span id="cb98-341"><a href="#cb98-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-342"><a href="#cb98-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Generating Synthetic Data using Synthpop}</span></span>
<span id="cb98-343"><a href="#cb98-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-344"><a href="#cb98-344" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute the 5th and 95th percentiles for the real data</span></span>
<span id="cb98-345"><a href="#cb98-345" aria-hidden="true" tabindex="-1"></a><span class="in">percentiles &lt;- compute_percentiles(heart_failure)</span></span>
<span id="cb98-346"><a href="#cb98-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-347"><a href="#cb98-347" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate low-fidelity synthetic data using random sampling</span></span>
<span id="cb98-348"><a href="#cb98-348" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_low_fidelity &lt;- syn(heart_failure, method = "sample", seed = 123)</span></span>
<span id="cb98-349"><a href="#cb98-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-350"><a href="#cb98-350" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert the synthetic dataset to a data frame</span></span>
<span id="cb98-351"><a href="#cb98-351" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_low_fidelity_synthpop &lt;- syn_data_low_fidelity$syn</span></span>
<span id="cb98-352"><a href="#cb98-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-353"><a href="#cb98-353" aria-hidden="true" tabindex="-1"></a><span class="in"># Scale the synthetic data to the 5th and 95th percentile ranges</span></span>
<span id="cb98-354"><a href="#cb98-354" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_low_fidelity_synthpop &lt;- scale_to_percentiles(syn_data_low_fidelity_synthpop, percentiles)</span></span>
<span id="cb98-355"><a href="#cb98-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-356"><a href="#cb98-356" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply the real missingness pattern to the synthetic dataset</span></span>
<span id="cb98-357"><a href="#cb98-357" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_low_fidelity_synthpop &lt;- generate_missingness_based_on_real(heart_failure, syn_data_low_fidelity_synthpop)</span></span>
<span id="cb98-358"><a href="#cb98-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-359"><a href="#cb98-359" aria-hidden="true" tabindex="-1"></a><span class="in"># Round off all numeric columns to 0 decimal places</span></span>
<span id="cb98-360"><a href="#cb98-360" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_low_fidelity_synthpop &lt;- syn_data_low_fidelity_synthpop %&gt;%</span></span>
<span id="cb98-361"><a href="#cb98-361" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.numeric), round, digits = 0))</span></span>
<span id="cb98-362"><a href="#cb98-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-363"><a href="#cb98-363" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a prefix 'synth_' to all synthetic dataset variable names</span></span>
<span id="cb98-364"><a href="#cb98-364" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_data_low_fidelity_synthpop) &lt;- paste("synth", colnames(syn_data_low_fidelity_synthpop), sep = "_")</span></span>
<span id="cb98-365"><a href="#cb98-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-366"><a href="#cb98-366" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the structure of the dataset (fix double variable issue)</span></span>
<span id="cb98-367"><a href="#cb98-367" aria-hidden="true" tabindex="-1"></a><span class="in">df_synthpop &lt;- data.frame(</span></span>
<span id="cb98-368"><a href="#cb98-368" aria-hidden="true" tabindex="-1"></a><span class="in">  Variable = names(syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-369"><a href="#cb98-369" aria-hidden="true" tabindex="-1"></a><span class="in">  Type   = unname(sapply(syn_data_low_fidelity_synthpop, \(x) paste(class(x), collapse = ", "))),</span></span>
<span id="cb98-370"><a href="#cb98-370" aria-hidden="true" tabindex="-1"></a><span class="in">  Values = unname(sapply(syn_data_low_fidelity_synthpop, \(x) paste(head(unique(x), 10), collapse = ", "))),</span></span>
<span id="cb98-371"><a href="#cb98-371" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = NULL,</span></span>
<span id="cb98-372"><a href="#cb98-372" aria-hidden="true" tabindex="-1"></a><span class="in">  check.names = FALSE</span></span>
<span id="cb98-373"><a href="#cb98-373" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-374"><a href="#cb98-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-375"><a href="#cb98-375" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove duplicated variables if any</span></span>
<span id="cb98-376"><a href="#cb98-376" aria-hidden="true" tabindex="-1"></a><span class="in">df_synthpop &lt;- df_synthpop[!duplicated(df_synthpop$Variable), ]</span></span>
<span id="cb98-377"><a href="#cb98-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-378"><a href="#cb98-378" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-379"><a href="#cb98-379" aria-hidden="true" tabindex="-1"></a><span class="in">  df_synthpop,</span></span>
<span id="cb98-380"><a href="#cb98-380" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Structure of the Heart Failure Dataset: Variables, Types, and Values (Synthpop)",</span></span>
<span id="cb98-381"><a href="#cb98-381" aria-hidden="true" tabindex="-1"></a><span class="in">  align = c("l","l","l"),</span></span>
<span id="cb98-382"><a href="#cb98-382" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = FALSE</span></span>
<span id="cb98-383"><a href="#cb98-383" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-384"><a href="#cb98-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-385"><a href="#cb98-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-386"><a href="#cb98-386" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generating Synthetic Data Using Metadada</span></span>
<span id="cb98-387"><a href="#cb98-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-388"><a href="#cb98-388" aria-hidden="true" tabindex="-1"></a>This method uses a data dictionary (metadata) to drive the generation of synthetic data. The metadata defines the structure and types of variables, which ensures that the generated synthetic data conforms to expected formats, such as ranges for continuous variables and categories for binary or categorical variables. Here's the preview of the first 10 rows of the synthetic data generated.</span>
<span id="cb98-389"><a href="#cb98-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-390"><a href="#cb98-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Generating Synthetic Data using Metadata}</span></span>
<span id="cb98-391"><a href="#cb98-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-392"><a href="#cb98-392" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute the 5th and 95th percentiles for the real data</span></span>
<span id="cb98-393"><a href="#cb98-393" aria-hidden="true" tabindex="-1"></a><span class="in">percentiles &lt;- compute_percentiles(heart_failure)</span></span>
<span id="cb98-394"><a href="#cb98-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-395"><a href="#cb98-395" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate synthetic data using metadata</span></span>
<span id="cb98-396"><a href="#cb98-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-397"><a href="#cb98-397" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the metadata from the Excel file</span></span>
<span id="cb98-398"><a href="#cb98-398" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure_metadata &lt;- read_excel(here("data", "heart_failure_metadata.xlsx"))</span></span>
<span id="cb98-399"><a href="#cb98-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-400"><a href="#cb98-400" aria-hidden="true" tabindex="-1"></a><span class="in"># Create an empty data frame based on the metadata structure</span></span>
<span id="cb98-401"><a href="#cb98-401" aria-hidden="true" tabindex="-1"></a><span class="in">n_rows &lt;- nrow(heart_failure)  # Number of synthetic records to generate</span></span>
<span id="cb98-402"><a href="#cb98-402" aria-hidden="true" tabindex="-1"></a><span class="in">variable_names &lt;- heart_failure_metadata$`Variable Name`</span></span>
<span id="cb98-403"><a href="#cb98-403" aria-hidden="true" tabindex="-1"></a><span class="in">data_types &lt;- heart_failure_metadata$Type</span></span>
<span id="cb98-404"><a href="#cb98-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-405"><a href="#cb98-405" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_metadata &lt;- data.frame(matrix(ncol = length(variable_names), nrow = n_rows))</span></span>
<span id="cb98-406"><a href="#cb98-406" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_data_metadata) &lt;- variable_names</span></span>
<span id="cb98-407"><a href="#cb98-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-408"><a href="#cb98-408" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to generate data based on metadata</span></span>
<span id="cb98-409"><a href="#cb98-409" aria-hidden="true" tabindex="-1"></a><span class="in">generate_data &lt;- function(variable, real_data, type, n) {</span></span>
<span id="cb98-410"><a href="#cb98-410" aria-hidden="true" tabindex="-1"></a><span class="in">  if (type == "Continuous" || type == "Integer") {</span></span>
<span id="cb98-411"><a href="#cb98-411" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.numeric(real_data[[variable]])) {</span></span>
<span id="cb98-412"><a href="#cb98-412" aria-hidden="true" tabindex="-1"></a><span class="in">      # Compute 5th and 95th percentiles for numeric variables</span></span>
<span id="cb98-413"><a href="#cb98-413" aria-hidden="true" tabindex="-1"></a><span class="in">      p5 &lt;- quantile(real_data[[variable]], probs = 0.05, na.rm = TRUE)</span></span>
<span id="cb98-414"><a href="#cb98-414" aria-hidden="true" tabindex="-1"></a><span class="in">      p95 &lt;- quantile(real_data[[variable]], probs = 0.95, na.rm = TRUE)</span></span>
<span id="cb98-415"><a href="#cb98-415" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb98-416"><a href="#cb98-416" aria-hidden="true" tabindex="-1"></a><span class="in">      if (type == "Continuous") {</span></span>
<span id="cb98-417"><a href="#cb98-417" aria-hidden="true" tabindex="-1"></a><span class="in">        return(runif(n, min = p5, max = p95))</span></span>
<span id="cb98-418"><a href="#cb98-418" aria-hidden="true" tabindex="-1"></a><span class="in">      } else if (type == "Integer") {</span></span>
<span id="cb98-419"><a href="#cb98-419" aria-hidden="true" tabindex="-1"></a><span class="in">        return(sample(floor(p5):ceiling(p95), n, replace = TRUE))</span></span>
<span id="cb98-420"><a href="#cb98-420" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb98-421"><a href="#cb98-421" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb98-422"><a href="#cb98-422" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (is.factor(real_data[[variable]])) {</span></span>
<span id="cb98-423"><a href="#cb98-423" aria-hidden="true" tabindex="-1"></a><span class="in">    return(sample(levels(real_data[[variable]]), n, replace = TRUE))</span></span>
<span id="cb98-424"><a href="#cb98-424" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (variable %in% c("anaemia", "diabetes", "hypertension", "smoking", "sex")) {</span></span>
<span id="cb98-425"><a href="#cb98-425" aria-hidden="true" tabindex="-1"></a><span class="in">    return(sample(unique(real_data[[variable]]), n, replace = TRUE))</span></span>
<span id="cb98-426"><a href="#cb98-426" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb98-427"><a href="#cb98-427" aria-hidden="true" tabindex="-1"></a><span class="in">    return(rep(NA, n))</span></span>
<span id="cb98-428"><a href="#cb98-428" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-429"><a href="#cb98-429" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-430"><a href="#cb98-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-431"><a href="#cb98-431" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate synthetic data based on the metadata</span></span>
<span id="cb98-432"><a href="#cb98-432" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in seq_along(variable_names)) {</span></span>
<span id="cb98-433"><a href="#cb98-433" aria-hidden="true" tabindex="-1"></a><span class="in">  syn_data_metadata[[i]] &lt;- generate_data(variable_names[i], heart_failure, data_types[i], n_rows)</span></span>
<span id="cb98-434"><a href="#cb98-434" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-435"><a href="#cb98-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-436"><a href="#cb98-436" aria-hidden="true" tabindex="-1"></a><span class="in"># Scale the synthetic data to the 5th and 95th percentile ranges</span></span>
<span id="cb98-437"><a href="#cb98-437" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_metadata &lt;- scale_to_percentiles(syn_data_metadata, percentiles)</span></span>
<span id="cb98-438"><a href="#cb98-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-439"><a href="#cb98-439" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply the real missingness pattern to the synthetic dataset</span></span>
<span id="cb98-440"><a href="#cb98-440" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_metadata &lt;- generate_missingness_based_on_real(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-441"><a href="#cb98-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-442"><a href="#cb98-442" aria-hidden="true" tabindex="-1"></a><span class="in"># Round off all numeric columns to 0 decimal places</span></span>
<span id="cb98-443"><a href="#cb98-443" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_metadata &lt;- syn_data_metadata %&gt;%</span></span>
<span id="cb98-444"><a href="#cb98-444" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.numeric), round, digits = 0))</span></span>
<span id="cb98-445"><a href="#cb98-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-446"><a href="#cb98-446" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a prefix 'synth_' to all synthetic dataset variable names</span></span>
<span id="cb98-447"><a href="#cb98-447" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_data_metadata) &lt;- paste("synth", colnames(syn_data_metadata), sep = "_")</span></span>
<span id="cb98-448"><a href="#cb98-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-449"><a href="#cb98-449" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the structure of the dataset (fix double variable issue)</span></span>
<span id="cb98-450"><a href="#cb98-450" aria-hidden="true" tabindex="-1"></a><span class="in">df_metadata &lt;- data.frame(</span></span>
<span id="cb98-451"><a href="#cb98-451" aria-hidden="true" tabindex="-1"></a><span class="in">  Variable = names(syn_data_metadata),</span></span>
<span id="cb98-452"><a href="#cb98-452" aria-hidden="true" tabindex="-1"></a><span class="in">  Type   = unname(sapply(syn_data_metadata, \(x) paste(class(x), collapse = ", "))),</span></span>
<span id="cb98-453"><a href="#cb98-453" aria-hidden="true" tabindex="-1"></a><span class="in">  Values = unname(sapply(syn_data_metadata, \(x) paste(head(unique(x), 10), collapse = ", "))),</span></span>
<span id="cb98-454"><a href="#cb98-454" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = NULL,</span></span>
<span id="cb98-455"><a href="#cb98-455" aria-hidden="true" tabindex="-1"></a><span class="in">  check.names = FALSE</span></span>
<span id="cb98-456"><a href="#cb98-456" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-457"><a href="#cb98-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-458"><a href="#cb98-458" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove duplicated variables if any</span></span>
<span id="cb98-459"><a href="#cb98-459" aria-hidden="true" tabindex="-1"></a><span class="in">df_metadata &lt;- df_metadata[!duplicated(df_metadata$Variable), ]</span></span>
<span id="cb98-460"><a href="#cb98-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-461"><a href="#cb98-461" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-462"><a href="#cb98-462" aria-hidden="true" tabindex="-1"></a><span class="in">  df_metadata,</span></span>
<span id="cb98-463"><a href="#cb98-463" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Structure of the Heart Failure Dataset: Variables, Types, and Values (Metadata)",</span></span>
<span id="cb98-464"><a href="#cb98-464" aria-hidden="true" tabindex="-1"></a><span class="in">  align = c("l","l","l"),</span></span>
<span id="cb98-465"><a href="#cb98-465" aria-hidden="true" tabindex="-1"></a><span class="in">  row.names = FALSE</span></span>
<span id="cb98-466"><a href="#cb98-466" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-467"><a href="#cb98-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-468"><a href="#cb98-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-469"><a href="#cb98-469" aria-hidden="true" tabindex="-1"></a><span class="fu">## Synthetic Data Identification</span></span>
<span id="cb98-470"><a href="#cb98-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-471"><a href="#cb98-471" aria-hidden="true" tabindex="-1"></a>In this section, we generate tables to identify which columns in the synthetic datasets are synthetic (prefixed with "synth_") and which remain unchanged from the real dataset. This helps ensure clarity on which variables have been altered during the synthetic data generation process.</span>
<span id="cb98-472"><a href="#cb98-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-473"><a href="#cb98-473" aria-hidden="true" tabindex="-1"></a>For each dataset, we produce a table displaying the column names and whether the column is synthetic. A column is marked "Yes" if it was generated synthetically and "No" if it was retained from the real data.</span>
<span id="cb98-474"><a href="#cb98-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-475"><a href="#cb98-475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Synthetic Data Identification and Column Names Table}</span></span>
<span id="cb98-476"><a href="#cb98-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-477"><a href="#cb98-477" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to create column info with dataset name</span></span>
<span id="cb98-478"><a href="#cb98-478" aria-hidden="true" tabindex="-1"></a><span class="in">create_column_info &lt;- function(dataset, dataset_name) {</span></span>
<span id="cb98-479"><a href="#cb98-479" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(</span></span>
<span id="cb98-480"><a href="#cb98-480" aria-hidden="true" tabindex="-1"></a><span class="in">    column_name = colnames(dataset),</span></span>
<span id="cb98-481"><a href="#cb98-481" aria-hidden="true" tabindex="-1"></a><span class="in">    dataset = dataset_name,</span></span>
<span id="cb98-482"><a href="#cb98-482" aria-hidden="true" tabindex="-1"></a><span class="in">    is_synthetic = ifelse(grepl("^synth_", colnames(dataset)), "Yes", "No"),</span></span>
<span id="cb98-483"><a href="#cb98-483" aria-hidden="true" tabindex="-1"></a><span class="in">    stringsAsFactors = FALSE</span></span>
<span id="cb98-484"><a href="#cb98-484" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-485"><a href="#cb98-485" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-486"><a href="#cb98-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-487"><a href="#cb98-487" aria-hidden="true" tabindex="-1"></a><span class="in"># Collect column info for all datasets</span></span>
<span id="cb98-488"><a href="#cb98-488" aria-hidden="true" tabindex="-1"></a><span class="in">all_column_info &lt;- bind_rows(</span></span>
<span id="cb98-489"><a href="#cb98-489" aria-hidden="true" tabindex="-1"></a><span class="in">  create_column_info(syn_data_1, "Parametric MICE"),</span></span>
<span id="cb98-490"><a href="#cb98-490" aria-hidden="true" tabindex="-1"></a><span class="in">  create_column_info(syn_cart_1, "CART Imputation"),</span></span>
<span id="cb98-491"><a href="#cb98-491" aria-hidden="true" tabindex="-1"></a><span class="in">  create_column_info(syn_data_low_fidelity_synthpop, "Synthpop (Low Fidelity)"),</span></span>
<span id="cb98-492"><a href="#cb98-492" aria-hidden="true" tabindex="-1"></a><span class="in">  create_column_info(syn_data_metadata, "Metadata-Based")</span></span>
<span id="cb98-493"><a href="#cb98-493" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-494"><a href="#cb98-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-495"><a href="#cb98-495" aria-hidden="true" tabindex="-1"></a><span class="in"># Reshape into wide format so variables appear once</span></span>
<span id="cb98-496"><a href="#cb98-496" aria-hidden="true" tabindex="-1"></a><span class="in">wide_column_info &lt;- all_column_info %&gt;%</span></span>
<span id="cb98-497"><a href="#cb98-497" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(</span></span>
<span id="cb98-498"><a href="#cb98-498" aria-hidden="true" tabindex="-1"></a><span class="in">    names_from = dataset,</span></span>
<span id="cb98-499"><a href="#cb98-499" aria-hidden="true" tabindex="-1"></a><span class="in">    values_from = is_synthetic</span></span>
<span id="cb98-500"><a href="#cb98-500" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-501"><a href="#cb98-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-502"><a href="#cb98-502" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the combined wide table</span></span>
<span id="cb98-503"><a href="#cb98-503" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-504"><a href="#cb98-504" aria-hidden="true" tabindex="-1"></a><span class="in">  wide_column_info,</span></span>
<span id="cb98-505"><a href="#cb98-505" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Synthetic Indicators for Each Variable Across Datasets"</span></span>
<span id="cb98-506"><a href="#cb98-506" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-507"><a href="#cb98-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-508"><a href="#cb98-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-509"><a href="#cb98-509" aria-hidden="true" tabindex="-1"></a><span class="fu">## Synthetic Dataset Structure</span></span>
<span id="cb98-510"><a href="#cb98-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-511"><a href="#cb98-511" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dataset Size and Structure Comparison</span></span>
<span id="cb98-512"><a href="#cb98-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-513"><a href="#cb98-513" aria-hidden="true" tabindex="-1"></a>This step evaluates whether the synthetic datasets match the real dataset in terms of the number of rows, columns, and feature types. Consistency in these dimensions is essential for the synthetic data to be a reliable stand-in for the real.</span>
<span id="cb98-514"><a href="#cb98-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-515"><a href="#cb98-515" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Number of Rows**: Indicates if the synthetic data captures the same number of records as the real. Any mismatch can impact comparability.</span>
<span id="cb98-516"><a href="#cb98-516" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-517"><a href="#cb98-517" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Number of Columns**: Ensures all variables are retained. Missing or extra columns suggest structural issues.</span>
<span id="cb98-518"><a href="#cb98-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-519"><a href="#cb98-519" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Feature Types**: Confirms that categorical, numerical, and other variable types remain unchanged, preserving analytical consistency.</span>
<span id="cb98-520"><a href="#cb98-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-521"><a href="#cb98-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Dataset Size and Structure Comparison}</span></span>
<span id="cb98-522"><a href="#cb98-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-523"><a href="#cb98-523" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to extract structure info</span></span>
<span id="cb98-524"><a href="#cb98-524" aria-hidden="true" tabindex="-1"></a><span class="in">get_structure_info &lt;- function(real_data, synthetic_data, dataset_name) {</span></span>
<span id="cb98-525"><a href="#cb98-525" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble(</span></span>
<span id="cb98-526"><a href="#cb98-526" aria-hidden="true" tabindex="-1"></a><span class="in">    Dataset = dataset_name,</span></span>
<span id="cb98-527"><a href="#cb98-527" aria-hidden="true" tabindex="-1"></a><span class="in">    Rows_Real = nrow(real_data),</span></span>
<span id="cb98-528"><a href="#cb98-528" aria-hidden="true" tabindex="-1"></a><span class="in">    Cols_Real = ncol(real_data),</span></span>
<span id="cb98-529"><a href="#cb98-529" aria-hidden="true" tabindex="-1"></a><span class="in">    Rows_Synthetic = nrow(synthetic_data),</span></span>
<span id="cb98-530"><a href="#cb98-530" aria-hidden="true" tabindex="-1"></a><span class="in">    Cols_Synthetic = ncol(synthetic_data),</span></span>
<span id="cb98-531"><a href="#cb98-531" aria-hidden="true" tabindex="-1"></a><span class="in">    Structure_Match = ifelse(</span></span>
<span id="cb98-532"><a href="#cb98-532" aria-hidden="true" tabindex="-1"></a><span class="in">      nrow(real_data) == nrow(synthetic_data) &amp; ncol(real_data) == ncol(synthetic_data),</span></span>
<span id="cb98-533"><a href="#cb98-533" aria-hidden="true" tabindex="-1"></a><span class="in">      "✅ Yes", "❌ No"</span></span>
<span id="cb98-534"><a href="#cb98-534" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb98-535"><a href="#cb98-535" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-536"><a href="#cb98-536" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-537"><a href="#cb98-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-538"><a href="#cb98-538" aria-hidden="true" tabindex="-1"></a><span class="in"># Collect results</span></span>
<span id="cb98-539"><a href="#cb98-539" aria-hidden="true" tabindex="-1"></a><span class="in">structure_comparison &lt;- bind_rows(</span></span>
<span id="cb98-540"><a href="#cb98-540" aria-hidden="true" tabindex="-1"></a><span class="in">  get_structure_info(heart_failure, syn_data_1, "Parametric MICE"),</span></span>
<span id="cb98-541"><a href="#cb98-541" aria-hidden="true" tabindex="-1"></a><span class="in">  get_structure_info(heart_failure, syn_cart_1, "CART Imputation"),</span></span>
<span id="cb98-542"><a href="#cb98-542" aria-hidden="true" tabindex="-1"></a><span class="in">  get_structure_info(heart_failure, syn_data_low_fidelity_synthpop, "Synthpop (Low Fidelity)"),</span></span>
<span id="cb98-543"><a href="#cb98-543" aria-hidden="true" tabindex="-1"></a><span class="in">  get_structure_info(heart_failure, syn_data_metadata, "Metadata-Based")</span></span>
<span id="cb98-544"><a href="#cb98-544" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-545"><a href="#cb98-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-546"><a href="#cb98-546" aria-hidden="true" tabindex="-1"></a><span class="in"># Display as a neat table</span></span>
<span id="cb98-547"><a href="#cb98-547" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-548"><a href="#cb98-548" aria-hidden="true" tabindex="-1"></a><span class="in">  structure_comparison,</span></span>
<span id="cb98-549"><a href="#cb98-549" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Comparison of Real vs Synthetic Dataset Sizes and Structures"</span></span>
<span id="cb98-550"><a href="#cb98-550" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-551"><a href="#cb98-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-552"><a href="#cb98-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-553"><a href="#cb98-553" aria-hidden="true" tabindex="-1"></a><span class="fu">### Categorical Variables: All Levels Maintained and Comparison of Distribution</span></span>
<span id="cb98-554"><a href="#cb98-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-555"><a href="#cb98-555" aria-hidden="true" tabindex="-1"></a>This section evaluates how well the synthetic datasets replicate the categorical variables in the real dataset, focusing on the preservation of all levels and their distributions.</span>
<span id="cb98-556"><a href="#cb98-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-557"><a href="#cb98-557" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Level Matching**: For each categorical variable, the synthetic dataset should retain all levels (categories) present in the real dataset. Missing levels suggest that the synthetic data may be incomplete, while additional levels could indicate errors in data generation.</span>
<span id="cb98-558"><a href="#cb98-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-559"><a href="#cb98-559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Distribution Comparison**: The frequency of each categorical level in the synthetic data should closely mirror that of the real dataset. Significant deviations in category frequencies suggest that the synthetic data does not fully capture the true distribution of the categorical features.</span>
<span id="cb98-560"><a href="#cb98-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-561"><a href="#cb98-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Categorical Variables: All Levels Maintained and Comparison of Distribution}</span></span>
<span id="cb98-562"><a href="#cb98-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-563"><a href="#cb98-563" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to collect categorical level info</span></span>
<span id="cb98-564"><a href="#cb98-564" aria-hidden="true" tabindex="-1"></a><span class="in">get_cat_levels &lt;- function(real_data, synthetic_data, dataset_name) {</span></span>
<span id="cb98-565"><a href="#cb98-565" aria-hidden="true" tabindex="-1"></a><span class="in">  cat_vars &lt;- colnames(real_data)[sapply(real_data, is.factor)]</span></span>
<span id="cb98-566"><a href="#cb98-566" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-567"><a href="#cb98-567" aria-hidden="true" tabindex="-1"></a><span class="in">  do.call(rbind, lapply(cat_vars, function(var) {</span></span>
<span id="cb98-568"><a href="#cb98-568" aria-hidden="true" tabindex="-1"></a><span class="in">    levels_real &lt;- unique(real_data[[var]])</span></span>
<span id="cb98-569"><a href="#cb98-569" aria-hidden="true" tabindex="-1"></a><span class="in">    levels_synth &lt;- unique(synthetic_data[[paste("synth", var, sep = "_")]])</span></span>
<span id="cb98-570"><a href="#cb98-570" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb98-571"><a href="#cb98-571" aria-hidden="true" tabindex="-1"></a><span class="in">    data.frame(</span></span>
<span id="cb98-572"><a href="#cb98-572" aria-hidden="true" tabindex="-1"></a><span class="in">      Variable = var,</span></span>
<span id="cb98-573"><a href="#cb98-573" aria-hidden="true" tabindex="-1"></a><span class="in">      Dataset = dataset_name,</span></span>
<span id="cb98-574"><a href="#cb98-574" aria-hidden="true" tabindex="-1"></a><span class="in">      Real_Levels = paste(levels_real, collapse = ", "),</span></span>
<span id="cb98-575"><a href="#cb98-575" aria-hidden="true" tabindex="-1"></a><span class="in">      Synthetic_Levels = paste(levels_synth, collapse = ", "),</span></span>
<span id="cb98-576"><a href="#cb98-576" aria-hidden="true" tabindex="-1"></a><span class="in">      Match = ifelse(all(levels_real %in% levels_synth), "✅ Yes", "❌ No"),</span></span>
<span id="cb98-577"><a href="#cb98-577" aria-hidden="true" tabindex="-1"></a><span class="in">      stringsAsFactors = FALSE</span></span>
<span id="cb98-578"><a href="#cb98-578" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb98-579"><a href="#cb98-579" aria-hidden="true" tabindex="-1"></a><span class="in">  }))</span></span>
<span id="cb98-580"><a href="#cb98-580" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-581"><a href="#cb98-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-582"><a href="#cb98-582" aria-hidden="true" tabindex="-1"></a><span class="in"># Collect results</span></span>
<span id="cb98-583"><a href="#cb98-583" aria-hidden="true" tabindex="-1"></a><span class="in">cat_comparison &lt;- bind_rows(</span></span>
<span id="cb98-584"><a href="#cb98-584" aria-hidden="true" tabindex="-1"></a><span class="in">  get_cat_levels(heart_failure, syn_data_1, "Parametric MICE"),</span></span>
<span id="cb98-585"><a href="#cb98-585" aria-hidden="true" tabindex="-1"></a><span class="in">  get_cat_levels(heart_failure, syn_cart_1, "CART Imputation"),</span></span>
<span id="cb98-586"><a href="#cb98-586" aria-hidden="true" tabindex="-1"></a><span class="in">  get_cat_levels(heart_failure, syn_data_low_fidelity_synthpop, "Synthpop (Low Fidelity)"),</span></span>
<span id="cb98-587"><a href="#cb98-587" aria-hidden="true" tabindex="-1"></a><span class="in">  get_cat_levels(heart_failure, syn_data_metadata, "Metadata-Based")</span></span>
<span id="cb98-588"><a href="#cb98-588" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-589"><a href="#cb98-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-590"><a href="#cb98-590" aria-hidden="true" tabindex="-1"></a><span class="in"># Display table</span></span>
<span id="cb98-591"><a href="#cb98-591" aria-hidden="true" tabindex="-1"></a><span class="in">kable(cat_comparison,</span></span>
<span id="cb98-592"><a href="#cb98-592" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Comparison of Categorical Variable Levels in Real vs Synthetic Datasets")</span></span>
<span id="cb98-593"><a href="#cb98-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-594"><a href="#cb98-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-595"><a href="#cb98-595" aria-hidden="true" tabindex="-1"></a><span class="fu">### Numeric Variables: Range and Distribution Comparison</span></span>
<span id="cb98-596"><a href="#cb98-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-597"><a href="#cb98-597" aria-hidden="true" tabindex="-1"></a>This analysis evaluates how well the numeric variables in the synthetic datasets replicate the real data in terms of range and distribution.</span>
<span id="cb98-598"><a href="#cb98-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-599"><a href="#cb98-599" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Range**: For each numeric variable, the synthetic data should maintain values within the range of the real dataset. Any deviations, especially outliers, could indicate inaccuracies in the synthetic generation process.</span>
<span id="cb98-600"><a href="#cb98-600" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-601"><a href="#cb98-601" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Distribution Comparison**: Density plots are used to compare the shape of the distributions between the real and synthetic datasets. Ideally, the synthetic data should closely mirror the real distribution, indicating that the underlying data generation model has captured the true variability of the numeric features.</span>
<span id="cb98-602"><a href="#cb98-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-603"><a href="#cb98-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Numeric Variables: Range and Distribution Comparison}</span></span>
<span id="cb98-604"><a href="#cb98-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-605"><a href="#cb98-605" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute per-variable stats for a (real, synthetic) pair</span></span>
<span id="cb98-606"><a href="#cb98-606" aria-hidden="true" tabindex="-1"></a><span class="in">numeric_summary &lt;- function(real, synth, dataset_name) {</span></span>
<span id="cb98-607"><a href="#cb98-607" aria-hidden="true" tabindex="-1"></a><span class="in">  num_vars &lt;- names(real)[sapply(real, is.numeric)]</span></span>
<span id="cb98-608"><a href="#cb98-608" aria-hidden="true" tabindex="-1"></a><span class="in">  # real percentiles</span></span>
<span id="cb98-609"><a href="#cb98-609" aria-hidden="true" tabindex="-1"></a><span class="in">  pctl &lt;- map(num_vars, ~quantile(real[[.x]], probs = c(.05, .95), na.rm = TRUE)) |&gt;</span></span>
<span id="cb98-610"><a href="#cb98-610" aria-hidden="true" tabindex="-1"></a><span class="in">    setNames(num_vars)</span></span>
<span id="cb98-611"><a href="#cb98-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-612"><a href="#cb98-612" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble(</span></span>
<span id="cb98-613"><a href="#cb98-613" aria-hidden="true" tabindex="-1"></a><span class="in">    Variable = num_vars,</span></span>
<span id="cb98-614"><a href="#cb98-614" aria-hidden="true" tabindex="-1"></a><span class="in">    Real_Min = map_dbl(num_vars, ~min(real[[.x]], na.rm = TRUE)),</span></span>
<span id="cb98-615"><a href="#cb98-615" aria-hidden="true" tabindex="-1"></a><span class="in">    Real_P5  = map_dbl(num_vars, ~pctl[[.x]][1]),</span></span>
<span id="cb98-616"><a href="#cb98-616" aria-hidden="true" tabindex="-1"></a><span class="in">    Real_P95 = map_dbl(num_vars, ~pctl[[.x]][2]),</span></span>
<span id="cb98-617"><a href="#cb98-617" aria-hidden="true" tabindex="-1"></a><span class="in">    Real_Max = map_dbl(num_vars, ~max(real[[.x]], na.rm = TRUE)),</span></span>
<span id="cb98-618"><a href="#cb98-618" aria-hidden="true" tabindex="-1"></a><span class="in">    Synth_Min = map_dbl(num_vars, ~min(synth[[paste0("synth_", .x)]], na.rm = TRUE)),</span></span>
<span id="cb98-619"><a href="#cb98-619" aria-hidden="true" tabindex="-1"></a><span class="in">    Synth_Max = map_dbl(num_vars, ~max(synth[[paste0("synth_", .x)]], na.rm = TRUE))</span></span>
<span id="cb98-620"><a href="#cb98-620" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb98-621"><a href="#cb98-621" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(</span></span>
<span id="cb98-622"><a href="#cb98-622" aria-hidden="true" tabindex="-1"></a><span class="in">      Within_P5_P95 = ifelse(Synth_Min &gt;= Real_P5 &amp; Synth_Max &lt;= Real_P95, "✅ Yes", "❌ No"),</span></span>
<span id="cb98-623"><a href="#cb98-623" aria-hidden="true" tabindex="-1"></a><span class="in">      Dataset = dataset_name,</span></span>
<span id="cb98-624"><a href="#cb98-624" aria-hidden="true" tabindex="-1"></a><span class="in">      .before = 1</span></span>
<span id="cb98-625"><a href="#cb98-625" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb98-626"><a href="#cb98-626" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-627"><a href="#cb98-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-628"><a href="#cb98-628" aria-hidden="true" tabindex="-1"></a><span class="in"># Build one continuous table for all synthetic datasets</span></span>
<span id="cb98-629"><a href="#cb98-629" aria-hidden="true" tabindex="-1"></a><span class="in">num_table &lt;- bind_rows(</span></span>
<span id="cb98-630"><a href="#cb98-630" aria-hidden="true" tabindex="-1"></a><span class="in">  numeric_summary(heart_failure, syn_data_1, "Parametric MICE"),</span></span>
<span id="cb98-631"><a href="#cb98-631" aria-hidden="true" tabindex="-1"></a><span class="in">  numeric_summary(heart_failure, syn_cart_1, "CART Imputation"),</span></span>
<span id="cb98-632"><a href="#cb98-632" aria-hidden="true" tabindex="-1"></a><span class="in">  numeric_summary(heart_failure, syn_data_low_fidelity_synthpop, "Synthpop (Low Fidelity)"),</span></span>
<span id="cb98-633"><a href="#cb98-633" aria-hidden="true" tabindex="-1"></a><span class="in">  numeric_summary(heart_failure, syn_data_metadata, "Metadata-Based")</span></span>
<span id="cb98-634"><a href="#cb98-634" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-635"><a href="#cb98-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-636"><a href="#cb98-636" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-637"><a href="#cb98-637" aria-hidden="true" tabindex="-1"></a><span class="in">  num_table,</span></span>
<span id="cb98-638"><a href="#cb98-638" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Numeric variables: real ranges &amp; percentiles vs. synthetic ranges (with P5–P95 containment check)"</span></span>
<span id="cb98-639"><a href="#cb98-639" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-640"><a href="#cb98-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-641"><a href="#cb98-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-642"><a href="#cb98-642" aria-hidden="true" tabindex="-1"></a><span class="fu">### Missingness Comparison</span></span>
<span id="cb98-643"><a href="#cb98-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-644"><a href="#cb98-644" aria-hidden="true" tabindex="-1"></a>In this section, we compare the proportions of missing values between the real dataset and each synthetic dataset. This comparison helps determine whether the synthetic datasets accurately represent the patterns of missingness in the real data.</span>
<span id="cb98-645"><a href="#cb98-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-646"><a href="#cb98-646" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Missingness Proportions**: For each dataset, we calculate the proportion of missing values for every column and compare the results across the real and synthetic datasets.</span>
<span id="cb98-647"><a href="#cb98-647" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-648"><a href="#cb98-648" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Comparison Outcome**: Ideally, the synthetic datasets should exhibit similar missingness proportions to the real data. Any deviations may indicate differences in how missing values were handled during the synthetic data generation process.</span>
<span id="cb98-649"><a href="#cb98-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-650"><a href="#cb98-650" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Introduction Plots</span></span>
<span id="cb98-651"><a href="#cb98-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-652"><a href="#cb98-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r intro-plots, fig.width=10, fig.height=8, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-653"><a href="#cb98-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-654"><a href="#cb98-654" aria-hidden="true" tabindex="-1"></a><span class="in"># Custom palette for the 5 metrics</span></span>
<span id="cb98-655"><a href="#cb98-655" aria-hidden="true" tabindex="-1"></a><span class="in">metric_palette &lt;- c(</span></span>
<span id="cb98-656"><a href="#cb98-656" aria-hidden="true" tabindex="-1"></a><span class="in">  "Discrete Columns"     = "#B0D99B",</span></span>
<span id="cb98-657"><a href="#cb98-657" aria-hidden="true" tabindex="-1"></a><span class="in">  "Continuous Columns"   = "#528AA8",</span></span>
<span id="cb98-658"><a href="#cb98-658" aria-hidden="true" tabindex="-1"></a><span class="in">  "All Missing Columns"  = "#FFB6DB",</span></span>
<span id="cb98-659"><a href="#cb98-659" aria-hidden="true" tabindex="-1"></a><span class="in">  "Complete Rows"        = "#264653",</span></span>
<span id="cb98-660"><a href="#cb98-660" aria-hidden="true" tabindex="-1"></a><span class="in">  "Missing Observations" = "#2A9D8F"</span></span>
<span id="cb98-661"><a href="#cb98-661" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-662"><a href="#cb98-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-663"><a href="#cb98-663" aria-hidden="true" tabindex="-1"></a><span class="in"># Strip 'synth_' for fair visuals</span></span>
<span id="cb98-664"><a href="#cb98-664" aria-hidden="true" tabindex="-1"></a><span class="in">strip_synth_prefix &lt;- function(df) { </span></span>
<span id="cb98-665"><a href="#cb98-665" aria-hidden="true" tabindex="-1"></a><span class="in">  names(df) &lt;- sub("^synth_", "", names(df)) </span></span>
<span id="cb98-666"><a href="#cb98-666" aria-hidden="true" tabindex="-1"></a><span class="in">  df </span></span>
<span id="cb98-667"><a href="#cb98-667" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-668"><a href="#cb98-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-669"><a href="#cb98-669" aria-hidden="true" tabindex="-1"></a><span class="in"># Datasets to compare</span></span>
<span id="cb98-670"><a href="#cb98-670" aria-hidden="true" tabindex="-1"></a><span class="in">datasets &lt;- list(</span></span>
<span id="cb98-671"><a href="#cb98-671" aria-hidden="true" tabindex="-1"></a><span class="in">  "Real Data"               = heart_failure,</span></span>
<span id="cb98-672"><a href="#cb98-672" aria-hidden="true" tabindex="-1"></a><span class="in">  "Parametric MICE"         = strip_synth_prefix(syn_data_1),</span></span>
<span id="cb98-673"><a href="#cb98-673" aria-hidden="true" tabindex="-1"></a><span class="in">  "CART Imputation"         = strip_synth_prefix(syn_cart_1),</span></span>
<span id="cb98-674"><a href="#cb98-674" aria-hidden="true" tabindex="-1"></a><span class="in">  "Synthpop (Low Fidelity)" = strip_synth_prefix(syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-675"><a href="#cb98-675" aria-hidden="true" tabindex="-1"></a><span class="in">  "Metadata-Based"          = strip_synth_prefix(syn_data_metadata)</span></span>
<span id="cb98-676"><a href="#cb98-676" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-677"><a href="#cb98-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-678"><a href="#cb98-678" aria-hidden="true" tabindex="-1"></a><span class="in"># Function: horizontal bar chart for the 5 metrics</span></span>
<span id="cb98-679"><a href="#cb98-679" aria-hidden="true" tabindex="-1"></a><span class="in">make_intro_plot &lt;- function(df, title) {</span></span>
<span id="cb98-680"><a href="#cb98-680" aria-hidden="true" tabindex="-1"></a><span class="in">  n_rows &lt;- nrow(df)</span></span>
<span id="cb98-681"><a href="#cb98-681" aria-hidden="true" tabindex="-1"></a><span class="in">  n_cols &lt;- ncol(df)</span></span>
<span id="cb98-682"><a href="#cb98-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-683"><a href="#cb98-683" aria-hidden="true" tabindex="-1"></a><span class="in">  pct_discrete   &lt;- 100 * sum(vapply(df, is.factor,  logical(1))) / n_cols</span></span>
<span id="cb98-684"><a href="#cb98-684" aria-hidden="true" tabindex="-1"></a><span class="in">  pct_continuous &lt;- 100 * sum(vapply(df, is.numeric, logical(1))) / n_cols</span></span>
<span id="cb98-685"><a href="#cb98-685" aria-hidden="true" tabindex="-1"></a><span class="in">  pct_allmisscol &lt;- 100 * sum(colSums(is.na(df)) == n_rows) / n_cols</span></span>
<span id="cb98-686"><a href="#cb98-686" aria-hidden="true" tabindex="-1"></a><span class="in">  pct_completer  &lt;- 100 * sum(complete.cases(df)) / n_rows</span></span>
<span id="cb98-687"><a href="#cb98-687" aria-hidden="true" tabindex="-1"></a><span class="in">  pct_missobs    &lt;- 100 * sum(is.na(df)) / (n_rows * n_cols)</span></span>
<span id="cb98-688"><a href="#cb98-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-689"><a href="#cb98-689" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_df &lt;- tibble::tibble(</span></span>
<span id="cb98-690"><a href="#cb98-690" aria-hidden="true" tabindex="-1"></a><span class="in">    Metric = factor(</span></span>
<span id="cb98-691"><a href="#cb98-691" aria-hidden="true" tabindex="-1"></a><span class="in">      c("Discrete Columns", "Continuous Columns", "All Missing Columns",</span></span>
<span id="cb98-692"><a href="#cb98-692" aria-hidden="true" tabindex="-1"></a><span class="in">        "Complete Rows", "Missing Observations"),</span></span>
<span id="cb98-693"><a href="#cb98-693" aria-hidden="true" tabindex="-1"></a><span class="in">      levels = rev(c("Discrete Columns", "Continuous Columns", "All Missing Columns",</span></span>
<span id="cb98-694"><a href="#cb98-694" aria-hidden="true" tabindex="-1"></a><span class="in">                     "Complete Rows", "Missing Observations")) # reverse for nicer order</span></span>
<span id="cb98-695"><a href="#cb98-695" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb98-696"><a href="#cb98-696" aria-hidden="true" tabindex="-1"></a><span class="in">    Percentage = c(pct_discrete, pct_continuous, pct_allmisscol, pct_completer, pct_missobs)</span></span>
<span id="cb98-697"><a href="#cb98-697" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-698"><a href="#cb98-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-699"><a href="#cb98-699" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(plot_df, aes(x = Percentage, y = Metric, fill = Metric)) +</span></span>
<span id="cb98-700"><a href="#cb98-700" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-701"><a href="#cb98-701" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(aes(label = paste0(round(Percentage, 1), "%")),</span></span>
<span id="cb98-702"><a href="#cb98-702" aria-hidden="true" tabindex="-1"></a><span class="in">              hjust = -0.1, size = 3.5) +</span></span>
<span id="cb98-703"><a href="#cb98-703" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_continuous(</span></span>
<span id="cb98-704"><a href="#cb98-704" aria-hidden="true" tabindex="-1"></a><span class="in">      labels = scales::percent_format(scale = 1),</span></span>
<span id="cb98-705"><a href="#cb98-705" aria-hidden="true" tabindex="-1"></a><span class="in">      limits = c(0, 100),</span></span>
<span id="cb98-706"><a href="#cb98-706" aria-hidden="true" tabindex="-1"></a><span class="in">      expand = expansion(mult = c(0, 0.05)) # headroom for labels</span></span>
<span id="cb98-707"><a href="#cb98-707" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb98-708"><a href="#cb98-708" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(values = metric_palette) +</span></span>
<span id="cb98-709"><a href="#cb98-709" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(title = title, x = "Percentage", y = NULL) +</span></span>
<span id="cb98-710"><a href="#cb98-710" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_light() +</span></span>
<span id="cb98-711"><a href="#cb98-711" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(</span></span>
<span id="cb98-712"><a href="#cb98-712" aria-hidden="true" tabindex="-1"></a><span class="in">      axis.text.y  = element_text(size = 9),</span></span>
<span id="cb98-713"><a href="#cb98-713" aria-hidden="true" tabindex="-1"></a><span class="in">      plot.title   = element_text(face = "bold")</span></span>
<span id="cb98-714"><a href="#cb98-714" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb98-715"><a href="#cb98-715" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-716"><a href="#cb98-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-717"><a href="#cb98-717" aria-hidden="true" tabindex="-1"></a><span class="in"># Build plots and combine in one grid</span></span>
<span id="cb98-718"><a href="#cb98-718" aria-hidden="true" tabindex="-1"></a><span class="in">wrap_plots(</span></span>
<span id="cb98-719"><a href="#cb98-719" aria-hidden="true" tabindex="-1"></a><span class="in">  imap(datasets, ~ make_intro_plot(.x, .y)),</span></span>
<span id="cb98-720"><a href="#cb98-720" aria-hidden="true" tabindex="-1"></a><span class="in">  ncol = 2</span></span>
<span id="cb98-721"><a href="#cb98-721" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb98-722"><a href="#cb98-722" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(</span></span>
<span id="cb98-723"><a href="#cb98-723" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Dataset Overview: Discrete/Continuous Columns, All-Missing Columns, Complete Rows, Missing Observations",</span></span>
<span id="cb98-724"><a href="#cb98-724" aria-hidden="true" tabindex="-1"></a><span class="in">    subtitle = "Percentages shown per dataset; axes standardized to 0–100%",</span></span>
<span id="cb98-725"><a href="#cb98-725" aria-hidden="true" tabindex="-1"></a><span class="in">    theme = theme(plot.title = element_text(face = "bold", size = 12))</span></span>
<span id="cb98-726"><a href="#cb98-726" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-727"><a href="#cb98-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-728"><a href="#cb98-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-729"><a href="#cb98-729" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Missingness Proportions and Comparison Outcome</span></span>
<span id="cb98-730"><a href="#cb98-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-731"><a href="#cb98-731" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Missingness Proportions and Comparison Outcome}</span></span>
<span id="cb98-732"><a href="#cb98-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-733"><a href="#cb98-733" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove 'synth_' prefix so names match the real dataset</span></span>
<span id="cb98-734"><a href="#cb98-734" aria-hidden="true" tabindex="-1"></a><span class="in">strip_synth_prefix &lt;- function(df) {</span></span>
<span id="cb98-735"><a href="#cb98-735" aria-hidden="true" tabindex="-1"></a><span class="in">  names(df) &lt;- sub("^synth_", "", names(df))</span></span>
<span id="cb98-736"><a href="#cb98-736" aria-hidden="true" tabindex="-1"></a><span class="in">  df</span></span>
<span id="cb98-737"><a href="#cb98-737" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-738"><a href="#cb98-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-739"><a href="#cb98-739" aria-hidden="true" tabindex="-1"></a><span class="in"># Compare against the real dataset's variable set</span></span>
<span id="cb98-740"><a href="#cb98-740" aria-hidden="true" tabindex="-1"></a><span class="in">core_vars &lt;- names(heart_failure)</span></span>
<span id="cb98-741"><a href="#cb98-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-742"><a href="#cb98-742" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to compute missingness proportions (2 d.p.) for one dataset</span></span>
<span id="cb98-743"><a href="#cb98-743" aria-hidden="true" tabindex="-1"></a><span class="in">get_missingness &lt;- function(df, label) {</span></span>
<span id="cb98-744"><a href="#cb98-744" aria-hidden="true" tabindex="-1"></a><span class="in">  df2 &lt;- df %&gt;% strip_synth_prefix()</span></span>
<span id="cb98-745"><a href="#cb98-745" aria-hidden="true" tabindex="-1"></a><span class="in">  # keep only variables present in the real data (prevents mismatches)</span></span>
<span id="cb98-746"><a href="#cb98-746" aria-hidden="true" tabindex="-1"></a><span class="in">  df2 &lt;- df2 %&gt;% select(any_of(core_vars))</span></span>
<span id="cb98-747"><a href="#cb98-747" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble(</span></span>
<span id="cb98-748"><a href="#cb98-748" aria-hidden="true" tabindex="-1"></a><span class="in">    Variable   = names(df2),</span></span>
<span id="cb98-749"><a href="#cb98-749" aria-hidden="true" tabindex="-1"></a><span class="in">    Proportion = round(colSums(is.na(df2)) / nrow(df2), 2),</span></span>
<span id="cb98-750"><a href="#cb98-750" aria-hidden="true" tabindex="-1"></a><span class="in">    Dataset    = label</span></span>
<span id="cb98-751"><a href="#cb98-751" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-752"><a href="#cb98-752" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-753"><a href="#cb98-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-754"><a href="#cb98-754" aria-hidden="true" tabindex="-1"></a><span class="in"># Build tidy table</span></span>
<span id="cb98-755"><a href="#cb98-755" aria-hidden="true" tabindex="-1"></a><span class="in">missing_tbl &lt;- bind_rows(</span></span>
<span id="cb98-756"><a href="#cb98-756" aria-hidden="true" tabindex="-1"></a><span class="in">  get_missingness(heart_failure, "Real Data"),</span></span>
<span id="cb98-757"><a href="#cb98-757" aria-hidden="true" tabindex="-1"></a><span class="in">  get_missingness(syn_data_1, "Parametric MICE"),</span></span>
<span id="cb98-758"><a href="#cb98-758" aria-hidden="true" tabindex="-1"></a><span class="in">  get_missingness(syn_cart_1, "CART Imputation"),</span></span>
<span id="cb98-759"><a href="#cb98-759" aria-hidden="true" tabindex="-1"></a><span class="in">  get_missingness(syn_data_low_fidelity_synthpop, "Synthpop (Low Fidelity)"),</span></span>
<span id="cb98-760"><a href="#cb98-760" aria-hidden="true" tabindex="-1"></a><span class="in">  get_missingness(syn_data_metadata, "Metadata-Based")</span></span>
<span id="cb98-761"><a href="#cb98-761" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-762"><a href="#cb98-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-763"><a href="#cb98-763" aria-hidden="true" tabindex="-1"></a><span class="in"># Pivot wider for side-by-side comparison</span></span>
<span id="cb98-764"><a href="#cb98-764" aria-hidden="true" tabindex="-1"></a><span class="in">missing_tbl_wide &lt;- missing_tbl %&gt;%</span></span>
<span id="cb98-765"><a href="#cb98-765" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = Dataset, values_from = Proportion) %&gt;%</span></span>
<span id="cb98-766"><a href="#cb98-766" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(Variable)</span></span>
<span id="cb98-767"><a href="#cb98-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-768"><a href="#cb98-768" aria-hidden="true" tabindex="-1"></a><span class="in"># Optional: add quick match flags (✅ if identical to Real Data)</span></span>
<span id="cb98-769"><a href="#cb98-769" aria-hidden="true" tabindex="-1"></a><span class="in"># missing_tbl_wide &lt;- missing_tbl_wide %&gt;%</span></span>
<span id="cb98-770"><a href="#cb98-770" aria-hidden="true" tabindex="-1"></a><span class="in">#   mutate(</span></span>
<span id="cb98-771"><a href="#cb98-771" aria-hidden="true" tabindex="-1"></a><span class="in">#     `Parametric MICE Match` = ifelse(`Parametric MICE` == `Real Data`, "✅", "❌"),</span></span>
<span id="cb98-772"><a href="#cb98-772" aria-hidden="true" tabindex="-1"></a><span class="in">#     `CART Imputation Match` = ifelse(`CART Imputation` == `Real Data`, "✅", "❌"),</span></span>
<span id="cb98-773"><a href="#cb98-773" aria-hidden="true" tabindex="-1"></a><span class="in">#     `Synthpop (Low Fidelity) Match` = ifelse(`Synthpop (Low Fidelity)` == `Real Data`, "✅", "❌"),</span></span>
<span id="cb98-774"><a href="#cb98-774" aria-hidden="true" tabindex="-1"></a><span class="in">#     `Metadata-Based Match` = ifelse(`Metadata-Based` == `Real Data`, "✅", "❌")</span></span>
<span id="cb98-775"><a href="#cb98-775" aria-hidden="true" tabindex="-1"></a><span class="in">#   )</span></span>
<span id="cb98-776"><a href="#cb98-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-777"><a href="#cb98-777" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-778"><a href="#cb98-778" aria-hidden="true" tabindex="-1"></a><span class="in">  missing_tbl_wide,</span></span>
<span id="cb98-779"><a href="#cb98-779" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Missingness Proportions by Variable (rounded to 2 d.p.)"</span></span>
<span id="cb98-780"><a href="#cb98-780" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-781"><a href="#cb98-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-782"><a href="#cb98-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-783"><a href="#cb98-783" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Missingness Maps</span></span>
<span id="cb98-784"><a href="#cb98-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-785"><a href="#cb98-785" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Missingness Maps, fig.width=14, fig.height=6, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-786"><a href="#cb98-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-787"><a href="#cb98-787" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate missingness map for the real dataset</span></span>
<span id="cb98-788"><a href="#cb98-788" aria-hidden="true" tabindex="-1"></a><span class="in">real_missing_map &lt;- aggr(heart_failure, col = c("#B0D99B", "#528AA8"),</span></span>
<span id="cb98-789"><a href="#cb98-789" aria-hidden="true" tabindex="-1"></a><span class="in">                             numbers = TRUE, sortVars = TRUE,</span></span>
<span id="cb98-790"><a href="#cb98-790" aria-hidden="true" tabindex="-1"></a><span class="in">                             labels = names(heart_failure), cex.axis = .7,</span></span>
<span id="cb98-791"><a href="#cb98-791" aria-hidden="true" tabindex="-1"></a><span class="in">                             gap = 3, ylab = c("Missing Data", "Pattern - real Dataset"))</span></span>
<span id="cb98-792"><a href="#cb98-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-793"><a href="#cb98-793" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate missingness map for Parametric MICE synthetic dataset</span></span>
<span id="cb98-794"><a href="#cb98-794" aria-hidden="true" tabindex="-1"></a><span class="in">parametric_mice_missing_map &lt;- aggr(syn_data_1, col = c("#B0D99B", "#528AA8"),</span></span>
<span id="cb98-795"><a href="#cb98-795" aria-hidden="true" tabindex="-1"></a><span class="in">                                    numbers = TRUE, sortVars = TRUE,</span></span>
<span id="cb98-796"><a href="#cb98-796" aria-hidden="true" tabindex="-1"></a><span class="in">                                    labels = names(syn_data_1), cex.axis = .7,</span></span>
<span id="cb98-797"><a href="#cb98-797" aria-hidden="true" tabindex="-1"></a><span class="in">                                    gap = 3, ylab = c("Missing Data", "Pattern - Parametric MICE Dataset"))</span></span>
<span id="cb98-798"><a href="#cb98-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-799"><a href="#cb98-799" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate missingness map for CART synthetic dataset</span></span>
<span id="cb98-800"><a href="#cb98-800" aria-hidden="true" tabindex="-1"></a><span class="in">cart_missing_map &lt;- aggr(syn_cart_1, col = c("#B0D99B", "#528AA8"),</span></span>
<span id="cb98-801"><a href="#cb98-801" aria-hidden="true" tabindex="-1"></a><span class="in">                         numbers = TRUE, sortVars = TRUE,</span></span>
<span id="cb98-802"><a href="#cb98-802" aria-hidden="true" tabindex="-1"></a><span class="in">                         labels = names(syn_cart_1), cex.axis = .7,</span></span>
<span id="cb98-803"><a href="#cb98-803" aria-hidden="true" tabindex="-1"></a><span class="in">                         gap = 3, ylab = c("Missing Data", "Pattern - CART Dataset"))</span></span>
<span id="cb98-804"><a href="#cb98-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-805"><a href="#cb98-805" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate missingness map for Synthpop synthetic dataset</span></span>
<span id="cb98-806"><a href="#cb98-806" aria-hidden="true" tabindex="-1"></a><span class="in">synthpop_missing_map &lt;- aggr(syn_data_low_fidelity_synthpop, col = c("#B0D99B", "#528AA8"),</span></span>
<span id="cb98-807"><a href="#cb98-807" aria-hidden="true" tabindex="-1"></a><span class="in">                             numbers = TRUE, sortVars = TRUE,</span></span>
<span id="cb98-808"><a href="#cb98-808" aria-hidden="true" tabindex="-1"></a><span class="in">                             labels = names(syn_data_low_fidelity_synthpop), cex.axis = .7,</span></span>
<span id="cb98-809"><a href="#cb98-809" aria-hidden="true" tabindex="-1"></a><span class="in">                             gap = 3, ylab = c("Missing Data", "Pattern - Synthpop Dataset"))</span></span>
<span id="cb98-810"><a href="#cb98-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-811"><a href="#cb98-811" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate missingness map for Metadata-based synthetic dataset</span></span>
<span id="cb98-812"><a href="#cb98-812" aria-hidden="true" tabindex="-1"></a><span class="in">metadata_missing_map &lt;- aggr(syn_data_metadata, col = c("#B0D99B", "#528AA8"),</span></span>
<span id="cb98-813"><a href="#cb98-813" aria-hidden="true" tabindex="-1"></a><span class="in">                             numbers = TRUE, sortVars = TRUE,</span></span>
<span id="cb98-814"><a href="#cb98-814" aria-hidden="true" tabindex="-1"></a><span class="in">                             labels = names(syn_data_metadata), cex.axis = .7,</span></span>
<span id="cb98-815"><a href="#cb98-815" aria-hidden="true" tabindex="-1"></a><span class="in">                             gap = 3, ylab = c("Missing Data", "Pattern - Metadata-Based Dataset"))</span></span>
<span id="cb98-816"><a href="#cb98-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-817"><a href="#cb98-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-818"><a href="#cb98-818" aria-hidden="true" tabindex="-1"></a><span class="fu">### Correlation Matrices Comparison</span></span>
<span id="cb98-819"><a href="#cb98-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-820"><a href="#cb98-820" aria-hidden="true" tabindex="-1"></a>In this section, we assess how well the correlations between numeric variables are preserved in the synthetic datasets compared to the real dataset. By comparing the correlation matrices, we evaluate whether the relationships between variables in the real data are reflected in the synthetic versions. This assessment is essential because maintaining the real data's correlation structure ensures that any statistical or machine learning models trained on synthetic data will behave similarly to those trained on real data.</span>
<span id="cb98-821"><a href="#cb98-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-822"><a href="#cb98-822" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Correlation Matrix**: A correlation matrix quantifies the strength and direction of relationships between pairs of numeric variables. Each cell in the matrix represents the correlation coefficient between two variables, which can range from -1 (perfect negative correlation) to +1 (perfect positive correlation). It is crucial that synthetic data retains these relationships to ensure that any analyses based on these dependencies remain valid.</span>
<span id="cb98-823"><a href="#cb98-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-824"><a href="#cb98-824" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Comparison Process**: The correlation matrices for both the real and synthetic datasets are computed and Visualised. Ideally, the structure and strength of correlations in the synthetic datasets should closely match those in the real dataset. Differences in correlation strength or direction indicate that the synthetic data may not fully capture the underlying relationships, which can affect the validity of any conclusions drawn from analyses using the synthetic data.</span>
<span id="cb98-825"><a href="#cb98-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-826"><a href="#cb98-826" aria-hidden="true" tabindex="-1"></a>Maintaining similar correlation structures is particularly important for use cases where relationships between variables play a crucial role, such as in predictive modeling, feature selection, and understanding variable dependencies. The following sections outline different methods used to compare correlation matrices between the real and synthetic datasets.</span>
<span id="cb98-827"><a href="#cb98-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-828"><a href="#cb98-828" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Correlation Matrices Comparison using psych</span></span>
<span id="cb98-829"><a href="#cb98-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-830"><a href="#cb98-830" aria-hidden="true" tabindex="-1"></a>The <span class="in">`psych`</span> package provides tools for analyzing and visualizing correlation matrices. The <span class="in">`corr.test()`</span> function is particularly useful for computing correlation coefficients while handling missing data and providing additional statistics, such as confidence intervals.</span>
<span id="cb98-831"><a href="#cb98-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-832"><a href="#cb98-832" aria-hidden="true" tabindex="-1"></a><span class="in">```{r correlation-matrices-comparison-table}</span></span>
<span id="cb98-833"><a href="#cb98-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-834"><a href="#cb98-834" aria-hidden="true" tabindex="-1"></a><span class="in"># Strip 'synth_' so names line up with real</span></span>
<span id="cb98-835"><a href="#cb98-835" aria-hidden="true" tabindex="-1"></a><span class="in">strip_synth_prefix &lt;- function(df) {</span></span>
<span id="cb98-836"><a href="#cb98-836" aria-hidden="true" tabindex="-1"></a><span class="in">  names(df) &lt;- sub("^synth_", "", names(df))</span></span>
<span id="cb98-837"><a href="#cb98-837" aria-hidden="true" tabindex="-1"></a><span class="in">  df</span></span>
<span id="cb98-838"><a href="#cb98-838" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-839"><a href="#cb98-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-840"><a href="#cb98-840" aria-hidden="true" tabindex="-1"></a><span class="in"># Build a tidy table of pairwise correlations for real vs one synthetic dataset</span></span>
<span id="cb98-841"><a href="#cb98-841" aria-hidden="true" tabindex="-1"></a><span class="in">corr_compare_one &lt;- function(real, synth, label) {</span></span>
<span id="cb98-842"><a href="#cb98-842" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- real |&gt; select(where(is.numeric))</span></span>
<span id="cb98-843"><a href="#cb98-843" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- synth |&gt; strip_synth_prefix() |&gt; select(where(is.numeric))</span></span>
<span id="cb98-844"><a href="#cb98-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-845"><a href="#cb98-845" aria-hidden="true" tabindex="-1"></a><span class="in">  common &lt;- intersect(names(real_num), names(synth_num))</span></span>
<span id="cb98-846"><a href="#cb98-846" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common) &lt; 2) {</span></span>
<span id="cb98-847"><a href="#cb98-847" aria-hidden="true" tabindex="-1"></a><span class="in">    return(tibble(Dataset = label, Var1 = character(), Var2 = character(),</span></span>
<span id="cb98-848"><a href="#cb98-848" aria-hidden="true" tabindex="-1"></a><span class="in">                  Real = numeric(), Synthetic = numeric(), Diff = numeric(), AbsDiff = numeric()))</span></span>
<span id="cb98-849"><a href="#cb98-849" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-850"><a href="#cb98-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-851"><a href="#cb98-851" aria-hidden="true" tabindex="-1"></a><span class="in">  # Compute Pearson correlations with pairwise complete observations</span></span>
<span id="cb98-852"><a href="#cb98-852" aria-hidden="true" tabindex="-1"></a><span class="in">  rc &lt;- cor(real_num[common],  use = "pairwise.complete.obs", method = "pearson")</span></span>
<span id="cb98-853"><a href="#cb98-853" aria-hidden="true" tabindex="-1"></a><span class="in">  sc &lt;- cor(synth_num[common], use = "pairwise.complete.obs", method = "pearson")</span></span>
<span id="cb98-854"><a href="#cb98-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-855"><a href="#cb98-855" aria-hidden="true" tabindex="-1"></a><span class="in">  # Keep only upper triangle (unique pairs)</span></span>
<span id="cb98-856"><a href="#cb98-856" aria-hidden="true" tabindex="-1"></a><span class="in">  ut &lt;- upper.tri(rc, diag = FALSE)</span></span>
<span id="cb98-857"><a href="#cb98-857" aria-hidden="true" tabindex="-1"></a><span class="in">  pairs &lt;- which(ut, arr.ind = TRUE)</span></span>
<span id="cb98-858"><a href="#cb98-858" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble(</span></span>
<span id="cb98-859"><a href="#cb98-859" aria-hidden="true" tabindex="-1"></a><span class="in">    Var1 = colnames(rc)[pairs[, 1]],</span></span>
<span id="cb98-860"><a href="#cb98-860" aria-hidden="true" tabindex="-1"></a><span class="in">    Var2 = colnames(rc)[pairs[, 2]],</span></span>
<span id="cb98-861"><a href="#cb98-861" aria-hidden="true" tabindex="-1"></a><span class="in">    Real = rc[pairs],</span></span>
<span id="cb98-862"><a href="#cb98-862" aria-hidden="true" tabindex="-1"></a><span class="in">    Synthetic = sc[pairs]</span></span>
<span id="cb98-863"><a href="#cb98-863" aria-hidden="true" tabindex="-1"></a><span class="in">  ) |&gt;</span></span>
<span id="cb98-864"><a href="#cb98-864" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(</span></span>
<span id="cb98-865"><a href="#cb98-865" aria-hidden="true" tabindex="-1"></a><span class="in">      Dataset = label,</span></span>
<span id="cb98-866"><a href="#cb98-866" aria-hidden="true" tabindex="-1"></a><span class="in">      Diff = Synthetic - Real,</span></span>
<span id="cb98-867"><a href="#cb98-867" aria-hidden="true" tabindex="-1"></a><span class="in">      AbsDiff = abs(Diff)</span></span>
<span id="cb98-868"><a href="#cb98-868" aria-hidden="true" tabindex="-1"></a><span class="in">    ) |&gt;</span></span>
<span id="cb98-869"><a href="#cb98-869" aria-hidden="true" tabindex="-1"></a><span class="in">    select(Dataset, Var1, Var2, Real, Synthetic, Diff, AbsDiff)</span></span>
<span id="cb98-870"><a href="#cb98-870" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-871"><a href="#cb98-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-872"><a href="#cb98-872" aria-hidden="true" tabindex="-1"></a><span class="in"># Build one combined table for all synthetic datasets</span></span>
<span id="cb98-873"><a href="#cb98-873" aria-hidden="true" tabindex="-1"></a><span class="in">corr_cmp_tbl &lt;- bind_rows(</span></span>
<span id="cb98-874"><a href="#cb98-874" aria-hidden="true" tabindex="-1"></a><span class="in">  corr_compare_one(heart_failure, syn_data_1, "Parametric MICE"),</span></span>
<span id="cb98-875"><a href="#cb98-875" aria-hidden="true" tabindex="-1"></a><span class="in">  corr_compare_one(heart_failure, syn_cart_1, "CART Imputation"),</span></span>
<span id="cb98-876"><a href="#cb98-876" aria-hidden="true" tabindex="-1"></a><span class="in">  corr_compare_one(heart_failure, syn_data_low_fidelity_synthpop, "Synthpop (Low Fidelity)"),</span></span>
<span id="cb98-877"><a href="#cb98-877" aria-hidden="true" tabindex="-1"></a><span class="in">  corr_compare_one(heart_failure, syn_data_metadata, "Metadata-Based")</span></span>
<span id="cb98-878"><a href="#cb98-878" aria-hidden="true" tabindex="-1"></a><span class="in">) |&gt;</span></span>
<span id="cb98-879"><a href="#cb98-879" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(Dataset, desc(AbsDiff)) |&gt;</span></span>
<span id="cb98-880"><a href="#cb98-880" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb98-881"><a href="#cb98-881" aria-hidden="true" tabindex="-1"></a><span class="in">    Real = round(Real, 2),</span></span>
<span id="cb98-882"><a href="#cb98-882" aria-hidden="true" tabindex="-1"></a><span class="in">    Synthetic = round(Synthetic, 2),</span></span>
<span id="cb98-883"><a href="#cb98-883" aria-hidden="true" tabindex="-1"></a><span class="in">    Diff = round(Diff, 2),</span></span>
<span id="cb98-884"><a href="#cb98-884" aria-hidden="true" tabindex="-1"></a><span class="in">    AbsDiff = round(AbsDiff, 2)</span></span>
<span id="cb98-885"><a href="#cb98-885" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-886"><a href="#cb98-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-887"><a href="#cb98-887" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-888"><a href="#cb98-888" aria-hidden="true" tabindex="-1"></a><span class="in">  corr_cmp_tbl,</span></span>
<span id="cb98-889"><a href="#cb98-889" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Pairwise Correlations: Real vs. Synthetic (sorted by largest absolute difference per dataset)",</span></span>
<span id="cb98-890"><a href="#cb98-890" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lllrrrr"</span></span>
<span id="cb98-891"><a href="#cb98-891" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-892"><a href="#cb98-892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-893"><a href="#cb98-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-894"><a href="#cb98-894" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Correlation Matrices Comparison using Corrplot</span></span>
<span id="cb98-895"><a href="#cb98-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-896"><a href="#cb98-896" aria-hidden="true" tabindex="-1"></a>The <span class="in">`corrplot`</span> package is widely used for visualizing correlation matrices. It provides a variety of options for customization, making it easy to identify patterns and relationships between variables. This method is particularly effective for visual comparisons because it highlights differences in correlation strength and direction.</span>
<span id="cb98-897"><a href="#cb98-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-898"><a href="#cb98-898" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Correlation Matrices Comparison using Corrplot, fig.width=14, fig.height=6, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-899"><a href="#cb98-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-900"><a href="#cb98-900" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove 'synth_' so names match the real dataset</span></span>
<span id="cb98-901"><a href="#cb98-901" aria-hidden="true" tabindex="-1"></a><span class="in">strip_synth_prefix &lt;- function(df) { names(df) &lt;- sub("^synth_", "", names(df)); df }</span></span>
<span id="cb98-902"><a href="#cb98-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-903"><a href="#cb98-903" aria-hidden="true" tabindex="-1"></a><span class="in"># Side-by-side correlation matrices (full width)</span></span>
<span id="cb98-904"><a href="#cb98-904" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices &lt;- function(real_data, synthetic_data, dataset_name) {</span></span>
<span id="cb98-905"><a href="#cb98-905" aria-hidden="true" tabindex="-1"></a><span class="in">  # Numeric-only</span></span>
<span id="cb98-906"><a href="#cb98-906" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- real_data[sapply(real_data, is.numeric)]</span></span>
<span id="cb98-907"><a href="#cb98-907" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- strip_synth_prefix(synthetic_data)[sapply(strip_synth_prefix(synthetic_data), is.numeric)]</span></span>
<span id="cb98-908"><a href="#cb98-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-909"><a href="#cb98-909" aria-hidden="true" tabindex="-1"></a><span class="in">  # Use common numeric variables in same order</span></span>
<span id="cb98-910"><a href="#cb98-910" aria-hidden="true" tabindex="-1"></a><span class="in">  common &lt;- intersect(names(real_num), names(synth_num))</span></span>
<span id="cb98-911"><a href="#cb98-911" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common) &lt; 2) {</span></span>
<span id="cb98-912"><a href="#cb98-912" aria-hidden="true" tabindex="-1"></a><span class="in">    message(dataset_name, ": fewer than 2 common numeric columns — skipping.")</span></span>
<span id="cb98-913"><a href="#cb98-913" aria-hidden="true" tabindex="-1"></a><span class="in">    return(invisible(NULL))</span></span>
<span id="cb98-914"><a href="#cb98-914" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-915"><a href="#cb98-915" aria-hidden="true" tabindex="-1"></a><span class="in">  real_corr  &lt;- cor(real_num[common],  use = "complete.obs")</span></span>
<span id="cb98-916"><a href="#cb98-916" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_corr &lt;- cor(synth_num[common], use = "complete.obs")</span></span>
<span id="cb98-917"><a href="#cb98-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-918"><a href="#cb98-918" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make two panels across the page</span></span>
<span id="cb98-919"><a href="#cb98-919" aria-hidden="true" tabindex="-1"></a><span class="in">  op &lt;- par(no.readonly = TRUE); on.exit(par(op), add = TRUE)</span></span>
<span id="cb98-920"><a href="#cb98-920" aria-hidden="true" tabindex="-1"></a><span class="in">  par(mfrow = c(1, 2), mar = c(4, 4, 4, 2))</span></span>
<span id="cb98-921"><a href="#cb98-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-922"><a href="#cb98-922" aria-hidden="true" tabindex="-1"></a><span class="in">  corrplot(real_corr,  tl.cex = 0.8, mar = c(0,0,2,0))</span></span>
<span id="cb98-923"><a href="#cb98-923" aria-hidden="true" tabindex="-1"></a><span class="in">  title(paste(dataset_name, "- Real Data"), line = 1)</span></span>
<span id="cb98-924"><a href="#cb98-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-925"><a href="#cb98-925" aria-hidden="true" tabindex="-1"></a><span class="in">  corrplot(synth_corr, tl.cex = 0.8, mar = c(0,0,2,0))</span></span>
<span id="cb98-926"><a href="#cb98-926" aria-hidden="true" tabindex="-1"></a><span class="in">  title(paste(dataset_name, "- Synthetic Data"), line = 1)</span></span>
<span id="cb98-927"><a href="#cb98-927" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-928"><a href="#cb98-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-929"><a href="#cb98-929" aria-hidden="true" tabindex="-1"></a><span class="in"># Run for each synthetic dataset</span></span>
<span id="cb98-930"><a href="#cb98-930" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices(heart_failure, syn_data_1, "Parametric MICE")</span></span>
<span id="cb98-931"><a href="#cb98-931" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices(heart_failure, syn_cart_1, "CART Imputation")</span></span>
<span id="cb98-932"><a href="#cb98-932" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices(heart_failure, syn_data_low_fidelity_synthpop, "Synthpop (Low Fidelity)")</span></span>
<span id="cb98-933"><a href="#cb98-933" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices(heart_failure, syn_data_metadata, "Metadata-Based")</span></span>
<span id="cb98-934"><a href="#cb98-934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-935"><a href="#cb98-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-936"><a href="#cb98-936" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Correlation Matrices Comparison using GGally</span></span>
<span id="cb98-937"><a href="#cb98-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-938"><a href="#cb98-938" aria-hidden="true" tabindex="-1"></a>The <span class="in">`GGally`</span> package extends <span class="in">`ggplot2`</span> to create pairwise visualizations, including correlation matrix plots. Using <span class="in">`ggpairs()`</span>, you can generate a matrix of scatterplots, histograms, and correlation coefficients, which provides a detailed view of the relationships between numeric variables in the real and synthetic datasets.</span>
<span id="cb98-939"><a href="#cb98-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-940"><a href="#cb98-940" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Correlation Matrices Comparison using GGally, fig.width=11, fig.height=11, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-941"><a href="#cb98-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-942"><a href="#cb98-942" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices_ggally &lt;- function(real_data, synthetic_data, dataset_name) {</span></span>
<span id="cb98-943"><a href="#cb98-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-944"><a href="#cb98-944" aria-hidden="true" tabindex="-1"></a><span class="in">  # Select only numeric columns from both datasets</span></span>
<span id="cb98-945"><a href="#cb98-945" aria-hidden="true" tabindex="-1"></a><span class="in">  real_numeric &lt;- real_data %&gt;% select(where(is.numeric))</span></span>
<span id="cb98-946"><a href="#cb98-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-947"><a href="#cb98-947" aria-hidden="true" tabindex="-1"></a><span class="in">  # Remove prefix 'synth_' from synthetic data column names</span></span>
<span id="cb98-948"><a href="#cb98-948" aria-hidden="true" tabindex="-1"></a><span class="in">  names(synthetic_data) &lt;- gsub("^synth_", "", names(synthetic_data))</span></span>
<span id="cb98-949"><a href="#cb98-949" aria-hidden="true" tabindex="-1"></a><span class="in">  synthetic_numeric &lt;- synthetic_data %&gt;% select(where(is.numeric))</span></span>
<span id="cb98-950"><a href="#cb98-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-951"><a href="#cb98-951" aria-hidden="true" tabindex="-1"></a><span class="in">  # Ensure that both datasets have the same columns</span></span>
<span id="cb98-952"><a href="#cb98-952" aria-hidden="true" tabindex="-1"></a><span class="in">  common_columns &lt;- intersect(names(real_numeric), names(synthetic_numeric))</span></span>
<span id="cb98-953"><a href="#cb98-953" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-954"><a href="#cb98-954" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common_columns) == 0) {</span></span>
<span id="cb98-955"><a href="#cb98-955" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("\nNo common numeric columns found for comparison in", dataset_name, "\n")</span></span>
<span id="cb98-956"><a href="#cb98-956" aria-hidden="true" tabindex="-1"></a><span class="in">    return()</span></span>
<span id="cb98-957"><a href="#cb98-957" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-958"><a href="#cb98-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-959"><a href="#cb98-959" aria-hidden="true" tabindex="-1"></a><span class="in">  real_numeric &lt;- real_numeric[, common_columns, drop = FALSE]</span></span>
<span id="cb98-960"><a href="#cb98-960" aria-hidden="true" tabindex="-1"></a><span class="in">  synthetic_numeric &lt;- synthetic_numeric[, common_columns, drop = FALSE]</span></span>
<span id="cb98-961"><a href="#cb98-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-962"><a href="#cb98-962" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add a column to differentiate between real and synthetic data</span></span>
<span id="cb98-963"><a href="#cb98-963" aria-hidden="true" tabindex="-1"></a><span class="in">  real_numeric$Dataset &lt;- "Real"</span></span>
<span id="cb98-964"><a href="#cb98-964" aria-hidden="true" tabindex="-1"></a><span class="in">  synthetic_numeric$Dataset &lt;- "Synth"</span></span>
<span id="cb98-965"><a href="#cb98-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-966"><a href="#cb98-966" aria-hidden="true" tabindex="-1"></a><span class="in">  # Combine the datasets</span></span>
<span id="cb98-967"><a href="#cb98-967" aria-hidden="true" tabindex="-1"></a><span class="in">  combined_data &lt;- rbind(real_numeric, synthetic_numeric)</span></span>
<span id="cb98-968"><a href="#cb98-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-969"><a href="#cb98-969" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create correlation matrix plot using GGally if there are valid columns to plot</span></span>
<span id="cb98-970"><a href="#cb98-970" aria-hidden="true" tabindex="-1"></a><span class="in">  if (ncol(combined_data) &gt; 1) {</span></span>
<span id="cb98-971"><a href="#cb98-971" aria-hidden="true" tabindex="-1"></a><span class="in">    p &lt;- ggpairs(</span></span>
<span id="cb98-972"><a href="#cb98-972" aria-hidden="true" tabindex="-1"></a><span class="in">      combined_data, </span></span>
<span id="cb98-973"><a href="#cb98-973" aria-hidden="true" tabindex="-1"></a><span class="in">      aes(color = Dataset, alpha = 0.5), </span></span>
<span id="cb98-974"><a href="#cb98-974" aria-hidden="true" tabindex="-1"></a><span class="in">      title = paste(dataset_name, "- Correlation Matrix Comparison"),</span></span>
<span id="cb98-975"><a href="#cb98-975" aria-hidden="true" tabindex="-1"></a><span class="in">      columns = 1:(ncol(combined_data) - 1),  # Exclude the 'Dataset' column from the plot</span></span>
<span id="cb98-976"><a href="#cb98-976" aria-hidden="true" tabindex="-1"></a><span class="in">      upper = list(continuous = wrap("cor", size = 3, alignPercent = 0.5)),  # Smaller correlation labels</span></span>
<span id="cb98-977"><a href="#cb98-977" aria-hidden="true" tabindex="-1"></a><span class="in">      lower = list(continuous = wrap("smooth", alpha = 0.4, size = 0.5)),  # Smoother plots for readability</span></span>
<span id="cb98-978"><a href="#cb98-978" aria-hidden="true" tabindex="-1"></a><span class="in">      diag = list(continuous = wrap("densityDiag", alpha = 0.5))  # Density plot with improved transparency</span></span>
<span id="cb98-979"><a href="#cb98-979" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb98-980"><a href="#cb98-980" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_minimal() +  # Use a cleaner theme</span></span>
<span id="cb98-981"><a href="#cb98-981" aria-hidden="true" tabindex="-1"></a><span class="in">      theme(</span></span>
<span id="cb98-982"><a href="#cb98-982" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(size = 8, face = "bold"),  # Smaller strip labels</span></span>
<span id="cb98-983"><a href="#cb98-983" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(angle = 45, hjust = 1, size = 7),  # Rotate x-axis labels for better readability</span></span>
<span id="cb98-984"><a href="#cb98-984" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y = element_text(size = 7),</span></span>
<span id="cb98-985"><a href="#cb98-985" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "top",  # Move legend to a better location</span></span>
<span id="cb98-986"><a href="#cb98-986" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.title = element_blank()  # Remove unnecessary legend title</span></span>
<span id="cb98-987"><a href="#cb98-987" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb98-988"><a href="#cb98-988" aria-hidden="true" tabindex="-1"></a><span class="in">    print(p)</span></span>
<span id="cb98-989"><a href="#cb98-989" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb98-990"><a href="#cb98-990" aria-hidden="true" tabindex="-1"></a><span class="in">    cat("\nNot enough numeric columns to generate a correlation matrix plot for", dataset_name, "\n")</span></span>
<span id="cb98-991"><a href="#cb98-991" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-992"><a href="#cb98-992" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-993"><a href="#cb98-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-994"><a href="#cb98-994" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply the function to each synthetic dataset</span></span>
<span id="cb98-995"><a href="#cb98-995" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices_ggally(heart_failure, syn_data_1, "Parametric MICE")</span></span>
<span id="cb98-996"><a href="#cb98-996" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices_ggally(heart_failure, syn_cart_1, "CART Imputation")</span></span>
<span id="cb98-997"><a href="#cb98-997" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices_ggally(heart_failure, syn_data_low_fidelity_synthpop, "Synthpop Low Fidelity")</span></span>
<span id="cb98-998"><a href="#cb98-998" aria-hidden="true" tabindex="-1"></a><span class="in">compare_correlation_matrices_ggally(heart_failure, syn_data_metadata, "Metadata-Based Synthetic Data")</span></span>
<span id="cb98-999"><a href="#cb98-999" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1000"><a href="#cb98-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1001"><a href="#cb98-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fidelity Assessment</span></span>
<span id="cb98-1002"><a href="#cb98-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1003"><a href="#cb98-1003" aria-hidden="true" tabindex="-1"></a><span class="fu">### Descriptive Statistics</span></span>
<span id="cb98-1004"><a href="#cb98-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1005"><a href="#cb98-1005" aria-hidden="true" tabindex="-1"></a>This section provides a comparative analysis of the descriptive statistics between the real dataset and the synthetic datasets generated using different methods.</span>
<span id="cb98-1006"><a href="#cb98-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1007"><a href="#cb98-1007" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Real Dataset</span></span>
<span id="cb98-1008"><a href="#cb98-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1009"><a href="#cb98-1009" aria-hidden="true" tabindex="-1"></a>The descriptive statistics for the real heart failure dataset include metrics such as mean, median, standard deviation, and range. This serves as the baseline for comparison with the synthetic datasets.</span>
<span id="cb98-1010"><a href="#cb98-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1011"><a href="#cb98-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Descriptive statistics for for the Real Dataset}</span></span>
<span id="cb98-1012"><a href="#cb98-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1013"><a href="#cb98-1013" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate descriptive stats</span></span>
<span id="cb98-1014"><a href="#cb98-1014" aria-hidden="true" tabindex="-1"></a><span class="in">desc_tbl &lt;- describe(heart_failure) %&gt;%</span></span>
<span id="cb98-1015"><a href="#cb98-1015" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame() %&gt;%</span></span>
<span id="cb98-1016"><a href="#cb98-1016" aria-hidden="true" tabindex="-1"></a><span class="in">  select(n, mean, sd, min, median, max) %&gt;%</span></span>
<span id="cb98-1017"><a href="#cb98-1017" aria-hidden="true" tabindex="-1"></a><span class="in">  round(2) %&gt;%</span></span>
<span id="cb98-1018"><a href="#cb98-1018" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble::rownames_to_column("Variable")</span></span>
<span id="cb98-1019"><a href="#cb98-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1020"><a href="#cb98-1020" aria-hidden="true" tabindex="-1"></a><span class="in"># Display as a neat table</span></span>
<span id="cb98-1021"><a href="#cb98-1021" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-1022"><a href="#cb98-1022" aria-hidden="true" tabindex="-1"></a><span class="in">  desc_tbl,</span></span>
<span id="cb98-1023"><a href="#cb98-1023" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Descriptive Statistics for the Heart Failure Dataset",</span></span>
<span id="cb98-1024"><a href="#cb98-1024" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrrrrrr"</span></span>
<span id="cb98-1025"><a href="#cb98-1025" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1026"><a href="#cb98-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1027"><a href="#cb98-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1028"><a href="#cb98-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Parametric Imputation (MICE)</span></span>
<span id="cb98-1029"><a href="#cb98-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1030"><a href="#cb98-1030" aria-hidden="true" tabindex="-1"></a>The synthetic data generated using the MICE framework is analyzed to compare its summary statistics with the real dataset. This will help evaluate how well the parametric method captures the key characteristics of the data.</span>
<span id="cb98-1031"><a href="#cb98-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1032"><a href="#cb98-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Descriptive statistics for parametric MICE dataset}</span></span>
<span id="cb98-1033"><a href="#cb98-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1034"><a href="#cb98-1034" aria-hidden="true" tabindex="-1"></a><span class="in"># Descriptive stats for Parametric MICE synthetic dataset</span></span>
<span id="cb98-1035"><a href="#cb98-1035" aria-hidden="true" tabindex="-1"></a><span class="in">desc_mice &lt;- describe(syn_data_1) %&gt;%</span></span>
<span id="cb98-1036"><a href="#cb98-1036" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame() %&gt;%</span></span>
<span id="cb98-1037"><a href="#cb98-1037" aria-hidden="true" tabindex="-1"></a><span class="in">  select(n, mean, sd, min, median, max) %&gt;%</span></span>
<span id="cb98-1038"><a href="#cb98-1038" aria-hidden="true" tabindex="-1"></a><span class="in">  round(2) %&gt;%</span></span>
<span id="cb98-1039"><a href="#cb98-1039" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble::rownames_to_column("Variable")</span></span>
<span id="cb98-1040"><a href="#cb98-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1041"><a href="#cb98-1041" aria-hidden="true" tabindex="-1"></a><span class="in"># Display table</span></span>
<span id="cb98-1042"><a href="#cb98-1042" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-1043"><a href="#cb98-1043" aria-hidden="true" tabindex="-1"></a><span class="in">  desc_mice,</span></span>
<span id="cb98-1044"><a href="#cb98-1044" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Descriptive Statistics for Parametric MICE Synthetic Dataset",</span></span>
<span id="cb98-1045"><a href="#cb98-1045" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrrrrrr"</span></span>
<span id="cb98-1046"><a href="#cb98-1046" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1047"><a href="#cb98-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1048"><a href="#cb98-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1049"><a href="#cb98-1049" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Non-Parametric Imputation (CART)</span></span>
<span id="cb98-1050"><a href="#cb98-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1051"><a href="#cb98-1051" aria-hidden="true" tabindex="-1"></a>The CART method is a non-parametric technique that handles non-linear relationships. The descriptive statistics of the CART-imputed synthetic data provide insight into how this method captures the dataset's distribution.</span>
<span id="cb98-1052"><a href="#cb98-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1053"><a href="#cb98-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Descriptive statistics for non-parametric CART dataset}</span></span>
<span id="cb98-1054"><a href="#cb98-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1055"><a href="#cb98-1055" aria-hidden="true" tabindex="-1"></a><span class="in"># Descriptive stats for CART synthetic dataset</span></span>
<span id="cb98-1056"><a href="#cb98-1056" aria-hidden="true" tabindex="-1"></a><span class="in">desc_cart &lt;- describe(syn_cart_1) %&gt;%</span></span>
<span id="cb98-1057"><a href="#cb98-1057" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame() %&gt;%</span></span>
<span id="cb98-1058"><a href="#cb98-1058" aria-hidden="true" tabindex="-1"></a><span class="in">  select(n, mean, sd, min, median, max) %&gt;%</span></span>
<span id="cb98-1059"><a href="#cb98-1059" aria-hidden="true" tabindex="-1"></a><span class="in">  round(2) %&gt;%</span></span>
<span id="cb98-1060"><a href="#cb98-1060" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble::rownames_to_column("Variable")</span></span>
<span id="cb98-1061"><a href="#cb98-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1062"><a href="#cb98-1062" aria-hidden="true" tabindex="-1"></a><span class="in"># Display table</span></span>
<span id="cb98-1063"><a href="#cb98-1063" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-1064"><a href="#cb98-1064" aria-hidden="true" tabindex="-1"></a><span class="in">  desc_cart,</span></span>
<span id="cb98-1065"><a href="#cb98-1065" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Descriptive Statistics for CART Synthetic Dataset",</span></span>
<span id="cb98-1066"><a href="#cb98-1066" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrrrrrr"</span></span>
<span id="cb98-1067"><a href="#cb98-1067" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1068"><a href="#cb98-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1069"><a href="#cb98-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1070"><a href="#cb98-1070" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Synthpop-Based Synthetic Data</span></span>
<span id="cb98-1071"><a href="#cb98-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1072"><a href="#cb98-1072" aria-hidden="true" tabindex="-1"></a>The Synthpop package generates synthetic data aimed at preserving data privacy. Descriptive statistics for this dataset help assess how well the key attributes of the real data are preserved.</span>
<span id="cb98-1073"><a href="#cb98-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1074"><a href="#cb98-1074" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Descriptive statistics for the synthpop dataset}</span></span>
<span id="cb98-1075"><a href="#cb98-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1076"><a href="#cb98-1076" aria-hidden="true" tabindex="-1"></a><span class="in"># Descriptive stats for Synthpop synthetic dataset</span></span>
<span id="cb98-1077"><a href="#cb98-1077" aria-hidden="true" tabindex="-1"></a><span class="in">desc_synthpop &lt;- describe(syn_data_low_fidelity_synthpop) %&gt;%</span></span>
<span id="cb98-1078"><a href="#cb98-1078" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame() %&gt;%</span></span>
<span id="cb98-1079"><a href="#cb98-1079" aria-hidden="true" tabindex="-1"></a><span class="in">  select(n, mean, sd, min, median, max) %&gt;%</span></span>
<span id="cb98-1080"><a href="#cb98-1080" aria-hidden="true" tabindex="-1"></a><span class="in">  round(2) %&gt;%</span></span>
<span id="cb98-1081"><a href="#cb98-1081" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble::rownames_to_column("Variable")</span></span>
<span id="cb98-1082"><a href="#cb98-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1083"><a href="#cb98-1083" aria-hidden="true" tabindex="-1"></a><span class="in"># Display as a clean table</span></span>
<span id="cb98-1084"><a href="#cb98-1084" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-1085"><a href="#cb98-1085" aria-hidden="true" tabindex="-1"></a><span class="in">  desc_synthpop,</span></span>
<span id="cb98-1086"><a href="#cb98-1086" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Descriptive Statistics for Synthpop Synthetic Dataset",</span></span>
<span id="cb98-1087"><a href="#cb98-1087" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrrrrrr"</span></span>
<span id="cb98-1088"><a href="#cb98-1088" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1089"><a href="#cb98-1089" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1090"><a href="#cb98-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1091"><a href="#cb98-1091" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Metadata-Based Synthetic Data</span></span>
<span id="cb98-1092"><a href="#cb98-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1093"><a href="#cb98-1093" aria-hidden="true" tabindex="-1"></a>The synthetic data generated using metadata ensures that variable structures conform to the data dictionary. The summary statistics here show how well the dataset reflects the real's attributes based on predefined metadata.</span>
<span id="cb98-1094"><a href="#cb98-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1095"><a href="#cb98-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Descriptive statistics for syn_data_metadata}</span></span>
<span id="cb98-1096"><a href="#cb98-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1097"><a href="#cb98-1097" aria-hidden="true" tabindex="-1"></a><span class="in"># Descriptive stats for Metadata-Based synthetic dataset</span></span>
<span id="cb98-1098"><a href="#cb98-1098" aria-hidden="true" tabindex="-1"></a><span class="in">desc_metadata &lt;- describe(syn_data_metadata) %&gt;%</span></span>
<span id="cb98-1099"><a href="#cb98-1099" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame() %&gt;%</span></span>
<span id="cb98-1100"><a href="#cb98-1100" aria-hidden="true" tabindex="-1"></a><span class="in">  select(n, mean, sd, min, median, max) %&gt;%</span></span>
<span id="cb98-1101"><a href="#cb98-1101" aria-hidden="true" tabindex="-1"></a><span class="in">  round(2) %&gt;%</span></span>
<span id="cb98-1102"><a href="#cb98-1102" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble::rownames_to_column("Variable")</span></span>
<span id="cb98-1103"><a href="#cb98-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1104"><a href="#cb98-1104" aria-hidden="true" tabindex="-1"></a><span class="in"># Display as a clean table</span></span>
<span id="cb98-1105"><a href="#cb98-1105" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-1106"><a href="#cb98-1106" aria-hidden="true" tabindex="-1"></a><span class="in">  desc_metadata,</span></span>
<span id="cb98-1107"><a href="#cb98-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Descriptive Statistics for Metadata-Based Synthetic Dataset",</span></span>
<span id="cb98-1108"><a href="#cb98-1108" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrrrrrr"</span></span>
<span id="cb98-1109"><a href="#cb98-1109" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1110"><a href="#cb98-1110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1111"><a href="#cb98-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1112"><a href="#cb98-1112" aria-hidden="true" tabindex="-1"></a>By comparing the descriptive statistics, you can evaluate how closely the synthetic datasets resemble the real dataset across key summary metrics. This is a critical step in assessing the quality and usability of synthetic data.</span>
<span id="cb98-1113"><a href="#cb98-1113" aria-hidden="true" tabindex="-1"></a>Histogram Similarity Score</span>
<span id="cb98-1114"><a href="#cb98-1114" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variable Exploration</span></span>
<span id="cb98-1115"><a href="#cb98-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1116"><a href="#cb98-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Parametric Imputation (MICE)</span></span>
<span id="cb98-1117"><a href="#cb98-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1118"><a href="#cb98-1118" aria-hidden="true" tabindex="-1"></a>The parametric imputation using the MICE framework generates synthetic data by imputing missing values based on multivariate normal distributions.</span>
<span id="cb98-1119"><a href="#cb98-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1120"><a href="#cb98-1120" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Bar Plots for Categorical Variables</span></span>
<span id="cb98-1121"><a href="#cb98-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1122"><a href="#cb98-1122" aria-hidden="true" tabindex="-1"></a>To evaluate the preservation of categorical variable distributions in the synthetic data, we generate bar plots comparing the proportions of categorical variables between the real and synthetic datasets.</span>
<span id="cb98-1123"><a href="#cb98-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1124"><a href="#cb98-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Bar Plots for Categorical Variables, fig.width=14, fig.height=6, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1125"><a href="#cb98-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1126"><a href="#cb98-1126" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine real and parametric MICE synthetic datasets</span></span>
<span id="cb98-1127"><a href="#cb98-1127" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$dataset &lt;- "real"</span></span>
<span id="cb98-1128"><a href="#cb98-1128" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_1$dataset &lt;- "synthetic"</span></span>
<span id="cb98-1129"><a href="#cb98-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1130"><a href="#cb98-1130" aria-hidden="true" tabindex="-1"></a><span class="in"># Adjust the column names for synthetic data by removing the 'synth_' prefix</span></span>
<span id="cb98-1131"><a href="#cb98-1131" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_data_1) &lt;- gsub("synth_", "", colnames(syn_data_1))</span></span>
<span id="cb98-1132"><a href="#cb98-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1133"><a href="#cb98-1133" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine both datasets (real and synthetic)</span></span>
<span id="cb98-1134"><a href="#cb98-1134" aria-hidden="true" tabindex="-1"></a><span class="in">combined_data_param &lt;- bind_rows(heart_failure, syn_data_1)</span></span>
<span id="cb98-1135"><a href="#cb98-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1136"><a href="#cb98-1136" aria-hidden="true" tabindex="-1"></a><span class="in"># Bar plots for categorical variables</span></span>
<span id="cb98-1137"><a href="#cb98-1137" aria-hidden="true" tabindex="-1"></a><span class="in">bar_plots &lt;- colnames(heart_failure)[map_lgl(heart_failure, is.factor)] %&gt;%</span></span>
<span id="cb98-1138"><a href="#cb98-1138" aria-hidden="true" tabindex="-1"></a><span class="in">  map(~ ggplot(combined_data_param, aes_string(.x, fill = 'dataset', group = 'dataset')) +</span></span>
<span id="cb98-1139"><a href="#cb98-1139" aria-hidden="true" tabindex="-1"></a><span class="in">        geom_bar(aes(y = ..prop..), position = position_dodge2(), stat = "count") +</span></span>
<span id="cb98-1140"><a href="#cb98-1140" aria-hidden="true" tabindex="-1"></a><span class="in">        scale_fill_manual(values = c("real" = "#B0D99B", "synthetic" = "#528AA8")) +</span></span>
<span id="cb98-1141"><a href="#cb98-1141" aria-hidden="true" tabindex="-1"></a><span class="in">        labs(x = .x, y = "Proportion")) %&gt;%</span></span>
<span id="cb98-1142"><a href="#cb98-1142" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork::wrap_plots() +</span></span>
<span id="cb98-1143"><a href="#cb98-1143" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Comparison of Categorical Variables Between real and Synthetic Datasets",</span></span>
<span id="cb98-1144"><a href="#cb98-1144" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme(plot.title = element_text(hjust = 0.5)))</span></span>
<span id="cb98-1145"><a href="#cb98-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1146"><a href="#cb98-1146" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the combined plot with one main title</span></span>
<span id="cb98-1147"><a href="#cb98-1147" aria-hidden="true" tabindex="-1"></a><span class="in">print(bar_plots)</span></span>
<span id="cb98-1148"><a href="#cb98-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1149"><a href="#cb98-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1150"><a href="#cb98-1150" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Density Plots for Numeric Variables</span></span>
<span id="cb98-1151"><a href="#cb98-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1152"><a href="#cb98-1152" aria-hidden="true" tabindex="-1"></a>The density plots illustrate the distribution of numeric variables between the real dataset and the parametric MICE synthetic data. The goal is to ensure that the synthetic data closely follows the real data’s numeric distribution.</span>
<span id="cb98-1153"><a href="#cb98-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1154"><a href="#cb98-1154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Density plots for numeric variables (parametric imputed data), fig.width=14, fig.height=10, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1155"><a href="#cb98-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1156"><a href="#cb98-1156" aria-hidden="true" tabindex="-1"></a><span class="in"># Density plots for numeric variables (parametric imputed data)</span></span>
<span id="cb98-1157"><a href="#cb98-1157" aria-hidden="true" tabindex="-1"></a><span class="in">density_plots_param &lt;- colnames(heart_failure)[map_lgl(heart_failure, is.numeric)] %&gt;%</span></span>
<span id="cb98-1158"><a href="#cb98-1158" aria-hidden="true" tabindex="-1"></a><span class="in">  map(~ ggplot(combined_data_param, aes_string(.x, fill = 'dataset', group = 'dataset')) +</span></span>
<span id="cb98-1159"><a href="#cb98-1159" aria-hidden="true" tabindex="-1"></a><span class="in">        geom_density(alpha = 0.5) +</span></span>
<span id="cb98-1160"><a href="#cb98-1160" aria-hidden="true" tabindex="-1"></a><span class="in">        scale_fill_manual(values = c("real" = "#B0D99B", "synthetic" = "#528AA8")) +</span></span>
<span id="cb98-1161"><a href="#cb98-1161" aria-hidden="true" tabindex="-1"></a><span class="in">        labs(x = .x, y = "Density")) %&gt;%</span></span>
<span id="cb98-1162"><a href="#cb98-1162" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork::wrap_plots(ncol = 2) +  # Arrange plots in 2 columns</span></span>
<span id="cb98-1163"><a href="#cb98-1163" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Comparison of Numeric Variables Between real and Parametric Synthetic Data",</span></span>
<span id="cb98-1164"><a href="#cb98-1164" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme(plot.title = element_text(hjust = 0.5)))</span></span>
<span id="cb98-1165"><a href="#cb98-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1166"><a href="#cb98-1166" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the combined density plots with one main title</span></span>
<span id="cb98-1167"><a href="#cb98-1167" aria-hidden="true" tabindex="-1"></a><span class="in">print(density_plots_param)</span></span>
<span id="cb98-1168"><a href="#cb98-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1169"><a href="#cb98-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1170"><a href="#cb98-1170" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Non-Parametric Imputation (CART)</span></span>
<span id="cb98-1171"><a href="#cb98-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1172"><a href="#cb98-1172" aria-hidden="true" tabindex="-1"></a>CART is a non-parametric approach for generating synthetic data that captures complex relationships between variables without making distributional assumptions.</span>
<span id="cb98-1173"><a href="#cb98-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1174"><a href="#cb98-1174" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Bar Plots for Categorical Variables</span></span>
<span id="cb98-1175"><a href="#cb98-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1176"><a href="#cb98-1176" aria-hidden="true" tabindex="-1"></a>The bar plots compare the distribution of categorical variables in the real and synthetic datasets generated using the CART method.</span>
<span id="cb98-1177"><a href="#cb98-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1178"><a href="#cb98-1178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Bar plots for categorical variables (CART-imputed data), fig.width=14, fig.height=6, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1179"><a href="#cb98-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1180"><a href="#cb98-1180" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine real and non-parametric CART synthetic datasets</span></span>
<span id="cb98-1181"><a href="#cb98-1181" aria-hidden="true" tabindex="-1"></a><span class="in">syn_cart_1$dataset &lt;- "synthetic"</span></span>
<span id="cb98-1182"><a href="#cb98-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1183"><a href="#cb98-1183" aria-hidden="true" tabindex="-1"></a><span class="in"># Adjust the column names for synthetic data by removing the 'synth_' prefix</span></span>
<span id="cb98-1184"><a href="#cb98-1184" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_cart_1) &lt;- gsub("synth_", "", colnames(syn_cart_1))</span></span>
<span id="cb98-1185"><a href="#cb98-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1186"><a href="#cb98-1186" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine both datasets (real and synthetic)</span></span>
<span id="cb98-1187"><a href="#cb98-1187" aria-hidden="true" tabindex="-1"></a><span class="in">combined_data_cart &lt;- bind_rows(heart_failure, syn_cart_1)</span></span>
<span id="cb98-1188"><a href="#cb98-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1189"><a href="#cb98-1189" aria-hidden="true" tabindex="-1"></a><span class="in"># Bar plots for categorical variables (CART-imputed data)</span></span>
<span id="cb98-1190"><a href="#cb98-1190" aria-hidden="true" tabindex="-1"></a><span class="in">bar_plots_cart &lt;- colnames(heart_failure)[map_lgl(heart_failure, is.factor)] %&gt;%</span></span>
<span id="cb98-1191"><a href="#cb98-1191" aria-hidden="true" tabindex="-1"></a><span class="in">  map(~ ggplot(combined_data_cart, aes_string(.x, fill = 'dataset', group = 'dataset')) +</span></span>
<span id="cb98-1192"><a href="#cb98-1192" aria-hidden="true" tabindex="-1"></a><span class="in">        geom_bar(aes(y = ..prop..), position = position_dodge2(), stat = "count") +</span></span>
<span id="cb98-1193"><a href="#cb98-1193" aria-hidden="true" tabindex="-1"></a><span class="in">        scale_fill_manual(values = c("real" = "#B0D99B", "synthetic" = "#528AA8")) +</span></span>
<span id="cb98-1194"><a href="#cb98-1194" aria-hidden="true" tabindex="-1"></a><span class="in">        labs(x = .x, y = "Proportion")) %&gt;%</span></span>
<span id="cb98-1195"><a href="#cb98-1195" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork::wrap_plots() +</span></span>
<span id="cb98-1196"><a href="#cb98-1196" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Comparison of Categorical Variables Between real and Synthetic Data",</span></span>
<span id="cb98-1197"><a href="#cb98-1197" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme(plot.title = element_text(hjust = 0.5)))</span></span>
<span id="cb98-1198"><a href="#cb98-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1199"><a href="#cb98-1199" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the combined plot with one main title</span></span>
<span id="cb98-1200"><a href="#cb98-1200" aria-hidden="true" tabindex="-1"></a><span class="in">print(bar_plots_cart)</span></span>
<span id="cb98-1201"><a href="#cb98-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1202"><a href="#cb98-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1203"><a href="#cb98-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Density Plots for Numeric Variables</span></span>
<span id="cb98-1204"><a href="#cb98-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1205"><a href="#cb98-1205" aria-hidden="true" tabindex="-1"></a>The density plots display how well the numeric variables in the CART-imputed synthetic data align with the real dataset.</span>
<span id="cb98-1206"><a href="#cb98-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1207"><a href="#cb98-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Density plots for numeric variables (CART-imputed data), fig.width=14, fig.height=10, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1208"><a href="#cb98-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1209"><a href="#cb98-1209" aria-hidden="true" tabindex="-1"></a><span class="in"># Density plots for numeric variables (CART-imputed data)</span></span>
<span id="cb98-1210"><a href="#cb98-1210" aria-hidden="true" tabindex="-1"></a><span class="in">density_plots_cart &lt;- colnames(heart_failure)[map_lgl(heart_failure, is.numeric)] %&gt;%</span></span>
<span id="cb98-1211"><a href="#cb98-1211" aria-hidden="true" tabindex="-1"></a><span class="in">  map(~ ggplot(combined_data_cart, aes_string(.x, fill = 'dataset', group = 'dataset')) +</span></span>
<span id="cb98-1212"><a href="#cb98-1212" aria-hidden="true" tabindex="-1"></a><span class="in">        geom_density(alpha = 0.5) +</span></span>
<span id="cb98-1213"><a href="#cb98-1213" aria-hidden="true" tabindex="-1"></a><span class="in">        scale_fill_manual(values = c("real" = "#B0D99B", "synthetic" = "#528AA8")) +</span></span>
<span id="cb98-1214"><a href="#cb98-1214" aria-hidden="true" tabindex="-1"></a><span class="in">        labs(x = .x, y = "Density")) %&gt;%</span></span>
<span id="cb98-1215"><a href="#cb98-1215" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork::wrap_plots(ncol = 2) +  # Arrange plots in 2 columns</span></span>
<span id="cb98-1216"><a href="#cb98-1216" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Comparison of Numeric Variables Between real and Synthetic Data",</span></span>
<span id="cb98-1217"><a href="#cb98-1217" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme(plot.title = element_text(hjust = 0.5)))</span></span>
<span id="cb98-1218"><a href="#cb98-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1219"><a href="#cb98-1219" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the combined density plots with one main title</span></span>
<span id="cb98-1220"><a href="#cb98-1220" aria-hidden="true" tabindex="-1"></a><span class="in">print(density_plots_cart)</span></span>
<span id="cb98-1221"><a href="#cb98-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1222"><a href="#cb98-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1223"><a href="#cb98-1223" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Synthpop-Based Synthetic Data</span></span>
<span id="cb98-1224"><a href="#cb98-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1225"><a href="#cb98-1225" aria-hidden="true" tabindex="-1"></a>Synthpop is used to generate synthetic datasets that closely follow the distributions of the real data for privacy-preserving data sharing.</span>
<span id="cb98-1226"><a href="#cb98-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1227"><a href="#cb98-1227" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Bar Plots for Categorical Variables</span></span>
<span id="cb98-1228"><a href="#cb98-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1229"><a href="#cb98-1229" aria-hidden="true" tabindex="-1"></a>These bar plots assess how well Synthpop-based synthetic data maintains the categorical distributions of the real dataset.</span>
<span id="cb98-1230"><a href="#cb98-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1231"><a href="#cb98-1231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Bar plots for categorical variables (Synthpop-based synthetic data), fig.width=14, fig.height=6, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1232"><a href="#cb98-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1233"><a href="#cb98-1233" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine real and Synthpop-based synthetic datasets</span></span>
<span id="cb98-1234"><a href="#cb98-1234" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$dataset &lt;- "real"</span></span>
<span id="cb98-1235"><a href="#cb98-1235" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_low_fidelity_synthpop$dataset &lt;- "synthetic"</span></span>
<span id="cb98-1236"><a href="#cb98-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1237"><a href="#cb98-1237" aria-hidden="true" tabindex="-1"></a><span class="in"># Adjust the column names for synthetic data by removing the 'synth_' prefix</span></span>
<span id="cb98-1238"><a href="#cb98-1238" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_data_low_fidelity_synthpop) &lt;- gsub("synth_", "", colnames(syn_data_low_fidelity_synthpop))</span></span>
<span id="cb98-1239"><a href="#cb98-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1240"><a href="#cb98-1240" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine both datasets (real and synthetic)</span></span>
<span id="cb98-1241"><a href="#cb98-1241" aria-hidden="true" tabindex="-1"></a><span class="in">combined_data_synthpop &lt;- bind_rows(heart_failure, syn_data_low_fidelity_synthpop)</span></span>
<span id="cb98-1242"><a href="#cb98-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1243"><a href="#cb98-1243" aria-hidden="true" tabindex="-1"></a><span class="in"># Bar plots for categorical variables (Synthpop-based synthetic data)</span></span>
<span id="cb98-1244"><a href="#cb98-1244" aria-hidden="true" tabindex="-1"></a><span class="in">bar_plots_synthpop &lt;- colnames(heart_failure)[map_lgl(heart_failure, is.factor)] %&gt;%</span></span>
<span id="cb98-1245"><a href="#cb98-1245" aria-hidden="true" tabindex="-1"></a><span class="in">  map(~ ggplot(combined_data_synthpop, aes_string(.x, fill = 'dataset', group = 'dataset')) +</span></span>
<span id="cb98-1246"><a href="#cb98-1246" aria-hidden="true" tabindex="-1"></a><span class="in">        geom_bar(aes(y = ..prop..), position = position_dodge2(), stat = "count") +</span></span>
<span id="cb98-1247"><a href="#cb98-1247" aria-hidden="true" tabindex="-1"></a><span class="in">        scale_fill_manual(values = c("real" = "#B0D99B", "synthetic" = "#528AA8")) +</span></span>
<span id="cb98-1248"><a href="#cb98-1248" aria-hidden="true" tabindex="-1"></a><span class="in">        labs(x = .x, y = "Proportion")) %&gt;%</span></span>
<span id="cb98-1249"><a href="#cb98-1249" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork::wrap_plots() +</span></span>
<span id="cb98-1250"><a href="#cb98-1250" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Comparison of Categorical Variables Between real and Synthetic Data",</span></span>
<span id="cb98-1251"><a href="#cb98-1251" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme(plot.title = element_text(hjust = 0.5)))</span></span>
<span id="cb98-1252"><a href="#cb98-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1253"><a href="#cb98-1253" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the combined plot with one main title</span></span>
<span id="cb98-1254"><a href="#cb98-1254" aria-hidden="true" tabindex="-1"></a><span class="in">print(bar_plots_synthpop)</span></span>
<span id="cb98-1255"><a href="#cb98-1255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1256"><a href="#cb98-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1257"><a href="#cb98-1257" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Density Plots for Numeric Variables</span></span>
<span id="cb98-1258"><a href="#cb98-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1259"><a href="#cb98-1259" aria-hidden="true" tabindex="-1"></a>The density plots illustrate how closely Synthpop-based synthetic data matches the real dataset for numeric variables.</span>
<span id="cb98-1260"><a href="#cb98-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1261"><a href="#cb98-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Density plots for numeric variables (Synthpop-based synthetic data), fig.width=14, fig.height=10, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1262"><a href="#cb98-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1263"><a href="#cb98-1263" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine real and Synthpop-based synthetic datasets</span></span>
<span id="cb98-1264"><a href="#cb98-1264" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$dataset &lt;- "real"</span></span>
<span id="cb98-1265"><a href="#cb98-1265" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_low_fidelity_synthpop$dataset &lt;- "synthetic"</span></span>
<span id="cb98-1266"><a href="#cb98-1266" aria-hidden="true" tabindex="-1"></a><span class="in">combined_data_synthpop &lt;- bind_rows(heart_failure, syn_data_low_fidelity_synthpop)</span></span>
<span id="cb98-1267"><a href="#cb98-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1268"><a href="#cb98-1268" aria-hidden="true" tabindex="-1"></a><span class="in"># Density plots for numeric variables (Synthpop-based synthetic data)</span></span>
<span id="cb98-1269"><a href="#cb98-1269" aria-hidden="true" tabindex="-1"></a><span class="in">density_plots_synthpop &lt;- colnames(heart_failure)[map_lgl(heart_failure, is.numeric)] %&gt;%</span></span>
<span id="cb98-1270"><a href="#cb98-1270" aria-hidden="true" tabindex="-1"></a><span class="in">  map(~ ggplot(combined_data_synthpop, aes_string(.x, fill = 'dataset', group = 'dataset')) +</span></span>
<span id="cb98-1271"><a href="#cb98-1271" aria-hidden="true" tabindex="-1"></a><span class="in">        geom_density(alpha = 0.5) +</span></span>
<span id="cb98-1272"><a href="#cb98-1272" aria-hidden="true" tabindex="-1"></a><span class="in">        scale_fill_manual(values = c("real" = "#B0D99B", "synthetic" = "#528AA8")) +</span></span>
<span id="cb98-1273"><a href="#cb98-1273" aria-hidden="true" tabindex="-1"></a><span class="in">        labs(x = .x, y = "Density")) %&gt;%</span></span>
<span id="cb98-1274"><a href="#cb98-1274" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork::wrap_plots(ncol = 2) +  # Arrange plots in 2 columns</span></span>
<span id="cb98-1275"><a href="#cb98-1275" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Comparison of Numeric Variables Between real and Synthetic Data",</span></span>
<span id="cb98-1276"><a href="#cb98-1276" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme(plot.title = element_text(hjust = 0.5)))</span></span>
<span id="cb98-1277"><a href="#cb98-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1278"><a href="#cb98-1278" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the combined density plots with one main title</span></span>
<span id="cb98-1279"><a href="#cb98-1279" aria-hidden="true" tabindex="-1"></a><span class="in">print(density_plots_synthpop)</span></span>
<span id="cb98-1280"><a href="#cb98-1280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1281"><a href="#cb98-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1282"><a href="#cb98-1282" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Metadata-Based Synthetic Data</span></span>
<span id="cb98-1283"><a href="#cb98-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1284"><a href="#cb98-1284" aria-hidden="true" tabindex="-1"></a>Metadata-based synthetic data generation uses a predefined data dictionary to ensure that the synthetic data follows the correct structure and distribution.</span>
<span id="cb98-1285"><a href="#cb98-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1286"><a href="#cb98-1286" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Bar Plots for Categorical Variables</span></span>
<span id="cb98-1287"><a href="#cb98-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1288"><a href="#cb98-1288" aria-hidden="true" tabindex="-1"></a>We compare the categorical variables of the real and metadata-based synthetic datasets to assess distributional alignment.</span>
<span id="cb98-1289"><a href="#cb98-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1290"><a href="#cb98-1290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Bar plots for categorical variables (Metadata-based synthetic data), fig.width=14, fig.height=6, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1291"><a href="#cb98-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1292"><a href="#cb98-1292" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine real and Metadata-based synthetic datasets</span></span>
<span id="cb98-1293"><a href="#cb98-1293" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$dataset &lt;- "real"</span></span>
<span id="cb98-1294"><a href="#cb98-1294" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_metadata$dataset &lt;- "synthetic"</span></span>
<span id="cb98-1295"><a href="#cb98-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1296"><a href="#cb98-1296" aria-hidden="true" tabindex="-1"></a><span class="in"># Adjust the column names for synthetic data by removing the 'synth_' prefix</span></span>
<span id="cb98-1297"><a href="#cb98-1297" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(syn_data_metadata) &lt;- gsub("synth_", "", colnames(syn_data_metadata))</span></span>
<span id="cb98-1298"><a href="#cb98-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1299"><a href="#cb98-1299" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine both datasets (real and synthetic)</span></span>
<span id="cb98-1300"><a href="#cb98-1300" aria-hidden="true" tabindex="-1"></a><span class="in">combined_data_metadata &lt;- bind_rows(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-1301"><a href="#cb98-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1302"><a href="#cb98-1302" aria-hidden="true" tabindex="-1"></a><span class="in"># Bar plots for categorical variables (Metadata-based synthetic data)</span></span>
<span id="cb98-1303"><a href="#cb98-1303" aria-hidden="true" tabindex="-1"></a><span class="in">bar_plots_metadata &lt;- colnames(heart_failure)[map_lgl(heart_failure, is.factor)] %&gt;%</span></span>
<span id="cb98-1304"><a href="#cb98-1304" aria-hidden="true" tabindex="-1"></a><span class="in">  map(~ ggplot(combined_data_metadata, aes_string(.x, fill = 'dataset', group = 'dataset')) +</span></span>
<span id="cb98-1305"><a href="#cb98-1305" aria-hidden="true" tabindex="-1"></a><span class="in">        geom_bar(aes(y = ..prop..), position = position_dodge2(), stat = "count") +</span></span>
<span id="cb98-1306"><a href="#cb98-1306" aria-hidden="true" tabindex="-1"></a><span class="in">        scale_fill_manual(values = c("real" = "#B0D99B", "synthetic" = "#528AA8")) +</span></span>
<span id="cb98-1307"><a href="#cb98-1307" aria-hidden="true" tabindex="-1"></a><span class="in">        labs(x = .x, y = "Proportion")) %&gt;%</span></span>
<span id="cb98-1308"><a href="#cb98-1308" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork::wrap_plots() +</span></span>
<span id="cb98-1309"><a href="#cb98-1309" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Comparison of Categorical Variables Between real and Synthetic Datasets",</span></span>
<span id="cb98-1310"><a href="#cb98-1310" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme(plot.title = element_text(hjust = 0.5)))</span></span>
<span id="cb98-1311"><a href="#cb98-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1312"><a href="#cb98-1312" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the combined plot with one main title</span></span>
<span id="cb98-1313"><a href="#cb98-1313" aria-hidden="true" tabindex="-1"></a><span class="in">print(bar_plots_metadata)</span></span>
<span id="cb98-1314"><a href="#cb98-1314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1315"><a href="#cb98-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1316"><a href="#cb98-1316" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Density Plots for Numeric Variables</span></span>
<span id="cb98-1317"><a href="#cb98-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1318"><a href="#cb98-1318" aria-hidden="true" tabindex="-1"></a>The density plots for numeric variables compare the distribution of numeric values between the real and metadata-based synthetic datasets.</span>
<span id="cb98-1319"><a href="#cb98-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1320"><a href="#cb98-1320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Density Plots for Numeric Variables, fig.width=14, fig.height=10, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1321"><a href="#cb98-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1322"><a href="#cb98-1322" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine real and Metadata-based synthetic datasets</span></span>
<span id="cb98-1323"><a href="#cb98-1323" aria-hidden="true" tabindex="-1"></a><span class="in">heart_failure$dataset &lt;- "real"</span></span>
<span id="cb98-1324"><a href="#cb98-1324" aria-hidden="true" tabindex="-1"></a><span class="in">syn_data_metadata$dataset &lt;- "synthetic"</span></span>
<span id="cb98-1325"><a href="#cb98-1325" aria-hidden="true" tabindex="-1"></a><span class="in">combined_data_metadata &lt;- bind_rows(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-1326"><a href="#cb98-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1327"><a href="#cb98-1327" aria-hidden="true" tabindex="-1"></a><span class="in"># Density plots for numeric variables (Metadata-based synthetic data)</span></span>
<span id="cb98-1328"><a href="#cb98-1328" aria-hidden="true" tabindex="-1"></a><span class="in">density_plots_metadata &lt;- colnames(heart_failure)[map_lgl(heart_failure, is.numeric)] %&gt;%</span></span>
<span id="cb98-1329"><a href="#cb98-1329" aria-hidden="true" tabindex="-1"></a><span class="in">  map(~ ggplot(combined_data_metadata, aes_string(.x, fill = 'dataset', group = 'dataset')) +</span></span>
<span id="cb98-1330"><a href="#cb98-1330" aria-hidden="true" tabindex="-1"></a><span class="in">        geom_density(alpha = 0.5) +</span></span>
<span id="cb98-1331"><a href="#cb98-1331" aria-hidden="true" tabindex="-1"></a><span class="in">        scale_fill_manual(values = c("real" = "#B0D99B", "synthetic" = "#528AA8")) +</span></span>
<span id="cb98-1332"><a href="#cb98-1332" aria-hidden="true" tabindex="-1"></a><span class="in">        labs(x = .x, y = "Density")) %&gt;%</span></span>
<span id="cb98-1333"><a href="#cb98-1333" aria-hidden="true" tabindex="-1"></a><span class="in">  patchwork::wrap_plots(ncol = 2) +  # Arrange plots in 2 columns</span></span>
<span id="cb98-1334"><a href="#cb98-1334" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Comparison of Numeric Variables Between real and Synthetic Data",</span></span>
<span id="cb98-1335"><a href="#cb98-1335" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme(plot.title = element_text(hjust = 0.5)))</span></span>
<span id="cb98-1336"><a href="#cb98-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1337"><a href="#cb98-1337" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the combined density plots with one main title</span></span>
<span id="cb98-1338"><a href="#cb98-1338" aria-hidden="true" tabindex="-1"></a><span class="in">print(density_plots_metadata)</span></span>
<span id="cb98-1339"><a href="#cb98-1339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1340"><a href="#cb98-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1341"><a href="#cb98-1341" aria-hidden="true" tabindex="-1"></a><span class="fu">### Histogram Similarity Score</span></span>
<span id="cb98-1342"><a href="#cb98-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1343"><a href="#cb98-1343" aria-hidden="true" tabindex="-1"></a>The Histogram Similarity Score measures how closely the marginal distributions of the synthetic data match the real data. Marginal distributions are critical for assessing whether key data characteristics such as spread, central tendency (mean/median), and shape (skewness/kurtosis) are preserved.</span>
<span id="cb98-1344"><a href="#cb98-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1345"><a href="#cb98-1345" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for Histogram Similarity:</span>
<span id="cb98-1346"><a href="#cb98-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1347"><a href="#cb98-1347" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Perfect Match:** 1 (100%) indicates a perfect match between the distributions.</span>
<span id="cb98-1348"><a href="#cb98-1348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Good Match:** 0.85–1 (85% to 100%) shows strong similarity.</span>
<span id="cb98-1349"><a href="#cb98-1349" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Moderate Match:** 0.65–0.85 suggests some differences that may need addressing.</span>
<span id="cb98-1350"><a href="#cb98-1350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Poor Match:** Below 0.65 indicates significant deviation from the real data.</span>
<span id="cb98-1351"><a href="#cb98-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1352"><a href="#cb98-1352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r histogram-similarity-score, fig.width=10, fig.height=4, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1353"><a href="#cb98-1353" aria-hidden="true" tabindex="-1"></a><span class="in"># Custom palette for datasets</span></span>
<span id="cb98-1354"><a href="#cb98-1354" aria-hidden="true" tabindex="-1"></a><span class="in">dataset_palette &lt;- c(</span></span>
<span id="cb98-1355"><a href="#cb98-1355" aria-hidden="true" tabindex="-1"></a><span class="in">  "Parametric MICE"       = "#B0D99B",</span></span>
<span id="cb98-1356"><a href="#cb98-1356" aria-hidden="true" tabindex="-1"></a><span class="in">  "CART Imputation"       = "#528AA8",</span></span>
<span id="cb98-1357"><a href="#cb98-1357" aria-hidden="true" tabindex="-1"></a><span class="in">  "Synthpop (Low Fidelity)" = "#FFB6DB",</span></span>
<span id="cb98-1358"><a href="#cb98-1358" aria-hidden="true" tabindex="-1"></a><span class="in">  "Metadata-Based"        = "#264653"</span></span>
<span id="cb98-1359"><a href="#cb98-1359" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1360"><a href="#cb98-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1361"><a href="#cb98-1361" aria-hidden="true" tabindex="-1"></a><span class="in"># Define function once</span></span>
<span id="cb98-1362"><a href="#cb98-1362" aria-hidden="true" tabindex="-1"></a><span class="in">calculate_histogram_similarity &lt;- function(real_data, synthetic_data) {</span></span>
<span id="cb98-1363"><a href="#cb98-1363" aria-hidden="true" tabindex="-1"></a><span class="in">  real_numeric &lt;- real_data[sapply(real_data, is.numeric)]</span></span>
<span id="cb98-1364"><a href="#cb98-1364" aria-hidden="true" tabindex="-1"></a><span class="in">  synthetic_numeric &lt;- synthetic_data[sapply(synthetic_data, is.numeric)]</span></span>
<span id="cb98-1365"><a href="#cb98-1365" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-1366"><a href="#cb98-1366" aria-hidden="true" tabindex="-1"></a><span class="in">  similarity_scores &lt;- sapply(names(real_numeric), function(var) {</span></span>
<span id="cb98-1367"><a href="#cb98-1367" aria-hidden="true" tabindex="-1"></a><span class="in">    real_hist &lt;- hist(real_numeric[[var]], plot = FALSE)</span></span>
<span id="cb98-1368"><a href="#cb98-1368" aria-hidden="true" tabindex="-1"></a><span class="in">    synthetic_hist &lt;- hist(synthetic_numeric[[var]], plot = FALSE)</span></span>
<span id="cb98-1369"><a href="#cb98-1369" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb98-1370"><a href="#cb98-1370" aria-hidden="true" tabindex="-1"></a><span class="in">    # Wasserstein distance between histogram midpoints</span></span>
<span id="cb98-1371"><a href="#cb98-1371" aria-hidden="true" tabindex="-1"></a><span class="in">    wasserstein_distance &lt;- transport::wasserstein1d(real_hist$mids, synthetic_hist$mids)</span></span>
<span id="cb98-1372"><a href="#cb98-1372" aria-hidden="true" tabindex="-1"></a><span class="in">    1 / (1 + wasserstein_distance)  # similarity score</span></span>
<span id="cb98-1373"><a href="#cb98-1373" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb98-1374"><a href="#cb98-1374" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-1375"><a href="#cb98-1375" aria-hidden="true" tabindex="-1"></a><span class="in">  mean(similarity_scores)</span></span>
<span id="cb98-1376"><a href="#cb98-1376" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1377"><a href="#cb98-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1378"><a href="#cb98-1378" aria-hidden="true" tabindex="-1"></a><span class="in"># Collect results in a tibble (convert to percentages)</span></span>
<span id="cb98-1379"><a href="#cb98-1379" aria-hidden="true" tabindex="-1"></a><span class="in">hist_sim_tbl &lt;- tibble::tibble(</span></span>
<span id="cb98-1380"><a href="#cb98-1380" aria-hidden="true" tabindex="-1"></a><span class="in">  Dataset = c("Parametric MICE", "CART Imputation", "Synthpop (Low Fidelity)", "Metadata-Based"),</span></span>
<span id="cb98-1381"><a href="#cb98-1381" aria-hidden="true" tabindex="-1"></a><span class="in">  Histogram_Similarity = c(</span></span>
<span id="cb98-1382"><a href="#cb98-1382" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_histogram_similarity(heart_failure, syn_data_1),</span></span>
<span id="cb98-1383"><a href="#cb98-1383" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_histogram_similarity(heart_failure, syn_cart_1),</span></span>
<span id="cb98-1384"><a href="#cb98-1384" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_histogram_similarity(heart_failure, syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-1385"><a href="#cb98-1385" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_histogram_similarity(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-1386"><a href="#cb98-1386" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1387"><a href="#cb98-1387" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-1388"><a href="#cb98-1388" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Histogram_Similarity = round(Histogram_Similarity * 100, 1))  # percentage</span></span>
<span id="cb98-1389"><a href="#cb98-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1390"><a href="#cb98-1390" aria-hidden="true" tabindex="-1"></a><span class="in"># Display as table</span></span>
<span id="cb98-1391"><a href="#cb98-1391" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-1392"><a href="#cb98-1392" aria-hidden="true" tabindex="-1"></a><span class="in">  hist_sim_tbl,</span></span>
<span id="cb98-1393"><a href="#cb98-1393" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Histogram Similarity Scores (%): higher = more similar to real data",</span></span>
<span id="cb98-1394"><a href="#cb98-1394" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lr"</span></span>
<span id="cb98-1395"><a href="#cb98-1395" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1396"><a href="#cb98-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1397"><a href="#cb98-1397" aria-hidden="true" tabindex="-1"></a><span class="in"># Horizontal bar chart with custom colours</span></span>
<span id="cb98-1398"><a href="#cb98-1398" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(hist_sim_tbl, aes(y = Dataset, x = Histogram_Similarity, fill = Dataset)) +</span></span>
<span id="cb98-1399"><a href="#cb98-1399" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-1400"><a href="#cb98-1400" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label = paste0(Histogram_Similarity, "%")), </span></span>
<span id="cb98-1401"><a href="#cb98-1401" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = -0.1, size = 3.3) +</span></span>
<span id="cb98-1402"><a href="#cb98-1402" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = dataset_palette) +</span></span>
<span id="cb98-1403"><a href="#cb98-1403" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 100)) +</span></span>
<span id="cb98-1404"><a href="#cb98-1404" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb98-1405"><a href="#cb98-1405" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Histogram Similarity by Synthetic Method",</span></span>
<span id="cb98-1406"><a href="#cb98-1406" aria-hidden="true" tabindex="-1"></a><span class="in">    subtitle = "Based on Wasserstein distance of variable histograms",</span></span>
<span id="cb98-1407"><a href="#cb98-1407" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Similarity (%)", y = NULL</span></span>
<span id="cb98-1408"><a href="#cb98-1408" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb98-1409"><a href="#cb98-1409" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb98-1410"><a href="#cb98-1410" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_text(size = 10))</span></span>
<span id="cb98-1411"><a href="#cb98-1411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1412"><a href="#cb98-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1413"><a href="#cb98-1413" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mutual Information Score</span></span>
<span id="cb98-1414"><a href="#cb98-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1415"><a href="#cb98-1415" aria-hidden="true" tabindex="-1"></a>The Mutual Information (MI) Score measures the shared information between pairs of features in the real and synthetic datasets, assessing how well relationships between variables are preserved.</span>
<span id="cb98-1416"><a href="#cb98-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1417"><a href="#cb98-1417" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for Mutual Information:</span>
<span id="cb98-1418"><a href="#cb98-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1419"><a href="#cb98-1419" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Perfect Alignment:** MI scores for synthetic data should ideally match the real within 10-20% for critical feature pairs.</span>
<span id="cb98-1420"><a href="#cb98-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Lower MI:** Consistently lower MI scores suggest that noise has been added, weakening relationships.</span>
<span id="cb98-1421"><a href="#cb98-1421" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Overfitting Risk:** Higher MI scores than the real may indicate overfitting, increasing re-identification risk.</span>
<span id="cb98-1422"><a href="#cb98-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1423"><a href="#cb98-1423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mutual-information-score, fig.width=10, fig.height=4, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1424"><a href="#cb98-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1425"><a href="#cb98-1425" aria-hidden="true" tabindex="-1"></a><span class="in"># Custom palette for datasets</span></span>
<span id="cb98-1426"><a href="#cb98-1426" aria-hidden="true" tabindex="-1"></a><span class="in">dataset_palette &lt;- c(</span></span>
<span id="cb98-1427"><a href="#cb98-1427" aria-hidden="true" tabindex="-1"></a><span class="in">  "Parametric MICE"         = "#B0D99B",</span></span>
<span id="cb98-1428"><a href="#cb98-1428" aria-hidden="true" tabindex="-1"></a><span class="in">  "CART Imputation"         = "#528AA8",</span></span>
<span id="cb98-1429"><a href="#cb98-1429" aria-hidden="true" tabindex="-1"></a><span class="in">  "Synthpop (Low Fidelity)" = "#FFB6DB",</span></span>
<span id="cb98-1430"><a href="#cb98-1430" aria-hidden="true" tabindex="-1"></a><span class="in">  "Metadata-Based"          = "#264653"</span></span>
<span id="cb98-1431"><a href="#cb98-1431" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1432"><a href="#cb98-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1433"><a href="#cb98-1433" aria-hidden="true" tabindex="-1"></a><span class="in"># ------- Helpers -------</span></span>
<span id="cb98-1434"><a href="#cb98-1434" aria-hidden="true" tabindex="-1"></a><span class="in"># Strip 'synth_' so variable names align with the real dataset</span></span>
<span id="cb98-1435"><a href="#cb98-1435" aria-hidden="true" tabindex="-1"></a><span class="in">strip_synth_prefix &lt;- function(df) {</span></span>
<span id="cb98-1436"><a href="#cb98-1436" aria-hidden="true" tabindex="-1"></a><span class="in">  names(df) &lt;- sub("^synth_", "", names(df))</span></span>
<span id="cb98-1437"><a href="#cb98-1437" aria-hidden="true" tabindex="-1"></a><span class="in">  df</span></span>
<span id="cb98-1438"><a href="#cb98-1438" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1439"><a href="#cb98-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1440"><a href="#cb98-1440" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute pairwise MI matrix for a data.frame of discretized columns</span></span>
<span id="cb98-1441"><a href="#cb98-1441" aria-hidden="true" tabindex="-1"></a><span class="in">compute_mi_matrix &lt;- function(df_disc) {</span></span>
<span id="cb98-1442"><a href="#cb98-1442" aria-hidden="true" tabindex="-1"></a><span class="in">  p &lt;- ncol(df_disc)</span></span>
<span id="cb98-1443"><a href="#cb98-1443" aria-hidden="true" tabindex="-1"></a><span class="in">  if (p &lt; 2) return(matrix(numeric(0), nrow = p, ncol = p,</span></span>
<span id="cb98-1444"><a href="#cb98-1444" aria-hidden="true" tabindex="-1"></a><span class="in">                           dimnames = list(colnames(df_disc), colnames(df_disc))))</span></span>
<span id="cb98-1445"><a href="#cb98-1445" aria-hidden="true" tabindex="-1"></a><span class="in">  M &lt;- matrix(0, nrow = p, ncol = p,</span></span>
<span id="cb98-1446"><a href="#cb98-1446" aria-hidden="true" tabindex="-1"></a><span class="in">              dimnames = list(colnames(df_disc), colnames(df_disc)))</span></span>
<span id="cb98-1447"><a href="#cb98-1447" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in seq_len(p)) {</span></span>
<span id="cb98-1448"><a href="#cb98-1448" aria-hidden="true" tabindex="-1"></a><span class="in">    for (j in i:p) {</span></span>
<span id="cb98-1449"><a href="#cb98-1449" aria-hidden="true" tabindex="-1"></a><span class="in">      # safe MI (skip NA rows; zero if not enough variation)</span></span>
<span id="cb98-1450"><a href="#cb98-1450" aria-hidden="true" tabindex="-1"></a><span class="in">      ok &lt;- is.finite(df_disc[[i]]) &amp; is.finite(df_disc[[j]])</span></span>
<span id="cb98-1451"><a href="#cb98-1451" aria-hidden="true" tabindex="-1"></a><span class="in">      xi &lt;- df_disc[[i]][ok]; xj &lt;- df_disc[[j]][ok]</span></span>
<span id="cb98-1452"><a href="#cb98-1452" aria-hidden="true" tabindex="-1"></a><span class="in">      mi &lt;- if (length(unique(xi)) &lt; 2 || length(unique(xj)) &lt; 2) 0 else</span></span>
<span id="cb98-1453"><a href="#cb98-1453" aria-hidden="true" tabindex="-1"></a><span class="in">        suppressWarnings(infotheo::mutinformation(xi, xj))</span></span>
<span id="cb98-1454"><a href="#cb98-1454" aria-hidden="true" tabindex="-1"></a><span class="in">      M[i, j] &lt;- mi</span></span>
<span id="cb98-1455"><a href="#cb98-1455" aria-hidden="true" tabindex="-1"></a><span class="in">      M[j, i] &lt;- mi</span></span>
<span id="cb98-1456"><a href="#cb98-1456" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb98-1457"><a href="#cb98-1457" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-1458"><a href="#cb98-1458" aria-hidden="true" tabindex="-1"></a><span class="in">  M</span></span>
<span id="cb98-1459"><a href="#cb98-1459" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1460"><a href="#cb98-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1461"><a href="#cb98-1461" aria-hidden="true" tabindex="-1"></a><span class="in"># Compare two MI matrices (upper triangle only) -&gt; 0–1 similarity score (higher = closer)</span></span>
<span id="cb98-1462"><a href="#cb98-1462" aria-hidden="true" tabindex="-1"></a><span class="in">mi_similarity_score &lt;- function(M_real, M_synth) {</span></span>
<span id="cb98-1463"><a href="#cb98-1463" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(M_real) == 0 || length(M_synth) == 0) return(NA_real_)</span></span>
<span id="cb98-1464"><a href="#cb98-1464" aria-hidden="true" tabindex="-1"></a><span class="in">  common &lt;- intersect(colnames(M_real), colnames(M_synth))</span></span>
<span id="cb98-1465"><a href="#cb98-1465" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common) &lt; 2) return(NA_real_)</span></span>
<span id="cb98-1466"><a href="#cb98-1466" aria-hidden="true" tabindex="-1"></a><span class="in">  R &lt;- M_real[common, common, drop = FALSE]</span></span>
<span id="cb98-1467"><a href="#cb98-1467" aria-hidden="true" tabindex="-1"></a><span class="in">  S &lt;- M_synth[common, common, drop = FALSE]</span></span>
<span id="cb98-1468"><a href="#cb98-1468" aria-hidden="true" tabindex="-1"></a><span class="in">  ut &lt;- upper.tri(R, diag = FALSE)</span></span>
<span id="cb98-1469"><a href="#cb98-1469" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_abs_diff &lt;- mean(abs(R[ut] - S[ut]))</span></span>
<span id="cb98-1470"><a href="#cb98-1470" aria-hidden="true" tabindex="-1"></a><span class="in">  1 / (1 + mean_abs_diff)</span></span>
<span id="cb98-1471"><a href="#cb98-1471" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1472"><a href="#cb98-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1473"><a href="#cb98-1473" aria-hidden="true" tabindex="-1"></a><span class="in"># Discretize numeric columns (equal-frequency bins); keep only shared numeric vars</span></span>
<span id="cb98-1474"><a href="#cb98-1474" aria-hidden="true" tabindex="-1"></a><span class="in">Mutual_Information &lt;- function(real_df, synth_df, nbins = 10) {</span></span>
<span id="cb98-1475"><a href="#cb98-1475" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- dplyr::select(real_df,  where(is.numeric))</span></span>
<span id="cb98-1476"><a href="#cb98-1476" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- strip_synth_prefix(synth_df) |&gt; dplyr::select(where(is.numeric))</span></span>
<span id="cb98-1477"><a href="#cb98-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1478"><a href="#cb98-1478" aria-hidden="true" tabindex="-1"></a><span class="in">  common &lt;- intersect(names(real_num), names(synth_num))</span></span>
<span id="cb98-1479"><a href="#cb98-1479" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common) &lt; 2) return(NA_real_)</span></span>
<span id="cb98-1480"><a href="#cb98-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1481"><a href="#cb98-1481" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- real_num[common]</span></span>
<span id="cb98-1482"><a href="#cb98-1482" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- synth_num[common]</span></span>
<span id="cb98-1483"><a href="#cb98-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1484"><a href="#cb98-1484" aria-hidden="true" tabindex="-1"></a><span class="in">  # Discretize numerics (returns integer codes)</span></span>
<span id="cb98-1485"><a href="#cb98-1485" aria-hidden="true" tabindex="-1"></a><span class="in">  real_disc  &lt;- as.data.frame(lapply(real_num,  \(x) infotheo::discretize(x, disc = "equalfreq", nbins = nbins)))</span></span>
<span id="cb98-1486"><a href="#cb98-1486" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_disc &lt;- as.data.frame(lapply(synth_num, \(x) infotheo::discretize(x, disc = "equalfreq", nbins = nbins)))</span></span>
<span id="cb98-1487"><a href="#cb98-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1488"><a href="#cb98-1488" aria-hidden="true" tabindex="-1"></a><span class="in">  # MI matrices and similarity score</span></span>
<span id="cb98-1489"><a href="#cb98-1489" aria-hidden="true" tabindex="-1"></a><span class="in">  M_real  &lt;- compute_mi_matrix(real_disc)</span></span>
<span id="cb98-1490"><a href="#cb98-1490" aria-hidden="true" tabindex="-1"></a><span class="in">  M_synth &lt;- compute_mi_matrix(synth_disc)</span></span>
<span id="cb98-1491"><a href="#cb98-1491" aria-hidden="true" tabindex="-1"></a><span class="in">  mi_similarity_score(M_real, M_synth)</span></span>
<span id="cb98-1492"><a href="#cb98-1492" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1493"><a href="#cb98-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1494"><a href="#cb98-1494" aria-hidden="true" tabindex="-1"></a><span class="in"># ------- Compute scores and present nicely (percentages) -------</span></span>
<span id="cb98-1495"><a href="#cb98-1495" aria-hidden="true" tabindex="-1"></a><span class="in">mi_results &lt;- tibble::tibble(</span></span>
<span id="cb98-1496"><a href="#cb98-1496" aria-hidden="true" tabindex="-1"></a><span class="in">  Dataset = c("Parametric MICE", "CART Imputation", "Synthpop (Low Fidelity)", "Metadata-Based"),</span></span>
<span id="cb98-1497"><a href="#cb98-1497" aria-hidden="true" tabindex="-1"></a><span class="in">  Mutual_Information = c(</span></span>
<span id="cb98-1498"><a href="#cb98-1498" aria-hidden="true" tabindex="-1"></a><span class="in">    Mutual_Information(heart_failure, syn_data_1),</span></span>
<span id="cb98-1499"><a href="#cb98-1499" aria-hidden="true" tabindex="-1"></a><span class="in">    Mutual_Information(heart_failure, syn_cart_1),</span></span>
<span id="cb98-1500"><a href="#cb98-1500" aria-hidden="true" tabindex="-1"></a><span class="in">    Mutual_Information(heart_failure, syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-1501"><a href="#cb98-1501" aria-hidden="true" tabindex="-1"></a><span class="in">    Mutual_Information(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-1502"><a href="#cb98-1502" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1503"><a href="#cb98-1503" aria-hidden="true" tabindex="-1"></a><span class="in">) |&gt;</span></span>
<span id="cb98-1504"><a href="#cb98-1504" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Mutual_Information = round(Mutual_Information * 100, 1))  # convert to %</span></span>
<span id="cb98-1505"><a href="#cb98-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1506"><a href="#cb98-1506" aria-hidden="true" tabindex="-1"></a><span class="in"># User-friendly table</span></span>
<span id="cb98-1507"><a href="#cb98-1507" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-1508"><a href="#cb98-1508" aria-hidden="true" tabindex="-1"></a><span class="in">  mi_results,</span></span>
<span id="cb98-1509"><a href="#cb98-1509" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Mutual Information Similarity (%): higher = synthetic preserves dependency structure more closely",</span></span>
<span id="cb98-1510"><a href="#cb98-1510" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lr"</span></span>
<span id="cb98-1511"><a href="#cb98-1511" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1512"><a href="#cb98-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1513"><a href="#cb98-1513" aria-hidden="true" tabindex="-1"></a><span class="in"># Horizontal bar chart with custom colours</span></span>
<span id="cb98-1514"><a href="#cb98-1514" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(mi_results, aes(y = Dataset, x = Mutual_Information, fill = Dataset)) +</span></span>
<span id="cb98-1515"><a href="#cb98-1515" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-1516"><a href="#cb98-1516" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label = paste0(Mutual_Information, "%")), </span></span>
<span id="cb98-1517"><a href="#cb98-1517" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = -0.1, size = 3.3) +</span></span>
<span id="cb98-1518"><a href="#cb98-1518" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = dataset_palette) +</span></span>
<span id="cb98-1519"><a href="#cb98-1519" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 100)) +</span></span>
<span id="cb98-1520"><a href="#cb98-1520" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb98-1521"><a href="#cb98-1521" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Mutual Information Similarity by Synthetic Method",</span></span>
<span id="cb98-1522"><a href="#cb98-1522" aria-hidden="true" tabindex="-1"></a><span class="in">    subtitle = "Based on pairwise MI matrices of discretized numeric variables (equal-frequency bins)",</span></span>
<span id="cb98-1523"><a href="#cb98-1523" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Similarity (%)", y = NULL</span></span>
<span id="cb98-1524"><a href="#cb98-1524" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb98-1525"><a href="#cb98-1525" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb98-1526"><a href="#cb98-1526" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_text(size = 10))</span></span>
<span id="cb98-1527"><a href="#cb98-1527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1528"><a href="#cb98-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1529"><a href="#cb98-1529" aria-hidden="true" tabindex="-1"></a><span class="fu">### Correlation Score</span></span>
<span id="cb98-1530"><a href="#cb98-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1531"><a href="#cb98-1531" aria-hidden="true" tabindex="-1"></a>The Correlation Score measures how well the relationships (correlations) between variables are preserved in the synthetic dataset compared to the real.</span>
<span id="cb98-1532"><a href="#cb98-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1533"><a href="#cb98-1533" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for Correlation Score:</span>
<span id="cb98-1534"><a href="#cb98-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1535"><a href="#cb98-1535" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Perfect Alignment:** Correlations in the synthetic data should match the real closely, with deviations of 5-10% being acceptable.</span>
<span id="cb98-1536"><a href="#cb98-1536" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Weaker Correlations:** If synthetic correlations are weaker, it may indicate loss of fidelity due to noise.</span>
<span id="cb98-1537"><a href="#cb98-1537" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Stronger Correlations:** Stronger correlations suggest overfitting, which may increase privacy risks.</span>
<span id="cb98-1538"><a href="#cb98-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1539"><a href="#cb98-1539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r correlation-score, fig.width=10, fig.height=4, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1540"><a href="#cb98-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1541"><a href="#cb98-1541" aria-hidden="true" tabindex="-1"></a><span class="in"># Custom palette for datasets</span></span>
<span id="cb98-1542"><a href="#cb98-1542" aria-hidden="true" tabindex="-1"></a><span class="in">dataset_palette &lt;- c(</span></span>
<span id="cb98-1543"><a href="#cb98-1543" aria-hidden="true" tabindex="-1"></a><span class="in">  "Parametric MICE"         = "#B0D99B",</span></span>
<span id="cb98-1544"><a href="#cb98-1544" aria-hidden="true" tabindex="-1"></a><span class="in">  "CART Imputation"         = "#528AA8",</span></span>
<span id="cb98-1545"><a href="#cb98-1545" aria-hidden="true" tabindex="-1"></a><span class="in">  "Synthpop (Low Fidelity)" = "#FFB6DB",</span></span>
<span id="cb98-1546"><a href="#cb98-1546" aria-hidden="true" tabindex="-1"></a><span class="in">  "Metadata-Based"          = "#264653"</span></span>
<span id="cb98-1547"><a href="#cb98-1547" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1548"><a href="#cb98-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1549"><a href="#cb98-1549" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Strip 'synth_' so names align</span></span>
<span id="cb98-1550"><a href="#cb98-1550" aria-hidden="true" tabindex="-1"></a><span class="in">strip_synth_prefix &lt;- function(df) {</span></span>
<span id="cb98-1551"><a href="#cb98-1551" aria-hidden="true" tabindex="-1"></a><span class="in">  names(df) &lt;- sub("^synth_", "", names(df))</span></span>
<span id="cb98-1552"><a href="#cb98-1552" aria-hidden="true" tabindex="-1"></a><span class="in">  df</span></span>
<span id="cb98-1553"><a href="#cb98-1553" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1554"><a href="#cb98-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1555"><a href="#cb98-1555" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Function to calculate Correlation Similarity Score</span></span>
<span id="cb98-1556"><a href="#cb98-1556" aria-hidden="true" tabindex="-1"></a><span class="in">calculate_correlation_score &lt;- function(real_data, synthetic_data) {</span></span>
<span id="cb98-1557"><a href="#cb98-1557" aria-hidden="true" tabindex="-1"></a><span class="in">  # Keep numeric columns only</span></span>
<span id="cb98-1558"><a href="#cb98-1558" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- real_data[sapply(real_data, is.numeric)]</span></span>
<span id="cb98-1559"><a href="#cb98-1559" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- strip_synth_prefix(synthetic_data)[sapply(strip_synth_prefix(synthetic_data), is.numeric)]</span></span>
<span id="cb98-1560"><a href="#cb98-1560" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-1561"><a href="#cb98-1561" aria-hidden="true" tabindex="-1"></a><span class="in">  # Use only common variables</span></span>
<span id="cb98-1562"><a href="#cb98-1562" aria-hidden="true" tabindex="-1"></a><span class="in">  common &lt;- intersect(names(real_num), names(synth_num))</span></span>
<span id="cb98-1563"><a href="#cb98-1563" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common) &lt; 2) return(NA_real_)</span></span>
<span id="cb98-1564"><a href="#cb98-1564" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-1565"><a href="#cb98-1565" aria-hidden="true" tabindex="-1"></a><span class="in">  real_corr  &lt;- cor(real_num[common],  use = "complete.obs")</span></span>
<span id="cb98-1566"><a href="#cb98-1566" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_corr &lt;- cor(synth_num[common], use = "complete.obs")</span></span>
<span id="cb98-1567"><a href="#cb98-1567" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-1568"><a href="#cb98-1568" aria-hidden="true" tabindex="-1"></a><span class="in">  # Frobenius norm difference → similarity score in [0,1]</span></span>
<span id="cb98-1569"><a href="#cb98-1569" aria-hidden="true" tabindex="-1"></a><span class="in">  corr_diff &lt;- norm(real_corr - synth_corr, type = "F")</span></span>
<span id="cb98-1570"><a href="#cb98-1570" aria-hidden="true" tabindex="-1"></a><span class="in">  1 / (1 + corr_diff)</span></span>
<span id="cb98-1571"><a href="#cb98-1571" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1572"><a href="#cb98-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1573"><a href="#cb98-1573" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Compute scores for all synthetic datasets</span></span>
<span id="cb98-1574"><a href="#cb98-1574" aria-hidden="true" tabindex="-1"></a><span class="in">corr_scores &lt;- tibble::tibble(</span></span>
<span id="cb98-1575"><a href="#cb98-1575" aria-hidden="true" tabindex="-1"></a><span class="in">  Dataset = c("Parametric MICE", "CART Imputation", "Synthpop (Low Fidelity)", "Metadata-Based"),</span></span>
<span id="cb98-1576"><a href="#cb98-1576" aria-hidden="true" tabindex="-1"></a><span class="in">  Correlation_Score = c(</span></span>
<span id="cb98-1577"><a href="#cb98-1577" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_correlation_score(heart_failure, syn_data_1),</span></span>
<span id="cb98-1578"><a href="#cb98-1578" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_correlation_score(heart_failure, syn_cart_1),</span></span>
<span id="cb98-1579"><a href="#cb98-1579" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_correlation_score(heart_failure, syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-1580"><a href="#cb98-1580" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_correlation_score(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-1581"><a href="#cb98-1581" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1582"><a href="#cb98-1582" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-1583"><a href="#cb98-1583" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Correlation_Score = round(Correlation_Score * 100, 1))   # convert to %</span></span>
<span id="cb98-1584"><a href="#cb98-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1585"><a href="#cb98-1585" aria-hidden="true" tabindex="-1"></a><span class="in"># --- User-friendly table</span></span>
<span id="cb98-1586"><a href="#cb98-1586" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb98-1587"><a href="#cb98-1587" aria-hidden="true" tabindex="-1"></a><span class="in">  corr_scores,</span></span>
<span id="cb98-1588"><a href="#cb98-1588" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Correlation Similarity Scores (%): higher = synthetic preserves correlation structure more closely",</span></span>
<span id="cb98-1589"><a href="#cb98-1589" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lr"</span></span>
<span id="cb98-1590"><a href="#cb98-1590" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1591"><a href="#cb98-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1592"><a href="#cb98-1592" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Horizontal bar chart with custom colours</span></span>
<span id="cb98-1593"><a href="#cb98-1593" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(corr_scores, aes(y = Dataset, x = Correlation_Score, fill = Dataset)) +</span></span>
<span id="cb98-1594"><a href="#cb98-1594" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-1595"><a href="#cb98-1595" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label = paste0(Correlation_Score, "%")), </span></span>
<span id="cb98-1596"><a href="#cb98-1596" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = -0.1, size = 3.3) +</span></span>
<span id="cb98-1597"><a href="#cb98-1597" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = dataset_palette) +</span></span>
<span id="cb98-1598"><a href="#cb98-1598" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 100)) +</span></span>
<span id="cb98-1599"><a href="#cb98-1599" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb98-1600"><a href="#cb98-1600" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Correlation Similarity by Synthetic Method",</span></span>
<span id="cb98-1601"><a href="#cb98-1601" aria-hidden="true" tabindex="-1"></a><span class="in">    subtitle = "Based on Frobenius norm difference between real and synthetic correlation matrices",</span></span>
<span id="cb98-1602"><a href="#cb98-1602" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Similarity (%)", y = NULL</span></span>
<span id="cb98-1603"><a href="#cb98-1603" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb98-1604"><a href="#cb98-1604" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb98-1605"><a href="#cb98-1605" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_text(size = 10))</span></span>
<span id="cb98-1606"><a href="#cb98-1606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1607"><a href="#cb98-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1608"><a href="#cb98-1608" aria-hidden="true" tabindex="-1"></a><span class="fu">## Utility Assessment</span></span>
<span id="cb98-1609"><a href="#cb98-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1610"><a href="#cb98-1610" aria-hidden="true" tabindex="-1"></a><span class="fu">### Feature Importance Consistency Assessment</span></span>
<span id="cb98-1611"><a href="#cb98-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1612"><a href="#cb98-1612" aria-hidden="true" tabindex="-1"></a>The Feature Importance Consistency Assessment evaluates how well the synthetic datasets retain the predictive significance of features compared to the real dataset. This assessment is essential for ensuring that the synthetic data accurately reflects the underlying relationships that contribute to the model's predictive performance.</span>
<span id="cb98-1613"><a href="#cb98-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1614"><a href="#cb98-1614" aria-hidden="true" tabindex="-1"></a>Feature importance measures each variable's contribution to model predictions. Consistency in feature importance rankings between the real and synthetic datasets serves as a crucial indicator of data quality. Significant discrepancies may indicate deficiencies in the synthetic data generation process, potentially affecting the performance of models trained on synthetic data.</span>
<span id="cb98-1615"><a href="#cb98-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1616"><a href="#cb98-1616" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for Feature Importance Consistency Assessment:</span>
<span id="cb98-1617"><a href="#cb98-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1618"><a href="#cb98-1618" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Perfect Match**: Feature importance scores in the synthetic dataset should closely align with those in the real dataset, particularly for highly predictive features.</span>
<span id="cb98-1619"><a href="#cb98-1619" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Acceptable Deviation**: A deviation of 10-15% is generally acceptable for most features. For variables identified as highly influential, stricter thresholds may be needed to maintain predictive accuracy.</span>
<span id="cb98-1620"><a href="#cb98-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1621"><a href="#cb98-1621" aria-hidden="true" tabindex="-1"></a>Types of Deviations</span>
<span id="cb98-1622"><a href="#cb98-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1623"><a href="#cb98-1623" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Underrepresentation**: If an important feature has lower importance in the synthetic dataset, it may suggest that critical predictive relationships are not well-preserved.</span>
<span id="cb98-1624"><a href="#cb98-1624" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Overrepresentation**: If a feature's importance is higher in the synthetic data, this could indicate noise or overfitting, potentially distorting the model’s perception of feature relationships.</span>
<span id="cb98-1625"><a href="#cb98-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1626"><a href="#cb98-1626" aria-hidden="true" tabindex="-1"></a>The following visualisation techniques will be used to compare feature importance:</span>
<span id="cb98-1627"><a href="#cb98-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1628"><a href="#cb98-1628" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bar Plots for Feature Importance Comparison**: Bar plots will compare feature importance scores between the real and synthetic datasets. This visual comparison can reveal significant deviations.</span>
<span id="cb98-1629"><a href="#cb98-1629" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**SHAP Summary Plots**: SHAP (SHapley Additive exPlanations) summary plots provide a comprehensive view of the distribution of SHAP values for each feature, allowing for a direct comparison between the real and synthetic datasets.</span>
<span id="cb98-1630"><a href="#cb98-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1631"><a href="#cb98-1631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Feature Importance Consistency Assessment, fig.width=10, fig.height=4, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1632"><a href="#cb98-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1633"><a href="#cb98-1633" aria-hidden="true" tabindex="-1"></a><span class="in"># Prepare the data for XGBoost</span></span>
<span id="cb98-1634"><a href="#cb98-1634" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)  # For reproducibility</span></span>
<span id="cb98-1635"><a href="#cb98-1635" aria-hidden="true" tabindex="-1"></a><span class="in">train_indices &lt;- sample(seq_len(nrow(heart_failure)), size = 0.7 * nrow(heart_failure))</span></span>
<span id="cb98-1636"><a href="#cb98-1636" aria-hidden="true" tabindex="-1"></a><span class="in">train_real &lt;- heart_failure[train_indices, ]</span></span>
<span id="cb98-1637"><a href="#cb98-1637" aria-hidden="true" tabindex="-1"></a><span class="in">test_real &lt;- heart_failure[-train_indices, ]</span></span>
<span id="cb98-1638"><a href="#cb98-1638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1639"><a href="#cb98-1639" aria-hidden="true" tabindex="-1"></a><span class="in">train_real_matrix &lt;- model.matrix(deceased ~ age + sex + anaemia + creatinine_phosphokinase + diabetes + ejection_fraction + platelets + serum_creatinine + serum_sodium + smoking + hypertension + follow_up - 1, data = train_real)</span></span>
<span id="cb98-1640"><a href="#cb98-1640" aria-hidden="true" tabindex="-1"></a><span class="in">train_real_label &lt;- train_real[rownames(train_real_matrix), "deceased"]</span></span>
<span id="cb98-1641"><a href="#cb98-1641" aria-hidden="true" tabindex="-1"></a><span class="in">train_real_label &lt;- as.numeric(train_real_label) - 1  # Convert factor to 0 and 1</span></span>
<span id="cb98-1642"><a href="#cb98-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1643"><a href="#cb98-1643" aria-hidden="true" tabindex="-1"></a><span class="in">train_synth &lt;- syn_data_1[train_indices, ]</span></span>
<span id="cb98-1644"><a href="#cb98-1644" aria-hidden="true" tabindex="-1"></a><span class="in">train_synth_matrix &lt;- model.matrix(deceased ~ age + sex + anaemia + creatinine_phosphokinase + diabetes + ejection_fraction + platelets + serum_creatinine + serum_sodium + smoking + hypertension + follow_up - 1, data = train_synth)</span></span>
<span id="cb98-1645"><a href="#cb98-1645" aria-hidden="true" tabindex="-1"></a><span class="in">train_synth_label &lt;- train_synth[rownames(train_synth_matrix), "deceased"]</span></span>
<span id="cb98-1646"><a href="#cb98-1646" aria-hidden="true" tabindex="-1"></a><span class="in">train_synth_label &lt;- as.numeric(train_synth_label) - 1  # Convert factor to 0 and 1</span></span>
<span id="cb98-1647"><a href="#cb98-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1648"><a href="#cb98-1648" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert to DMatrix format, which is required for XGBoost</span></span>
<span id="cb98-1649"><a href="#cb98-1649" aria-hidden="true" tabindex="-1"></a><span class="in">dtrain_real &lt;- xgb.DMatrix(data = train_real_matrix, label = train_real_label)</span></span>
<span id="cb98-1650"><a href="#cb98-1650" aria-hidden="true" tabindex="-1"></a><span class="in">dtrain_synth &lt;- xgb.DMatrix(data = train_synth_matrix, label = train_synth_label)</span></span>
<span id="cb98-1651"><a href="#cb98-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1652"><a href="#cb98-1652" aria-hidden="true" tabindex="-1"></a><span class="in"># Set up parameters for XGBoost</span></span>
<span id="cb98-1653"><a href="#cb98-1653" aria-hidden="true" tabindex="-1"></a><span class="in">params &lt;- list(</span></span>
<span id="cb98-1654"><a href="#cb98-1654" aria-hidden="true" tabindex="-1"></a><span class="in">  objective = "binary:logistic",</span></span>
<span id="cb98-1655"><a href="#cb98-1655" aria-hidden="true" tabindex="-1"></a><span class="in">  eval_metric = "auc",  # Use AUC as an evaluation metric</span></span>
<span id="cb98-1656"><a href="#cb98-1656" aria-hidden="true" tabindex="-1"></a><span class="in">  max_depth = 3,</span></span>
<span id="cb98-1657"><a href="#cb98-1657" aria-hidden="true" tabindex="-1"></a><span class="in">  eta = 0.1</span></span>
<span id="cb98-1658"><a href="#cb98-1658" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1659"><a href="#cb98-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1660"><a href="#cb98-1660" aria-hidden="true" tabindex="-1"></a><span class="in"># Tune hyperparameters using cross-validation (with parallel processing)</span></span>
<span id="cb98-1661"><a href="#cb98-1661" aria-hidden="true" tabindex="-1"></a><span class="in">cv_real &lt;- xgb.cv(</span></span>
<span id="cb98-1662"><a href="#cb98-1662" aria-hidden="true" tabindex="-1"></a><span class="in">  params = params,</span></span>
<span id="cb98-1663"><a href="#cb98-1663" aria-hidden="true" tabindex="-1"></a><span class="in">  data = dtrain_real,</span></span>
<span id="cb98-1664"><a href="#cb98-1664" aria-hidden="true" tabindex="-1"></a><span class="in">  nrounds = 100,</span></span>
<span id="cb98-1665"><a href="#cb98-1665" aria-hidden="true" tabindex="-1"></a><span class="in">  nfold = 5,</span></span>
<span id="cb98-1666"><a href="#cb98-1666" aria-hidden="true" tabindex="-1"></a><span class="in">  verbose = 0,</span></span>
<span id="cb98-1667"><a href="#cb98-1667" aria-hidden="true" tabindex="-1"></a><span class="in">  early_stopping_rounds = 10,</span></span>
<span id="cb98-1668"><a href="#cb98-1668" aria-hidden="true" tabindex="-1"></a><span class="in">  nthread = num_cores  # Number of threads for parallel processing</span></span>
<span id="cb98-1669"><a href="#cb98-1669" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1670"><a href="#cb98-1670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1671"><a href="#cb98-1671" aria-hidden="true" tabindex="-1"></a><span class="in">best_nrounds_real &lt;- cv_real$best_iteration</span></span>
<span id="cb98-1672"><a href="#cb98-1672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1673"><a href="#cb98-1673" aria-hidden="true" tabindex="-1"></a><span class="in">cv_synth &lt;- xgb.cv(</span></span>
<span id="cb98-1674"><a href="#cb98-1674" aria-hidden="true" tabindex="-1"></a><span class="in">  params = params,</span></span>
<span id="cb98-1675"><a href="#cb98-1675" aria-hidden="true" tabindex="-1"></a><span class="in">  data = dtrain_synth,</span></span>
<span id="cb98-1676"><a href="#cb98-1676" aria-hidden="true" tabindex="-1"></a><span class="in">  nrounds = 100,</span></span>
<span id="cb98-1677"><a href="#cb98-1677" aria-hidden="true" tabindex="-1"></a><span class="in">  nfold = 5,</span></span>
<span id="cb98-1678"><a href="#cb98-1678" aria-hidden="true" tabindex="-1"></a><span class="in">  verbose = 0,</span></span>
<span id="cb98-1679"><a href="#cb98-1679" aria-hidden="true" tabindex="-1"></a><span class="in">  early_stopping_rounds = 10,</span></span>
<span id="cb98-1680"><a href="#cb98-1680" aria-hidden="true" tabindex="-1"></a><span class="in">  nthread = num_cores  # Number of threads for parallel processing</span></span>
<span id="cb98-1681"><a href="#cb98-1681" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1682"><a href="#cb98-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1683"><a href="#cb98-1683" aria-hidden="true" tabindex="-1"></a><span class="in">best_nrounds_synth &lt;- cv_synth$best_iteration</span></span>
<span id="cb98-1684"><a href="#cb98-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1685"><a href="#cb98-1685" aria-hidden="true" tabindex="-1"></a><span class="in"># Train XGBoost on real data (TRTR)</span></span>
<span id="cb98-1686"><a href="#cb98-1686" aria-hidden="true" tabindex="-1"></a><span class="in">xgb_model_trtr &lt;- xgboost(params = params, data = dtrain_real, nrounds = best_nrounds_real, verbose = 0, nthread = num_cores)</span></span>
<span id="cb98-1687"><a href="#cb98-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1688"><a href="#cb98-1688" aria-hidden="true" tabindex="-1"></a><span class="in"># Train XGBoost on synthetic data (TSTR)</span></span>
<span id="cb98-1689"><a href="#cb98-1689" aria-hidden="true" tabindex="-1"></a><span class="in">xgb_model_tstr &lt;- xgboost(params = params, data = dtrain_synth, nrounds = best_nrounds_synth, verbose = 0, nthread = num_cores)</span></span>
<span id="cb98-1690"><a href="#cb98-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1691"><a href="#cb98-1691" aria-hidden="true" tabindex="-1"></a><span class="in"># Get feature importance for TRTR</span></span>
<span id="cb98-1692"><a href="#cb98-1692" aria-hidden="true" tabindex="-1"></a><span class="in">importance_trtr &lt;- xgb.importance(feature_names = colnames(train_real_matrix), model = xgb_model_trtr)</span></span>
<span id="cb98-1693"><a href="#cb98-1693" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Feature Importance for TRTR:\n")</span></span>
<span id="cb98-1694"><a href="#cb98-1694" aria-hidden="true" tabindex="-1"></a><span class="in">print(importance_trtr)</span></span>
<span id="cb98-1695"><a href="#cb98-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1696"><a href="#cb98-1696" aria-hidden="true" tabindex="-1"></a><span class="in"># Get feature importance for TSTR</span></span>
<span id="cb98-1697"><a href="#cb98-1697" aria-hidden="true" tabindex="-1"></a><span class="in">importance_tstr &lt;- xgb.importance(feature_names = colnames(train_synth_matrix), model = xgb_model_tstr)</span></span>
<span id="cb98-1698"><a href="#cb98-1698" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\nFeature Importance for TSTR:\n")</span></span>
<span id="cb98-1699"><a href="#cb98-1699" aria-hidden="true" tabindex="-1"></a><span class="in">print(importance_tstr)</span></span>
<span id="cb98-1700"><a href="#cb98-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1701"><a href="#cb98-1701" aria-hidden="true" tabindex="-1"></a><span class="in"># Visualise feature importance for TRTR and TSTR</span></span>
<span id="cb98-1702"><a href="#cb98-1702" aria-hidden="true" tabindex="-1"></a><span class="in">importance_trtr$Dataset &lt;- "Real Data"</span></span>
<span id="cb98-1703"><a href="#cb98-1703" aria-hidden="true" tabindex="-1"></a><span class="in">importance_tstr$Dataset &lt;- "Synthetic Data"</span></span>
<span id="cb98-1704"><a href="#cb98-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1705"><a href="#cb98-1705" aria-hidden="true" tabindex="-1"></a><span class="in">importance_combined &lt;- rbind(importance_trtr, importance_tstr)</span></span>
<span id="cb98-1706"><a href="#cb98-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1707"><a href="#cb98-1707" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot feature importance comparison</span></span>
<span id="cb98-1708"><a href="#cb98-1708" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(importance_combined, aes(x = reorder(Feature, Gain), y = Gain, fill = Dataset)) +</span></span>
<span id="cb98-1709"><a href="#cb98-1709" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb98-1710"><a href="#cb98-1710" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_flip() +</span></span>
<span id="cb98-1711"><a href="#cb98-1711" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Feature Importance Comparison (TRTR vs TSTR)",</span></span>
<span id="cb98-1712"><a href="#cb98-1712" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Feature",</span></span>
<span id="cb98-1713"><a href="#cb98-1713" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Gain") +</span></span>
<span id="cb98-1714"><a href="#cb98-1714" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("Real Data" = "#B0D99B", "Synthetic Data" = "#528AA8")) +</span></span>
<span id="cb98-1715"><a href="#cb98-1715" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb98-1716"><a href="#cb98-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1717"><a href="#cb98-1717" aria-hidden="true" tabindex="-1"></a><span class="in"># Correlation analysis between feature importance rankings</span></span>
<span id="cb98-1718"><a href="#cb98-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1719"><a href="#cb98-1719" aria-hidden="true" tabindex="-1"></a><span class="in">importance_trtr &lt;- importance_trtr %&gt;% mutate(rank = rank(-Gain))</span></span>
<span id="cb98-1720"><a href="#cb98-1720" aria-hidden="true" tabindex="-1"></a><span class="in">importance_tstr &lt;- importance_tstr %&gt;% mutate(rank = rank(-Gain))</span></span>
<span id="cb98-1721"><a href="#cb98-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1722"><a href="#cb98-1722" aria-hidden="true" tabindex="-1"></a><span class="in">importance_ranking &lt;- inner_join(importance_trtr, importance_tstr, by = "Feature", suffix = c("_trtr", "_tstr"))</span></span>
<span id="cb98-1723"><a href="#cb98-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1724"><a href="#cb98-1724" aria-hidden="true" tabindex="-1"></a><span class="in">correlation &lt;- cor(importance_ranking$rank_trtr, importance_ranking$rank_tstr, method = "spearman")</span></span>
<span id="cb98-1725"><a href="#cb98-1725" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\nSpearman correlation Between TRTR and TSTR Feature Importance Rankings:\n")</span></span>
<span id="cb98-1726"><a href="#cb98-1726" aria-hidden="true" tabindex="-1"></a><span class="in">print(correlation)</span></span>
<span id="cb98-1727"><a href="#cb98-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1728"><a href="#cb98-1728" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate SHAP values for better interpretability</span></span>
<span id="cb98-1729"><a href="#cb98-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1730"><a href="#cb98-1730" aria-hidden="true" tabindex="-1"></a><span class="in"># SHAP values for TRTR</span></span>
<span id="cb98-1731"><a href="#cb98-1731" aria-hidden="true" tabindex="-1"></a><span class="in">shap_values_trtr &lt;- shap.values(xgb_model_trtr, dtrain_real)</span></span>
<span id="cb98-1732"><a href="#cb98-1732" aria-hidden="true" tabindex="-1"></a><span class="in">shap_long_trtr &lt;- shap.prep(shap_contrib = shap_values_trtr$shap_score, X_train = train_real_matrix)</span></span>
<span id="cb98-1733"><a href="#cb98-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1734"><a href="#cb98-1734" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\nSHAP Summary for TRTR:\n")</span></span>
<span id="cb98-1735"><a href="#cb98-1735" aria-hidden="true" tabindex="-1"></a><span class="in">shap_values_trtr$mean_shap_score %&gt;% print()</span></span>
<span id="cb98-1736"><a href="#cb98-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1737"><a href="#cb98-1737" aria-hidden="true" tabindex="-1"></a><span class="in"># SHAP values for TSTR</span></span>
<span id="cb98-1738"><a href="#cb98-1738" aria-hidden="true" tabindex="-1"></a><span class="in">shap_values_tstr &lt;- shap.values(xgb_model_tstr, dtrain_synth)</span></span>
<span id="cb98-1739"><a href="#cb98-1739" aria-hidden="true" tabindex="-1"></a><span class="in">shap_long_tstr &lt;- shap.prep(shap_contrib = shap_values_tstr$shap_score, X_train = train_synth_matrix)</span></span>
<span id="cb98-1740"><a href="#cb98-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1741"><a href="#cb98-1741" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\nSHAP Summary for TSTR:\n")</span></span>
<span id="cb98-1742"><a href="#cb98-1742" aria-hidden="true" tabindex="-1"></a><span class="in">shap_values_tstr$mean_shap_score %&gt;% print()</span></span>
<span id="cb98-1743"><a href="#cb98-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1744"><a href="#cb98-1744" aria-hidden="true" tabindex="-1"></a><span class="in"># SHAP visualisation</span></span>
<span id="cb98-1745"><a href="#cb98-1745" aria-hidden="true" tabindex="-1"></a><span class="in">shap.plot.summary(shap_long_trtr)</span></span>
<span id="cb98-1746"><a href="#cb98-1746" aria-hidden="true" tabindex="-1"></a><span class="in">shap.plot.summary(shap_long_tstr)</span></span>
<span id="cb98-1747"><a href="#cb98-1747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1748"><a href="#cb98-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1749"><a href="#cb98-1749" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prediction Score</span></span>
<span id="cb98-1750"><a href="#cb98-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1751"><a href="#cb98-1751" aria-hidden="true" tabindex="-1"></a>The Prediction Score assesses synthetic data utility by comparing models trained on real data (Train Real Test Real (TRTR)) versus synthetic data (Train Synthetic Test Real (TSTR)) using two metrics:</span>
<span id="cb98-1752"><a href="#cb98-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1753"><a href="#cb98-1753" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Accuracy**: The proportion of correct predictions made by the model.</span>
<span id="cb98-1754"><a href="#cb98-1754" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**pMSE (Prediction Mean Squared Error)**: Measures the average of the squared differences between predicted and actual values.</span>
<span id="cb98-1755"><a href="#cb98-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1756"><a href="#cb98-1756" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for Prediction Score:</span>
<span id="cb98-1757"><a href="#cb98-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1758"><a href="#cb98-1758" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Accuracy**: TSTR accuracy should be within 5-10% of TRTR accuracy. Lower accuracy signals that synthetic data isn’t fully representative of the real dataset.</span>
<span id="cb98-1759"><a href="#cb98-1759" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**pMSE**: TSTR pMSE should be close to TRTR pMSE. A 5-10% deviation is acceptable; a higher pMSE suggests synthetic data may not be accurately reflecting the true relationships in the real data.</span>
<span id="cb98-1760"><a href="#cb98-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1761"><a href="#cb98-1761" aria-hidden="true" tabindex="-1"></a>This section assesses the utility of synthetic data generated through various methods, using XGBoost to calculate both Accuracy and pMSE for TRTR and TSTR.</span>
<span id="cb98-1762"><a href="#cb98-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1763"><a href="#cb98-1763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1764"><a href="#cb98-1764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Prediction Score, fig.width=10, fig.height=4, fig.align='center', out.width='100%'}</span></span>
<span id="cb98-1765"><a href="#cb98-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1766"><a href="#cb98-1766" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb98-1767"><a href="#cb98-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1768"><a href="#cb98-1768" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- helpers ----</span></span>
<span id="cb98-1769"><a href="#cb98-1769" aria-hidden="true" tabindex="-1"></a><span class="in">strip_synth_prefix &lt;- function(df) { names(df) &lt;- sub("^synth_", "", names(df)); df }</span></span>
<span id="cb98-1770"><a href="#cb98-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1771"><a href="#cb98-1771" aria-hidden="true" tabindex="-1"></a><span class="in">align_target_levels &lt;- function(df, levels_ref = NULL, positive = NULL) {</span></span>
<span id="cb98-1772"><a href="#cb98-1772" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!is.factor(df$deceased)) {</span></span>
<span id="cb98-1773"><a href="#cb98-1773" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.numeric(df$deceased)) df$deceased &lt;- factor(as.character(df$deceased)) else df$deceased &lt;- factor(df$deceased)</span></span>
<span id="cb98-1774"><a href="#cb98-1774" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb98-1775"><a href="#cb98-1775" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!is.null(levels_ref)) df$deceased &lt;- factor(df$deceased, levels = levels_ref)</span></span>
<span id="cb98-1776"><a href="#cb98-1776" aria-hidden="true" tabindex="-1"></a><span class="in">  lev &lt;- levels(df$deceased)</span></span>
<span id="cb98-1777"><a href="#cb98-1777" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(lev) &lt; 2) stop("Target 'deceased' must have two levels.")</span></span>
<span id="cb98-1778"><a href="#cb98-1778" aria-hidden="true" tabindex="-1"></a><span class="in">  pos &lt;- if (!is.null(positive) &amp;&amp; positive %in% lev) positive else if ("1" %in% lev) "1" else lev[2]</span></span>
<span id="cb98-1779"><a href="#cb98-1779" aria-hidden="true" tabindex="-1"></a><span class="in">  df$deceased &lt;- stats::relevel(df$deceased, ref = pos)</span></span>
<span id="cb98-1780"><a href="#cb98-1780" aria-hidden="true" tabindex="-1"></a><span class="in">  list(data = df, levels = levels(df$deceased), positive = pos)</span></span>
<span id="cb98-1781"><a href="#cb98-1781" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1782"><a href="#cb98-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1783"><a href="#cb98-1783" aria-hidden="true" tabindex="-1"></a><span class="in">evaluate_model &lt;- function(train_data, test_data, label, tune_grid, train_control, seed = 123) {</span></span>
<span id="cb98-1784"><a href="#cb98-1784" aria-hidden="true" tabindex="-1"></a><span class="in">  test_aln  &lt;- align_target_levels(test_data)</span></span>
<span id="cb98-1785"><a href="#cb98-1785" aria-hidden="true" tabindex="-1"></a><span class="in">  train_aln &lt;- align_target_levels(train_data, levels_ref = test_aln$levels, positive = test_aln$positive)</span></span>
<span id="cb98-1786"><a href="#cb98-1786" aria-hidden="true" tabindex="-1"></a><span class="in">  train_data &lt;- train_aln$data</span></span>
<span id="cb98-1787"><a href="#cb98-1787" aria-hidden="true" tabindex="-1"></a><span class="in">  test_data  &lt;- test_aln$data</span></span>
<span id="cb98-1788"><a href="#cb98-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1789"><a href="#cb98-1789" aria-hidden="true" tabindex="-1"></a><span class="in">  set.seed(seed)</span></span>
<span id="cb98-1790"><a href="#cb98-1790" aria-hidden="true" tabindex="-1"></a><span class="in">  model &lt;- caret::train(</span></span>
<span id="cb98-1791"><a href="#cb98-1791" aria-hidden="true" tabindex="-1"></a><span class="in">    deceased ~ follow_up + serum_creatinine + ejection_fraction +</span></span>
<span id="cb98-1792"><a href="#cb98-1792" aria-hidden="true" tabindex="-1"></a><span class="in">      creatinine_phosphokinase + serum_sodium + age + platelets,</span></span>
<span id="cb98-1793"><a href="#cb98-1793" aria-hidden="true" tabindex="-1"></a><span class="in">    data      = train_data,</span></span>
<span id="cb98-1794"><a href="#cb98-1794" aria-hidden="true" tabindex="-1"></a><span class="in">    method    = "xgbTree",</span></span>
<span id="cb98-1795"><a href="#cb98-1795" aria-hidden="true" tabindex="-1"></a><span class="in">    trControl = train_control,</span></span>
<span id="cb98-1796"><a href="#cb98-1796" aria-hidden="true" tabindex="-1"></a><span class="in">    tuneGrid  = tune_grid,</span></span>
<span id="cb98-1797"><a href="#cb98-1797" aria-hidden="true" tabindex="-1"></a><span class="in">    na.action = na.pass</span></span>
<span id="cb98-1798"><a href="#cb98-1798" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1799"><a href="#cb98-1799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1800"><a href="#cb98-1800" aria-hidden="true" tabindex="-1"></a><span class="in">  pred &lt;- predict(model, test_data)</span></span>
<span id="cb98-1801"><a href="#cb98-1801" aria-hidden="true" tabindex="-1"></a><span class="in">  acc  &lt;- mean(pred == test_data$deceased, na.rm = TRUE)</span></span>
<span id="cb98-1802"><a href="#cb98-1802" aria-hidden="true" tabindex="-1"></a><span class="in">  yhat &lt;- as.numeric(pred)</span></span>
<span id="cb98-1803"><a href="#cb98-1803" aria-hidden="true" tabindex="-1"></a><span class="in">  y    &lt;- as.numeric(test_data$deceased)</span></span>
<span id="cb98-1804"><a href="#cb98-1804" aria-hidden="true" tabindex="-1"></a><span class="in">  pMSE &lt;- mean((yhat - y)^2, na.rm = TRUE)</span></span>
<span id="cb98-1805"><a href="#cb98-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1806"><a href="#cb98-1806" aria-hidden="true" tabindex="-1"></a><span class="in">  tibble::tibble(Dataset = label, Accuracy = acc, pMSE = pMSE)</span></span>
<span id="cb98-1807"><a href="#cb98-1807" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1808"><a href="#cb98-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1809"><a href="#cb98-1809" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- CV setup ----</span></span>
<span id="cb98-1810"><a href="#cb98-1810" aria-hidden="true" tabindex="-1"></a><span class="in">train_control &lt;- caret::trainControl(method = "cv", number = 5)</span></span>
<span id="cb98-1811"><a href="#cb98-1811" aria-hidden="true" tabindex="-1"></a><span class="in">tune_grid &lt;- expand.grid(</span></span>
<span id="cb98-1812"><a href="#cb98-1812" aria-hidden="true" tabindex="-1"></a><span class="in">  nrounds = 50,</span></span>
<span id="cb98-1813"><a href="#cb98-1813" aria-hidden="true" tabindex="-1"></a><span class="in">  max_depth = 3,</span></span>
<span id="cb98-1814"><a href="#cb98-1814" aria-hidden="true" tabindex="-1"></a><span class="in">  eta = 0.1,</span></span>
<span id="cb98-1815"><a href="#cb98-1815" aria-hidden="true" tabindex="-1"></a><span class="in">  gamma = 0,</span></span>
<span id="cb98-1816"><a href="#cb98-1816" aria-hidden="true" tabindex="-1"></a><span class="in">  colsample_bytree = 0.8,</span></span>
<span id="cb98-1817"><a href="#cb98-1817" aria-hidden="true" tabindex="-1"></a><span class="in">  min_child_weight = 1,</span></span>
<span id="cb98-1818"><a href="#cb98-1818" aria-hidden="true" tabindex="-1"></a><span class="in">  subsample = 0.7</span></span>
<span id="cb98-1819"><a href="#cb98-1819" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1820"><a href="#cb98-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1821"><a href="#cb98-1821" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- prepare synthetic splits ----</span></span>
<span id="cb98-1822"><a href="#cb98-1822" aria-hidden="true" tabindex="-1"></a><span class="in">syn_mice      &lt;- strip_synth_prefix(syn_data_1)</span></span>
<span id="cb98-1823"><a href="#cb98-1823" aria-hidden="true" tabindex="-1"></a><span class="in">syn_cart      &lt;- strip_synth_prefix(syn_cart_1)</span></span>
<span id="cb98-1824"><a href="#cb98-1824" aria-hidden="true" tabindex="-1"></a><span class="in">syn_synthpop  &lt;- strip_synth_prefix(syn_data_low_fidelity_synthpop)</span></span>
<span id="cb98-1825"><a href="#cb98-1825" aria-hidden="true" tabindex="-1"></a><span class="in">syn_metadata  &lt;- strip_synth_prefix(syn_data_metadata)</span></span>
<span id="cb98-1826"><a href="#cb98-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1827"><a href="#cb98-1827" aria-hidden="true" tabindex="-1"></a><span class="in">train_synth_mice     &lt;- syn_mice[train_indices, , drop = FALSE]</span></span>
<span id="cb98-1828"><a href="#cb98-1828" aria-hidden="true" tabindex="-1"></a><span class="in">train_synth_cart     &lt;- syn_cart[train_indices, , drop = FALSE]</span></span>
<span id="cb98-1829"><a href="#cb98-1829" aria-hidden="true" tabindex="-1"></a><span class="in">train_synth_synthpop &lt;- syn_synthpop[train_indices, , drop = FALSE]</span></span>
<span id="cb98-1830"><a href="#cb98-1830" aria-hidden="true" tabindex="-1"></a><span class="in">train_synth_metadata &lt;- syn_metadata[train_indices, , drop = FALSE]</span></span>
<span id="cb98-1831"><a href="#cb98-1831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1832"><a href="#cb98-1832" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- results table ----</span></span>
<span id="cb98-1833"><a href="#cb98-1833" aria-hidden="true" tabindex="-1"></a><span class="in">results &lt;- dplyr::bind_rows(</span></span>
<span id="cb98-1834"><a href="#cb98-1834" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluate_model(train_real,               test_real, "TRTR (Real→Real)",     tune_grid, train_control),</span></span>
<span id="cb98-1835"><a href="#cb98-1835" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluate_model(train_synth_mice,         test_real, "TSTR (MICE→Real)",     tune_grid, train_control),</span></span>
<span id="cb98-1836"><a href="#cb98-1836" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluate_model(train_synth_cart,         test_real, "TSTR (CART→Real)",     tune_grid, train_control),</span></span>
<span id="cb98-1837"><a href="#cb98-1837" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluate_model(train_synth_synthpop,     test_real, "TSTR (Synthpop→Real)", tune_grid, train_control),</span></span>
<span id="cb98-1838"><a href="#cb98-1838" aria-hidden="true" tabindex="-1"></a><span class="in">  evaluate_model(train_synth_metadata,     test_real, "TSTR (Metadata→Real)", tune_grid, train_control)</span></span>
<span id="cb98-1839"><a href="#cb98-1839" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-1840"><a href="#cb98-1840" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb98-1841"><a href="#cb98-1841" aria-hidden="true" tabindex="-1"></a><span class="in">    Accuracy = scales::percent(Accuracy, accuracy = 0.1),</span></span>
<span id="cb98-1842"><a href="#cb98-1842" aria-hidden="true" tabindex="-1"></a><span class="in">    pMSE     = round(pMSE, 3)</span></span>
<span id="cb98-1843"><a href="#cb98-1843" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1844"><a href="#cb98-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1845"><a href="#cb98-1845" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-1846"><a href="#cb98-1846" aria-hidden="true" tabindex="-1"></a><span class="in">  results,</span></span>
<span id="cb98-1847"><a href="#cb98-1847" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Prediction Score Summary (XGBoost, 5-fold CV): TRTR vs TSTR",</span></span>
<span id="cb98-1848"><a href="#cb98-1848" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrr"</span></span>
<span id="cb98-1849"><a href="#cb98-1849" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1850"><a href="#cb98-1850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1851"><a href="#cb98-1851" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- horizontal Accuracy bar chart ----</span></span>
<span id="cb98-1852"><a href="#cb98-1852" aria-hidden="true" tabindex="-1"></a><span class="in">palette5 &lt;- c("#B0D99B", "#528AA8", "#FFB6DB", "#264653", "#2A9D8F")</span></span>
<span id="cb98-1853"><a href="#cb98-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1854"><a href="#cb98-1854" aria-hidden="true" tabindex="-1"></a><span class="in">plot_df &lt;- results %&gt;%</span></span>
<span id="cb98-1855"><a href="#cb98-1855" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Accuracy_num = readr::parse_number(Accuracy) / 100)</span></span>
<span id="cb98-1856"><a href="#cb98-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1857"><a href="#cb98-1857" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(plot_df, aes(y = Dataset, x = Accuracy_num, fill = Dataset)) +</span></span>
<span id="cb98-1858"><a href="#cb98-1858" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-1859"><a href="#cb98-1859" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label = Accuracy), hjust = -0.1, size = 3.5) +</span></span>
<span id="cb98-1860"><a href="#cb98-1860" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = setNames(palette5, unique(plot_df$Dataset))) +</span></span>
<span id="cb98-1861"><a href="#cb98-1861" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = scales::percent_format(accuracy = 1), limits = c(0, 1)) +</span></span>
<span id="cb98-1862"><a href="#cb98-1862" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Model Accuracy: TRTR vs TSTR", x = "Accuracy", y = NULL) +</span></span>
<span id="cb98-1863"><a href="#cb98-1863" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb98-1864"><a href="#cb98-1864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1865"><a href="#cb98-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1866"><a href="#cb98-1866" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quality Score (QScore)</span></span>
<span id="cb98-1867"><a href="#cb98-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1868"><a href="#cb98-1868" aria-hidden="true" tabindex="-1"></a>The QScore provides a comprehensive evaluation of synthetic data by aggregating multiple metrics, such as distribution similarity, feature importance, and correlation preservation, into a single score. This offers a clear, overall assessment of how well the synthetic data replicates the real dataset.</span>
<span id="cb98-1869"><a href="#cb98-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1870"><a href="#cb98-1870" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for QScore:</span>
<span id="cb98-1871"><a href="#cb98-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1872"><a href="#cb98-1872" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Excellent Quality (0.8 - 1.0)**: Indicates the synthetic data closely mirrors the real and can be confidently used for most analyses.</span>
<span id="cb98-1873"><a href="#cb98-1873" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Good Quality (0.6 - 0.8)**: Reflects good alignment, with some minor deviations. Suitable for most use cases, but some caution is advised.</span>
<span id="cb98-1874"><a href="#cb98-1874" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Moderate Quality (0.4 - 0.6)**: The synthetic data may be useful for exploratory analysis but shows significant deviations in key metrics.</span>
<span id="cb98-1875"><a href="#cb98-1875" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Poor Quality (&lt; 0.4)**: The synthetic data poorly aligns with the real and is likely unsuitable for most analytic or modeling tasks.</span>
<span id="cb98-1876"><a href="#cb98-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1877"><a href="#cb98-1877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Quality Score, fig.width=10, fig.height=4, fig.align='center', out.width='99%'}</span></span>
<span id="cb98-1878"><a href="#cb98-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1879"><a href="#cb98-1879" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- QScore helper ----</span></span>
<span id="cb98-1880"><a href="#cb98-1880" aria-hidden="true" tabindex="-1"></a><span class="in">calculate_qscore &lt;- function(real_data, synthetic_data, num_queries = 10) {</span></span>
<span id="cb98-1881"><a href="#cb98-1881" aria-hidden="true" tabindex="-1"></a><span class="in">  numeric_real_vars  &lt;- names(real_data)[sapply(real_data, is.numeric)]</span></span>
<span id="cb98-1882"><a href="#cb98-1882" aria-hidden="true" tabindex="-1"></a><span class="in">  numeric_synth_vars &lt;- names(synthetic_data)[sapply(synthetic_data, is.numeric)]</span></span>
<span id="cb98-1883"><a href="#cb98-1883" aria-hidden="true" tabindex="-1"></a><span class="in">  common_vars &lt;- intersect(numeric_real_vars, numeric_synth_vars)</span></span>
<span id="cb98-1884"><a href="#cb98-1884" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common_vars) == 0) return(NA_real_)</span></span>
<span id="cb98-1885"><a href="#cb98-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1886"><a href="#cb98-1886" aria-hidden="true" tabindex="-1"></a><span class="in">  qscores &lt;- replicate(num_queries, {</span></span>
<span id="cb98-1887"><a href="#cb98-1887" aria-hidden="true" tabindex="-1"></a><span class="in">    var_name &lt;- sample(common_vars, 1)</span></span>
<span id="cb98-1888"><a href="#cb98-1888" aria-hidden="true" tabindex="-1"></a><span class="in">    fun_name &lt;- sample(c("mean", "sum"), 1)</span></span>
<span id="cb98-1889"><a href="#cb98-1889" aria-hidden="true" tabindex="-1"></a><span class="in">    fun      &lt;- match.fun(fun_name)</span></span>
<span id="cb98-1890"><a href="#cb98-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1891"><a href="#cb98-1891" aria-hidden="true" tabindex="-1"></a><span class="in">    real_val  &lt;- fun(real_data[[var_name]],  na.rm = TRUE)</span></span>
<span id="cb98-1892"><a href="#cb98-1892" aria-hidden="true" tabindex="-1"></a><span class="in">    synth_val &lt;- fun(synthetic_data[[var_name]], na.rm = TRUE)</span></span>
<span id="cb98-1893"><a href="#cb98-1893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1894"><a href="#cb98-1894" aria-hidden="true" tabindex="-1"></a><span class="in">    if (!is.na(real_val) &amp;&amp; real_val != 0 &amp;&amp; !is.na(synth_val)) {</span></span>
<span id="cb98-1895"><a href="#cb98-1895" aria-hidden="true" tabindex="-1"></a><span class="in">      abs(real_val - synth_val) / abs(real_val)  # proportion difference (0–1)</span></span>
<span id="cb98-1896"><a href="#cb98-1896" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb98-1897"><a href="#cb98-1897" aria-hidden="true" tabindex="-1"></a><span class="in">      0</span></span>
<span id="cb98-1898"><a href="#cb98-1898" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb98-1899"><a href="#cb98-1899" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb98-1900"><a href="#cb98-1900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1901"><a href="#cb98-1901" aria-hidden="true" tabindex="-1"></a><span class="in">  mean(qscores, na.rm = TRUE)</span></span>
<span id="cb98-1902"><a href="#cb98-1902" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1903"><a href="#cb98-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1904"><a href="#cb98-1904" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Compute and present ----</span></span>
<span id="cb98-1905"><a href="#cb98-1905" aria-hidden="true" tabindex="-1"></a><span class="in">qscore_tbl &lt;- tibble::tibble(</span></span>
<span id="cb98-1906"><a href="#cb98-1906" aria-hidden="true" tabindex="-1"></a><span class="in">  Dataset = c("Parametric MICE", "CART Imputation",</span></span>
<span id="cb98-1907"><a href="#cb98-1907" aria-hidden="true" tabindex="-1"></a><span class="in">              "Synthpop (Low Fidelity)", "Metadata-Based"),</span></span>
<span id="cb98-1908"><a href="#cb98-1908" aria-hidden="true" tabindex="-1"></a><span class="in">  QScore = c(</span></span>
<span id="cb98-1909"><a href="#cb98-1909" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_qscore(heart_failure, syn_data_1),</span></span>
<span id="cb98-1910"><a href="#cb98-1910" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_qscore(heart_failure, syn_cart_1),</span></span>
<span id="cb98-1911"><a href="#cb98-1911" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_qscore(heart_failure, syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-1912"><a href="#cb98-1912" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_qscore(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-1913"><a href="#cb98-1913" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1914"><a href="#cb98-1914" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-1915"><a href="#cb98-1915" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::mutate(</span></span>
<span id="cb98-1916"><a href="#cb98-1916" aria-hidden="true" tabindex="-1"></a><span class="in">    QScore_num = QScore,                                   # keep numeric 0–1</span></span>
<span id="cb98-1917"><a href="#cb98-1917" aria-hidden="true" tabindex="-1"></a><span class="in">    QScore_pct = scales::percent(QScore_num, accuracy = 0.1) # pretty %</span></span>
<span id="cb98-1918"><a href="#cb98-1918" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1919"><a href="#cb98-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1920"><a href="#cb98-1920" aria-hidden="true" tabindex="-1"></a><span class="in"># --- User-friendly table (as percentages) ---</span></span>
<span id="cb98-1921"><a href="#cb98-1921" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-1922"><a href="#cb98-1922" aria-hidden="true" tabindex="-1"></a><span class="in">  qscore_tbl %&gt;% dplyr::select(Dataset, `QScore (%)` = QScore_pct),</span></span>
<span id="cb98-1923"><a href="#cb98-1923" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Quality Score (QScore) — average % difference in aggregates (lower is better)",</span></span>
<span id="cb98-1924"><a href="#cb98-1924" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lr"</span></span>
<span id="cb98-1925"><a href="#cb98-1925" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1926"><a href="#cb98-1926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1927"><a href="#cb98-1927" aria-hidden="true" tabindex="-1"></a><span class="in"># --- Horizontal bar chart (percent axis) ---</span></span>
<span id="cb98-1928"><a href="#cb98-1928" aria-hidden="true" tabindex="-1"></a><span class="in">pal &lt;- c("#B0D99B", "#528AA8", "#FFB6DB", "#264653", "#2A9D8F")</span></span>
<span id="cb98-1929"><a href="#cb98-1929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1930"><a href="#cb98-1930" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(qscore_tbl, aes(y = Dataset, x = QScore_num, fill = Dataset)) +</span></span>
<span id="cb98-1931"><a href="#cb98-1931" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-1932"><a href="#cb98-1932" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(aes(label = QScore_pct), hjust = -0.1, size = 3.5) +</span></span>
<span id="cb98-1933"><a href="#cb98-1933" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = setNames(pal[seq_len(nrow(qscore_tbl))], qscore_tbl$Dataset)) +</span></span>
<span id="cb98-1934"><a href="#cb98-1934" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = scales::percent_format(accuracy = 1), limits = c(0, 1),</span></span>
<span id="cb98-1935"><a href="#cb98-1935" aria-hidden="true" tabindex="-1"></a><span class="in">                     expand = expansion(mult = c(0, 0.05))) +</span></span>
<span id="cb98-1936"><a href="#cb98-1936" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb98-1937"><a href="#cb98-1937" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "QScore Comparison (Lower is Better)",</span></span>
<span id="cb98-1938"><a href="#cb98-1938" aria-hidden="true" tabindex="-1"></a><span class="in">    subtitle = "Average percentage difference between real and synthetic aggregates across random queries",</span></span>
<span id="cb98-1939"><a href="#cb98-1939" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "QScore (%)", y = NULL</span></span>
<span id="cb98-1940"><a href="#cb98-1940" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb98-1941"><a href="#cb98-1941" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb98-1942"><a href="#cb98-1942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-1943"><a href="#cb98-1943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1944"><a href="#cb98-1944" aria-hidden="true" tabindex="-1"></a><span class="fu">## Privacy / Disclosure Risk</span></span>
<span id="cb98-1945"><a href="#cb98-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1946"><a href="#cb98-1946" aria-hidden="true" tabindex="-1"></a><span class="fu">### Check for Replication of Real Value Combinations</span></span>
<span id="cb98-1947"><a href="#cb98-1947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1948"><a href="#cb98-1948" aria-hidden="true" tabindex="-1"></a>This check identifies if any records in the synthetic data are exact duplicates of those in the real dataset. High replication increases privacy risks, so minimal or no duplication is ideal for preserving privacy.</span>
<span id="cb98-1949"><a href="#cb98-1949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1950"><a href="#cb98-1950" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Check for Replication of Real Value Combinations, fig.width=8, fig.height=5, fig.align='center', out.width='99%'}</span></span>
<span id="cb98-1951"><a href="#cb98-1951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1952"><a href="#cb98-1952" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Replicated rows count ----</span></span>
<span id="cb98-1953"><a href="#cb98-1953" aria-hidden="true" tabindex="-1"></a><span class="in">check_replicated_rows &lt;- function(real_data, synthetic_data) {</span></span>
<span id="cb98-1954"><a href="#cb98-1954" aria-hidden="true" tabindex="-1"></a><span class="in">  combined &lt;- rbind(real_data, synthetic_data)</span></span>
<span id="cb98-1955"><a href="#cb98-1955" aria-hidden="true" tabindex="-1"></a><span class="in">  sum(duplicated(combined))</span></span>
<span id="cb98-1956"><a href="#cb98-1956" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1957"><a href="#cb98-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1958"><a href="#cb98-1958" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Build results table ----</span></span>
<span id="cb98-1959"><a href="#cb98-1959" aria-hidden="true" tabindex="-1"></a><span class="in">replication_tbl &lt;- tibble::tibble(</span></span>
<span id="cb98-1960"><a href="#cb98-1960" aria-hidden="true" tabindex="-1"></a><span class="in">  Dataset = c("Parametric MICE", "Non-Parametric CART", </span></span>
<span id="cb98-1961"><a href="#cb98-1961" aria-hidden="true" tabindex="-1"></a><span class="in">              "Synthpop (Low Fidelity)", "Metadata-Based"),</span></span>
<span id="cb98-1962"><a href="#cb98-1962" aria-hidden="true" tabindex="-1"></a><span class="in">  Replicated_Rows = c(</span></span>
<span id="cb98-1963"><a href="#cb98-1963" aria-hidden="true" tabindex="-1"></a><span class="in">    check_replicated_rows(heart_failure, syn_data_1),</span></span>
<span id="cb98-1964"><a href="#cb98-1964" aria-hidden="true" tabindex="-1"></a><span class="in">    check_replicated_rows(heart_failure, syn_cart_1),</span></span>
<span id="cb98-1965"><a href="#cb98-1965" aria-hidden="true" tabindex="-1"></a><span class="in">    check_replicated_rows(heart_failure, syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-1966"><a href="#cb98-1966" aria-hidden="true" tabindex="-1"></a><span class="in">    check_replicated_rows(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-1967"><a href="#cb98-1967" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1968"><a href="#cb98-1968" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-1969"><a href="#cb98-1969" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb98-1970"><a href="#cb98-1970" aria-hidden="true" tabindex="-1"></a><span class="in">    Total_Rows = nrow(heart_failure),</span></span>
<span id="cb98-1971"><a href="#cb98-1971" aria-hidden="true" tabindex="-1"></a><span class="in">    Replication_Percent = round((Replicated_Rows / Total_Rows) * 100, 2),</span></span>
<span id="cb98-1972"><a href="#cb98-1972" aria-hidden="true" tabindex="-1"></a><span class="in">    Status = ifelse(Replicated_Rows &gt; 0, "⚠️ Replication Found", "✅ No Replication")</span></span>
<span id="cb98-1973"><a href="#cb98-1973" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-1974"><a href="#cb98-1974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1975"><a href="#cb98-1975" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- User-friendly table ----</span></span>
<span id="cb98-1976"><a href="#cb98-1976" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-1977"><a href="#cb98-1977" aria-hidden="true" tabindex="-1"></a><span class="in">  replication_tbl,</span></span>
<span id="cb98-1978"><a href="#cb98-1978" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Replication Check: Exact Matching Rows Between Real and Synthetic Datasets",</span></span>
<span id="cb98-1979"><a href="#cb98-1979" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrrrl"</span></span>
<span id="cb98-1980"><a href="#cb98-1980" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-1981"><a href="#cb98-1981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-1982"><a href="#cb98-1982" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Optional: bar chart if any replication &gt; 0 ----</span></span>
<span id="cb98-1983"><a href="#cb98-1983" aria-hidden="true" tabindex="-1"></a><span class="in">if (any(replication_tbl$Replicated_Rows &gt; 0)) {</span></span>
<span id="cb98-1984"><a href="#cb98-1984" aria-hidden="true" tabindex="-1"></a><span class="in">  pal &lt;- c("#B0D99B", "#528AA8", "#FFB6DB", "#264653")</span></span>
<span id="cb98-1985"><a href="#cb98-1985" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-1986"><a href="#cb98-1986" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(replication_tbl, aes(y = Dataset, x = Replicated_Rows, fill = Dataset)) +</span></span>
<span id="cb98-1987"><a href="#cb98-1987" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-1988"><a href="#cb98-1988" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(aes(label = Replicated_Rows), hjust = -0.1, size = 3.5) +</span></span>
<span id="cb98-1989"><a href="#cb98-1989" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(values = pal[seq_len(nrow(replication_tbl))]) +</span></span>
<span id="cb98-1990"><a href="#cb98-1990" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb98-1991"><a href="#cb98-1991" aria-hidden="true" tabindex="-1"></a><span class="in">      title = "Replication of Real Rows in Synthetic Data",</span></span>
<span id="cb98-1992"><a href="#cb98-1992" aria-hidden="true" tabindex="-1"></a><span class="in">      subtitle = "Counts of exact duplicated rows across real and synthetic datasets",</span></span>
<span id="cb98-1993"><a href="#cb98-1993" aria-hidden="true" tabindex="-1"></a><span class="in">      x = "Number of Replicated Rows", y = NULL</span></span>
<span id="cb98-1994"><a href="#cb98-1994" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb98-1995"><a href="#cb98-1995" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_minimal()</span></span>
<span id="cb98-1996"><a href="#cb98-1996" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb98-1997"><a href="#cb98-1997" aria-hidden="true" tabindex="-1"></a><span class="in">  cat("✅ No replicated rows were found across any synthetic dataset. No plot is generated.\n")</span></span>
<span id="cb98-1998"><a href="#cb98-1998" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-1999"><a href="#cb98-1999" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-2000"><a href="#cb98-2000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2001"><a href="#cb98-2001" aria-hidden="true" tabindex="-1"></a><span class="fu">### Check for Unique Value Combinations</span></span>
<span id="cb98-2002"><a href="#cb98-2002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2003"><a href="#cb98-2003" aria-hidden="true" tabindex="-1"></a>This analysis compares the number of unique row combinations between the real and synthetic datasets. A high number of unique combinations in the synthetic data suggests that it captures diverse patterns while minimising the replication of sensitive information, enhancing privacy protection.</span>
<span id="cb98-2004"><a href="#cb98-2004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2005"><a href="#cb98-2005" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Check for Unique Value Combinations, fig.width=10, fig.height=4, fig.align='center', out.width='99%'}</span></span>
<span id="cb98-2006"><a href="#cb98-2006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2007"><a href="#cb98-2007" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Count unique rows ----</span></span>
<span id="cb98-2008"><a href="#cb98-2008" aria-hidden="true" tabindex="-1"></a><span class="in">unique_combinations &lt;- function(data) {</span></span>
<span id="cb98-2009"><a href="#cb98-2009" aria-hidden="true" tabindex="-1"></a><span class="in">  nrow(unique(data))</span></span>
<span id="cb98-2010"><a href="#cb98-2010" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2011"><a href="#cb98-2011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2012"><a href="#cb98-2012" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Build results table ----</span></span>
<span id="cb98-2013"><a href="#cb98-2013" aria-hidden="true" tabindex="-1"></a><span class="in">unique_tbl &lt;- tibble::tibble(</span></span>
<span id="cb98-2014"><a href="#cb98-2014" aria-hidden="true" tabindex="-1"></a><span class="in">  Dataset = c("Real Data", "Parametric MICE", </span></span>
<span id="cb98-2015"><a href="#cb98-2015" aria-hidden="true" tabindex="-1"></a><span class="in">              "Non-Parametric CART", "Synthpop (Low Fidelity)", </span></span>
<span id="cb98-2016"><a href="#cb98-2016" aria-hidden="true" tabindex="-1"></a><span class="in">              "Metadata-Based"),</span></span>
<span id="cb98-2017"><a href="#cb98-2017" aria-hidden="true" tabindex="-1"></a><span class="in">  Unique_Combinations = c(</span></span>
<span id="cb98-2018"><a href="#cb98-2018" aria-hidden="true" tabindex="-1"></a><span class="in">    unique_combinations(heart_failure),</span></span>
<span id="cb98-2019"><a href="#cb98-2019" aria-hidden="true" tabindex="-1"></a><span class="in">    unique_combinations(syn_data_1),</span></span>
<span id="cb98-2020"><a href="#cb98-2020" aria-hidden="true" tabindex="-1"></a><span class="in">    unique_combinations(syn_cart_1),</span></span>
<span id="cb98-2021"><a href="#cb98-2021" aria-hidden="true" tabindex="-1"></a><span class="in">    unique_combinations(syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-2022"><a href="#cb98-2022" aria-hidden="true" tabindex="-1"></a><span class="in">    unique_combinations(syn_data_metadata)</span></span>
<span id="cb98-2023"><a href="#cb98-2023" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-2024"><a href="#cb98-2024" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-2025"><a href="#cb98-2025" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb98-2026"><a href="#cb98-2026" aria-hidden="true" tabindex="-1"></a><span class="in">    Total_Rows = c(nrow(heart_failure), rep(nrow(heart_failure), 4)),</span></span>
<span id="cb98-2027"><a href="#cb98-2027" aria-hidden="true" tabindex="-1"></a><span class="in">    Percent_Unique = round((Unique_Combinations / Total_Rows) * 100, 2)</span></span>
<span id="cb98-2028"><a href="#cb98-2028" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-2029"><a href="#cb98-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2030"><a href="#cb98-2030" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- User-friendly table ----</span></span>
<span id="cb98-2031"><a href="#cb98-2031" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-2032"><a href="#cb98-2032" aria-hidden="true" tabindex="-1"></a><span class="in">  unique_tbl,</span></span>
<span id="cb98-2033"><a href="#cb98-2033" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Unique Value Combinations in Real vs. Synthetic Datasets",</span></span>
<span id="cb98-2034"><a href="#cb98-2034" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrr"</span></span>
<span id="cb98-2035"><a href="#cb98-2035" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2036"><a href="#cb98-2036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2037"><a href="#cb98-2037" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Plot only if any dataset has &gt; 0 unique rows ----</span></span>
<span id="cb98-2038"><a href="#cb98-2038" aria-hidden="true" tabindex="-1"></a><span class="in">if (any(unique_tbl$Unique_Combinations &gt; 0, na.rm = TRUE)) {</span></span>
<span id="cb98-2039"><a href="#cb98-2039" aria-hidden="true" tabindex="-1"></a><span class="in">  pal &lt;- c("#B0D99B", "#528AA8", "#FFB6DB", "#264653", "#2A9D8F")</span></span>
<span id="cb98-2040"><a href="#cb98-2040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2041"><a href="#cb98-2041" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(unique_tbl, aes(y = Dataset, x = Percent_Unique, fill = Dataset)) +</span></span>
<span id="cb98-2042"><a href="#cb98-2042" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-2043"><a href="#cb98-2043" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(aes(label = paste0(Percent_Unique, "%")), hjust = -0.1, size = 3.5) +</span></span>
<span id="cb98-2044"><a href="#cb98-2044" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(values = pal[seq_len(nrow(unique_tbl))]) +</span></span>
<span id="cb98-2045"><a href="#cb98-2045" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_continuous(limits = c(0, 100)) +</span></span>
<span id="cb98-2046"><a href="#cb98-2046" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb98-2047"><a href="#cb98-2047" aria-hidden="true" tabindex="-1"></a><span class="in">      title = "Percentage of Unique Row Combinations",</span></span>
<span id="cb98-2048"><a href="#cb98-2048" aria-hidden="true" tabindex="-1"></a><span class="in">      subtitle = "Higher % means fewer duplicates within the dataset",</span></span>
<span id="cb98-2049"><a href="#cb98-2049" aria-hidden="true" tabindex="-1"></a><span class="in">      x = "Percent of Rows that are Unique", y = NULL</span></span>
<span id="cb98-2050"><a href="#cb98-2050" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb98-2051"><a href="#cb98-2051" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_minimal()</span></span>
<span id="cb98-2052"><a href="#cb98-2052" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb98-2053"><a href="#cb98-2053" aria-hidden="true" tabindex="-1"></a><span class="in">  cat("✅ No unique combinations detected across datasets.  No plot is generated. \n")</span></span>
<span id="cb98-2054"><a href="#cb98-2054" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2055"><a href="#cb98-2055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-2056"><a href="#cb98-2056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2057"><a href="#cb98-2057" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exact Match Score</span></span>
<span id="cb98-2058"><a href="#cb98-2058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2059"><a href="#cb98-2059" aria-hidden="true" tabindex="-1"></a>The Exact Match Score measures how many individual records in the synthetic data are identical to records in the real dataset. Lower scores are ideal for privacy preservation, as high exact matches may pose privacy risks.</span>
<span id="cb98-2060"><a href="#cb98-2060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2061"><a href="#cb98-2061" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for Exact Match Score:</span>
<span id="cb98-2062"><a href="#cb98-2062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2063"><a href="#cb98-2063" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0 - 0.1**: Strong privacy protection with minimal or no exact matches, ideal for most privacy-preserving synthetic data.</span>
<span id="cb98-2064"><a href="#cb98-2064" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0.1 - 0.3**: Moderate exact matches, indicating some privacy risk but generally acceptable for many use cases.</span>
<span id="cb98-2065"><a href="#cb98-2065" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0.3 - 0.5**: Higher exact matches, raising privacy concerns. Review is needed to ensure proper data generation.</span>
<span id="cb98-2066"><a href="#cb98-2066" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Above 0.5**: Significant privacy risk, as the synthetic data too closely replicates the real.</span>
<span id="cb98-2067"><a href="#cb98-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2068"><a href="#cb98-2068" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Exact Match Score, fig.width=8, fig.height=5, fig.align='center', out.width='99%'}</span></span>
<span id="cb98-2069"><a href="#cb98-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2070"><a href="#cb98-2070" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Exact Match Score ----</span></span>
<span id="cb98-2071"><a href="#cb98-2071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2072"><a href="#cb98-2072" aria-hidden="true" tabindex="-1"></a><span class="in">calculate_exact_match_score &lt;- function(real_data, synthetic_data) {</span></span>
<span id="cb98-2073"><a href="#cb98-2073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2074"><a href="#cb98-2074" aria-hidden="true" tabindex="-1"></a><span class="in"># Use only shared columns (to avoid mismatched names / prefixed cols)</span></span>
<span id="cb98-2075"><a href="#cb98-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2076"><a href="#cb98-2076" aria-hidden="true" tabindex="-1"></a><span class="in">common_cols &lt;- intersect(names(real_data), names(synthetic_data))</span></span>
<span id="cb98-2077"><a href="#cb98-2077" aria-hidden="true" tabindex="-1"></a><span class="in">if (length(common_cols) == 0) {</span></span>
<span id="cb98-2078"><a href="#cb98-2078" aria-hidden="true" tabindex="-1"></a><span class="in">return(list(</span></span>
<span id="cb98-2079"><a href="#cb98-2079" aria-hidden="true" tabindex="-1"></a><span class="in">exact_match_rows   = NA_integer_,</span></span>
<span id="cb98-2080"><a href="#cb98-2080" aria-hidden="true" tabindex="-1"></a><span class="in">total_synth_rows   = NA_integer_,</span></span>
<span id="cb98-2081"><a href="#cb98-2081" aria-hidden="true" tabindex="-1"></a><span class="in">exact_match_score  = NA_real_</span></span>
<span id="cb98-2082"><a href="#cb98-2082" aria-hidden="true" tabindex="-1"></a><span class="in">))</span></span>
<span id="cb98-2083"><a href="#cb98-2083" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2084"><a href="#cb98-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2085"><a href="#cb98-2085" aria-hidden="true" tabindex="-1"></a><span class="in">real_aligned  &lt;- real_data[, common_cols, drop = FALSE]</span></span>
<span id="cb98-2086"><a href="#cb98-2086" aria-hidden="true" tabindex="-1"></a><span class="in">synth_aligned &lt;- synthetic_data[, common_cols, drop = FALSE]</span></span>
<span id="cb98-2087"><a href="#cb98-2087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2088"><a href="#cb98-2088" aria-hidden="true" tabindex="-1"></a><span class="in"># Helper: build a row "signature" string for fast equality checking</span></span>
<span id="cb98-2089"><a href="#cb98-2089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2090"><a href="#cb98-2090" aria-hidden="true" tabindex="-1"></a><span class="in">row_sig &lt;- function(df) {</span></span>
<span id="cb98-2091"><a href="#cb98-2091" aria-hidden="true" tabindex="-1"></a><span class="in">apply(</span></span>
<span id="cb98-2092"><a href="#cb98-2092" aria-hidden="true" tabindex="-1"></a><span class="in">df,</span></span>
<span id="cb98-2093"><a href="#cb98-2093" aria-hidden="true" tabindex="-1"></a><span class="in">1,</span></span>
<span id="cb98-2094"><a href="#cb98-2094" aria-hidden="true" tabindex="-1"></a><span class="in">function(rowvals) paste(</span></span>
<span id="cb98-2095"><a href="#cb98-2095" aria-hidden="true" tabindex="-1"></a><span class="in">ifelse(is.na(rowvals), "&lt;NA&gt;", as.character(rowvals)),</span></span>
<span id="cb98-2096"><a href="#cb98-2096" aria-hidden="true" tabindex="-1"></a><span class="in">collapse = "||"</span></span>
<span id="cb98-2097"><a href="#cb98-2097" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2098"><a href="#cb98-2098" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2099"><a href="#cb98-2099" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2100"><a href="#cb98-2100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2101"><a href="#cb98-2101" aria-hidden="true" tabindex="-1"></a><span class="in">real_keys  &lt;- unique(row_sig(real_aligned))</span></span>
<span id="cb98-2102"><a href="#cb98-2102" aria-hidden="true" tabindex="-1"></a><span class="in">synth_keys &lt;- row_sig(synth_aligned)</span></span>
<span id="cb98-2103"><a href="#cb98-2103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2104"><a href="#cb98-2104" aria-hidden="true" tabindex="-1"></a><span class="in"># Count exact matches (synthetic rows that appear verbatim in real)</span></span>
<span id="cb98-2105"><a href="#cb98-2105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2106"><a href="#cb98-2106" aria-hidden="true" tabindex="-1"></a><span class="in">is_exact_match &lt;- synth_keys %in% real_keys</span></span>
<span id="cb98-2107"><a href="#cb98-2107" aria-hidden="true" tabindex="-1"></a><span class="in">n_matches      &lt;- sum(is_exact_match, na.rm = TRUE)</span></span>
<span id="cb98-2108"><a href="#cb98-2108" aria-hidden="true" tabindex="-1"></a><span class="in">total_synth    &lt;- length(synth_keys)</span></span>
<span id="cb98-2109"><a href="#cb98-2109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2110"><a href="#cb98-2110" aria-hidden="true" tabindex="-1"></a><span class="in"># Proportion of synthetic rows that are exact copies of real rows</span></span>
<span id="cb98-2111"><a href="#cb98-2111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2112"><a href="#cb98-2112" aria-hidden="true" tabindex="-1"></a><span class="in">exact_score &lt;- n_matches / total_synth</span></span>
<span id="cb98-2113"><a href="#cb98-2113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2114"><a href="#cb98-2114" aria-hidden="true" tabindex="-1"></a><span class="in">list(</span></span>
<span id="cb98-2115"><a href="#cb98-2115" aria-hidden="true" tabindex="-1"></a><span class="in">exact_match_rows   = n_matches,</span></span>
<span id="cb98-2116"><a href="#cb98-2116" aria-hidden="true" tabindex="-1"></a><span class="in">total_synth_rows   = total_synth,</span></span>
<span id="cb98-2117"><a href="#cb98-2117" aria-hidden="true" tabindex="-1"></a><span class="in">exact_match_score  = exact_score</span></span>
<span id="cb98-2118"><a href="#cb98-2118" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2119"><a href="#cb98-2119" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2120"><a href="#cb98-2120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2121"><a href="#cb98-2121" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Results table ----</span></span>
<span id="cb98-2122"><a href="#cb98-2122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2123"><a href="#cb98-2123" aria-hidden="true" tabindex="-1"></a><span class="in">exact_mice     &lt;- calculate_exact_match_score(heart_failure, syn_data_1)</span></span>
<span id="cb98-2124"><a href="#cb98-2124" aria-hidden="true" tabindex="-1"></a><span class="in">exact_cart     &lt;- calculate_exact_match_score(heart_failure, syn_cart_1)</span></span>
<span id="cb98-2125"><a href="#cb98-2125" aria-hidden="true" tabindex="-1"></a><span class="in">exact_synthpop &lt;- calculate_exact_match_score(heart_failure, syn_data_low_fidelity_synthpop)</span></span>
<span id="cb98-2126"><a href="#cb98-2126" aria-hidden="true" tabindex="-1"></a><span class="in">exact_meta     &lt;- calculate_exact_match_score(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-2127"><a href="#cb98-2127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2128"><a href="#cb98-2128" aria-hidden="true" tabindex="-1"></a><span class="in">exact_tbl &lt;- tibble::tibble(</span></span>
<span id="cb98-2129"><a href="#cb98-2129" aria-hidden="true" tabindex="-1"></a><span class="in">Dataset = c("Parametric MICE",</span></span>
<span id="cb98-2130"><a href="#cb98-2130" aria-hidden="true" tabindex="-1"></a><span class="in">"Non-Parametric CART",</span></span>
<span id="cb98-2131"><a href="#cb98-2131" aria-hidden="true" tabindex="-1"></a><span class="in">"Synthpop (Low Fidelity)",</span></span>
<span id="cb98-2132"><a href="#cb98-2132" aria-hidden="true" tabindex="-1"></a><span class="in">"Metadata-Based"),</span></span>
<span id="cb98-2133"><a href="#cb98-2133" aria-hidden="true" tabindex="-1"></a><span class="in">Exact_Match_Rows = c(</span></span>
<span id="cb98-2134"><a href="#cb98-2134" aria-hidden="true" tabindex="-1"></a><span class="in">exact_mice$exact_match_rows,</span></span>
<span id="cb98-2135"><a href="#cb98-2135" aria-hidden="true" tabindex="-1"></a><span class="in">exact_cart$exact_match_rows,</span></span>
<span id="cb98-2136"><a href="#cb98-2136" aria-hidden="true" tabindex="-1"></a><span class="in">exact_synthpop$exact_match_rows,</span></span>
<span id="cb98-2137"><a href="#cb98-2137" aria-hidden="true" tabindex="-1"></a><span class="in">exact_meta$exact_match_rows</span></span>
<span id="cb98-2138"><a href="#cb98-2138" aria-hidden="true" tabindex="-1"></a><span class="in">),</span></span>
<span id="cb98-2139"><a href="#cb98-2139" aria-hidden="true" tabindex="-1"></a><span class="in">Total_Synthetic_Rows = c(</span></span>
<span id="cb98-2140"><a href="#cb98-2140" aria-hidden="true" tabindex="-1"></a><span class="in">exact_mice$total_synth_rows,</span></span>
<span id="cb98-2141"><a href="#cb98-2141" aria-hidden="true" tabindex="-1"></a><span class="in">exact_cart$total_synth_rows,</span></span>
<span id="cb98-2142"><a href="#cb98-2142" aria-hidden="true" tabindex="-1"></a><span class="in">exact_synthpop$total_synth_rows,</span></span>
<span id="cb98-2143"><a href="#cb98-2143" aria-hidden="true" tabindex="-1"></a><span class="in">exact_meta$total_synth_rows</span></span>
<span id="cb98-2144"><a href="#cb98-2144" aria-hidden="true" tabindex="-1"></a><span class="in">),</span></span>
<span id="cb98-2145"><a href="#cb98-2145" aria-hidden="true" tabindex="-1"></a><span class="in">Exact_Match_Score = c(</span></span>
<span id="cb98-2146"><a href="#cb98-2146" aria-hidden="true" tabindex="-1"></a><span class="in">exact_mice$exact_match_score,</span></span>
<span id="cb98-2147"><a href="#cb98-2147" aria-hidden="true" tabindex="-1"></a><span class="in">exact_cart$exact_match_score,</span></span>
<span id="cb98-2148"><a href="#cb98-2148" aria-hidden="true" tabindex="-1"></a><span class="in">exact_synthpop$exact_match_score,</span></span>
<span id="cb98-2149"><a href="#cb98-2149" aria-hidden="true" tabindex="-1"></a><span class="in">exact_meta$exact_match_score</span></span>
<span id="cb98-2150"><a href="#cb98-2150" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2151"><a href="#cb98-2151" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-2152"><a href="#cb98-2152" aria-hidden="true" tabindex="-1"></a><span class="in">mutate(</span></span>
<span id="cb98-2153"><a href="#cb98-2153" aria-hidden="true" tabindex="-1"></a><span class="in">Exact_Match_Percent = round(Exact_Match_Score * 100, 3),</span></span>
<span id="cb98-2154"><a href="#cb98-2154" aria-hidden="true" tabindex="-1"></a><span class="in">Status = dplyr::case_when(</span></span>
<span id="cb98-2155"><a href="#cb98-2155" aria-hidden="true" tabindex="-1"></a><span class="in">is.na(Exact_Match_Score)                     ~ "— Insufficient data",</span></span>
<span id="cb98-2156"><a href="#cb98-2156" aria-hidden="true" tabindex="-1"></a><span class="in">Exact_Match_Score == 0                       ~ "✅ 0% (Strong Privacy)",</span></span>
<span id="cb98-2157"><a href="#cb98-2157" aria-hidden="true" tabindex="-1"></a><span class="in">Exact_Match_Score &lt;= 0.10                    ~ "⚠️ ≤10% (Low Risk)",</span></span>
<span id="cb98-2158"><a href="#cb98-2158" aria-hidden="true" tabindex="-1"></a><span class="in">Exact_Match_Score &lt;= 0.30                    ~ "❗ 10–30% (Moderate Risk)",</span></span>
<span id="cb98-2159"><a href="#cb98-2159" aria-hidden="true" tabindex="-1"></a><span class="in">Exact_Match_Score &lt;= 0.50                    ~ "❌ 30–50% (High Risk)",</span></span>
<span id="cb98-2160"><a href="#cb98-2160" aria-hidden="true" tabindex="-1"></a><span class="in">TRUE                                         ~ "🚫 &gt;50% (Critical Risk)"</span></span>
<span id="cb98-2161"><a href="#cb98-2161" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2162"><a href="#cb98-2162" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2163"><a href="#cb98-2163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2164"><a href="#cb98-2164" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- User-friendly table ----</span></span>
<span id="cb98-2165"><a href="#cb98-2165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2166"><a href="#cb98-2166" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-2167"><a href="#cb98-2167" aria-hidden="true" tabindex="-1"></a><span class="in">exact_tbl %&gt;%</span></span>
<span id="cb98-2168"><a href="#cb98-2168" aria-hidden="true" tabindex="-1"></a><span class="in">dplyr::select(</span></span>
<span id="cb98-2169"><a href="#cb98-2169" aria-hidden="true" tabindex="-1"></a><span class="in">Dataset,</span></span>
<span id="cb98-2170"><a href="#cb98-2170" aria-hidden="true" tabindex="-1"></a><span class="in">Exact_Match_Rows,</span></span>
<span id="cb98-2171"><a href="#cb98-2171" aria-hidden="true" tabindex="-1"></a><span class="in">Total_Synthetic_Rows,</span></span>
<span id="cb98-2172"><a href="#cb98-2172" aria-hidden="true" tabindex="-1"></a><span class="in">`Exact Match %` = Exact_Match_Percent,</span></span>
<span id="cb98-2173"><a href="#cb98-2173" aria-hidden="true" tabindex="-1"></a><span class="in">Status</span></span>
<span id="cb98-2174"><a href="#cb98-2174" aria-hidden="true" tabindex="-1"></a><span class="in">),</span></span>
<span id="cb98-2175"><a href="#cb98-2175" aria-hidden="true" tabindex="-1"></a><span class="in">caption = "Exact Match Score: Proportion of synthetic rows that are perfect duplicates of real rows (lower is better for privacy)",</span></span>
<span id="cb98-2176"><a href="#cb98-2176" aria-hidden="true" tabindex="-1"></a><span class="in">align   = "lrrrl"</span></span>
<span id="cb98-2177"><a href="#cb98-2177" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2178"><a href="#cb98-2178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2179"><a href="#cb98-2179" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Conditional plot ----</span></span>
<span id="cb98-2180"><a href="#cb98-2180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2181"><a href="#cb98-2181" aria-hidden="true" tabindex="-1"></a><span class="in">if (any(exact_tbl$Exact_Match_Score &gt; 0, na.rm = TRUE)) {</span></span>
<span id="cb98-2182"><a href="#cb98-2182" aria-hidden="true" tabindex="-1"></a><span class="in">pal &lt;- c("#B0D99B", "#528AA8", "#FFB6DB", "#264653")</span></span>
<span id="cb98-2183"><a href="#cb98-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2184"><a href="#cb98-2184" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(</span></span>
<span id="cb98-2185"><a href="#cb98-2185" aria-hidden="true" tabindex="-1"></a><span class="in">exact_tbl,</span></span>
<span id="cb98-2186"><a href="#cb98-2186" aria-hidden="true" tabindex="-1"></a><span class="in">aes(</span></span>
<span id="cb98-2187"><a href="#cb98-2187" aria-hidden="true" tabindex="-1"></a><span class="in">y = Dataset,</span></span>
<span id="cb98-2188"><a href="#cb98-2188" aria-hidden="true" tabindex="-1"></a><span class="in">x = Exact_Match_Percent,</span></span>
<span id="cb98-2189"><a href="#cb98-2189" aria-hidden="true" tabindex="-1"></a><span class="in">fill = Dataset</span></span>
<span id="cb98-2190"><a href="#cb98-2190" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2191"><a href="#cb98-2191" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb98-2192"><a href="#cb98-2192" aria-hidden="true" tabindex="-1"></a><span class="in">geom_col(alpha = 0.9, show.legend = FALSE, na.rm = TRUE) +</span></span>
<span id="cb98-2193"><a href="#cb98-2193" aria-hidden="true" tabindex="-1"></a><span class="in">geom_text(</span></span>
<span id="cb98-2194"><a href="#cb98-2194" aria-hidden="true" tabindex="-1"></a><span class="in">aes(label = paste0(Exact_Match_Percent, "%")),</span></span>
<span id="cb98-2195"><a href="#cb98-2195" aria-hidden="true" tabindex="-1"></a><span class="in">hjust = -0.1,</span></span>
<span id="cb98-2196"><a href="#cb98-2196" aria-hidden="true" tabindex="-1"></a><span class="in">size = 3.5</span></span>
<span id="cb98-2197"><a href="#cb98-2197" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb98-2198"><a href="#cb98-2198" aria-hidden="true" tabindex="-1"></a><span class="in">scale_fill_manual(values = pal[seq_len(nrow(exact_tbl))]) +</span></span>
<span id="cb98-2199"><a href="#cb98-2199" aria-hidden="true" tabindex="-1"></a><span class="in">scale_x_continuous(</span></span>
<span id="cb98-2200"><a href="#cb98-2200" aria-hidden="true" tabindex="-1"></a><span class="in">limits = c(</span></span>
<span id="cb98-2201"><a href="#cb98-2201" aria-hidden="true" tabindex="-1"></a><span class="in">0,</span></span>
<span id="cb98-2202"><a href="#cb98-2202" aria-hidden="true" tabindex="-1"></a><span class="in">max(exact_tbl$Exact_Match_Percent, na.rm = TRUE) * 1.15</span></span>
<span id="cb98-2203"><a href="#cb98-2203" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2204"><a href="#cb98-2204" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb98-2205"><a href="#cb98-2205" aria-hidden="true" tabindex="-1"></a><span class="in">labs(</span></span>
<span id="cb98-2206"><a href="#cb98-2206" aria-hidden="true" tabindex="-1"></a><span class="in">title    = "Exact Match Score by Synthetic Method",</span></span>
<span id="cb98-2207"><a href="#cb98-2207" aria-hidden="true" tabindex="-1"></a><span class="in">subtitle = "Lower values mean fewer fully replicated real rows appear in the synthetic data",</span></span>
<span id="cb98-2208"><a href="#cb98-2208" aria-hidden="true" tabindex="-1"></a><span class="in">x        = "Exact Match (%)",</span></span>
<span id="cb98-2209"><a href="#cb98-2209" aria-hidden="true" tabindex="-1"></a><span class="in">y        = NULL</span></span>
<span id="cb98-2210"><a href="#cb98-2210" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb98-2211"><a href="#cb98-2211" aria-hidden="true" tabindex="-1"></a><span class="in">theme_minimal()</span></span>
<span id="cb98-2212"><a href="#cb98-2212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2213"><a href="#cb98-2213" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb98-2214"><a href="#cb98-2214" aria-hidden="true" tabindex="-1"></a><span class="in">cat("✅ All Exact Match Scores are 0%. No exact real-row replications found, so no plot is generated.\n")</span></span>
<span id="cb98-2215"><a href="#cb98-2215" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2216"><a href="#cb98-2216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-2217"><a href="#cb98-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2218"><a href="#cb98-2218" aria-hidden="true" tabindex="-1"></a><span class="fu">### Neighbors' Privacy Score</span></span>
<span id="cb98-2219"><a href="#cb98-2219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2220"><a href="#cb98-2220" aria-hidden="true" tabindex="-1"></a>The Neighbors' Privacy Score identifies real records that are "too similar" to synthetic records by using a nearest-neighbors search. This metric helps evaluate privacy risk by detecting synthetic records that closely resemble real data, which could compromise privacy.</span>
<span id="cb98-2221"><a href="#cb98-2221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2222"><a href="#cb98-2222" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for Neighbors' Privacy Score:</span>
<span id="cb98-2223"><a href="#cb98-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2224"><a href="#cb98-2224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0 - 0.1**: Indicates strong privacy protection, with very few synthetic records too similar to real ones.</span>
<span id="cb98-2225"><a href="#cb98-2225" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0.1 - 0.3**: Moderate similarity, where privacy risk exists but remains within acceptable limits for many cases.</span>
<span id="cb98-2226"><a href="#cb98-2226" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Above 0.3**: Higher similarity, raising privacy concerns and requiring review to ensure the synthetic data is not too closely mimicking real data.</span>
<span id="cb98-2227"><a href="#cb98-2227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2228"><a href="#cb98-2228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Neighbors Privacy Score, fig.width=8, fig.height=5, fig.align='center', out.width='99%'}</span></span>
<span id="cb98-2229"><a href="#cb98-2229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2230"><a href="#cb98-2230" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Neighbors' Privacy Score ----</span></span>
<span id="cb98-2231"><a href="#cb98-2231" aria-hidden="true" tabindex="-1"></a><span class="in">calculate_neighbors_privacy_score &lt;- function(real_data, synthetic_data, k = 5, threshold = 0.01) {</span></span>
<span id="cb98-2232"><a href="#cb98-2232" aria-hidden="true" tabindex="-1"></a><span class="in">  # Numeric-only columns</span></span>
<span id="cb98-2233"><a href="#cb98-2233" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- real_data[sapply(real_data, is.numeric)]</span></span>
<span id="cb98-2234"><a href="#cb98-2234" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- synthetic_data[sapply(synthetic_data, is.numeric)]</span></span>
<span id="cb98-2235"><a href="#cb98-2235" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2236"><a href="#cb98-2236" aria-hidden="true" tabindex="-1"></a><span class="in">  if (ncol(real_num) == 0 || ncol(synth_num) == 0) return(NA_real_)</span></span>
<span id="cb98-2237"><a href="#cb98-2237" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2238"><a href="#cb98-2238" aria-hidden="true" tabindex="-1"></a><span class="in">  # Keep only common columns</span></span>
<span id="cb98-2239"><a href="#cb98-2239" aria-hidden="true" tabindex="-1"></a><span class="in">  common &lt;- intersect(names(real_num), names(synth_num))</span></span>
<span id="cb98-2240"><a href="#cb98-2240" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common) == 0) return(NA_real_)</span></span>
<span id="cb98-2241"><a href="#cb98-2241" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- real_num[common]</span></span>
<span id="cb98-2242"><a href="#cb98-2242" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- synth_num[common]</span></span>
<span id="cb98-2243"><a href="#cb98-2243" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2244"><a href="#cb98-2244" aria-hidden="true" tabindex="-1"></a><span class="in">  # Complete cases</span></span>
<span id="cb98-2245"><a href="#cb98-2245" aria-hidden="true" tabindex="-1"></a><span class="in">  real_cc  &lt;- real_num[complete.cases(real_num), , drop = FALSE]</span></span>
<span id="cb98-2246"><a href="#cb98-2246" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_cc &lt;- synth_num[complete.cases(synth_num), , drop = FALSE]</span></span>
<span id="cb98-2247"><a href="#cb98-2247" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2248"><a href="#cb98-2248" aria-hidden="true" tabindex="-1"></a><span class="in">  if (nrow(real_cc) &lt; k || nrow(synth_cc) == 0) return(NA_real_)</span></span>
<span id="cb98-2249"><a href="#cb98-2249" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2250"><a href="#cb98-2250" aria-hidden="true" tabindex="-1"></a><span class="in">  # Standardise</span></span>
<span id="cb98-2251"><a href="#cb98-2251" aria-hidden="true" tabindex="-1"></a><span class="in">  real_scaled  &lt;- scale(real_cc)</span></span>
<span id="cb98-2252"><a href="#cb98-2252" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_scaled &lt;- scale(synth_cc)</span></span>
<span id="cb98-2253"><a href="#cb98-2253" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2254"><a href="#cb98-2254" aria-hidden="true" tabindex="-1"></a><span class="in">  # k-NN distances from synthetic → real</span></span>
<span id="cb98-2255"><a href="#cb98-2255" aria-hidden="true" tabindex="-1"></a><span class="in">  neighbors &lt;- FNN::get.knnx(real_scaled, synth_scaled, k)$nn.dist</span></span>
<span id="cb98-2256"><a href="#cb98-2256" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2257"><a href="#cb98-2257" aria-hidden="true" tabindex="-1"></a><span class="in">  # Privacy risk: synthetic records "too close" to real</span></span>
<span id="cb98-2258"><a href="#cb98-2258" aria-hidden="true" tabindex="-1"></a><span class="in">  close_matches &lt;- sum(rowMeans(neighbors) &lt; threshold)</span></span>
<span id="cb98-2259"><a href="#cb98-2259" aria-hidden="true" tabindex="-1"></a><span class="in">  score &lt;- close_matches / nrow(synth_scaled)</span></span>
<span id="cb98-2260"><a href="#cb98-2260" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2261"><a href="#cb98-2261" aria-hidden="true" tabindex="-1"></a><span class="in">  return(score)</span></span>
<span id="cb98-2262"><a href="#cb98-2262" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2263"><a href="#cb98-2263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2264"><a href="#cb98-2264" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Build results table ----</span></span>
<span id="cb98-2265"><a href="#cb98-2265" aria-hidden="true" tabindex="-1"></a><span class="in">neighbors_tbl &lt;- tibble::tibble(</span></span>
<span id="cb98-2266"><a href="#cb98-2266" aria-hidden="true" tabindex="-1"></a><span class="in">  Dataset = c("Parametric MICE", "Non-Parametric CART",</span></span>
<span id="cb98-2267"><a href="#cb98-2267" aria-hidden="true" tabindex="-1"></a><span class="in">              "Synthpop (Low Fidelity)", "Metadata-Based"),</span></span>
<span id="cb98-2268"><a href="#cb98-2268" aria-hidden="true" tabindex="-1"></a><span class="in">  Neighbors_Privacy_Score = c(</span></span>
<span id="cb98-2269"><a href="#cb98-2269" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_neighbors_privacy_score(heart_failure, syn_data_1),</span></span>
<span id="cb98-2270"><a href="#cb98-2270" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_neighbors_privacy_score(heart_failure, syn_cart_1),</span></span>
<span id="cb98-2271"><a href="#cb98-2271" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_neighbors_privacy_score(heart_failure, syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-2272"><a href="#cb98-2272" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_neighbors_privacy_score(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-2273"><a href="#cb98-2273" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-2274"><a href="#cb98-2274" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-2275"><a href="#cb98-2275" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb98-2276"><a href="#cb98-2276" aria-hidden="true" tabindex="-1"></a><span class="in">    Neighbors_Privacy_Score = round(Neighbors_Privacy_Score, 4),</span></span>
<span id="cb98-2277"><a href="#cb98-2277" aria-hidden="true" tabindex="-1"></a><span class="in">    Status = case_when(</span></span>
<span id="cb98-2278"><a href="#cb98-2278" aria-hidden="true" tabindex="-1"></a><span class="in">      Neighbors_Privacy_Score == 0 ~ "✅ No risky neighbors",</span></span>
<span id="cb98-2279"><a href="#cb98-2279" aria-hidden="true" tabindex="-1"></a><span class="in">      Neighbors_Privacy_Score &lt; 0.01 ~ "⚠️ Low risk",</span></span>
<span id="cb98-2280"><a href="#cb98-2280" aria-hidden="true" tabindex="-1"></a><span class="in">      TRUE ~ "❌ High risk"</span></span>
<span id="cb98-2281"><a href="#cb98-2281" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb98-2282"><a href="#cb98-2282" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-2283"><a href="#cb98-2283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2284"><a href="#cb98-2284" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- User-friendly table ----</span></span>
<span id="cb98-2285"><a href="#cb98-2285" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-2286"><a href="#cb98-2286" aria-hidden="true" tabindex="-1"></a><span class="in">  neighbors_tbl,</span></span>
<span id="cb98-2287"><a href="#cb98-2287" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Neighbors' Privacy Score: Proportion of synthetic records too close to real records (lower is better for privacy)",</span></span>
<span id="cb98-2288"><a href="#cb98-2288" aria-hidden="true" tabindex="-1"></a><span class="in">  align = "lrr"</span></span>
<span id="cb98-2289"><a href="#cb98-2289" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2290"><a href="#cb98-2290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2291"><a href="#cb98-2291" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Plot only if any score &gt; 0 ----</span></span>
<span id="cb98-2292"><a href="#cb98-2292" aria-hidden="true" tabindex="-1"></a><span class="in">if (any(neighbors_tbl$Neighbors_Privacy_Score &gt; 0)) {</span></span>
<span id="cb98-2293"><a href="#cb98-2293" aria-hidden="true" tabindex="-1"></a><span class="in">  pal &lt;- c("#B0D99B", "#528AA8", "#FFB6DB", "#264653")</span></span>
<span id="cb98-2294"><a href="#cb98-2294" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2295"><a href="#cb98-2295" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(neighbors_tbl, aes(y = Dataset, x = Neighbors_Privacy_Score, fill = Dataset)) +</span></span>
<span id="cb98-2296"><a href="#cb98-2296" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_col(alpha = 0.9, show.legend = FALSE) +</span></span>
<span id="cb98-2297"><a href="#cb98-2297" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(aes(label = Neighbors_Privacy_Score), hjust = -0.1, size = 3.5) +</span></span>
<span id="cb98-2298"><a href="#cb98-2298" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(values = pal[seq_len(nrow(neighbors_tbl))]) +</span></span>
<span id="cb98-2299"><a href="#cb98-2299" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_continuous(labels = scales::percent_format(accuracy = 0.1)) +</span></span>
<span id="cb98-2300"><a href="#cb98-2300" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb98-2301"><a href="#cb98-2301" aria-hidden="true" tabindex="-1"></a><span class="in">      title = "Neighbors' Privacy Score by Synthetic Method",</span></span>
<span id="cb98-2302"><a href="#cb98-2302" aria-hidden="true" tabindex="-1"></a><span class="in">      subtitle = "Lower values mean synthetic records are less likely to be close replicas of real individuals",</span></span>
<span id="cb98-2303"><a href="#cb98-2303" aria-hidden="true" tabindex="-1"></a><span class="in">      x = "Privacy Score (Proportion of risky neighbors)", y = NULL</span></span>
<span id="cb98-2304"><a href="#cb98-2304" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb98-2305"><a href="#cb98-2305" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_minimal()</span></span>
<span id="cb98-2306"><a href="#cb98-2306" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb98-2307"><a href="#cb98-2307" aria-hidden="true" tabindex="-1"></a><span class="in">  cat("✅ All Neighbors' Privacy Scores are 0. No risky neighbors detected. No plot is generated.\n")</span></span>
<span id="cb98-2308"><a href="#cb98-2308" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2309"><a href="#cb98-2309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-2310"><a href="#cb98-2310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2311"><a href="#cb98-2311" aria-hidden="true" tabindex="-1"></a><span class="fu">### Membership Inference Score</span></span>
<span id="cb98-2312"><a href="#cb98-2312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2313"><a href="#cb98-2313" aria-hidden="true" tabindex="-1"></a>The Membership Inference Score evaluates the risk of membership inference attacks, which attempt to determine whether a specific record belongs to the real dataset. This metric helps assess the vulnerability of synthetic data to privacy breaches.</span>
<span id="cb98-2314"><a href="#cb98-2314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2315"><a href="#cb98-2315" aria-hidden="true" tabindex="-1"></a>Ideal Ranges for Membership Inference Score:</span>
<span id="cb98-2316"><a href="#cb98-2316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2317"><a href="#cb98-2317" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0 - 0.1**: Indicates low risk, where it is unlikely that membership inference attacks can accurately identify real records.</span>
<span id="cb98-2318"><a href="#cb98-2318" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0.1 - 0.3**: Moderate risk, where some vulnerability to membership inference exists but may still be acceptable for certain use cases.</span>
<span id="cb98-2319"><a href="#cb98-2319" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Above 0.3**: High risk, suggesting significant privacy concerns as the synthetic data could reveal membership information about the real records.</span>
<span id="cb98-2320"><a href="#cb98-2320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2321"><a href="#cb98-2321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Membership Inference Score, fig.width=8, fig.height=5, fig.align='center', out.width='99%'}</span></span>
<span id="cb98-2322"><a href="#cb98-2322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2323"><a href="#cb98-2323" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Membership Inference Score ----</span></span>
<span id="cb98-2324"><a href="#cb98-2324" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpreted as the proportion of synthetic records that are "too close" to the real data.</span></span>
<span id="cb98-2325"><a href="#cb98-2325" aria-hidden="true" tabindex="-1"></a><span class="in"># Lower is better (safer).</span></span>
<span id="cb98-2326"><a href="#cb98-2326" aria-hidden="true" tabindex="-1"></a><span class="in">calculate_membership_inference_score &lt;- function(real_data, synthetic_data, k = 5, threshold = 0.01) {</span></span>
<span id="cb98-2327"><a href="#cb98-2327" aria-hidden="true" tabindex="-1"></a><span class="in">  # Numeric-only columns</span></span>
<span id="cb98-2328"><a href="#cb98-2328" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- real_data[sapply(real_data, is.numeric)]</span></span>
<span id="cb98-2329"><a href="#cb98-2329" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- synthetic_data[sapply(synthetic_data, is.numeric)]</span></span>
<span id="cb98-2330"><a href="#cb98-2330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2331"><a href="#cb98-2331" aria-hidden="true" tabindex="-1"></a><span class="in">  # Guardrails</span></span>
<span id="cb98-2332"><a href="#cb98-2332" aria-hidden="true" tabindex="-1"></a><span class="in">  if (ncol(real_num) == 0 || ncol(synth_num) == 0) return(NA_real_)</span></span>
<span id="cb98-2333"><a href="#cb98-2333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2334"><a href="#cb98-2334" aria-hidden="true" tabindex="-1"></a><span class="in">  # Keep only common numeric variables</span></span>
<span id="cb98-2335"><a href="#cb98-2335" aria-hidden="true" tabindex="-1"></a><span class="in">  common &lt;- intersect(names(real_num), names(synth_num))</span></span>
<span id="cb98-2336"><a href="#cb98-2336" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(common) == 0) return(NA_real_)</span></span>
<span id="cb98-2337"><a href="#cb98-2337" aria-hidden="true" tabindex="-1"></a><span class="in">  real_num  &lt;- real_num[common]</span></span>
<span id="cb98-2338"><a href="#cb98-2338" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_num &lt;- synth_num[common]</span></span>
<span id="cb98-2339"><a href="#cb98-2339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2340"><a href="#cb98-2340" aria-hidden="true" tabindex="-1"></a><span class="in">  # Use complete cases</span></span>
<span id="cb98-2341"><a href="#cb98-2341" aria-hidden="true" tabindex="-1"></a><span class="in">  real_cc  &lt;- real_num[complete.cases(real_num), , drop = FALSE]</span></span>
<span id="cb98-2342"><a href="#cb98-2342" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_cc &lt;- synth_num[complete.cases(synth_num), , drop = FALSE]</span></span>
<span id="cb98-2343"><a href="#cb98-2343" aria-hidden="true" tabindex="-1"></a><span class="in">  if (nrow(real_cc) &lt; k || nrow(synth_cc) == 0) return(NA_real_)</span></span>
<span id="cb98-2344"><a href="#cb98-2344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2345"><a href="#cb98-2345" aria-hidden="true" tabindex="-1"></a><span class="in">  # Standardize</span></span>
<span id="cb98-2346"><a href="#cb98-2346" aria-hidden="true" tabindex="-1"></a><span class="in">  real_scaled  &lt;- scale(real_cc)</span></span>
<span id="cb98-2347"><a href="#cb98-2347" aria-hidden="true" tabindex="-1"></a><span class="in">  synth_scaled &lt;- scale(synth_cc)</span></span>
<span id="cb98-2348"><a href="#cb98-2348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2349"><a href="#cb98-2349" aria-hidden="true" tabindex="-1"></a><span class="in">  # k-NN distances from synthetic → real</span></span>
<span id="cb98-2350"><a href="#cb98-2350" aria-hidden="true" tabindex="-1"></a><span class="in">  nn &lt;- FNN::get.knnx(real_scaled, synth_scaled, k)$nn.dist</span></span>
<span id="cb98-2351"><a href="#cb98-2351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2352"><a href="#cb98-2352" aria-hidden="true" tabindex="-1"></a><span class="in">  # Score: proportion of synthetic records whose average distance to k nearest reals is below threshold</span></span>
<span id="cb98-2353"><a href="#cb98-2353" aria-hidden="true" tabindex="-1"></a><span class="in">  risky &lt;- sum(rowMeans(nn) &lt; threshold)</span></span>
<span id="cb98-2354"><a href="#cb98-2354" aria-hidden="true" tabindex="-1"></a><span class="in">  risky / nrow(synth_scaled)</span></span>
<span id="cb98-2355"><a href="#cb98-2355" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2356"><a href="#cb98-2356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2357"><a href="#cb98-2357" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Results table ----</span></span>
<span id="cb98-2358"><a href="#cb98-2358" aria-hidden="true" tabindex="-1"></a><span class="in">mis_tbl &lt;- tibble::tibble(</span></span>
<span id="cb98-2359"><a href="#cb98-2359" aria-hidden="true" tabindex="-1"></a><span class="in">  Dataset = c("Parametric MICE", "Non-Parametric CART",</span></span>
<span id="cb98-2360"><a href="#cb98-2360" aria-hidden="true" tabindex="-1"></a><span class="in">              "Synthpop (Low Fidelity)", "Metadata-Based"),</span></span>
<span id="cb98-2361"><a href="#cb98-2361" aria-hidden="true" tabindex="-1"></a><span class="in">  Membership_Inference_Score = c(</span></span>
<span id="cb98-2362"><a href="#cb98-2362" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_membership_inference_score(heart_failure, syn_data_1),</span></span>
<span id="cb98-2363"><a href="#cb98-2363" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_membership_inference_score(heart_failure, syn_cart_1),</span></span>
<span id="cb98-2364"><a href="#cb98-2364" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_membership_inference_score(heart_failure, syn_data_low_fidelity_synthpop),</span></span>
<span id="cb98-2365"><a href="#cb98-2365" aria-hidden="true" tabindex="-1"></a><span class="in">    calculate_membership_inference_score(heart_failure, syn_data_metadata)</span></span>
<span id="cb98-2366"><a href="#cb98-2366" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-2367"><a href="#cb98-2367" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb98-2368"><a href="#cb98-2368" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb98-2369"><a href="#cb98-2369" aria-hidden="true" tabindex="-1"></a><span class="in">    Membership_Inference_Score = round(Membership_Inference_Score, 4),</span></span>
<span id="cb98-2370"><a href="#cb98-2370" aria-hidden="true" tabindex="-1"></a><span class="in">    Status = dplyr::case_when(</span></span>
<span id="cb98-2371"><a href="#cb98-2371" aria-hidden="true" tabindex="-1"></a><span class="in">      is.na(Membership_Inference_Score)              ~ "— Insufficient data",</span></span>
<span id="cb98-2372"><a href="#cb98-2372" aria-hidden="true" tabindex="-1"></a><span class="in">      Membership_Inference_Score == 0                ~ "✅ No risky memberships",</span></span>
<span id="cb98-2373"><a href="#cb98-2373" aria-hidden="true" tabindex="-1"></a><span class="in">      Membership_Inference_Score &lt; 0.01              ~ "⚠️ Low risk",</span></span>
<span id="cb98-2374"><a href="#cb98-2374" aria-hidden="true" tabindex="-1"></a><span class="in">      TRUE                                           ~ "❌ High risk"</span></span>
<span id="cb98-2375"><a href="#cb98-2375" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb98-2376"><a href="#cb98-2376" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb98-2377"><a href="#cb98-2377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2378"><a href="#cb98-2378" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- User-friendly table ----</span></span>
<span id="cb98-2379"><a href="#cb98-2379" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(</span></span>
<span id="cb98-2380"><a href="#cb98-2380" aria-hidden="true" tabindex="-1"></a><span class="in">  mis_tbl,</span></span>
<span id="cb98-2381"><a href="#cb98-2381" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Membership Inference Score: Proportion of synthetic records that are very close to real records (lower is better for privacy)",</span></span>
<span id="cb98-2382"><a href="#cb98-2382" aria-hidden="true" tabindex="-1"></a><span class="in">  align   = "lrr"</span></span>
<span id="cb98-2383"><a href="#cb98-2383" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb98-2384"><a href="#cb98-2384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2385"><a href="#cb98-2385" aria-hidden="true" tabindex="-1"></a><span class="in"># ---- Plot only if any risky memberships (&gt; 0) ----</span></span>
<span id="cb98-2386"><a href="#cb98-2386" aria-hidden="true" tabindex="-1"></a><span class="in">if (any(mis_tbl$Membership_Inference_Score &gt; 0, na.rm = TRUE)) {</span></span>
<span id="cb98-2387"><a href="#cb98-2387" aria-hidden="true" tabindex="-1"></a><span class="in">  pal &lt;- c("#B0D99B", "#528AA8", "#FFB6DB", "#264653")</span></span>
<span id="cb98-2388"><a href="#cb98-2388" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb98-2389"><a href="#cb98-2389" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(mis_tbl, aes(y = Dataset, x = Membership_Inference_Score, fill = Dataset)) +</span></span>
<span id="cb98-2390"><a href="#cb98-2390" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_col(alpha = 0.9, show.legend = FALSE, na.rm = TRUE) +</span></span>
<span id="cb98-2391"><a href="#cb98-2391" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(</span></span>
<span id="cb98-2392"><a href="#cb98-2392" aria-hidden="true" tabindex="-1"></a><span class="in">      aes(label = ifelse(is.na(Membership_Inference_Score), "NA",</span></span>
<span id="cb98-2393"><a href="#cb98-2393" aria-hidden="true" tabindex="-1"></a><span class="in">                         scales::percent(Membership_Inference_Score, accuracy = 0.01))),</span></span>
<span id="cb98-2394"><a href="#cb98-2394" aria-hidden="true" tabindex="-1"></a><span class="in">      hjust = -0.1, size = 3.5</span></span>
<span id="cb98-2395"><a href="#cb98-2395" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb98-2396"><a href="#cb98-2396" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(values = pal[seq_len(nrow(mis_tbl))]) +</span></span>
<span id="cb98-2397"><a href="#cb98-2397" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +</span></span>
<span id="cb98-2398"><a href="#cb98-2398" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb98-2399"><a href="#cb98-2399" aria-hidden="true" tabindex="-1"></a><span class="in">      title    = "Membership Inference Score by Synthetic Method",</span></span>
<span id="cb98-2400"><a href="#cb98-2400" aria-hidden="true" tabindex="-1"></a><span class="in">      subtitle = "Lower values indicate better privacy protection",</span></span>
<span id="cb98-2401"><a href="#cb98-2401" aria-hidden="true" tabindex="-1"></a><span class="in">      x = "Score (Proportion of risky memberships)",</span></span>
<span id="cb98-2402"><a href="#cb98-2402" aria-hidden="true" tabindex="-1"></a><span class="in">      y = NULL</span></span>
<span id="cb98-2403"><a href="#cb98-2403" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb98-2404"><a href="#cb98-2404" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_minimal()</span></span>
<span id="cb98-2405"><a href="#cb98-2405" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb98-2406"><a href="#cb98-2406" aria-hidden="true" tabindex="-1"></a><span class="in">  cat("✅ All Membership Inference Scores are 0. No risky memberships detected. No plot is generated. \n")</span></span>
<span id="cb98-2407"><a href="#cb98-2407" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-2408"><a href="#cb98-2408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-2409"><a href="#cb98-2409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2410"><a href="#cb98-2410" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusions</span></span>
<span id="cb98-2411"><a href="#cb98-2411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2412"><a href="#cb98-2412" aria-hidden="true" tabindex="-1"></a>This report evaluated the fidelity, utility, privacy, and overall quality of synthetic data generated using parametric MICE, non-parametric CART, Synthpop, and metadata-based methods. Key findings include:</span>
<span id="cb98-2413"><a href="#cb98-2413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2414"><a href="#cb98-2414" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data Structure Preservation**: All methods preserved the structure of the real dataset, though minor variations in variable distributions were observed.</span>
<span id="cb98-2415"><a href="#cb98-2415" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Categorical Variables**: Most synthetic datasets retained categorical levels, but frequency distribution discrepancies were particularly notable in Synthpop data.</span>
<span id="cb98-2416"><a href="#cb98-2416" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Numeric Variables**: The range and distribution of numeric variables were largely maintained across methods, with slight variations in density plots.</span>
<span id="cb98-2417"><a href="#cb98-2417" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Correlation &amp; Mutual Information**: While most methods captured variable relationships, weaker correlations and lower mutual information scores suggested some loss of feature dependencies in certain synthetic datasets.</span>
<span id="cb98-2418"><a href="#cb98-2418" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Utility (Prediction Score)**: Synthetic data performed similarly to real data in predictive modeling, though slight reductions in accuracy and increased pMSE indicated less precise representation of the real dataset's predictive capabilities.</span>
<span id="cb98-2419"><a href="#cb98-2419" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Privacy (Exact Match &amp; Neighbors' Privacy Scores)**: All synthetic datasets demonstrated strong privacy protection, with zero values for both Exact Match and Neighbors' Privacy Scores. This indicates that no synthetic records were identical to or highly similar to any real records, affirming robust privacy across all methods.</span>
<span id="cb98-2420"><a href="#cb98-2420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2421"><a href="#cb98-2421" aria-hidden="true" tabindex="-1"></a>In conclusion, synthetic data generated through these methods provides a balance between utility and privacy, though method selection should align with specific analytic or privacy needs.</span>
<span id="cb98-2422"><a href="#cb98-2422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2423"><a href="#cb98-2423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Stop the parallel cluster}</span></span>
<span id="cb98-2424"><a href="#cb98-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2425"><a href="#cb98-2425" aria-hidden="true" tabindex="-1"></a><span class="in"># Stop the parallel cluster</span></span>
<span id="cb98-2426"><a href="#cb98-2426" aria-hidden="true" tabindex="-1"></a><span class="in">stopCluster(cl)</span></span>
<span id="cb98-2427"><a href="#cb98-2427" aria-hidden="true" tabindex="-1"></a><span class="in">registerDoSEQ()</span></span>
<span id="cb98-2428"><a href="#cb98-2428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>